<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>runwu2204</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-11-23T05:06:44.000Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>runwu2204</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GBK乱码</title>
    <link href="http://example.com/2024/11/23/%E5%BC%80%E5%8F%91/JAVA/GBK%E4%B9%B1%E7%A0%81/"/>
    <id>http://example.com/2024/11/23/%E5%BC%80%E5%8F%91/JAVA/GBK%E4%B9%B1%E7%A0%81/</id>
    <published>2024-11-22T17:38:47.000Z</published>
    <updated>2024-11-23T05:06:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>java加个参数<code>-Dfile.encoding=utf-8</code>即可 </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;java加个参数&lt;code&gt;-Dfile.encoding=utf-8&lt;/code&gt;即可 &lt;/p&gt;
</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="JAVA" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/JAVA/"/>
    
    
  </entry>
  
  <entry>
    <title>封装jar包</title>
    <link href="http://example.com/2024/11/23/%E5%BC%80%E5%8F%91/JAVA/%E5%B0%81%E8%A3%85jar%E5%8C%85/"/>
    <id>http://example.com/2024/11/23/%E5%BC%80%E5%8F%91/JAVA/%E5%B0%81%E8%A3%85jar%E5%8C%85/</id>
    <published>2024-11-22T16:41:58.000Z</published>
    <updated>2024-11-22T16:55:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>可使用idea直接进行封包</p><p>注意需要在项目文件夹的resources下创建META-INF文件夹后创建一个<code>MANIFEST.MF</code>文件</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230050993.png"                      alt="image-20241123005006956"                ></p><p>最简单的MANIFEST如下所示只需要包含对应的main函数所在的类即可</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">Main-Class: org.example.Main</span><br></pre></td></tr></table></figure></div><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230044530.png"                      alt="image-20241123004413348"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230044328.png"                      alt="image-20241123004425241"                ></p><p>可以直接自动生成</p><blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230046968.png"                      alt="image-20241123004654876"                ></p></blockquote><p>也可直接创建空的</p><blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230054660.png"                      alt="image-20241123005429570"                ></p><p>然后手动添加module的output</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230054742.png"                      alt="image-20241123005455651"                ></p><p>效果是一样的</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;可使用idea直接进行封包&lt;/p&gt;
&lt;p&gt;注意需要在项目文件夹的resources下创建META-INF文件夹后创建一个&lt;code&gt;MANIFEST.MF&lt;/code&gt;文件&lt;/p&gt;
&lt;p&gt;&lt;img  
                     lazyload
      </summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="JAVA" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/JAVA/"/>
    
    
  </entry>
  
  <entry>
    <title>基本环境配置</title>
    <link href="http://example.com/2024/11/22/%E5%BC%80%E5%8F%91/JAVA/JAVA-agent/%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://example.com/2024/11/22/%E5%BC%80%E5%8F%91/JAVA/JAVA-agent/%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2024-11-22T15:15:58.000Z</published>
    <updated>2024-11-23T06:56:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="instrumentation"><a href="#instrumentation" class="headerlink" title="instrumentation"></a>instrumentation</h2><blockquote><p><a class="link"   href="https://www.cnblogs.com/liboware/p/12496195.html" >Java探针技术-instrutment中retransformClasses和redefineClasses - 洛神灬殇 - 博客园 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://www.cnblogs.com/stateis0/p/9062201.html" >探秘 Java 热部署三（Java agent agentmain） - 莫那-鲁道 - 博客园 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><a class="link"   href="https://cloud.tencent.com/developer/article/2050980" >1000个字带你一次性搞懂JavaAgent技术，反正我是彻底服了-腾讯云开发者社区-腾讯云 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h3 id="premain"><a href="#premain" class="headerlink" title="premain"></a>premain</h3><blockquote><p>先于main执行</p><p>在MANIFEST中插入</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Premain-Class: xxx.xxx.xxx</span><br></pre></td></tr></table></figure></div><p>对应类中需要带有</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Agentmain</span><span class="params">(String agentArgs, Instrumentation inst)</span></span><br></pre></td></tr></table></figure></div><p>调用方式</p><p>在-jar前面加入 <code> -javaagent:xxx.jar</code></p><p>具体类似<code>java -javaagent:agent.jar -jar main.jar</code>(agent jar指对应带<code>Agent-Class</code>或者<code>Premain-Class</code>的jar包 而<code>main.jar</code>指的是对应带main 也就是需要被hook的jar包)</p><p>主要使用<em>transform</em>(相当于加载class前需要调用的函数)来实现加载对应class时调用修改函数</p><p>则需要加入</p><p><code>Can-Retransform-Classes: true</code>  <code>Can-Redefine-Classes: true</code></p><p>否则会报unsupported</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Premain-Class: xxx.xxx.xxx</span><br><span class="line">Can-Retransform-Classes: true</span><br><span class="line">Can-Redefine-Classes: true</span><br></pre></td></tr></table></figure></div></blockquote><h3 id="agentmain"><a href="#agentmain" class="headerlink" title="agentmain"></a>agentmain</h3><blockquote><p>在类加载后执行</p><p>在MANIFEST中插入</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Agent-Class: xxx.xxx.xxx</span><br></pre></td></tr></table></figure></div><p>对应类中需要带有</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">agentmain</span><span class="params">(String agentArgs, Instrumentation instrumentation)</span></span><br></pre></td></tr></table></figure></div><p>调用方式</p><p>使用</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VirtualMachine</span> <span class="variable">vm</span> <span class="operator">=</span> VirtualMachine.attach(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">vm.loadAgent(<span class="string">&quot;xxx.jar&quot;</span>);<span class="comment">//会调用里面注册好的agentmain方法</span></span><br></pre></td></tr></table></figure></div></blockquote><h2 id="exp"><a href="#exp" class="headerlink" title="exp:"></a>exp:</h2><h3 id="使用premain修改构造函数，添加新函数"><a href="#使用premain修改构造函数，添加新函数" class="headerlink" title="使用premain修改构造函数，添加新函数"></a>使用premain修改构造函数，添加新函数</h3><p>AgentMainTest</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.ClassDefinition;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.ClassFileTransformer;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.IllegalClassFormatException;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"><span class="keyword">import</span> java.security.ProtectionDomain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgentMainTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">premain</span><span class="params">(String agentArgs, Instrumentation instrumentation)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;开始代理 Agent&quot;</span>);</span><br><span class="line">        instrumentation.addTransformer(<span class="keyword">new</span> <span class="title class_">Transformer</span>(),<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Transformer</span> <span class="keyword">implements</span> <span class="title class_">ClassFileTransformer</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="type">byte</span>[] classfileBuffer) <span class="keyword">throws</span> IllegalClassFormatException &#123;</span><br><span class="line">            <span class="keyword">if</span>(className.contains(<span class="string">&quot;java/util/Date&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;IN:&quot;</span>+className);</span><br><span class="line">                    ClassPool classPool=ClassPool.getDefault();</span><br><span class="line">                    CtClass clazz=classPool.get(<span class="string">&quot;java.util.Date&quot;</span>);</span><br><span class="line">                    <span class="comment">//动态添加test函数</span></span><br><span class="line">                    <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtMethod</span>(CtClass.intType, <span class="string">&quot;test&quot;</span>, <span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;CtClass.intType&#125;, clazz);</span><br><span class="line">                    ctMethod.setModifiers(Modifier.PUBLIC);</span><br><span class="line">                    ctMethod.setBody(<span class="string">&quot;&#123;return $1;&#125;&quot;</span>);</span><br><span class="line">                    clazz.addMethod(ctMethod);</span><br><span class="line">                    <span class="comment">//动态修改构造函数</span></span><br><span class="line">                    CtConstructor ctConstructor=clazz.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;);</span><br><span class="line">                    ctConstructor.setBody(<span class="string">&quot;this(0L);&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> clazz.toBytecode();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;error:&quot;</span>+className);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="comment">//其他情况直接返回</span></span><br><span class="line">                    ClassPool classPool=ClassPool.getDefault();</span><br><span class="line">                    CtClass clazz=classPool.get(className);</span><br><span class="line">                    <span class="keyword">return</span> clazz.toBytecode();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>Main</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Press Shift twice to open the Search Everywhere dialog and type `show whitespaces`,</span></span><br><span class="line"><span class="comment">// then press Enter. You can now see whitespace characters in your code.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        Date dt=<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        Method nmethod=Date.class.getDeclaredMethod(<span class="string">&quot;test&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;<span class="type">int</span>.class&#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(String.valueOf(dt));</span><br><span class="line">        System.out.println(nmethod.invoke(dt,<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Press Shift+F10 or click the green arrow button in the gutter to run the code.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>jar包结构</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230239355.png"                      alt="image-20241123023901306"                ></p><p>运行结果</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411230239430.png"                      alt="image-20241123023930393"                ></p><h3 id="使用agentmain动态补丁"><a href="#使用agentmain动态补丁" class="headerlink" title="使用agentmain动态补丁"></a>使用agentmain动态补丁</h3><p>注意需要导入对应版本java的lib下的tools.jar</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411231444355.png"                      alt="image-20241123144439254"                ></p><p>导入方式类似这样</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411231450732.png"                      alt="image-20241123145025676"                ></p><p>项目结构</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411231453055.png"                      alt="image-20241123145311019"                ></p><p>AgentMainTest</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.ClassFileTransformer;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.IllegalClassFormatException;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"><span class="keyword">import</span> java.security.ProtectionDomain;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> javassist.CtMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgentMainTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AgentMainTest</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">premain</span><span class="params">(String agentArgs, Instrumentation instrumentation)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;premain 开始代理 Agent&quot;</span>);</span><br><span class="line">        instrumentation.addTransformer(<span class="keyword">new</span> <span class="title class_">Transformer</span>(), <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">agentmain</span><span class="params">(String agentArgs, Instrumentation instrumentation)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;agentmain 开始代理 Agent&quot;</span>);</span><br><span class="line">        instrumentation.addTransformer(<span class="keyword">new</span> <span class="title class_">Transformer</span>(), <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Transformer</span> <span class="keyword">implements</span> <span class="title class_">ClassFileTransformer</span> &#123;</span><br><span class="line">        Transformer() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="type">byte</span>[] classfileBuffer) <span class="keyword">throws</span> IllegalClassFormatException &#123;</span><br><span class="line">            ClassPool classPool;</span><br><span class="line">            CtClass clazz;</span><br><span class="line">            <span class="keyword">if</span> (className.contains(<span class="string">&quot;java/util/Date&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;IN:&quot;</span> + className);</span><br><span class="line">                    classPool = ClassPool.getDefault();</span><br><span class="line">                    clazz = classPool.get(<span class="string">&quot;java.util.Date&quot;</span>);</span><br><span class="line">                    <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtMethod</span>(CtClass.intType, <span class="string">&quot;test&quot;</span>, <span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;CtClass.intType&#125;, clazz);</span><br><span class="line">                    ctMethod.setModifiers(<span class="number">1</span>);</span><br><span class="line">                    ctMethod.setBody(<span class="string">&quot;&#123;return $1;&#125;&quot;</span>);</span><br><span class="line">                    clazz.addMethod(ctMethod);</span><br><span class="line">                    <span class="type">CtConstructor</span> <span class="variable">ctConstructor</span> <span class="operator">=</span> clazz.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">CtClass</span>[<span class="number">0</span>]);</span><br><span class="line">                    ctConstructor.setBody(<span class="string">&quot;this(0L);&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> clazz.toBytecode();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception var10) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;error:&quot;</span> + className);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    classPool = ClassPool.getDefault();</span><br><span class="line">                    clazz = classPool.get(className);</span><br><span class="line">                    <span class="keyword">return</span> clazz.toBytecode();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception var11) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>Main</p><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"><span class="keyword">import</span> java.lang.management.ManagementFactory;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Press Shift twice to open the Search Everywhere dialog and type `show whitespaces`,</span></span><br><span class="line"><span class="comment">// then press Enter. You can now see whitespace characters in your code.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ManagementFactory.getRuntimeMXBean().getName();<span class="comment">//会获得pid@计算机id</span></span><br><span class="line">        String Pid=name.split(<span class="string">&quot;@&quot;</span>)[<span class="number">0</span>];<span class="comment">//获取pid</span></span><br><span class="line">        <span class="comment">// 使用VirtualMachine类来attach到当前进程</span></span><br><span class="line">        <span class="type">VirtualMachine</span> <span class="variable">vm</span> <span class="operator">=</span> VirtualMachine.attach(Pid);</span><br><span class="line">        <span class="comment">//加载agent</span></span><br><span class="line">        vm.loadAgent(<span class="string">&quot;unnamed.jar&quot;</span>);</span><br><span class="line">        Date dt=<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        Method nmethod=Date.class.getDeclaredMethod(<span class="string">&quot;test&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;<span class="type">int</span>.class&#125;);</span><br><span class="line">        System.out.println(String.valueOf(dt));</span><br><span class="line">        System.out.println(nmethod.invoke(dt,<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>MANIFEST.MF</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">Can-Redefine-Classes: true</span><br><span class="line">Premain-Class: org.example.AgentMainTest</span><br><span class="line">Agent-Class: org.example.AgentMainTest</span><br><span class="line">Can-Retransform-Classes: true</span><br><span class="line">Can-Redefine-Classes: true</span><br><span class="line">Main-Class: org.example.Main</span><br><span class="line">Class-Path: javassist-3.25.0-GA.jar tools.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>Class-Path 注意路径就是当前路径的相对地址 此处我直接在unamed文件夹调用的所以直接用这个地址</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411231453629.png"                      alt="image-20241123145338596"                ></p><p>运行效果</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411231455674.png"                      alt="image-20241123145551638"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;instrumentation&quot;&gt;&lt;a href=&quot;#instrumentation&quot; class=&quot;headerlink&quot; title=&quot;instrumentation&quot;&gt;&lt;/a&gt;instrumentation&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a cl</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="JAVA" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/JAVA/"/>
    
    <category term="JAVA-agent" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/JAVA/JAVA-agent/"/>
    
    
  </entry>
  
  <entry>
    <title>inf编写</title>
    <link href="http://example.com/2024/11/11/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/inf%E7%BC%96%E5%86%99/"/>
    <id>http://example.com/2024/11/11/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/inf%E7%BC%96%E5%86%99/</id>
    <published>2024-11-11T10:43:32.000Z</published>
    <updated>2024-11-11T10:43:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>ClassGUID</p><blockquote><p><a class="link"   href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors" >为供应商提供的系统定义的设备安装程序类 - Windows drivers | Microsoft Learn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ClassGUID&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://learn.microsoft.com/zh-cn/windows-hardware/drivers/install/system-defined-d</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Windows" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/"/>
    
    <category term="驱动" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>kbfilter</title>
    <link href="http://example.com/2024/11/10/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Rust/kbfilter/"/>
    <id>http://example.com/2024/11/10/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Rust/kbfilter/</id>
    <published>2024-11-10T14:31:51.000Z</published>
    <updated>2024-11-10T14:31:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><a class="link"   href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/wdf/using-inx-files-to-create-inf-files" >使用 INX 文件创建 INF 文件 - Windows drivers | Microsoft Learn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://learn.microsoft.com/zh-cn/windows-hardware/drivers/wdf/using-inx-files-to-create-inf-files&quot; &gt;使用 INX 文件创建 </summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Windows" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/"/>
    
    <category term="驱动" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/"/>
    
    <category term="Rust" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Rust/"/>
    
    
  </entry>
  
  <entry>
    <title>windbg调试</title>
    <link href="http://example.com/2024/11/09/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/windbg%E8%B0%83%E8%AF%95/"/>
    <id>http://example.com/2024/11/09/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/windbg%E8%B0%83%E8%AF%95/</id>
    <published>2024-11-09T09:09:00.000Z</published>
    <updated>2024-11-09T10:16:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>在虚拟机上配置net调试后</p><blockquote><p><code>bcdedit /set testsigning on</code></p><p><code>bcdedit /dbgsettings net hostip:宿主机ip(不是虚拟机) port:54321</code></p><p><code>bcdedit /dbgsettings</code></p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411091709757.png"                      alt="image-20241109170927301"                ></p><p>此处我的驱动名叫<code>echo_2.sys</code></p><p>设置对应的加载事件断点</p><p><code>sxe ld echo_2</code></p><p><code>lm m echo_2</code></p><blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3: kd&gt; lm m echo_2</span><br><span class="line">Browse full module list</span><br><span class="line">start             end                 module name</span><br><span class="line">fffff807`282b0000 fffff807`282cf000   echo_2     (deferred)     </span><br></pre></td></tr></table></figure></div></blockquote><p>IDA上设置基址为刚拿到的<code>0xfffff807282b0000</code></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411091739095.png"                      alt="image-20241109173916817"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411091740920.png"                      alt="image-20241109174023751"                ></p><p>找到要断住的位置比如我要断<code> FxDriverEntry</code></p><p>在windbg内<code>bp FFFFF807282C00F4</code></p><p>就可以中断在对应位置</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411091741255.png"                      alt="image-20241109174132063"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在虚拟机上配置net调试后&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;bcdedit /set testsigning on&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bcdedit /dbgsettings net hostip:宿主机ip(不是虚拟机) port</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Windows" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/"/>
    
    <category term="驱动" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/"/>
    
    <category term="调试" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/"/>
    
    
  </entry>
  
  <entry>
    <title>端口转发</title>
    <link href="http://example.com/2024/11/08/%E5%BC%80%E5%8F%91/VMware/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"/>
    <id>http://example.com/2024/11/08/%E5%BC%80%E5%8F%91/VMware/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/</id>
    <published>2024-11-07T17:44:30.000Z</published>
    <updated>2024-11-07T17:44:42.000Z</updated>
    
    <content type="html"><![CDATA[<p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411080101297.png"                      alt="image-20241108010100098"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411080101998.png"                      alt="image-20241108010136931"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411080101009.png"                      alt="image-20241108010151955"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411080102397.png"                      alt="image-20241108010205234"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411080102783.png"                      alt="image-20241108010217733"                ></p><p>类似于这样即可</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411080102108.png"                      alt="image-20241108010223082"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img  
                     lazyload
                     src=&quot;/images/loading.svg&quot;
                     data-src=&quot;https://cdn.jsdelivr.n</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="VMware" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/VMware/"/>
    
    
  </entry>
  
  <entry>
    <title>取消warningaserror</title>
    <link href="http://example.com/2024/11/04/%E5%BC%80%E5%8F%91/IOT/idf/%E5%8F%96%E6%B6%88warningaserror/"/>
    <id>http://example.com/2024/11/04/%E5%BC%80%E5%8F%91/IOT/idf/%E5%8F%96%E6%B6%88warningaserror/</id>
    <published>2024-11-03T18:50:08.000Z</published>
    <updated>2024-11-03T18:51:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>将源码的<code>CMakeLists.txt</code>（不是项目根目录的）在这个后面<code>idf_component_register(SRCS &quot;main.c&quot;)</code>加上<code>set_target_properties($&#123;COMPONENT_LIB&#125; PROPERTIES COMPILE_FLAGS -w )</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;将源码的&lt;code&gt;CMakeLists.txt&lt;/code&gt;（不是项目根目录的）在这个后面&lt;code&gt;idf_component_register(SRCS &amp;quot;main.c&amp;quot;)&lt;/code&gt;加上&lt;code&gt;set_target_properties($</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="IOT" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/IOT/"/>
    
    <category term="idf" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/IOT/idf/"/>
    
    
  </entry>
  
  <entry>
    <title>Anaconda</title>
    <link href="http://example.com/2024/11/03/%E5%BC%80%E5%8F%91/Python/Anaconda/"/>
    <id>http://example.com/2024/11/03/%E5%BC%80%E5%8F%91/Python/Anaconda/</id>
    <published>2024-11-03T12:10:12.000Z</published>
    <updated>2024-11-03T18:50:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>运行库缺失如<a class="link"   href="https://blog.csdn.net/qzzzxiaosheng/article/details/125119006?utm_source=app&app_version=5.0.0" >Microsoft Visual C++ 14.0 is required.-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>设置环境变量</p><p><code>conda env config vars set xxx=xxx</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;运行库缺失如&lt;a class=&quot;link&quot;   href=&quot;https://blog.csdn.net/qzzzxiaosheng/article/details/125119006?utm_source=app&amp;app_version=5.0.0&quot; &gt;Microsoft </summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Python" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>多工具链</title>
    <link href="http://example.com/2024/11/03/%E5%BC%80%E5%8F%91/Rust/%E5%A4%9A%E5%B7%A5%E5%85%B7%E9%93%BE/"/>
    <id>http://example.com/2024/11/03/%E5%BC%80%E5%8F%91/Rust/%E5%A4%9A%E5%B7%A5%E5%85%B7%E9%93%BE/</id>
    <published>2024-11-02T17:02:51.000Z</published>
    <updated>2024-11-02T17:35:38.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>rustup toolchain install xxx</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;rustup toolchain install xxx&lt;/code&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Rust" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Rust/"/>
    
    
  </entry>
  
  <entry>
    <title>Ndisfilter驱动</title>
    <link href="http://example.com/2024/11/02/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Ndisfilter%E9%A9%B1%E5%8A%A8/"/>
    <id>http://example.com/2024/11/02/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Ndisfilter%E9%A9%B1%E5%8A%A8/</id>
    <published>2024-11-02T15:48:58.000Z</published>
    <updated>2024-11-06T16:27:50.000Z</updated>
    
    <content type="html"><![CDATA[<p><a class="link"   href="https://github.com/Ragebone/MS_bindview" >Ragebone&#x2F;MS_bindview: Compiled Microsoft Bindview tool, since it was a PITA to build. 64Bit. #pls_dont_sue_me <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>需要inf文件和cer文件</p><p>inf文件用于安装驱动，cer文件用于根证书信任驱动</p><blockquote><p>如果没有根证书信任，会将自己安装的驱动优先级放到最后，会被系统默认的驱动占用，导致无法正常使用设备。</p></blockquote><p>选择service点击install</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411030036180.png"                      alt="image-20241103003622135"                ></p><p>从磁盘安装</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411030036175.png"                      alt="image-20241103003602133"                ></p><p>选择inf</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411030037832.png"                      alt="image-20241103003710782"                ></p><p>通过instDrv操纵驱动启停也可通过命令行<code>net start servicename</code> <code>net stop servicename</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://github.com/Ragebone/MS_bindview&quot; &gt;Ragebone&amp;#x2F;MS_bindview: Compiled Microsoft Bindview tool, since it w</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Windows" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/"/>
    
    <category term="驱动" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>网络重置</title>
    <link href="http://example.com/2024/11/02/%E5%BC%80%E5%8F%91/linux/%E7%BD%91%E7%BB%9C%E9%87%8D%E7%BD%AE/"/>
    <id>http://example.com/2024/11/02/%E5%BC%80%E5%8F%91/linux/%E7%BD%91%E7%BB%9C%E9%87%8D%E7%BD%AE/</id>
    <published>2024-11-01T17:52:48.000Z</published>
    <updated>2024-11-01T17:52:54.000Z</updated>
    
    <content type="html"><![CDATA[<p><a class="link"   href="https://blog.csdn.net/weixin_54513557/article/details/124722681" >Kali-Linux虚拟机连接网络失败以及kali无法ping主机的问题_kaliping不通主机-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://blog.csdn.net/weixin_54513557/article/details/124722681&quot; &gt;Kali-Linux虚拟机连接网络失败以及kali无法ping主机的问题_kaliping不通</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="linux" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>基本操作</title>
    <link href="http://example.com/2024/11/01/%E5%BC%80%E5%8F%91/Git/%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <id>http://example.com/2024/11/01/%E5%BC%80%E5%8F%91/Git/%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</id>
    <published>2024-10-31T17:32:06.000Z</published>
    <updated>2024-10-31T17:39:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>两种协议(根据链接不同)</p><blockquote><p>https 不能免密</p><p><a class="link"   href="https://github.com/username/reponame" >https://github.com/username/reponame <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>ssh 可免密</p><p><a class="link"   href="mailto:&#103;&#105;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#x2e;&#99;&#x6f;&#109;" >&#103;&#105;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#x2e;&#99;&#x6f;&#109; <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>:username&#x2F;reponame</p></blockquote><p>免密传输</p><blockquote><p>需要远程信任本地公钥</p><p><code>ssh-keygen -t rsa -C &quot;GitHub 邮箱&quot;</code></p><p>github <code>setting</code>-&gt;<code>SSH and GPG keys</code>-&gt;<code>New SSH key</code></p><p><code>ssh -T git@github.com</code> 输出successfully代表网络连接成功</p><p><code>ssh-agent -s</code>启用ssh服务后<code>ssh-add 私钥地址(默认生成在~/.ssh/id_rsa) </code></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;两种协议(根据链接不同)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;https 不能免密&lt;/p&gt;
&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://github.com/username/reponame&quot; &gt;https://github.com/user</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Git" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Git/"/>
    
    
  </entry>
  
  <entry>
    <title>1</title>
    <link href="http://example.com/2024/10/31/%E5%BC%80%E5%8F%91/MSYS2/1/"/>
    <id>http://example.com/2024/10/31/%E5%BC%80%E5%8F%91/MSYS2/1/</id>
    <published>2024-10-31T15:48:00.000Z</published>
    <updated>2024-10-31T15:48:17.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>F:\Development\env\msys2\msys2_shell.cmd -msys2 -no-start -mintty -c &quot; some command&quot;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;F:&#92;Development&#92;env&#92;msys2&#92;msys2_shell.cmd -msys2 -no-start -mintty -c &amp;quot; some command&amp;quot;&lt;/code&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="MSYS2" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/MSYS2/"/>
    
    
  </entry>
  
  <entry>
    <title>Vmware双机调试</title>
    <link href="http://example.com/2024/10/28/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vmware%E5%8F%8C%E6%9C%BA%E8%B0%83%E8%AF%95/"/>
    <id>http://example.com/2024/10/28/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vmware%E5%8F%8C%E6%9C%BA%E8%B0%83%E8%AF%95/</id>
    <published>2024-10-28T03:13:20.000Z</published>
    <updated>2024-11-08T14:29:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="串口"><a href="#串口" class="headerlink" title="串口"></a>串口</h2><p>双机调试需要配置一个虚拟机</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202410281119860.png"                      alt="image-20241028111942588"                ></p><p>在虚拟机内<code>win+r</code></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202410281154655.png"                      alt="image-20241028115407606"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202410281155364.png"                      alt="image-20241028115501314"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202410281155864.png"                      alt="image-20241028115512824"                ></p><p>command</p><blockquote><p>创建驱动服务<code>sc create mydriver binpath=c:\1.sys type=kernel start=demand error=ignore</code></p></blockquote><h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p><code>bcdedit /set testsigning on</code></p><p>重启后使用</p><p><code>bcdedit /dbgsettings net hostip:宿主机ip(不是虚拟机) port:50010</code>设置对应端口，此处我使用NAT</p><p>可以用<code>bcdedit /dbgsettings</code>查看当前调试配置</p><blockquote><p>注意：需要两个电脑相互ping通，注意防火墙的配置</p></blockquote><p>最好将虚拟机设置成静态ip，方便vmware进行端口转发</p><p>ida其他版本 </p><p>ida9.0的windbg <code>connect string</code>:<code>net:port=54321,key=w229goc2j72k.2pnz9ylivxg79.17cgn4ndol1zi.1keplhskzpdtx</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;串口&quot;&gt;&lt;a href=&quot;#串口&quot; class=&quot;headerlink&quot; title=&quot;串口&quot;&gt;&lt;/a&gt;串口&lt;/h2&gt;&lt;p&gt;双机调试需要配置一个虚拟机&lt;/p&gt;
&lt;p&gt;&lt;img  
                     lazyload
            </summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Windows" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/"/>
    
    <category term="驱动" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/"/>
    
    <category term="调试" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/"/>
    
    <category term="环境配置" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/%E8%B0%83%E8%AF%95/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    
    
  </entry>
  
  <entry>
    <title>DriverSample</title>
    <link href="http://example.com/2024/10/26/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Rust/DriverSample/"/>
    <id>http://example.com/2024/10/26/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Rust/DriverSample/</id>
    <published>2024-10-25T17:30:02.000Z</published>
    <updated>2024-11-08T12:11:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a class="link"   href="https://github.com/microsoft/Windows-rust-driver-samples" >microsoft&#x2F;Windows-rust-driver-samples: Rust port of the official Windows Driver Samples on Github. Leverages windows-drivers-rs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>wdk</p><blockquote><p>使用wdk即可，ewdk没太大必要，需要注意自己使用的wdk对应的msvc链子的版本</p></blockquote><p>LLVM</p><blockquote><p>安装完成后将<code>LLVM路径/bin</code>放入<code>LIBCLANG_PATH</code>环境变量中</p></blockquote></blockquote><p>测试的时候在根目录下<code>cargo make</code>即可</p><blockquote><p>出现以下问题</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202410260132610.png"                      alt="image-20241026013233394"                ></p><p>代表你有多个kit版本，主要需要将<code>Windows Kits\10\Lib</code>与<code>Windows Kits\10\Tools</code>出现的最高版本一样，否则他会在另外一个地方找不到对应文件的存在</p><p>例如一个10.0.26一个10.0.22,他会直接在两个地方找10.0.26，如果没找到就会报错</p><p>需要注意对应wdk安装的版本</p></blockquote><p>快速创建项目</p><blockquote><p>工具cargo-generate</p><p><code>cargo install cargo-generate</code>即可</p></blockquote><p><code>cargo generate --git https://github.com/microsoft/Windows-rust-driver-samples</code></p><h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><p>参考<a class="link"   href="https://github.com/microsoft/Windows-rust-driver-samples/issues/30" >Driver does not attach to device and does not log anything · Issue #30 · microsoft&#x2F;Windows-rust-driver-samples <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p><code>pnputil.exe /add-driver .\echo_2.inf /install</code></p><p><code>pnputil /enum-devices /class Sample /connected</code></p><p><code>devgen.exe /add /hardwareid &quot;root\ECHO_2&quot;</code></p></blockquote><p>因为对应设备使用的驱动为<code> c_swdevice.inf</code>而不是我们安装的<code>echo_2.inf</code></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411030847031.png"                      alt="image-20241103084747669"                ></p><p>原因是证书未被信任(优先级 已签名&gt;未签名)，可以先将target下的</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411030906763.png"                      alt="image-20241103090620603"                ></p><p>放入根证书 然后重新安装即可</p><h2 id="代码37"><a href="#代码37" class="headerlink" title="代码37"></a>代码37</h2><p>老工具链</p><blockquote><p>出现类似这种问题</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411082005688.png"                      alt="image-20241108200517328"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202411030913718.png"                      alt="image-20241103091322633"                ></p><p><a class="link"   href="https://github.com/microsoft/windows-drivers-rs/issues/42#issuecomment-1905274389" >https://github.com/microsoft/windows-drivers-rs/issues/42#issuecomment-1905274389 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>更改<code>wdk-sys/src/wdf.rs</code></p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WdfMinimumVersionRequired: ULONG = 33;</span><br><span class="line">//变为</span><br><span class="line">WdfMinimumVersionRequired: ULONG = 31;</span><br></pre></td></tr></table></figure></div></blockquote><p>新工具链</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h2&gt;&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://github.com/microsoft/Windows-rust-driv</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="Windows" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/"/>
    
    <category term="驱动" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/"/>
    
    <category term="Rust" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/Windows/%E9%A9%B1%E5%8A%A8/Rust/"/>
    
    
  </entry>
  
  <entry>
    <title>二次剩余</title>
    <link href="http://example.com/2024/10/02/Crypto/RSA/%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99/"/>
    <id>http://example.com/2024/10/02/Crypto/RSA/%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99/</id>
    <published>2024-10-02T09:31:02.000Z</published>
    <updated>2024-10-02T09:31:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>[<a class="link"   href="https://www.nssctf.cn/problem/262" >羊城杯 2020]GMC | NSSCTF <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[&lt;a class=&quot;link&quot;   href=&quot;https://www.nssctf.cn/problem/262&quot; &gt;羊城杯 2020]GMC | NSSCTF &lt;i class=&quot;fa-regular fa-arrow-up-right-from-square fa-</summary>
      
    
    
    
    <category term="Crypto" scheme="http://example.com/categories/Crypto/"/>
    
    <category term="RSA" scheme="http://example.com/categories/Crypto/RSA/"/>
    
    
  </entry>
  
  <entry>
    <title>vscode</title>
    <link href="http://example.com/2024/09/30/%E5%BC%80%E5%8F%91/IOT/rust/vscode/"/>
    <id>http://example.com/2024/09/30/%E5%BC%80%E5%8F%91/IOT/rust/vscode/</id>
    <published>2024-09-30T13:43:01.000Z</published>
    <updated>2024-09-30T13:53:29.000Z</updated>
    
    <content type="html"><![CDATA[<p><a class="link"   href="https://github.com/rust-embedded/cortex-m-quickstart" >rust-embedded&#x2F;cortex-m-quickstart: Template to develop bare metal applications for Cortex-M microcontrollers (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>需要<code>cargo generate</code></p><p><code>cargo install generate</code>即可</p><p>stm32f103c8t6的 memory.x</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Linker script for the STM32F103C8T6 */</span></span><br><span class="line">MEMORY</span><br><span class="line">&#123;</span><br><span class="line">  FLASH : ORIGIN = <span class="number">0x08000000</span>, LENGTH = <span class="number">64</span>K</span><br><span class="line">  RAM : ORIGIN = <span class="number">0x20000000</span>, LENGTH = <span class="number">20</span>K</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://github.com/rust-embedded/cortex-m-quickstart&quot; &gt;rust-embedded&amp;#x2F;cortex-m-quickstart: Template to develo</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="IOT" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/IOT/"/>
    
    <category term="rust" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/IOT/rust/"/>
    
    
  </entry>
  
  <entry>
    <title>设置Androidavd</title>
    <link href="http://example.com/2024/09/27/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/%E8%AE%BE%E7%BD%AEAndroidavd/"/>
    <id>http://example.com/2024/09/27/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/%E8%AE%BE%E7%BD%AEAndroidavd/</id>
    <published>2024-09-27T14:31:47.000Z</published>
    <updated>2024-09-27T14:32:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://cdn.jsdelivr.net/gh/runwu2204/Blog_imgs/202409272231493.png"                      alt="image-20240927223154345"                ></p><p>环境变量中添加这几个键值用于限定android工具链位置</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img  
                     lazyload
                     src=&quot;/images/loading.svg&quot;
                     data-src=&quot;https://cdn.jsdelivr.n</summary>
      
    
    
    
    <category term="开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/"/>
    
    <category term="安卓开发" scheme="http://example.com/categories/%E5%BC%80%E5%8F%91/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>常见保护措施</title>
    <link href="http://example.com/2024/09/19/Pwn/linux/%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/%E5%B8%B8%E8%A7%81%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/"/>
    <id>http://example.com/2024/09/19/Pwn/linux/%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/%E5%B8%B8%E8%A7%81%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/</id>
    <published>2024-09-18T18:04:52.000Z</published>
    <updated>2024-09-18T18:20:18.000Z</updated>
    
    <content type="html"><![CDATA[<p><a class="link"   href="https://blog.csdn.net/qq_44108455/article/details/104985351" >pwn学习—保护机制_pie enabled-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;https://blog.csdn.net/qq_44108455/article/details/104985351&quot; &gt;pwn学习—保护机制_pie enabled-CSDN博客 &lt;i class=&quot;fa-regular </summary>
      
    
    
    
    <category term="Pwn" scheme="http://example.com/categories/Pwn/"/>
    
    <category term="linux" scheme="http://example.com/categories/Pwn/linux/"/>
    
    <category term="保护措施" scheme="http://example.com/categories/Pwn/linux/%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/"/>
    
    
  </entry>
  
</feed>
